Project Path: arc_gmh5225_Bad-BugCheck-Old_zgk6_k1r

Source Tree:

```txt
arc_gmh5225_Bad-BugCheck-Old_zgk6_k1r
├── BOOTVID.lib
├── Bad BugCheck ! !
│   ├── Bad BugCheck ! !.vcxproj
│   ├── Bad BugCheck ! !.vcxproj.filters
│   ├── BadBugCheck!!.inf
│   ├── bootvid.h
│   ├── driver.c
│   ├── fileio.c
│   ├── fileio.h
│   ├── vga.c
│   └── vga.h
├── Bad BugCheck ! !.sln
└── README.md

```

`Bad BugCheck ! !.sln`:

```sln

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 16
VisualStudioVersion = 16.0.31410.357
MinimumVisualStudioVersion = 10.0.40219.1
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "Bad BugCheck ! !", "Bad BugCheck ! !\Bad BugCheck ! !.vcxproj", "{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|ARM = Debug|ARM
		Debug|ARM64 = Debug|ARM64
		Debug|x64 = Debug|x64
		Debug|x86 = Debug|x86
		Release|ARM = Release|ARM
		Release|ARM64 = Release|ARM64
		Release|x64 = Release|x64
		Release|x86 = Release|x86
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Debug|ARM.ActiveCfg = Debug|ARM
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Debug|ARM.Build.0 = Debug|ARM
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Debug|ARM.Deploy.0 = Debug|ARM
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Debug|ARM64.ActiveCfg = Debug|ARM64
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Debug|ARM64.Build.0 = Debug|ARM64
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Debug|ARM64.Deploy.0 = Debug|ARM64
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Debug|x64.ActiveCfg = Debug|x64
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Debug|x64.Build.0 = Debug|x64
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Debug|x64.Deploy.0 = Debug|x64
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Debug|x86.ActiveCfg = Debug|Win32
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Debug|x86.Build.0 = Debug|Win32
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Debug|x86.Deploy.0 = Debug|Win32
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Release|ARM.ActiveCfg = Release|ARM
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Release|ARM.Build.0 = Release|ARM
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Release|ARM.Deploy.0 = Release|ARM
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Release|ARM64.ActiveCfg = Release|ARM64
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Release|ARM64.Build.0 = Release|ARM64
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Release|ARM64.Deploy.0 = Release|ARM64
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Release|x64.ActiveCfg = Release|x64
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Release|x64.Build.0 = Release|x64
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Release|x64.Deploy.0 = Release|x64
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Release|x86.ActiveCfg = Release|Win32
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Release|x86.Build.0 = Release|Win32
		{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}.Release|x86.Deploy.0 = Release|Win32
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {23096B1A-ACD3-4308-9495-85B570CD56A1}
	EndGlobalSection
EndGlobal

```

`Bad BugCheck ! !/Bad BugCheck ! !.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="12.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM">
      <Configuration>Debug</Configuration>
      <Platform>ARM</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM">
      <Configuration>Release</Configuration>
      <Platform>ARM</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM64">
      <Configuration>Debug</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM64">
      <Configuration>Release</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <ProjectGuid>{3CE6E33B-4FE4-4F57-9B2D-D4AD77E0800F}</ProjectGuid>
    <TemplateGuid>{1bc93793-694f-48fe-9372-81e2b05556fd}</TemplateGuid>
    <TargetFrameworkVersion>v4.5</TargetFrameworkVersion>
    <MinimumVisualStudioVersion>12.0</MinimumVisualStudioVersion>
    <Configuration>Debug</Configuration>
    <Platform Condition="'$(Platform)' == ''">Win32</Platform>
    <RootNamespace>Bad_BugCheck____</RootNamespace>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <TargetVersion>
    </TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Desktop</DriverTargetPlatform>
    <Driver_SpectreMitigation>false</Driver_SpectreMitigation>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <TargetVersion>
    </TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Desktop</DriverTargetPlatform>
    <Driver_SpectreMitigation>false</Driver_SpectreMitigation>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="PropertySheets">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <ClCompile>
      <WarningLevel>Level1</WarningLevel>
    </ClCompile>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <ClCompile>
      <TreatWarningAsError>false</TreatWarningAsError>
    </ClCompile>
    <Link>
      <AdditionalDependencies>$(SolutionDir)BOOTVID.lib;%(AdditionalDependencies)</AdditionalDependencies>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <WarningLevel>Level1</WarningLevel>
    </ClCompile>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <TreatWarningAsError>false</TreatWarningAsError>
    </ClCompile>
    <Link>
      <AdditionalDependencies>$(SolutionDir)BOOTVID.lib;%(AdditionalDependencies)</AdditionalDependencies>
    </Link>
  </ItemDefinitionGroup>
  <ItemGroup>
    <Inf Include="BadBugCheck!!.inf" />
  </ItemGroup>
  <ItemGroup>
    <FilesToPackage Include="$(TargetPath)" />
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="driver.c" />
    <ClCompile Include="fileio.c" />
    <ClCompile Include="vga.c" />
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="bootvid.h" />
    <ClInclude Include="fileio.h" />
    <ClInclude Include="vga.h" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`Bad BugCheck ! !/Bad BugCheck ! !.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="Source Files">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="Header Files">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hpp;hxx;hm;inl;inc;xsd</Extensions>
    </Filter>
    <Filter Include="Resource Files">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
    <Filter Include="Driver Files">
      <UniqueIdentifier>{8E41214B-6785-4CFE-B992-037D68949A14}</UniqueIdentifier>
      <Extensions>inf;inv;inx;mof;mc;</Extensions>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <Inf Include="BadBugCheck!!.inf">
      <Filter>Driver Files</Filter>
    </Inf>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="driver.c">
      <Filter>Source Files</Filter>
    </ClCompile>
    <ClCompile Include="vga.c">
      <Filter>Source Files</Filter>
    </ClCompile>
    <ClCompile Include="fileio.c">
      <Filter>Source Files</Filter>
    </ClCompile>
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="bootvid.h">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="vga.h">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="fileio.h">
      <Filter>Header Files</Filter>
    </ClInclude>
  </ItemGroup>
</Project>
```

`Bad BugCheck ! !/BadBugCheck!!.inf`:

```inf
;
; BadBugCheck!!.inf
;

[Version]
Signature="$WINDOWS NT$"
Class=Sample ; TODO: edit Class
ClassGuid={78A1C341-4539-11d3-B88D-00C04FAD5171} ; TODO: edit ClassGuid
Provider=%ManufacturerName%
CatalogFile=BadBugCheck!!.cat
DriverVer= ; TODO: set DriverVer in stampinf property pages
PnpLockDown=1

[DestinationDirs]
DefaultDestDir = 12
BadBugCheck!!_Device_CoInstaller_CopyFiles = 11

; ================= Class section =====================

[ClassInstall32]
Addreg=SampleClassReg

[SampleClassReg]
HKR,,,0,%ClassName%
HKR,,Icon,,-5

[SourceDisksNames]
1 = %DiskName%,,,""

[SourceDisksFiles]
BadBugCheck!!.sys  = 1,,
WdfCoInstaller$KMDFCOINSTALLERVERSION$.dll=1 ; make sure the number matches with SourceDisksNames

;*****************************************
; Install Section
;*****************************************

[Manufacturer]
%ManufacturerName%=Standard,NT$ARCH$

[Standard.NT$ARCH$]
%BadBugCheck!!.DeviceDesc%=BadBugCheck!!_Device, Root\BadBugCheck!! ; TODO: edit hw-id

[BadBugCheck!!_Device.NT]
CopyFiles=Drivers_Dir

[Drivers_Dir]
BadBugCheck!!.sys

;-------------- Service installation
[BadBugCheck!!_Device.NT.Services]
AddService = BadBugCheck!!,%SPSVCINST_ASSOCSERVICE%, BadBugCheck!!_Service_Inst

; -------------- BadBugCheck!! driver install sections
[BadBugCheck!!_Service_Inst]
DisplayName    = %BadBugCheck!!.SVCDESC%
ServiceType    = 1               ; SERVICE_KERNEL_DRIVER
StartType      = 3               ; SERVICE_DEMAND_START
ErrorControl   = 1               ; SERVICE_ERROR_NORMAL
ServiceBinary  = %12%\BadBugCheck!!.sys

;
;--- BadBugCheck!!_Device Coinstaller installation ------
;

[BadBugCheck!!_Device.NT.CoInstallers]
AddReg=BadBugCheck!!_Device_CoInstaller_AddReg
CopyFiles=BadBugCheck!!_Device_CoInstaller_CopyFiles

[BadBugCheck!!_Device_CoInstaller_AddReg]
HKR,,CoInstallers32,0x00010000, "WdfCoInstaller$KMDFCOINSTALLERVERSION$.dll,WdfCoInstaller"

[BadBugCheck!!_Device_CoInstaller_CopyFiles]
WdfCoInstaller$KMDFCOINSTALLERVERSION$.dll

[BadBugCheck!!_Device.NT.Wdf]
KmdfService =  BadBugCheck!!, BadBugCheck!!_wdfsect
[BadBugCheck!!_wdfsect]
KmdfLibraryVersion = $KMDFVERSION$

[Strings]
SPSVCINST_ASSOCSERVICE= 0x00000002
ManufacturerName="<Your manufacturer name>" ;TODO: Replace with your manufacturer name
ClassName="Samples" ; TODO: edit ClassName
DiskName = "BadBugCheck!! Installation Disk"
BadBugCheck!!.DeviceDesc = "BadBugCheck!! Device"
BadBugCheck!!.SVCDESC = "BadBugCheck!! Service"

```

`Bad BugCheck ! !/bootvid.h`:

```h
#ifndef BOOTVID_H
#define BOOTVID_H

#include <wdm.h>

#define BV_COLOR_BLACK          0
#define BV_COLOR_RED            1
#define BV_COLOR_GREEN          2
#define BV_COLOR_BROWN          3
#define BV_COLOR_BLUE           4
#define BV_COLOR_MAGENTA        5
#define BV_COLOR_CYAN           6
#define BV_COLOR_DARK_GRAY      7
#define BV_COLOR_LIGHT_GRAY     8
#define BV_COLOR_LIGHT_RED      9
#define BV_COLOR_LIGHT_GREEN    10
#define BV_COLOR_YELLOW         11
#define BV_COLOR_LIGHT_BLUE     12
#define BV_COLOR_LIGHT_MAGENTA  13
#define BV_COLOR_LIGHT_CYAN     14
#define BV_COLOR_WHITE          15
#define BV_COLOR_NONE           16
#define BV_MAX_COLORS           16

NTKERNELAPI BOOLEAN VidInitialize(BOOLEAN SetMode);
NTKERNELAPI VOID  	VidResetDisplay(BOOLEAN HalReset);
NTKERNELAPI ULONG   VidSetTextColor(ULONG Color);
NTKERNELAPI VOID  	VidDisplayStringXY(PUCHAR String, ULONG Left, ULONG Top, BOOLEAN Transparent);
NTKERNELAPI VOID  	VidSetScrollRegion(ULONG Left, ULONG Top, ULONG Right, ULONG Bottom);
NTKERNELAPI VOID  	VidCleanUp(VOID);
NTKERNELAPI VOID  	VidBufferToScreenBlt(PUCHAR Buffer, ULONG Left, ULONG Top, ULONG Width, ULONG Height, ULONG Delta);
NTKERNELAPI VOID  	VidDisplayString(PUCHAR String);
NTKERNELAPI ULONG   VidBitBlt(PVOID pbuff, ULONG x, ULONG y);
NTKERNELAPI VOID  	VidScreenToBufferBlt(PUCHAR Buffer, ULONG Left, ULONG Top, ULONG Width, ULONG Height, ULONG Delta);
NTKERNELAPI VOID  	VidSolidColorFill(ULONG Left, ULONG Top, ULONG Right, ULONG Bottom, UCHAR Color);

#endif // !BOOTVID_H
```

`Bad BugCheck ! !/driver.c`:

```c
#define _NO_CRT_STDIO_INLINE
#include <wdm.h>
#include <ntddk.h>
#include <ntstrsafe.h>
#include "bootvid.h"
#include "vga.h"
#include "fileio.h"

#define DELAY_ONE_MICROSECOND 	(-10)
#define DELAY_ONE_MILLISECOND	(DELAY_ONE_MICROSECOND*1000)
#define DELAY_SECOND (DELAY_ONE_MILLISECOND * 1000)


void DriverUnload(PDRIVER_OBJECT DriverObject) {
    UNREFERENCED_PARAMETER(DriverObject);
}

NTSTATUS DriverEntry(PDRIVER_OBJECT DriverObject) {
    
	ULONG Mode;
	NTSTATUS Status;
	LARGE_INTEGER Interval;
	Status = VgaGetMode(&Mode);

	if (((NTSTATUS)(Status)) >= 0) {
		VidInitialize(TRUE);
		VidResetDisplay(TRUE);
		VidSolidColorFill(0, 0, 639, 479, BV_COLOR_RED);
		VidSetTextColor(BV_COLOR_WHITE);
		unsigned char* rawData;
		WCHAR string[256];
		for (INT i = 0; i < 4367; i++) {
			rawData = ExAllocatePoolZero(NonPagedPool, 153718, 'SEX2');
			RtlStringCbPrintfExW(string, 256, NULL, NULL, STRSAFE_NO_TRUNCATION, L"\\DosDevices\\C:\\out_bootvid\\%d.bmp", i);
			ReadFile(string, rawData, 153718, 0);
			VidBitBlt(&rawData[0xe], 0, 0);
			ExFreePool(rawData);
			Interval.QuadPart = DELAY_ONE_MILLISECOND;
			KeDelayExecutionThread(KernelMode, FALSE, &Interval);
		}
		Interval.QuadPart = DELAY_SECOND * 2;
		KeDelayExecutionThread(KernelMode, FALSE, &Interval);
		VgaSetMode(Mode);
		KeBugCheckEx(0xbadadd7e, NULL, NULL, NULL, NULL);
	}

	DriverObject->DriverUnload = DriverUnload;
    return STATUS_SUCCESS;
}
```

`Bad BugCheck ! !/fileio.c`:

```c
#include "fileio.h"

VOID ReadFile(PCWSTR path, PVOID buffer, ULONG len, INT offset) {
	UNICODE_STRING uniName;
	OBJECT_ATTRIBUTES objAttr;

	RtlInitUnicodeString(&uniName, path);
	InitializeObjectAttributes(&objAttr, &uniName, OBJ_CASE_INSENSITIVE | OBJ_KERNEL_HANDLE, NULL, NULL);

	HANDLE handle;
	NTSTATUS status;
	IO_STATUS_BLOCK ioStatusBlock;

	if (KeGetCurrentIrql() != PASSIVE_LEVEL)
		return;

	status = ZwCreateFile(&handle, GENERIC_READ, &objAttr, &ioStatusBlock, NULL, FILE_ATTRIBUTE_NORMAL, 0, FILE_OPEN, FILE_SYNCHRONOUS_IO_NONALERT, NULL, 0);
	LARGE_INTEGER      byteOffset;

	if (((NTSTATUS)(status)) >= 0) {
		byteOffset.LowPart = byteOffset.HighPart = offset;
		//try to read the file
		status = ZwReadFile(handle, NULL, NULL, NULL, &ioStatusBlock, buffer, len, &byteOffset, NULL);
		ZwClose(handle);
	}
}
```

`Bad BugCheck ! !/fileio.h`:

```h
#ifndef  FILEIO_H
#define	 FILEIO_H

#include <wdm.h>

VOID ReadFile(PCWSTR path, PVOID buffer, ULONG len, INT offset);

#endif // ! FILEIO_H
```

`Bad BugCheck ! !/vga.c`:

```c
#include "vga.h"

NTSTATUS VgaGetMode(ULONG* pMode) {
    BOOLEAN b;
    NTSTATUS Status;
    struct X86_BIOS_REGISTERS Registers;

    memset(&Registers, 0, sizeof(Registers));

    Registers.Eax = 0x4F03;

    b = x86BiosCall(0x10, &Registers);

    if ((b) && (Registers.Eax == 0x4F)) {
        *pMode = Registers.Ebx;
        Status = STATUS_SUCCESS;
    }
    else Status = STATUS_UNSUCCESSFUL;

    return Status;
}

NTSTATUS VgaSetMode(ULONG Mode) {
    BOOLEAN b;
    NTSTATUS Status;
    struct X86_BIOS_REGISTERS Registers;

    memset(&Registers, 0, sizeof(Registers));

    Registers.Eax = 0x4F02;
    Registers.Ebx = 0x4000 | Mode;

    b = x86BiosCall(0x10, &Registers);

    if ((b) && (Registers.Eax == 0x4F)) {
        Status = STATUS_SUCCESS;
    }
    else Status = STATUS_UNSUCCESSFUL;

    return Status;
}

```

`Bad BugCheck ! !/vga.h`:

```h
#ifndef VGA_H
#define VGA_H

#include <wdm.h>

struct X86_BIOS_REGISTERS {
    ULONG Eax;
    ULONG Ecx;
    ULONG Edx;
    ULONG Ebx;
    ULONG Ebp;
    ULONG Esi;
    ULONG Edi;
    USHORT SegDs;
    USHORT SegEs;
};

NTKERNELAPI BOOLEAN x86BiosCall(ULONG InterruptNumber, struct X86_BIOS_REGISTERS* pRegisters);
NTSTATUS VgaGetMode(ULONG* pMode);
NTSTATUS VgaSetMode(ULONG Mode);


#endif // !VGA_H

```

`README.md`:

```md
# Bad-BugCheck-
Bad Apple but its BSOD [Bootvid]

# How does it work???
The driver uses bootvid's ```VidBitBlt``` function to display each frame and in the end it BugChecks. Bootvid is also used by the BSOD for displaying on the screen.
However as it was only made for displaying the BSOD, Bootscreen it flickers alot and is very slow while displaying the bmps quickly

# NOTE
This driver has only been tested on VMware and I had several issues of the graphics driver interfering and the system BugChecking alot.
Incase you want to try it yourself. Get a copy of Windows 10/11 Insider and install it in VMware and disable the graphics driver using `devmgmt.msc`

```