Project Path: arc_gmh5225_kernel-csgo_z730t9jy

Source Tree:

```txt
arc_gmh5225_kernel-csgo_z730t9jy
├── README.md
├── kernel-csgo
│   ├── definitions.hpp
│   ├── dispatch.cpp
│   ├── dispatch.hpp
│   ├── driver.cpp
│   ├── helper.cpp
│   ├── helper.hpp
│   ├── hook.cpp
│   ├── hook.hpp
│   ├── kernel-csgo.inf
│   ├── kernel-csgo.vcxproj
│   ├── kernel-csgo.vcxproj.filters
│   ├── memory.cpp
│   ├── memory.hpp
│   ├── ntapi.hpp
│   └── ntstructs.hpp
├── kernel-csgo-usermode
│   ├── Source.cpp
│   ├── cheat.cpp
│   ├── cheat.hpp
│   ├── definitions.hpp
│   ├── driver_control.cpp
│   ├── driver_control.hpp
│   ├── hook.cpp
│   ├── hook.hpp
│   ├── kernel-csgo-usermode.vcxproj
│   ├── kernel-csgo-usermode.vcxproj.filters
│   ├── memory.cpp
│   ├── memory.hpp
│   └── offsets.hpp
└── kernel-csgo.sln

```

`README.md`:

```md
# kernel-csgo

#### Simple kernel cheat with hook for communication

![kernel-csgo-usermode.exe](https://imgur.com/8GdCwR9.png)

## How to use
- download and compile in Visual Studio 2019 (with driver dev kit)
- manual map the kernel-csgo.sys driver using [kdmapper](https://github.com/TheCruZ/kdmapper-1803-2004)
- run Counter-Strike: Global Offensive
- run kernel-csgo-usermode.exe and enjoy :)

## Features
- hooks a function for communication
- get_module_base / read_memory / write_memory all inside the driver
- implemented a basic triggerbot for PoC (mouse_event)
- easy to add other cheat features

## Make it safer by
- doing dynamic function imports
- encrypting strings
- changing the hook function
- not using kdmapper but making your own mapper
- not using mouse_event() haha

```

`kernel-csgo-usermode/Source.cpp`:

```cpp
#include "cheat.hpp"

int main()
{
	printf("[kernel-csgo]: Loading necessary modules...\n");
	LoadLibraryA("user32.dll");
	LoadLibraryA("win32u.dll");
	if (GetModuleHandleA("win32u.dll"))
	{
		printf("[kernel-csgo]: Modules loaded\n");
		cheat::run();
	}
	else
	{
		printf("[kernel-csgo]: Modules failed to load, quitting\n");
	}

	return 0;
}
```

`kernel-csgo-usermode/cheat.cpp`:

```cpp
#include "cheat.hpp"

void cheat::run()
{
	printf("[kernel-csgo]: Looking for csgo.exe process...\n");
	ULONG process_id = memory::get_process_id_by_name("csgo.exe");
	if (process_id)
	{
		printf("[kernel-csgo]: Process identifier found: %d\n", process_id);
		printf("[kernel-csgo]: Looking for client.dll...\n");
		ULONG client_base = driver_control::get_client_base(process_id);
		if (client_base)
		{
			printf("[kernel-csgo]: client.dll found: 0x%x\n", client_base);
			printf("[kernel-csgo]: Running...\n");

			for (;;)
			{
				ULONG my_player = driver_control::read_memory<ULONG>(process_id, client_base + m_dwLocalPlayer);
				if (my_player <= 0) { continue; }

				ULONG my_team = driver_control::read_memory<ULONG>(process_id, my_player + m_iTeamNum);
				ULONG my_cross = driver_control::read_memory<ULONG>(process_id, my_player + m_iCrossHairID);

				if (my_cross >= 1 && my_cross <= 64)
				{
					ULONG entity = driver_control::read_memory<ULONG>(process_id, client_base + m_dwEntityList + ((my_cross - 1) * 0x10));
					if (entity <= 0) { continue; }

					ULONG entity_health = driver_control::read_memory<ULONG>(process_id, entity + m_iHealth);
					ULONG entity_team = driver_control::read_memory<ULONG>(process_id, entity + m_iTeamNum);

					if (entity_health > 0 && entity_team != my_team && entity_team > 1)
					{
						Sleep(3);
						mouse_event(MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0);
						Sleep(1);
						mouse_event(MOUSEEVENTF_LEFTUP, 0, 0, 0, 0);
					}
				}
				Sleep(1);
			}
		}
		else
		{
			printf("[kernel-csgo]: Failed to obtain client.dll\n");
		}
	}
	else
	{
		printf("[kernel-csgo]: Failed to find csgo.exe process\n");
	}
}

```

`kernel-csgo-usermode/cheat.hpp`:

```hpp
#pragma once

#include "driver_control.hpp"
#include "offsets.hpp"

namespace cheat
{
	void run();
}
```

`kernel-csgo-usermode/definitions.hpp`:

```hpp
#pragma once

#include <Windows.h>
#include <iostream>

#define CODE_CLIENT_REQUEST 0x1
#define CODE_READ_MEMORY 0x2
#define CODE_WRITE_MEMORY 0x3

typedef struct _INFO_STRUCT
{
	ULONG code;
	ULONG process_id;
	ULONG client_base;
	ULONG address;
	ULONG buffer;
	ULONG size;
}INFO_STRUCT, * PINFO_STRUCT;
```

`kernel-csgo-usermode/driver_control.cpp`:

```cpp
#include "driver_control.hpp"

ULONG driver_control::get_client_base(ULONG process_id)
{
    INFO_STRUCT info = { 0 };
    info.code = CODE_CLIENT_REQUEST;
    info.process_id = process_id;

    hook::call_hook(&info);

    return info.client_base;
}

```

`kernel-csgo-usermode/driver_control.hpp`:

```hpp
#pragma once

#include "memory.hpp"

namespace driver_control
{
	ULONG get_client_base(ULONG process_id);

	template<typename t>
	t read_memory(ULONG process_id, ULONG address);

	template<typename t>
	void write_memory(ULONG process_id, ULONG address, t buffer);

	template<typename t>
	t read_memory(ULONG process_id, ULONG address)
	{
		INFO_STRUCT info = { 0 };
		info.code = CODE_READ_MEMORY;
		info.process_id = process_id;
		info.address = address;
		info.size = sizeof(t);

		hook::call_hook(&info);

		return *(t*)&info.buffer;
	}

	template<typename t>
	void write_memory(ULONG process_id, ULONG address, t buffer)
	{
		INFO_STRUCT info = { 0 };
		info.code = CODE_WRITE_MEMORY;
		info.process_id = process_id;
		info.address = address;
		info.buffer = buffer;
		info.size = sizeof(t);

		hook::call_hook(&info);
	}
}



```

`kernel-csgo-usermode/hook.cpp`:

```cpp
#include "hook.hpp"

void hook::call_hook(void* info_struct)
{
	void* hooked_fn = GetProcAddress(GetModuleHandleA("win32u.dll"), "NtQueryCompositionSurfaceStatistics");

	auto fn = static_cast<void(_stdcall*)(void*)>(hooked_fn);

	fn(info_struct);
}

```

`kernel-csgo-usermode/hook.hpp`:

```hpp
#pragma once

#include "definitions.hpp"

namespace hook
{
	void call_hook(void* info_struct);
}
```

`kernel-csgo-usermode/kernel-csgo-usermode.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <VCProjectVersion>16.0</VCProjectVersion>
    <Keyword>Win32Proj</Keyword>
    <ProjectGuid>{d5447991-b611-4256-a954-cd661767313a}</ProjectGuid>
    <RootNamespace>kernelcsgousermode</RootNamespace>
    <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v142</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v142</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v142</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v142</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>MultiByte</CharacterSet>
    <SpectreMitigation>false</SpectreMitigation>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="Shared">
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <LinkIncremental>true</LinkIncremental>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <LinkIncremental>false</LinkIncremental>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <LinkIncremental>true</LinkIncremental>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <LinkIncremental>false</LinkIncremental>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
      <DebugInformationFormat>None</DebugInformationFormat>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <GenerateDebugInformation>false</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemGroup>
    <ClInclude Include="cheat.hpp" />
    <ClInclude Include="definitions.hpp" />
    <ClInclude Include="driver_control.hpp" />
    <ClInclude Include="hook.hpp" />
    <ClInclude Include="memory.hpp" />
    <ClInclude Include="offsets.hpp" />
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="cheat.cpp" />
    <ClCompile Include="driver_control.cpp" />
    <ClCompile Include="hook.cpp" />
    <ClCompile Include="memory.cpp" />
    <ClCompile Include="Source.cpp" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`kernel-csgo-usermode/kernel-csgo-usermode.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="Source Files">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;c++;cppm;ixx;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="Header Files">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hh;hpp;hxx;h++;hm;inl;inc;ipp;xsd</Extensions>
    </Filter>
    <Filter Include="Resource Files">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="cheat.hpp">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="definitions.hpp">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="driver_control.hpp">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="hook.hpp">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="memory.hpp">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="offsets.hpp">
      <Filter>Header Files</Filter>
    </ClInclude>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="cheat.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
    <ClCompile Include="driver_control.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
    <ClCompile Include="hook.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
    <ClCompile Include="memory.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
    <ClCompile Include="Source.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
  </ItemGroup>
</Project>
```

`kernel-csgo-usermode/memory.cpp`:

```cpp
#include "memory.hpp"

ULONG memory::get_process_id_by_name(const char* process_name)
{
	ULONG process_id = 0;
	HANDLE ss = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, NULL);
	if (ss)
	{
		PROCESSENTRY32 pe;
		pe.dwSize = sizeof(PROCESSENTRY32);
		if (Process32First(ss, &pe))
		{
			do
			{
				if (!strcmp(pe.szExeFile, process_name))
				{
					process_id = pe.th32ProcessID;
					break;
				}
			} while (Process32Next(ss, &pe));
		}
		CloseHandle(ss);
	}
	return process_id;
}

```

`kernel-csgo-usermode/memory.hpp`:

```hpp
#pragma once

#include "hook.hpp"
#include <TlHelp32.h>

namespace memory
{
	ULONG get_process_id_by_name(const char* process_name);
}
```

`kernel-csgo-usermode/offsets.hpp`:

```hpp
#pragma once

// CSGO offsets and netvars
// 19.08.2020. 20:34:30

#define m_dwEpochTime 1597862070

#define m_dwLocalPlayer 0xD3FC5C
#define m_dwEntityList 0x4D5450C
#define m_dwClientState 0x589DD4
#define m_dwPlayerResource 0x3183DF0
#define m_dwForceAttack 0x3185AA0
#define m_dwForceAlt1 0x51FE268
#define m_dwForceJump 0x51FE22C
#define m_dwSensitivity 0xD4569C
#define m_dwGlowObject 0x529C3D0

#define m_iCrossHairID 0xB3E4
#define m_bHasDefuser 0xB388
#define m_iGlowIndex 0xA438
#define m_flFlashDuration 0xA420
#define m_iShotsFired 0xA390
#define m_dwPlayerInfo 0x52B8
#define m_dwViewAngles 0x4D88
#define m_bIsScoped 0x3928
#define m_vecPunch 0x302C
#define m_dwButtonBits 0x2717
#define m_dwBoneMatrix 0x26A8
#define m_iPlayerC4 0x165C
#define m_bSpotted 0x93D

#define m_hViewModel 0x32F8
#define m_iViewModelIndex 0x3240
#define m_flFallbackWear 0x31D0
#define m_nFallbackPaintKit 0x31C8
#define m_iItemIDHigh 0x2FC0
#define m_iEntityQuality 0x2FAC
#define m_iItemDefinitionIndex 0x2FAA
#define m_hActiveWeapon 0x2EF8
#define m_hMyWeapons 0x2DF8
#define m_nModelIndex 0x258

#define m_szMapName 0x28C
#define m_szMapPath 0x188
#define m_iLocalPlayer 0x180
#define m_dwInGame 0x108

#define m_vecOrigin 0x138
#define m_angRotation 0x12C
#define m_vecViewOffset 0x108
#define m_fFlags 0x104
#define m_iHealth 0x100
#define m_iTeamNum 0xF4
#define m_bDormant 0xED
```

`kernel-csgo.sln`:

```sln

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 16
VisualStudioVersion = 16.0.30406.217
MinimumVisualStudioVersion = 10.0.40219.1
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "kernel-csgo", "kernel-csgo\kernel-csgo.vcxproj", "{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}"
EndProject
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "kernel-csgo-usermode", "kernel-csgo-usermode\kernel-csgo-usermode.vcxproj", "{D5447991-B611-4256-A954-CD661767313A}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|ARM = Debug|ARM
		Debug|ARM64 = Debug|ARM64
		Debug|x64 = Debug|x64
		Debug|x86 = Debug|x86
		Release|ARM = Release|ARM
		Release|ARM64 = Release|ARM64
		Release|x64 = Release|x64
		Release|x86 = Release|x86
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Debug|ARM.ActiveCfg = Debug|ARM
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Debug|ARM.Build.0 = Debug|ARM
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Debug|ARM.Deploy.0 = Debug|ARM
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Debug|ARM64.ActiveCfg = Debug|ARM64
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Debug|ARM64.Build.0 = Debug|ARM64
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Debug|ARM64.Deploy.0 = Debug|ARM64
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Debug|x64.ActiveCfg = Debug|x64
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Debug|x64.Build.0 = Debug|x64
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Debug|x64.Deploy.0 = Debug|x64
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Debug|x86.ActiveCfg = Debug|Win32
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Debug|x86.Build.0 = Debug|Win32
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Debug|x86.Deploy.0 = Debug|Win32
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Release|ARM.ActiveCfg = Release|ARM
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Release|ARM.Build.0 = Release|ARM
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Release|ARM.Deploy.0 = Release|ARM
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Release|ARM64.ActiveCfg = Release|ARM64
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Release|ARM64.Build.0 = Release|ARM64
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Release|ARM64.Deploy.0 = Release|ARM64
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Release|x64.ActiveCfg = Release|x64
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Release|x64.Build.0 = Release|x64
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Release|x64.Deploy.0 = Release|x64
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Release|x86.ActiveCfg = Release|Win32
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Release|x86.Build.0 = Release|Win32
		{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}.Release|x86.Deploy.0 = Release|Win32
		{D5447991-B611-4256-A954-CD661767313A}.Debug|ARM.ActiveCfg = Debug|Win32
		{D5447991-B611-4256-A954-CD661767313A}.Debug|ARM64.ActiveCfg = Debug|Win32
		{D5447991-B611-4256-A954-CD661767313A}.Debug|x64.ActiveCfg = Debug|x64
		{D5447991-B611-4256-A954-CD661767313A}.Debug|x64.Build.0 = Debug|x64
		{D5447991-B611-4256-A954-CD661767313A}.Debug|x86.ActiveCfg = Debug|Win32
		{D5447991-B611-4256-A954-CD661767313A}.Debug|x86.Build.0 = Debug|Win32
		{D5447991-B611-4256-A954-CD661767313A}.Release|ARM.ActiveCfg = Release|Win32
		{D5447991-B611-4256-A954-CD661767313A}.Release|ARM64.ActiveCfg = Release|Win32
		{D5447991-B611-4256-A954-CD661767313A}.Release|x64.ActiveCfg = Release|x64
		{D5447991-B611-4256-A954-CD661767313A}.Release|x64.Build.0 = Release|x64
		{D5447991-B611-4256-A954-CD661767313A}.Release|x86.ActiveCfg = Release|Win32
		{D5447991-B611-4256-A954-CD661767313A}.Release|x86.Build.0 = Release|Win32
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {312E91B3-C75C-45BF-8D20-35134112A5AC}
	EndGlobalSection
EndGlobal

```

`kernel-csgo/definitions.hpp`:

```hpp
#pragma once

#include "ntapi.hpp"

#define CODE_CLIENT_REQUEST 0x1
#define CODE_READ_MEMORY 0x2
#define CODE_WRITE_MEMORY 0x3

typedef struct _INFO_STRUCT
{
	ULONG code;
	ULONG process_id;
	ULONG client_base;
	ULONG address;
	ULONG buffer;
	ULONG size;
}INFO_STRUCT, * PINFO_STRUCT;
```

`kernel-csgo/dispatch.cpp`:

```cpp
#include "dispatch.hpp"

void dispatch::handler(void* info_struct)
{
	PINFO_STRUCT info = (PINFO_STRUCT)info_struct;

	if (info->code == CODE_CLIENT_REQUEST)
	{
		PEPROCESS target_process = NULL;
		if (NT_SUCCESS(PsLookupProcessByProcessId((HANDLE)info->process_id, &target_process)))
		{
			KAPC_STATE apc;
			KeStackAttachProcess(target_process, &apc);
			ULONG b = memory::get_module_base(target_process, L"client.dll");
			KeUnstackDetachProcess(&apc);
			if (b) { info->client_base = b; }
		}
	}
	else if (info->code == CODE_READ_MEMORY)
	{
		PEPROCESS target_process = NULL;
		if (NT_SUCCESS(PsLookupProcessByProcessId((HANDLE)info->process_id, &target_process)))
		{
			memory::read_memory(target_process, (void*)info->address, &info->buffer, info->size);
		}
	}
	else if (info->code == CODE_WRITE_MEMORY)
	{
		PEPROCESS target_process = NULL;
		if (NT_SUCCESS(PsLookupProcessByProcessId((HANDLE)info->process_id, &target_process)))
		{
			memory::write_memory(target_process, &info->buffer, (void*)info->address, info->size);
		}
	}
}


```

`kernel-csgo/dispatch.hpp`:

```hpp
#pragma once

#include "memory.hpp"

namespace dispatch
{
	void handler(void* info_struct);
}
```

`kernel-csgo/driver.cpp`:

```cpp
#include "dispatch.hpp"

extern "C" NTSTATUS DriverEntry(PDRIVER_OBJECT driver_object, PUNICODE_STRING registry_path)
{
	UNREFERENCED_PARAMETER(driver_object);
	UNREFERENCED_PARAMETER(registry_path);
	hook::init_hook(&dispatch::handler);

	DbgPrintEx(0, 0, "[kernel-csgo]: Driver loaded\n");

	return STATUS_SUCCESS;
}
```

`kernel-csgo/helper.cpp`:

```cpp
#include "helper.hpp"

void* helper::get_sys_module(const char* module_name)
{
	void* module_base = 0;
	ULONG bytes = 0;
	NTSTATUS status = ZwQuerySystemInformation(SystemModuleInformation, NULL, bytes, &bytes);

	if (!bytes) { return NULL; }

	PRTL_PROCESS_MODULES modules = (PRTL_PROCESS_MODULES)ExAllocatePoolWithTag(NonPagedPool, bytes, 0x4e425151);

	status = ZwQuerySystemInformation(SystemModuleInformation, modules, bytes, &bytes);

	if (!NT_SUCCESS(status)) { return NULL; }

	PRTL_PROCESS_MODULE_INFORMATION module = modules->Modules;

	for (ULONG i = 0; i < modules->NumberOfModules; i++)
	{
		if (strcmp((char*)module[i].FullPathName, module_name) == 0)
		{
			module_base = module[i].ImageBase;
			break;
		}
	}

	if (modules) { ExFreePoolWithTag(modules, 0x4e425151); }

	if (module_base <= 0) { return NULL; }

	return module_base;
}

void* helper::get_sys_module_export(const char* module_name, const char* function_name)
{
	void* module = get_sys_module(module_name);

	if (!module) { return NULL; }

	return RtlFindExportedRoutineByName(module, function_name);
}

bool helper::wpm_safe(void* address, void* buffer, size_t size)
{
	PMDL mdl = IoAllocateMdl(address, size, FALSE, FALSE, NULL);
	if (!mdl) { return false; }

	MmProbeAndLockPages(mdl, KernelMode, IoReadAccess);
	void* map = MmMapLockedPagesSpecifyCache(mdl, KernelMode, MmNonCached, NULL, FALSE, NormalPagePriority);
	MmProtectMdlSystemAddress(mdl, PAGE_READWRITE);

	memcpy(map, buffer, size);

	MmUnmapLockedPages(map, mdl);
	MmUnlockPages(mdl);
	IoFreeMdl(mdl);

	return true;
}

```

`kernel-csgo/helper.hpp`:

```hpp
#pragma once

#include "definitions.hpp"

namespace helper
{
	void* get_sys_module(const char* module_name);

	void* get_sys_module_export(const char* module_name, const char* function_name);

	bool wpm_safe(void* address, void* buffer, size_t size);
}

```

`kernel-csgo/hook.cpp`:

```cpp
#include "hook.hpp"

bool hook::init_hook(void* kernel_address)
{
	if (!kernel_address) { return false; }

	void** function = reinterpret_cast<void**>(helper::get_sys_module_export("\\SystemRoot\\System32\\drivers\\dxgkrnl.sys", "NtQueryCompositionSurfaceStatistics"));
	if (!function) { return false; }

	unsigned char mov_rax[] = { 0x48, 0xB8 };
	unsigned char jmp_rax[] = { 0xFF, 0xE0 };

	unsigned char original_fn[] = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

	RtlSecureZeroMemory(&original_fn, sizeof(original_fn));
	memcpy((void*)((ULONG_PTR)original_fn), &mov_rax, sizeof(mov_rax));

	uintptr_t hook_address = reinterpret_cast<uintptr_t>(kernel_address);
	memcpy((void*)((ULONG_PTR)original_fn + sizeof(mov_rax)), &hook_address, sizeof(void*));
	memcpy((void*)((ULONG_PTR)original_fn + sizeof(mov_rax) + sizeof(void*)), &jmp_rax, sizeof(jmp_rax));

	helper::wpm_safe(function, &original_fn, sizeof(original_fn));
	
	return true;
}

```

`kernel-csgo/hook.hpp`:

```hpp
#pragma once

#include "helper.hpp"

namespace hook
{
	bool init_hook(void* kernel_address);
}

```

`kernel-csgo/kernel-csgo.inf`:

```inf
;
; kernel-csgo.inf
;

[Version]
Signature="$WINDOWS NT$"
Class=Sample ; TODO: edit Class
ClassGuid={78A1C341-4539-11d3-B88D-00C04FAD5171} ; TODO: edit ClassGuid
Provider=%ManufacturerName%
CatalogFile=kernel-csgo.cat
DriverVer= ; TODO: set DriverVer in stampinf property pages

[DestinationDirs]
DefaultDestDir = 12
kernel-csgo_Device_CoInstaller_CopyFiles = 11

; ================= Class section =====================

[ClassInstall32]
Addreg=SampleClassReg

[SampleClassReg]
HKR,,,0,%ClassName%
HKR,,Icon,,-5

[SourceDisksNames]
1 = %DiskName%,,,""

[SourceDisksFiles]
kernel-csgo.sys  = 1,,
WdfCoInstaller$KMDFCOINSTALLERVERSION$.dll=1 ; make sure the number matches with SourceDisksNames

;*****************************************
; Install Section
;*****************************************

[Manufacturer]
%ManufacturerName%=Standard,NT$ARCH$

[Standard.NT$ARCH$]
%kernel-csgo.DeviceDesc%=kernel-csgo_Device, Root\kernel-csgo ; TODO: edit hw-id

[kernel-csgo_Device.NT]
CopyFiles=Drivers_Dir

[Drivers_Dir]
kernel-csgo.sys

;-------------- Service installation
[kernel-csgo_Device.NT.Services]
AddService = kernel-csgo,%SPSVCINST_ASSOCSERVICE%, kernel-csgo_Service_Inst

; -------------- kernel-csgo driver install sections
[kernel-csgo_Service_Inst]
DisplayName    = %kernel-csgo.SVCDESC%
ServiceType    = 1               ; SERVICE_KERNEL_DRIVER
StartType      = 3               ; SERVICE_DEMAND_START
ErrorControl   = 1               ; SERVICE_ERROR_NORMAL
ServiceBinary  = %12%\kernel-csgo.sys

;
;--- kernel-csgo_Device Coinstaller installation ------
;

[kernel-csgo_Device.NT.CoInstallers]
AddReg=kernel-csgo_Device_CoInstaller_AddReg
CopyFiles=kernel-csgo_Device_CoInstaller_CopyFiles

[kernel-csgo_Device_CoInstaller_AddReg]
HKR,,CoInstallers32,0x00010000, "WdfCoInstaller$KMDFCOINSTALLERVERSION$.dll,WdfCoInstaller"

[kernel-csgo_Device_CoInstaller_CopyFiles]
WdfCoInstaller$KMDFCOINSTALLERVERSION$.dll

[kernel-csgo_Device.NT.Wdf]
KmdfService =  kernel-csgo, kernel-csgo_wdfsect
[kernel-csgo_wdfsect]
KmdfLibraryVersion = $KMDFVERSION$

[Strings]
SPSVCINST_ASSOCSERVICE= 0x00000002
ManufacturerName="<Your manufacturer name>" ;TODO: Replace with your manufacturer name
ClassName="Samples" ; TODO: edit ClassName
DiskName = "kernel-csgo Installation Disk"
kernel-csgo.DeviceDesc = "kernel-csgo Device"
kernel-csgo.SVCDESC = "kernel-csgo Service"

```

`kernel-csgo/kernel-csgo.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="12.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM">
      <Configuration>Debug</Configuration>
      <Platform>ARM</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM">
      <Configuration>Release</Configuration>
      <Platform>ARM</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM64">
      <Configuration>Debug</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM64">
      <Configuration>Release</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <ProjectGuid>{8A69696E-2C6D-42BD-85B3-82B0F4FD241E}</ProjectGuid>
    <TemplateGuid>{1bc93793-694f-48fe-9372-81e2b05556fd}</TemplateGuid>
    <TargetFrameworkVersion>v4.5</TargetFrameworkVersion>
    <MinimumVisualStudioVersion>12.0</MinimumVisualStudioVersion>
    <Configuration>Debug</Configuration>
    <Platform Condition="'$(Platform)' == ''">Win32</Platform>
    <RootNamespace>kernel_csgo</RootNamespace>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Desktop</DriverTargetPlatform>
    <SpectreMitigation>false</SpectreMitigation>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="PropertySheets">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
    <EnableInf2cat>false</EnableInf2cat>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <DebugInformationFormat>None</DebugInformationFormat>
      <BufferSecurityCheck>false</BufferSecurityCheck>
      <TreatWarningAsError>false</TreatWarningAsError>
    </ClCompile>
    <Link>
      <GenerateDebugInformation>false</GenerateDebugInformation>
      <EntryPointSymbol>DriverEntry</EntryPointSymbol>
    </Link>
  </ItemDefinitionGroup>
  <ItemGroup>
    <Inf Include="kernel-csgo.inf" />
  </ItemGroup>
  <ItemGroup>
    <FilesToPackage Include="$(TargetPath)" />
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="definitions.hpp" />
    <ClInclude Include="dispatch.hpp" />
    <ClInclude Include="helper.hpp" />
    <ClInclude Include="hook.hpp" />
    <ClInclude Include="memory.hpp" />
    <ClInclude Include="ntapi.hpp" />
    <ClInclude Include="ntstructs.hpp" />
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="dispatch.cpp" />
    <ClCompile Include="driver.cpp" />
    <ClCompile Include="helper.cpp" />
    <ClCompile Include="hook.cpp" />
    <ClCompile Include="memory.cpp" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`kernel-csgo/kernel-csgo.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="Source Files">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="Header Files">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hpp;hxx;hm;inl;inc;xsd</Extensions>
    </Filter>
    <Filter Include="Resource Files">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
    <Filter Include="Driver Files">
      <UniqueIdentifier>{8E41214B-6785-4CFE-B992-037D68949A14}</UniqueIdentifier>
      <Extensions>inf;inv;inx;mof;mc;</Extensions>
    </Filter>
    <Filter Include="Header Files\nt">
      <UniqueIdentifier>{18d7bc01-3e9c-4b86-b682-2a6330491da3}</UniqueIdentifier>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <Inf Include="kernel-csgo.inf">
      <Filter>Driver Files</Filter>
    </Inf>
  </ItemGroup>
  <ItemGroup>
    <ClInclude Include="ntapi.hpp">
      <Filter>Header Files\nt</Filter>
    </ClInclude>
    <ClInclude Include="ntstructs.hpp">
      <Filter>Header Files\nt</Filter>
    </ClInclude>
    <ClInclude Include="definitions.hpp">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="dispatch.hpp">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="helper.hpp">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="hook.hpp">
      <Filter>Header Files</Filter>
    </ClInclude>
    <ClInclude Include="memory.hpp">
      <Filter>Header Files</Filter>
    </ClInclude>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="dispatch.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
    <ClCompile Include="driver.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
    <ClCompile Include="helper.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
    <ClCompile Include="hook.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
    <ClCompile Include="memory.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
  </ItemGroup>
</Project>
```

`kernel-csgo/memory.cpp`:

```cpp
#include "memory.hpp"

ULONG memory::get_module_base(PEPROCESS process, LPCWSTR module_name)
{
	if (!process) { return 0; }

	__try
	{
		PPEB32 peb32 = (PPEB32)PsGetProcessWow64Process(process);
		if (!peb32 || !peb32->Ldr) { return 0; }

		for (PLIST_ENTRY32 plist_entry = (PLIST_ENTRY32)((PPEB_LDR_DATA32)peb32->Ldr)->InLoadOrderModuleList.Flink;
			plist_entry != &((PPEB_LDR_DATA32)peb32->Ldr)->InLoadOrderModuleList;
			plist_entry = (PLIST_ENTRY32)plist_entry->Flink)
		{
			PLDR_DATA_TABLE_ENTRY32 pentry = CONTAINING_RECORD(plist_entry, LDR_DATA_TABLE_ENTRY32, InLoadOrderLinks);

			if (wcscmp((PWCH)pentry->BaseDllName.Buffer, module_name) == 0)
			{
				return pentry->DllBase;
			}
		}
	}
	__except (EXCEPTION_EXECUTE_HANDLER)
	{

	}

	return 0;
}

NTSTATUS memory::read_memory(PEPROCESS target_process, void* source, void* target, size_t size)
{
	if (!target_process) { return STATUS_INVALID_PARAMETER; }

	size_t bytes = 0;
	NTSTATUS status = MmCopyVirtualMemory(target_process, source, IoGetCurrentProcess(), target, size, KernelMode, &bytes);
	if (!NT_SUCCESS(status) || !bytes)
	{
		return STATUS_INVALID_ADDRESS;
	}
	return status;
}

NTSTATUS memory::write_memory(PEPROCESS target_process, void* source, void* target, size_t size)
{
	if (!target_process) { return STATUS_INVALID_PARAMETER; }

	size_t bytes = 0;
	NTSTATUS status = MmCopyVirtualMemory(IoGetCurrentProcess(), source, target_process, target, size, KernelMode, &bytes);
	if (!NT_SUCCESS(status) || !bytes)
	{
		return STATUS_INVALID_ADDRESS;
	}
	return status;
}

```

`kernel-csgo/memory.hpp`:

```hpp
#pragma once

#include "hook.hpp"

namespace memory
{
	ULONG get_module_base(PEPROCESS process, LPCWSTR module_name);

	NTSTATUS read_memory(PEPROCESS target_process, void* source, void* target, size_t size);

	NTSTATUS write_memory(PEPROCESS target_process, void* source, void* target, size_t size);
}
```

`kernel-csgo/ntapi.hpp`:

```hpp
#pragma once

#include "ntstructs.hpp"

extern "C"
NTKERNELAPI
PVOID
NTAPI
RtlFindExportedRoutineByName(
	PVOID ImageBase,
	PCCH RoutineName
);

extern "C"
NTKERNELAPI
NTSTATUS
ZwQuerySystemInformation(
	ULONG InfoClass,
	PVOID Buffer,
	ULONG Length,
	PULONG ReturnLength
);

extern "C"
NTKERNELAPI
PVOID
NTAPI
PsGetProcessWow64Process(_In_ PEPROCESS Process);

extern "C"
NTKERNELAPI
NTSTATUS
NTAPI
MmCopyVirtualMemory(
	_In_ PEPROCESS FromProcess,
	_In_ PVOID FromAddress,
	_In_ PEPROCESS ToProcess,
	_Out_ PVOID ToAddress,
	_In_ SIZE_T BufferSize,
	_In_ KPROCESSOR_MODE PreviousMode,
	_Out_ PSIZE_T NumberOfBytesCopied
);
```

`kernel-csgo/ntstructs.hpp`:

```hpp
#pragma once

#include <ntifs.h>
#include <windef.h>

typedef enum _SYSTEM_INFORMATION_CLASS
{
	SystemBasicInformation,
	SystemProcessorInformation,
	SystemPerformanceInformation,
	SystemTimeOfDayInformation,
	SystemPathInformation,
	SystemProcessInformation,
	SystemCallCountInformation,
	SystemDeviceInformation,
	SystemProcessorPerformanceInformation,
	SystemFlagsInformation,
	SystemCallTimeInformation,
	SystemModuleInformation,
} SYSTEM_INFORMATION_CLASS, * PSYSTEM_INFORMATION_CLASS;

typedef struct _RTL_PROCESS_MODULE_INFORMATION
{
	HANDLE Section;
	PVOID MappedBase;
	PVOID ImageBase;
	ULONG ImageSize;
	ULONG Flags;
	USHORT LoadOrderIndex;
	USHORT InitOrderIndex;
	USHORT LoadCount;
	USHORT OffsetToFileName;
	UCHAR FullPathName[256];
} RTL_PROCESS_MODULE_INFORMATION, * PRTL_PROCESS_MODULE_INFORMATION;

typedef struct _RTL_PROCESS_MODULES
{
	ULONG NumberOfModules;
	RTL_PROCESS_MODULE_INFORMATION Modules[1];
} RTL_PROCESS_MODULES, * PRTL_PROCESS_MODULES;

typedef struct _PEB_LDR_DATA32
{
	ULONG Length;
	UCHAR Initialized;
	ULONG SsHandle;
	LIST_ENTRY32 InLoadOrderModuleList;
	LIST_ENTRY32 InMemoryOrderModuleList;
	LIST_ENTRY32 InInitializationOrderModuleList;
} PEB_LDR_DATA32, * PPEB_LDR_DATA32;

typedef struct _LDR_DATA_TABLE_ENTRY32
{
	LIST_ENTRY32 InLoadOrderLinks;
	LIST_ENTRY32 InMemoryOrderLinks;
	LIST_ENTRY32 InInitializationOrderLinks;
	ULONG DllBase;
	ULONG EntryPoint;
	ULONG SizeOfImage;
	UNICODE_STRING32 FullDllName;
	UNICODE_STRING32 BaseDllName;
	ULONG Flags;
	USHORT LoadCount;
	USHORT TlsIndex;
	LIST_ENTRY32 HashLinks;
	ULONG TimeDateStamp;
} LDR_DATA_TABLE_ENTRY32, * PLDR_DATA_TABLE_ENTRY32;

typedef struct _PEB32
{
	UCHAR InheritedAddressSpace;
	UCHAR ReadImageFileExecOptions;
	UCHAR BeingDebugged;
	UCHAR BitField;
	ULONG Mutant;
	ULONG ImageBaseAddress;
	ULONG Ldr;
	ULONG ProcessParameters;
	ULONG SubSystemData;
	ULONG ProcessHeap;
	ULONG FastPebLock;
	ULONG AtlThunkSListPtr;
	ULONG IFEOKey;
	ULONG CrossProcessFlags;
	ULONG UserSharedInfoPtr;
	ULONG SystemReserved;
	ULONG AtlThunkSListPtr32;
	ULONG ApiSetMap;
} PEB32, * PPEB32;

```