Project Path: arc_gmh5225_ASCTool_awzrf0cq

Source Tree:

```txt
arc_gmh5225_ASCTool_awzrf0cq
├── ASCTool.iml
├── lib
│   ├── ASCTool.jar
│   └── apksigner.jar
├── out
│   └── artifacts
│       └── ASCTool_jar
│           └── ASCTool.jar
├── pom.xml
├── readme.md
└── src
    └── main
        ├── kotlin
        │   └── com
        │       └── wan
        │           └── asctool
        │               ├── app
        │               │   ├── MyApp.kt
        │               │   └── Styles.kt
        │               ├── controller
        │               │   └── MainController.kt
        │               ├── util
        │               │   ├── TornadoFxUtil.kt
        │               │   └── Util.kt
        │               └── view
        │                   ├── AboutView.kt
        │                   ├── MainView.kt
        │                   └── SignMessageInputView.kt
        └── resources
            ├── config.properties
            ├── default.jks
            ├── img
            │   ├── file.png
            │   ├── icon.png
            │   ├── weixin.jpg
            │   └── zhifubao.jpg
            └── util
                ├── zipalign
                └── zipalign.exe

```

`ASCTool.iml`:

```iml
<?xml version="1.0" encoding="UTF-8"?>
<module org.jetbrains.idea.maven.project.MavenProjectsManager.isMavenModule="true" type="JAVA_MODULE" version="4">
  <component name="FacetManager">
    <facet type="kotlin-language" name="Kotlin">
      <configuration version="2" platform="JVM 1.8" allPlatforms="JVM [1.8]" useProjectSettings="false">
        <compilerSettings />
        <compilerArguments>
          <option name="jvmTarget" value="1.8" />
          <option name="languageVersion" value="1.2" />
          <option name="apiVersion" value="1.2" />
          <option name="pluginOptions">
            <array />
          </option>
          <option name="pluginClasspaths">
            <array />
          </option>
          <option name="errors">
            <ArgumentParseErrors />
          </option>
          <option name="coroutinesWarn" value="true" />
        </compilerArguments>
      </configuration>
    </facet>
    <facet type="TornadoFX" name="TornadoFX">
      <configuration />
    </facet>
  </component>
  <component name="NewModuleRootManager" LANGUAGE_LEVEL="JDK_1_5">
    <output url="file://$MODULE_DIR$/target/classes" />
    <output-test url="file://$MODULE_DIR$/target/test-classes" />
    <content url="file://$MODULE_DIR$">
      <sourceFolder url="file://$MODULE_DIR$/src/main/resources" type="java-resource" />
      <sourceFolder url="file://$MODULE_DIR$/src/main/kotlin" isTestSource="false" />
      <excludeFolder url="file://$MODULE_DIR$/target" />
    </content>
    <orderEntry type="inheritedJdk" />
    <orderEntry type="sourceFolder" forTests="false" />
    <orderEntry type="library" name="Maven: no.tornado:tornadofx:1.7.0" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.1.0" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-stdlib-jre7:1.1.0" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-reflect:1.1.0" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-stdlib:1.1.0" level="project" />
    <orderEntry type="library" scope="TEST" name="Maven: org.jetbrains.kotlin:kotlin-test:1.1.0" level="project" />
    <orderEntry type="library" name="Maven: no.tornado:tornadofx:1.7.9" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-stdlib:1.1.3-2" level="project" />
    <orderEntry type="library" scope="TEST" name="Maven: org.jetbrains.kotlin:kotlin-test:1.1.3-2" level="project" />
    <orderEntry type="library" name="Maven: no.tornado:tornadofx:1.7.14" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.2.10" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.2.10" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-reflect:1.2.10" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-stdlib:1.2.21" level="project" />
    <orderEntry type="library" scope="TEST" name="Maven: org.jetbrains.kotlin:kotlin-test:1.2.21" level="project" />
    <orderEntry type="library" name="ASCTool" level="project" />
    <orderEntry type="library" name="ASCTool-1.0" level="project" />
    <orderEntry type="library" name="Maven: no.tornado:tornadofx:1.7.17" level="project" />
    <orderEntry type="library" name="Maven: org.glassfish:javax.json:1.1.2" level="project" />
    <orderEntry type="library" name="Maven: javax.json:javax.json-api:1.1.2" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.2.60" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.2.60" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-reflect:1.2.60" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-stdlib:1.2.60" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains.kotlin:kotlin-stdlib-common:1.2.60" level="project" />
    <orderEntry type="library" name="Maven: org.jetbrains:annotations:13.0" level="project" />
    <orderEntry type="library" scope="TEST" name="Maven: org.jetbrains.kotlin:kotlin-test:1.2.60" level="project" />
    <orderEntry type="library" scope="TEST" name="Maven: org.jetbrains.kotlin:kotlin-test-common:1.2.60" level="project" />
    <orderEntry type="library" name="Maven: com.github.bkenn:kfoenix:0.1.3" level="project" />
    <orderEntry type="library" name="Maven: com.jfoenix:jfoenix:8.0.7" level="project" />
    <orderEntry type="module-library">
      <library name="Maven: com.wan:asctool:1.0">
        <CLASSES>
          <root url="jar://$MODULE_DIR$/lib/ASCTool.jar!/" />
        </CLASSES>
        <JAVADOC />
        <SOURCES />
      </library>
    </orderEntry>
  </component>
</module>
```

`pom.xml`:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.wan.asctool</groupId>
    <artifactId>tornadofx-maven-project</artifactId>
    <version>1.0</version>
    <packaging>jar</packaging>

    <properties>
        <kotlin.version>1.2.60</kotlin.version>
        <tornadofx.version>1.7.17</tornadofx.version>
    </properties>

    <dependencies>
        <dependency>
            <groupId>no.tornado</groupId>
            <artifactId>tornadofx</artifactId>
            <version>${tornadofx.version}</version>
        </dependency>
        <dependency>
            <groupId>org.jetbrains.kotlin</groupId>
            <artifactId>kotlin-stdlib</artifactId>
            <version>${kotlin.version}</version>
        </dependency>
        <dependency>
            <groupId>org.jetbrains.kotlin</groupId>
            <artifactId>kotlin-test</artifactId>
            <version>${kotlin.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>com.github.bkenn</groupId>
            <artifactId>kfoenix</artifactId>
            <version>0.1.3</version>
        </dependency>
        <dependency>
            <groupId>com.wan</groupId>
            <artifactId>asctool</artifactId>
            <version>1.0</version>
            <scope>system</scope>
            <systemPath>${basedir}/lib/ASCTool.jar</systemPath>
        </dependency>
    </dependencies>

    <build>
        <sourceDirectory>src/main/kotlin</sourceDirectory>
        <plugins>
            <plugin>
                <groupId>org.jetbrains.kotlin</groupId>
                <artifactId>kotlin-maven-plugin</artifactId>
                <version>${kotlin.version}</version>
                <executions>
                    <execution>
                        <id>compile</id>
                        <phase>compile</phase>
                        <goals>
                            <goal>compile</goal>
                        </goals>
                        <configuration>
                        <jvmTarget>1.8</jvmTarget>
                        </configuration>
                    </execution>
                    <execution>
                        <id>test-compile</id>
                        <phase>test-compile</phase>
                        <goals>
                            <goal>test-compile</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

</project>

```

`readme.md`:

```md
# ASCTool

APk签名验证破解工具 APK Signature Crack Tool

本工具只对那些仅通过 PackageManager.getPackageInfo().signatures 来校验签名的应用有效。

基于JavaFx框架，使用Kotlin语言实现
## 更新日志

### 2022年2月18日
1. 新增v2和v3签名，与自动对齐（选项可选）
2. 兼容mac（虽然未测试）
3. 修复找不到默认签名文件问题

### 2021年3月17日
1. 新增重签名功能(可对未签名的apk进行签名) 
2. 新增文件拖动功能
3. 修复使用自定义签名报错问题


## 软件界面

![](https://images.gitee.com/uploads/images/2019/0922/131337_2e0b8f07_5050769.png)

![](https://images.gitee.com/uploads/images/2019/0922/131337_755422d7_5050769.png)

## 下载

下载地址： https://stars-one.lanzouq.com/iPHYM02p50sb

[码云下载](https://gitee.com/stars-one/ASCTool/attach_files/970115/download/apk%E7%AD%BE%E5%90%8D%E7%A0%B4%E8%A7%A3%E5%B7%A5%E5%85%B7.jar)

> PS:码云下载慢得不行，50KB/s，无语了

## 使用
### 1.安装jdk（jdk1.8+）
### 2.双击下载的ASCTool.jar,打开使用

```

`src/main/kotlin/com/wan/asctool/app/MyApp.kt`:

```kt
package com.wan.asctool.app

import com.wan.asctool.view.MainView
import tornadofx.App

class MyApp: App(MainView::class, Styles::class)
```

`src/main/kotlin/com/wan/asctool/app/Styles.kt`:

```kt
package com.wan.asctool.app

import javafx.scene.text.FontWeight
import tornadofx.*

class Styles : Stylesheet() {
    companion object {
        val heading by cssclass()
        val mybutton by cssclass()
    }

    init {
        label and heading {
            padding = box(10.px)
            fontSize = 20.px
            fontWeight = FontWeight.BOLD
        }
        button {
            and(mybutton) {
                backgroundColor += c("#66bef1")
                textFill = c("white")
                and(hover) {
                    backgroundColor += c("#435aee")
                }

            }

        }
    }
}
```

`src/main/kotlin/com/wan/asctool/controller/MainController.kt`:

```kt
package com.wan.asctool.controller

import bin.signer.ApkSigner
import bin.signer.key.KeystoreKey
import cc.binmt.signature.ASCTool
import com.android.apksigner.ApkSignerTool
import com.wan.asctool.util.getCurrentJarPath
import com.wan.asctool.util.isWin
import tornadofx.*
import java.io.BufferedReader
import java.io.File
import java.io.InputStreamReader
import java.util.*


/**
 *
 * @author StarsOne
 * @date Create in  2019/9/18 0018 11:33
 * @description
 *
 */
class MainController : Controller() {


    fun test() {
        val file = File(javaClass.classLoader.getResource("").toURI())
        println(file.path)
    }

    /**
     * 重新签名
     */
    fun reSignApk(srcApkPath: String, outApkPath: String, option: Int, signVersion: Int = 1): String {
        //使用自定义签名文件设置签名
        val apkFile = File(srcApkPath)
        val outputApkFile = File(outApkPath)

        //获取签名文件及相关密码信息,使用strList存放
        val strList = arrayListOf<String>()

        if (option == 1) {
            //保存自动签名的选择option
            val lists = arrayListOf("my-keyFilePath", "my-password", "my-alias", "my-aliasPassword")
            lists.forEach {
                strList.add(config.string(it, ""))
            }

        } else {
            //使用默认测试签名文件进行签名
            val resourceAsStream = javaClass.classLoader.getResourceAsStream("config.properties")
            val properties = Properties()
            properties.load(resourceAsStream)
            val lists = arrayListOf("keyFilePath", "password", "alias", "aliasPassword")
            val map = properties.toMutableMap()

            lists.forEach {
                strList.add(map[it].toString())
            }
        }

        var signFilePath = strList[0]
        val signPwd = strList[1]
        val signAlias = strList[2]
        val signAliasPwd = strList[3]

        val fileUrl = resources.url("/img/file.png")
        signFilePath = if (fileUrl.path.contains("!/")) {
            if (option == 1) {
                signFilePath
            } else {
                //是jar包打开
                val currentJarPath = getCurrentJarPath(fileUrl)
                val file = File(currentJarPath.parent, signFilePath)
                if (!file.exists()) {
                    file.writeBytes(resources.stream("/" + signFilePath).readBytes())
                }
                file.path
            }
        } else {
            val filePath = resources.url("/" + signFilePath).file
            val file = File(filePath)
            file.path
        }
        println("jks文件: $signFilePath")
        val keystoreKey = KeystoreKey(signFilePath, signPwd, signAlias, signAliasPwd)

        ApkSigner.signApk(apkFile, outputApkFile, keystoreKey, null)

        if (signVersion == 1) {
            //v2签名
            return v2SignApk(outApkPath, strList)
        }
        return ""

    }

    /**
     * v2签名
     */
    fun v2SignApk(srcApkPath: String, strList: List<String>): String {
        val srcFile = File(srcApkPath)
        val tempFile = File(srcFile.parentFile, srcFile.nameWithoutExtension + "_temp" + ".apk")
        val outputApk = File(srcFile.parentFile, srcFile.nameWithoutExtension + "_v2" + ".apk")


        //todo 需要调整
        val zalipPath = getZalipPath()

        //zip对齐
        //val zalipPath = "D:\\app\\dev\\Android\\SDK\\build-tools\\28.0.3\\zipalign.exe"
        val progress = Runtime.getRuntime().exec("$zalipPath -p -f -v 4 $srcApkPath ${tempFile.path}")

        val br = BufferedReader(InputStreamReader(progress.inputStream))
        //StringBuffer b = new StringBuffer();
        var line: String? = null
        val b = StringBuffer()
        while (br.readLine().also { line = it } != null) {
            b.appendln(line)
        }

        val signFilePath = strList[0]
        val signPwd = strList[1]
        val signAlias = strList[2]
        val signAliasPwd = strList[3]

        val str = """sign --ks $signFilePath --ks-pass pass:${signPwd} --ks-key-alias ${signAlias} --key-pass pass:${signAliasPwd} --out ${outputApk.path} ${tempFile.path}
        """.trimMargin()
        b.appendln()
        b.appendln(str)

        val paramArray = str.split(" ").toTypedArray()
        ApkSignerTool.main(paramArray)

        //校验下签名
        ApkSignerTool.main(arrayOf("verify", "-v", outputApk.path))

        //删除对齐的那个apk文件
        System.gc()
        tempFile.delete()
        srcFile.delete()

        return b.toString()
    }

    private fun getZalipPath(): String {
        val zipalignPath = if (isWin()) "/util/zipalign.exe" else "/util/zipalign"
        val fileName = if (isWin()) "zipalign.exe" else "zipalign"

        val fileUrl = resources.url("/img/file.png")

        val result = if (fileUrl.path.contains("!/")) {
            //是jar包打开
            val currentJarPath = getCurrentJarPath(fileUrl)
            val file = File(currentJarPath.parent, fileName)
            if (!file.exists()) {
                file.writeBytes(resources.stream(zipalignPath).readBytes())
            }
            file.path
        } else {
            val filePath = resources.url(zipalignPath).file
            val file = File(filePath)
            file.path
        }
        println("ZalipPath : $result")
        return result
    }

    /**
     * 开始签名破解
     */
    fun startTask(srcApkPath: String, outApkPath: String, option: Int, signVersion: Int = 1) {
        val resourceAsStream = javaClass.classLoader.getResourceAsStream("config.properties")

        val properties = Properties()
        properties.load(resourceAsStream)

        properties.setProperty("option", option.toString())//保存自动签名的选择option

        val lists = arrayListOf("my-keyFilePath", "my-password", "my-alias", "my-aliasPassword")

        val map = properties.toMutableMap()
        //转为Map<String,String>类型 固定顺序
        val infoMap = linkedMapOf<String, String>()

        when (option) {
            //使用默认签名
            0 -> {
                //删除map中不需要的配置数据
                map.remove("option")
                if (map.containsKey("my-keyFilePath")) {
                    for (key in lists) {
                        map.remove(key)
                    }
                }
                infoMap.apply {
                    val entries = map.entries
                    for (entry in entries) {
                        this["${entry.key}"] = "${entry.value}"
                    }
                }
                //签名验证破解
                val keyFileInputSteam = resources.stream(infoMap["keyFilePath"] ?: "")
                ASCTool(srcApkPath, outApkPath, keyFileInputSteam, infoMap).startTask()
            }
            //使用自定义签名文件进行签名
            1 -> {
                val infoMap = hashMapOf<String, String>()
                infoMap.apply {
                    for (key in lists) {
                        this[key.substringAfter("my-")] = "${map[key]}"
                    }
                }
                ASCTool(srcApkPath, outApkPath, infoMap).startTask()
            }
            //不自动签名
            2 -> {
                ASCTool(srcApkPath, outApkPath).startTask()
            }
        }


        if (option == 0 || option == 1) {
            //是否v2签名
            if (signVersion == 2) {
                v2SignApk(srcApkPath, infoMap.values.toList())
            }
        }

    }
}


```

`src/main/kotlin/com/wan/asctool/util/TornadoFxUtil.kt`:

```kt
package com.wan.asctool.util

import java.io.File
import java.net.URI
import java.net.URL

/**
 * @author starsone
 * @date 2022/02/14 15:35
 */

/**
 * 获取当前jar包的文件路径
 *
 * @param url 在View中使用resources.url("")获取的参数
 * @return
 */
fun getCurrentJarPath(url: URL): File {
    val filePath = url.path.substringBeforeLast("!/")
    return File(URI.create(filePath))
}

/**
 * 当前系统是否为window系统
 */
fun isWin(): Boolean {
    val prop = System.getProperties()

    val os = prop.getProperty("os.name")
    return os.contains("win", true)
}

```

`src/main/kotlin/com/wan/asctool/util/Util.kt`:

```kt
package com.wan.asctool.util

import javafx.beans.property.StringProperty
import javafx.scene.control.Control
import javafx.stage.FileChooser
import tornadofx.*
import java.io.File

/**
 *
 * @author StarsOne
 * @date Create in  2019/9/20 0020 18:47
 * @description
 *
 */
/**
 * 验证apk输入是否正确
 */
fun validateApkFile(control: Control, property: StringProperty): Boolean {
    val validationContext = ValidationContext()
    validationContext.addValidator(control, property) {

        when {
            it.isNullOrBlank() -> error("此项是不能为空！！")
            File(it).extension == "apk" -> null
            else -> error("输入错误")
        }
    }
    return validationContext.validate()
}

/**
 * 验证签名文件是否正确
 */
fun validateSignFile(control: Control, property: StringProperty): Boolean {
    val validationContext = ValidationContext()
    validationContext.addValidator(control, property) {

        when {
            it.isNullOrBlank() -> error("此项是不能为空！！")
            File(it).extension == "keystore" || File(it).extension == "jks" -> null
            else -> error("请输入正确的文件路径")
        }
    }

    return validationContext.validate()
}

/**
 * 选择apk文件
 */
fun chooseApkFile(control: Control): String {
    val fileChooser = FileChooser()
    fileChooser.extensionFilters.add(FileChooser.ExtensionFilter("选择文件", "*.apk"))
    fileChooser.title ="选择签名文件"
    return fileChooser.showOpenDialog(control.scene.window)?.path ?: ""
}

/**
 * 选择签名文件
 */
fun chooseSignFile(control: Control): String {
    val fileChooser = FileChooser()
    fileChooser.title ="选择签名文件"
    fileChooser.extensionFilters.add(FileChooser.ExtensionFilter("选择文件", listOf("*.jks","*.keystore")))
    return fileChooser.showOpenDialog(control.scene.window)?.path ?: ""
}


```

`src/main/kotlin/com/wan/asctool/view/AboutView.kt`:

```kt
package com.wan.asctool.view

import javafx.geometry.Pos
import javafx.scene.text.FontWeight
import tornadofx.*
import java.awt.Desktop
import java.net.URI

/**
 *
 * @author StarsOne
 * @date Create in  2019/9/20 0020 14:07
 * @description
 *
 */
class AboutView : View("关于") {


    override val root = vbox {
        setPrefSize(500.0, 600.0)
        form {
            fieldset {
                alignment = Pos.CENTER
                vbox(spacing = 5.0) {
                    hbox {
                        alignment = Pos.CENTER
                        imageview("img/icon.png") {
                            alignment = Pos.CENTER
                            fitWidth = 50.0
                            fitHeight = 50.0
                        }
                    }
                    hbox {
                        alignment = Pos.CENTER
                        label("APK签名验证破解工具")
                    }

                }

                vbox {
                    padding = tornadofx.insets(left = 50,top = 15)
                    label("本工具只对那些仅通过 PackageManager.getPackageInfo().signatures来校验签名的应用有效"){
                        prefHeight = 50.0
                        isWrapText = true
                        style {
                            fontWeight = FontWeight.BOLD
                            fontSize = Dimension(16.0, Dimension.LinearUnits.px)
                        }
                    }
                }
                vbox{
                    padding = tornadofx.insets(left = 50.0)

                    field("软件作者") {
                        label("stars-one")
                    }
                    field("项目地址") {
                        hyperlink("https://github.com/Stars-One/ASCTool") {
                            action {
                                Desktop.getDesktop().browse(URI(this.text))
                            }
                        }
                    }
                    field("我的博客") {
                        hyperlink("https://www.cnblogs.com/stars-one") {
                            action {
                                Desktop.getDesktop().browse(URI(this.text))
                            }
                        }
                    }
                    field("联系QQ") {
                        hyperlink("1053894518") {

                        }
                    }
                }

                hbox {
                    padding = tornadofx.insets(top = 10)
                    alignment = Pos.CENTER
                    label("对你有帮助的话，不妨打赏一波！") {
                        style {
                            fontWeight = FontWeight.BOLD
                            fontSize = Dimension(20.0, Dimension.LinearUnits.px)
                        }
                    }
                }

                hbox {
                    alignment = Pos.CENTER
                    spacing = 20.0
                    vbox {
                        alignment = Pos.CENTER
                        label("微信")
                        imageview("img/weixin.jpg") {
                            alignment = Pos.CENTER
                            fitWidth = 180.0
                            fitHeight = 180.0
                        }
                    }
                    vbox {
                        alignment = Pos.CENTER
                        label("支付宝")
                        imageview("img/zhifubao.jpg") {
                            alignment = Pos.CENTER
                            fitWidth = 180.0
                            fitHeight = 180.0
                        }
                    }

                }
            }
        }

    }


}
```

`src/main/kotlin/com/wan/asctool/view/MainView.kt`:

```kt
package com.wan.asctool.view

import com.jfoenix.controls.JFXButton
import com.wan.asctool.app.Styles
import com.wan.asctool.controller.MainController
import com.wan.asctool.util.chooseApkFile
import com.wan.asctool.util.getCurrentJarPath
import com.wan.asctool.util.isWin
import com.wan.asctool.util.validateApkFile
import javafx.geometry.Pos
import javafx.scene.control.TextArea
import javafx.scene.control.TextField
import javafx.scene.image.Image
import kfoenix.jfxbutton
import kfoenix.jfxradiobutton
import tornadofx.*
import java.io.*


class MainView : View() {

    val mainController: MainController by inject()
    var srcApkFile: TextField by singleAssign()
    var outApkFile: TextField by singleAssign()

    var setSignButton: JFXButton by singleAssign()
    var settingSign: Field by singleAssign()

    var textarea by singleAssign<TextArea>()

    var option = 0
    var signVersion = 1 //默认v1+v2


    init {
        title = "APK签名验证破解工具 by star-sone"
        setStageIcon(Image("img/icon.png"))
    }

    override val root = vbox {
        setPrefSize(500.0, 400.0)
        menubar {
            menu("帮助") {
                item("关于") {
                    action {
                        find(AboutView::class).openModal()
//                        openInternalWindow(AboutView::class)
                    }
                }
            }
        }
        form {
            fieldset {
                field("需要处理的apk") {
                    srcApkFile = textfield {
                        promptText = "可拖动文件到这"
                        isFocusTraversable = false

                        setOnDragExited {
                            val files = it.getDragboard().getFiles()
                            //获得文件
                            val file = files[0]
                            if (file.extension == "apk") {
                                srcApkFile.text = file.path
                            }
                        }
                    }

                    jfxbutton {
                        graphic = imageview("img/file.png") {
                            fitHeight = 30.0
                            fitWidth = 30.0
                        }
                        action {
                            srcApkFile.text = chooseApkFile(srcApkFile)
                        }
                    }

                }

                field("输出apk名字") {
                    outApkFile = textfield {
                        isFocusTraversable = false
                        promptText = "输出路径与输入路径相同，默认为out.apk"
                    }
                }

                field("自动签名设置") {
                    togglegroup {
                        jfxradiobutton("使用默认签名") {
                            isSelected = true
                            setOnAction {
                                settingSign.isDisable = true
                                option = 0
                            }
                        }
                        jfxradiobutton("使用自定义签名") {
                            setOnAction {
                                settingSign.isDisable = false
                                option = 1
                            }
                        }
                        jfxradiobutton("不自动签名") {
                            setOnAction {
                                settingSign.isDisable = true
                                option = 2
                            }
                        }
                    }
                }

                settingSign = field("设置签名文件") {
                    isDisable = true
                    setSignButton = jfxbutton("设置签名文件") {
                        addClass(Styles.mybutton)
                        action {
                            openInternalWindow(SignMessageInputView::class)
                        }

                    }
                }

                field("签名版本") {
                    togglegroup {
                        jfxradiobutton("v1") {
                            setOnAction {
                                signVersion = 0
                            }
                        }
                        jfxradiobutton("v1+v2+v3") {
                            isSelected = true
                            setOnAction {
                                signVersion = 1
                            }
                        }
                    }
                }

                text("重签名apk会覆盖原本的签名,当然,也可以直接对一个未签名的apk签名")

                field {
                    hbox(20) {
                        alignment = Pos.CENTER
                        jfxbutton("破解签名验证") {
                            addClass(Styles.mybutton)

                            action {
                                textarea.clear()

                                //验证通过则进行解密
                                if (validateApkFile(srcApkFile, srcApkFile.textProperty())) {
                                    val srcPath = srcApkFile.text
                                    val parentPath = File(srcPath).parent
                                    var outPath = File(parentPath, "out.apk").path
                                    val outPathText = outApkFile.text
                                    if (!outPathText.isNullOrBlank()) {
                                        outPath = if (outPathText.endsWith(".apk")) {
                                            File(parentPath, outPathText).path
                                        } else {
                                            File(parentPath, "$outPathText.apk").path
                                        }
                                    }
                                    val stream = ByteArrayOutputStream()
                                    System.setOut(PrintStream(stream))

                                    var lines: List<String>
                                    runAsync {
                                        //进行解密
                                        textarea.appendText("正在处理，请稍候...\n")
                                        mainController.startTask(srcPath, outPath, option, signVersion)
                                        val bf = BufferedReader(InputStreamReader(ByteArrayInputStream(stream.toByteArray())))
                                        lines = bf.readLines()

                                        for (line in lines) {
                                            textarea.appendText(line + "\n")
                                            Thread.sleep(200)
                                        }
                                    } ui {
                                        textarea.appendText("签名破解已成功！")
                                    }

                                }
                            }
                        }
                        jfxbutton("apk重签名") {
                            addClass(Styles.mybutton)

                            action {
                                textarea.clear()
                                textarea.appendText("重新签名...\n")
                                if (validateApkFile(srcApkFile, srcApkFile.textProperty())) {
                                    val srcPath = srcApkFile.text
                                    val parentPath = File(srcPath).parent
                                    var outPath = File(parentPath, "out.apk").path
                                    val outPathText = outApkFile.text
                                    if (!outPathText.isNullOrBlank()) {
                                        outPath = if (outPathText.endsWith(".apk")) {
                                            File(parentPath, outPathText).path
                                        } else {
                                            File(parentPath, "$outPathText.apk").path
                                        }
                                    }

                                    runAsync {
                                        mainController.reSignApk(srcPath, outPath, option, signVersion)
                                    } ui {
                                        textarea.appendText(it)
                                        textarea.appendText("重新签名完毕...\n")
                                    }

                                }

                            }
                        }
                        button("test").action {


                        }
                    }
                }
                field {
                    textarea = textarea {
                        isEditable = false
                        isWrapText = true
                    }
                }

            }
        }

    }

}

```

`src/main/kotlin/com/wan/asctool/view/SignMessageInputView.kt`:

```kt
package com.wan.asctool.view

import com.wan.asctool.app.Styles
import com.wan.asctool.controller.MainController
import com.wan.asctool.util.chooseSignFile
import com.wan.asctool.util.validateSignFile
import javafx.geometry.Pos
import javafx.scene.control.TextField
import kfoenix.jfxbutton
import tornadofx.*
import java.io.File
import java.io.FileWriter
import java.util.*
import java.util.jar.JarFile

/**
 *
 * @author StarsOne
 * @date Create in  2019/9/20 0020 14:07
 * @description
 *
 */
class SignMessageInputView : View("输入自定义签名文件信息") {
    var keyFilePathTf by singleAssign<TextField>()
    var passwordTf by singleAssign<TextField>()
    var aliasTf by singleAssign<TextField>()
    var aliasPasswordTf by singleAssign<TextField>()

    val mainController: MainController by inject()

    override fun onDock() {
        loadProperties()
    }

    override val root = vbox {
        form {
            fieldset {
                field("签名文件路径") {
                    keyFilePathTf = textfield()
                    jfxbutton {
                        graphic = imageview("img/file.png") {
                            fitHeight = 30.0
                            fitWidth = 30.0
                        }
                        action {
                            keyFilePathTf.text = chooseSignFile(keyFilePathTf)
                        }
                    }
                }
                field("密码") {
                    passwordTf = textfield()
                }
                field("别名(alias)") {
                    aliasTf = textfield()
                }
                field("别名密码") {
                    aliasPasswordTf = textfield()
                }
            }
        }
        hbox {
            alignment = Pos.CENTER
            jfxbutton("保存") {
                addClass(Styles.mybutton)
                action {
                    if (validateSignFile(keyFilePathTf, keyFilePathTf.textProperty())) {
                        writeProperties()
                        //关闭对话框
                        close()
                    }
                }
            }
        }
    }


    fun loadProperties() {
        val config = mainController.config
        val controlList = listOf(keyFilePathTf, passwordTf, aliasTf, aliasPasswordTf)
        val lists = listOf("my-keyFilePath", "my-password", "my-alias", "my-aliasPassword")
        lists.forEachIndexed { index, s ->
            controlList[index].text = config.string(s,"")
        }

    }

    fun writeProperties() {

        val config = mainController.config
        val controlList = listOf(keyFilePathTf, passwordTf, aliasTf, aliasPasswordTf)
        val lists = listOf("my-keyFilePath", "my-password", "my-alias", "my-aliasPassword")

        lists.forEachIndexed { index, s ->
            config[s] = controlList[index].text
        }
        config.save()

    }
}
```

`src/main/resources/config.properties`:

```properties
# 0\uFFFD\uFFFD\u02B9\uFFFD\uFFFD\u012C\uFFFD\uFFFD\u01E9\uFFFD\uFFFD 1: \u02B9\uFFFD\uFFFD\uFFFD\u0536\uFFFD\uFFFD\uFFFD\u01E9\uFFFD\uFFFD 2\uFFFD\uFFFD \uFFFD\uFFFD\u01E9\uFFFD\uFFFD
#option=0
#keyFilePath=D:\\project\\App-Dev\\xinjiang\\app\\xuexibao.keys
##keyFilePath=default.jks
#password=tyky$123456
#alias=tyky_czing
#aliasPassword=tyky$123456
#
option=0
keyFilePath=default.jks
password=123456
alias=key0
aliasPassword=654321


```