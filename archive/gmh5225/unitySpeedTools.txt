Project Path: arc_gmh5225_unitySpeedTools_dvlic2zh

Source Tree:

```txt
arc_gmh5225_unitySpeedTools_dvlic2zh
├── LatestBuild
├── README.md
├── unitySpeedTools2020
│   ├── Package
│   │   ├── DEBIAN
│   │   │   ├── control
│   │   │   └── control.txt
│   │   ├── Library
│   │   │   ├── MobileSubstrate
│   │   │   │   └── DynamicLibraries
│   │   │   │       ├── unitySpeedTools2020.dylib
│   │   │   │       └── unitySpeedTools2020.plist
│   │   │   └── PreferenceLoader
│   │   │       └── Preferences
│   │   │           ├── unitySpeedTools2020.plist
│   │   │           ├── unitySpeedTools2020Icon.png
│   │   │           └── unitySpeedTools2020Icon@2x.png
│   │   └── Library.zip
│   ├── PackageVersion.plist
│   ├── getU3dsystemfunc.h
│   ├── getU3dsystemfunc.mm
│   ├── p_inc.h
│   ├── spscapi.h
│   ├── spscapi.mm
│   ├── unitySpeedTools2020-Prefix.pch
│   ├── unitySpeedTools2020.mm
│   ├── unitySpeedTools2020.xm
│   ├── x5fPmc.h
│   ├── x5fPmc.mm
│   ├── x5fPmgd.h
│   └── x5fPmw
│       ├── Controller
│       │   ├── x5fPavc.h
│       │   ├── x5fPavc.m
│       │   ├── x5fPmbvc.h
│       │   ├── x5fPmbvc.m
│       │   ├── x5fPmvc.h
│       │   ├── x5fPmvc.m
│       │   ├── x5fPsvc.h
│       │   └── x5fPsvc.m
│       ├── Model
│       │   ├── x5fPmco.h
│       │   └── x5fPmco.m
│       └── View
│           ├── HBView.h
│           ├── HBView.m
│           ├── HBWindow.h
│           ├── HBWindow.m
│           ├── x5fPav.h
│           ├── x5fPav.m
│           ├── x5fPavm.h
│           ├── x5fPavm.m
│           ├── x5fPb.h
│           ├── x5fPb.m
│           ├── x5fPdb.h
│           ├── x5fPdb.m
│           ├── x5fPl.h
│           ├── x5fPl.m
│           ├── x5fPsc.h
│           └── x5fPsc.m
└── unitySpeedTools2020.xcodeproj
    ├── project.pbxproj
    ├── project.xcworkspace
    │   ├── contents.xcworkspacedata
    │   ├── xcshareddata
    │   │   └── IDEWorkspaceChecks.plist
    │   └── xcuserdata
    │       └── xuzhengda.xcuserdatad
    │           └── UserInterfaceState.xcuserstate
    └── xcuserdata
        └── xuzhengda.xcuserdatad
            └── xcschemes
                └── xcschememanagement.plist

```

`README.md`:

```md
# unitySpeedTools2020

unitySpeedTools2020是unitySpeedTools的无验证版本。

English version is in wiki page


# 功能

主要提供越狱环境下对Unity游戏的速度控制，一个简陋的界面可在游戏中进行调速，或者在系统设置菜单中调整好速度，在游戏用一个按钮来快捷加速/减速、恢复原速。

# 原理

1、在插件启动时，在屏幕上加载一个按钮。

2、点击按钮，会根据特征值开始查找Unity的System函数

	2.1、20211102更新，根据函数名il2cpp_resolve_icall查找il2cpp_resolve_icall_0，即System函数的原身。

3、使用System函数查找UnityEngine.Time::set_timeScale(System.Single)的地址，进行劫持

4、劫持后可开始进行变速。

5、暂停时将对劫持的汇编进行还原，以便绕过某些突发的完整性校验。

## 特征值

根据多个Unity游戏的二进制进行整理，找出最通用的特征值。该值可能不止一组，补充更多特征值将可使变速器适用于更多的Unity游戏


## 适配性

非Unity游戏的、不使用Unity引擎此2函数进行变速的、有根据速度进行非正常游戏判定的，将无法使用此插件。有些变速还将导致外挂判定，而被封号。


```

`unitySpeedTools2020.xcodeproj/project.pbxproj`:

```pbxproj
// !$*UTF8*$!
{
	archiveVersion = 1;
	classes = {
	};
	objectVersion = 50;
	objects = {

/* Begin PBXBuildFile section */
		B1B0C21E24519E0600F25F9D /* Foundation.framework in Frameworks */ = {isa = PBXBuildFile; fileRef = B1B0C21D24519E0600F25F9D /* Foundation.framework */; };
		B1B0C22924519E0600F25F9D /* unitySpeedTools2020.mm in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C22824519E0600F25F9D /* unitySpeedTools2020.mm */; };
		B1B0C2602451A5A700F25F9D /* x5fPmvc.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C2442451A5A600F25F9D /* x5fPmvc.m */; };
		B1B0C2612451A5A700F25F9D /* x5fPmbvc.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C2452451A5A600F25F9D /* x5fPmbvc.h */; };
		B1B0C2622451A5A700F25F9D /* x5fPsvc.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C2462451A5A600F25F9D /* x5fPsvc.h */; };
		B1B0C2632451A5A700F25F9D /* x5fPavc.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C2472451A5A600F25F9D /* x5fPavc.h */; };
		B1B0C2642451A5A700F25F9D /* x5fPmvc.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C2482451A5A600F25F9D /* x5fPmvc.h */; };
		B1B0C2652451A5A700F25F9D /* x5fPmbvc.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C2492451A5A600F25F9D /* x5fPmbvc.m */; };
		B1B0C2662451A5A700F25F9D /* x5fPsvc.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C24A2451A5A600F25F9D /* x5fPsvc.m */; };
		B1B0C2672451A5A700F25F9D /* x5fPavc.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C24B2451A5A600F25F9D /* x5fPavc.m */; };
		B1B0C2682451A5A700F25F9D /* x5fPmco.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C24D2451A5A600F25F9D /* x5fPmco.m */; };
		B1B0C2692451A5A700F25F9D /* x5fPmco.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C24E2451A5A600F25F9D /* x5fPmco.h */; };
		B1B0C26A2451A5A700F25F9D /* x5fPdb.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C2502451A5A600F25F9D /* x5fPdb.h */; };
		B1B0C26B2451A5A700F25F9D /* x5fPav.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C2512451A5A600F25F9D /* x5fPav.m */; };
		B1B0C26C2451A5A700F25F9D /* x5fPsc.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C2522451A5A600F25F9D /* x5fPsc.m */; };
		B1B0C26D2451A5A700F25F9D /* HBView.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C2532451A5A600F25F9D /* HBView.m */; };
		B1B0C26E2451A5A700F25F9D /* x5fPb.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C2542451A5A600F25F9D /* x5fPb.m */; };
		B1B0C26F2451A5A700F25F9D /* x5fPl.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C2552451A5A600F25F9D /* x5fPl.m */; };
		B1B0C2702451A5A700F25F9D /* HBWindow.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C2562451A5A600F25F9D /* HBWindow.m */; };
		B1B0C2712451A5A700F25F9D /* x5fPavm.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C2572451A5A600F25F9D /* x5fPavm.h */; };
		B1B0C2722451A5A700F25F9D /* x5fPav.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C2582451A5A600F25F9D /* x5fPav.h */; };
		B1B0C2732451A5A700F25F9D /* x5fPdb.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C2592451A5A600F25F9D /* x5fPdb.m */; };
		B1B0C2742451A5A700F25F9D /* HBView.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C25A2451A5A600F25F9D /* HBView.h */; };
		B1B0C2752451A5A700F25F9D /* x5fPsc.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C25B2451A5A600F25F9D /* x5fPsc.h */; };
		B1B0C2762451A5A700F25F9D /* x5fPl.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C25C2451A5A600F25F9D /* x5fPl.h */; };
		B1B0C2772451A5A700F25F9D /* x5fPb.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C25D2451A5A600F25F9D /* x5fPb.h */; };
		B1B0C2782451A5A700F25F9D /* x5fPavm.m in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C25E2451A5A600F25F9D /* x5fPavm.m */; };
		B1B0C2792451A5A700F25F9D /* HBWindow.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C25F2451A5A600F25F9D /* HBWindow.h */; };
		B1B0C2822451A5DE00F25F9D /* spscapi.mm in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C27A2451A5DD00F25F9D /* spscapi.mm */; };
		B1B0C2832451A5DE00F25F9D /* x5fPmc.mm in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C27B2451A5DD00F25F9D /* x5fPmc.mm */; };
		B1B0C2842451A5DE00F25F9D /* x5fPmgd.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C27C2451A5DD00F25F9D /* x5fPmgd.h */; };
		B1B0C2852451A5DE00F25F9D /* x5fPmc.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C27D2451A5DD00F25F9D /* x5fPmc.h */; };
		B1B0C2862451A5DE00F25F9D /* getU3dsystemfunc.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C27E2451A5DD00F25F9D /* getU3dsystemfunc.h */; };
		B1B0C2872451A5DE00F25F9D /* getU3dsystemfunc.mm in Sources */ = {isa = PBXBuildFile; fileRef = B1B0C27F2451A5DE00F25F9D /* getU3dsystemfunc.mm */; };
		B1B0C2882451A5DE00F25F9D /* spscapi.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C2802451A5DE00F25F9D /* spscapi.h */; };
		B1B0C2892451A5DE00F25F9D /* p_inc.h in Headers */ = {isa = PBXBuildFile; fileRef = B1B0C2812451A5DE00F25F9D /* p_inc.h */; };
		B1B0C2902451B09700F25F9D /* UIKit.framework in Frameworks */ = {isa = PBXBuildFile; fileRef = B1B0C28F2451B09700F25F9D /* UIKit.framework */; };
		B1B0C2922451B09E00F25F9D /* libsubstrate.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = B1B0C2912451B09E00F25F9D /* libsubstrate.dylib */; };
		B1B0C2942451B0B400F25F9D /* QuartzCore.framework in Frameworks */ = {isa = PBXBuildFile; fileRef = B1B0C2932451B0B400F25F9D /* QuartzCore.framework */; };
		B1B0C2962451B0BA00F25F9D /* CoreGraphics.framework in Frameworks */ = {isa = PBXBuildFile; fileRef = B1B0C2952451B0BA00F25F9D /* CoreGraphics.framework */; };
/* End PBXBuildFile section */

/* Begin PBXFileReference section */
		B1B0C21A24519E0600F25F9D /* unitySpeedTools2020.dylib */ = {isa = PBXFileReference; explicitFileType = "compiled.mach-o.dylib"; includeInIndex = 0; path = unitySpeedTools2020.dylib; sourceTree = BUILT_PRODUCTS_DIR; };
		B1B0C21D24519E0600F25F9D /* Foundation.framework */ = {isa = PBXFileReference; lastKnownFileType = wrapper.framework; name = Foundation.framework; path = System/Library/Frameworks/Foundation.framework; sourceTree = SDKROOT; };
		B1B0C22224519E0600F25F9D /* control.txt */ = {isa = PBXFileReference; lastKnownFileType = text; path = control.txt; sourceTree = "<group>"; };
		B1B0C22324519E0600F25F9D /* control */ = {isa = PBXFileReference; lastKnownFileType = text; path = control; sourceTree = "<group>"; };
		B1B0C22524519E0600F25F9D /* PackageVersion.plist */ = {isa = PBXFileReference; lastKnownFileType = text.plist.xml; name = PackageVersion.plist; path = ../PackageVersion.plist; sourceTree = "<group>"; };
		B1B0C22624519E0600F25F9D /* unitySpeedTools2020-Prefix.pch */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = "unitySpeedTools2020-Prefix.pch"; path = "../unitySpeedTools2020-Prefix.pch"; sourceTree = "<group>"; };
		B1B0C22724519E0600F25F9D /* unitySpeedTools2020.xm */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.objcpp; path = unitySpeedTools2020.xm; sourceTree = "<group>"; xcLanguageSpecificationIdentifier = xcode.lang.objcpp; };
		B1B0C22824519E0600F25F9D /* unitySpeedTools2020.mm */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.objcpp; path = unitySpeedTools2020.mm; sourceTree = "<group>"; };
		B1B0C22D24519E0600F25F9D /* unitySpeedTools2020.plist */ = {isa = PBXFileReference; lastKnownFileType = text.plist.xml; path = unitySpeedTools2020.plist; sourceTree = "<group>"; };
		B1B0C2442451A5A600F25F9D /* x5fPmvc.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = x5fPmvc.m; sourceTree = "<group>"; };
		B1B0C2452451A5A600F25F9D /* x5fPmbvc.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = x5fPmbvc.h; sourceTree = "<group>"; };
		B1B0C2462451A5A600F25F9D /* x5fPsvc.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = x5fPsvc.h; sourceTree = "<group>"; };
		B1B0C2472451A5A600F25F9D /* x5fPavc.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = x5fPavc.h; sourceTree = "<group>"; };
		B1B0C2482451A5A600F25F9D /* x5fPmvc.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = x5fPmvc.h; sourceTree = "<group>"; };
		B1B0C2492451A5A600F25F9D /* x5fPmbvc.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = x5fPmbvc.m; sourceTree = "<group>"; };
		B1B0C24A2451A5A600F25F9D /* x5fPsvc.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = x5fPsvc.m; sourceTree = "<group>"; };
		B1B0C24B2451A5A600F25F9D /* x5fPavc.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = x5fPavc.m; sourceTree = "<group>"; };
		B1B0C24D2451A5A600F25F9D /* x5fPmco.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = x5fPmco.m; sourceTree = "<group>"; };
		B1B0C24E2451A5A600F25F9D /* x5fPmco.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = x5fPmco.h; sourceTree = "<group>"; };
		B1B0C2502451A5A600F25F9D /* x5fPdb.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = x5fPdb.h; sourceTree = "<group>"; };
		B1B0C2512451A5A600F25F9D /* x5fPav.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = x5fPav.m; sourceTree = "<group>"; };
		B1B0C2522451A5A600F25F9D /* x5fPsc.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = x5fPsc.m; sourceTree = "<group>"; };
		B1B0C2532451A5A600F25F9D /* HBView.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = HBView.m; sourceTree = "<group>"; };
		B1B0C2542451A5A600F25F9D /* x5fPb.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = x5fPb.m; sourceTree = "<group>"; };
		B1B0C2552451A5A600F25F9D /* x5fPl.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = x5fPl.m; sourceTree = "<group>"; };
		B1B0C2562451A5A600F25F9D /* HBWindow.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = HBWindow.m; sourceTree = "<group>"; };
		B1B0C2572451A5A600F25F9D /* x5fPavm.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = x5fPavm.h; sourceTree = "<group>"; };
		B1B0C2582451A5A600F25F9D /* x5fPav.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = x5fPav.h; sourceTree = "<group>"; };
		B1B0C2592451A5A600F25F9D /* x5fPdb.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = x5fPdb.m; sourceTree = "<group>"; };
		B1B0C25A2451A5A600F25F9D /* HBView.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = HBView.h; sourceTree = "<group>"; };
		B1B0C25B2451A5A600F25F9D /* x5fPsc.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = x5fPsc.h; sourceTree = "<group>"; };
		B1B0C25C2451A5A600F25F9D /* x5fPl.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = x5fPl.h; sourceTree = "<group>"; };
		B1B0C25D2451A5A600F25F9D /* x5fPb.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = x5fPb.h; sourceTree = "<group>"; };
		B1B0C25E2451A5A600F25F9D /* x5fPavm.m */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.objc; path = x5fPavm.m; sourceTree = "<group>"; };
		B1B0C25F2451A5A600F25F9D /* HBWindow.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = HBWindow.h; sourceTree = "<group>"; };
		B1B0C27A2451A5DD00F25F9D /* spscapi.mm */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.objcpp; name = spscapi.mm; path = unitySpeedTools2020/spscapi.mm; sourceTree = SOURCE_ROOT; };
		B1B0C27B2451A5DD00F25F9D /* x5fPmc.mm */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.objcpp; name = x5fPmc.mm; path = unitySpeedTools2020/x5fPmc.mm; sourceTree = SOURCE_ROOT; };
		B1B0C27C2451A5DD00F25F9D /* x5fPmgd.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = x5fPmgd.h; path = unitySpeedTools2020/x5fPmgd.h; sourceTree = SOURCE_ROOT; };
		B1B0C27D2451A5DD00F25F9D /* x5fPmc.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = x5fPmc.h; path = unitySpeedTools2020/x5fPmc.h; sourceTree = SOURCE_ROOT; };
		B1B0C27E2451A5DD00F25F9D /* getU3dsystemfunc.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = getU3dsystemfunc.h; path = unitySpeedTools2020/getU3dsystemfunc.h; sourceTree = SOURCE_ROOT; };
		B1B0C27F2451A5DE00F25F9D /* getU3dsystemfunc.mm */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.objcpp; name = getU3dsystemfunc.mm; path = unitySpeedTools2020/getU3dsystemfunc.mm; sourceTree = SOURCE_ROOT; };
		B1B0C2802451A5DE00F25F9D /* spscapi.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = spscapi.h; path = unitySpeedTools2020/spscapi.h; sourceTree = SOURCE_ROOT; };
		B1B0C2812451A5DE00F25F9D /* p_inc.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = p_inc.h; path = unitySpeedTools2020/p_inc.h; sourceTree = SOURCE_ROOT; };
		B1B0C28F2451B09700F25F9D /* UIKit.framework */ = {isa = PBXFileReference; lastKnownFileType = wrapper.framework; name = UIKit.framework; path = System/Library/Frameworks/UIKit.framework; sourceTree = SDKROOT; };
		B1B0C2912451B09E00F25F9D /* libsubstrate.dylib */ = {isa = PBXFileReference; lastKnownFileType = "compiled.mach-o.dylib"; name = libsubstrate.dylib; path = ../../../../../opt/iOSOpenDev/lib/libsubstrate.dylib; sourceTree = "<group>"; };
		B1B0C2932451B0B400F25F9D /* QuartzCore.framework */ = {isa = PBXFileReference; lastKnownFileType = wrapper.framework; name = QuartzCore.framework; path = Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/QuartzCore.framework; sourceTree = DEVELOPER_DIR; };
		B1B0C2952451B0BA00F25F9D /* CoreGraphics.framework */ = {isa = PBXFileReference; lastKnownFileType = wrapper.framework; name = CoreGraphics.framework; path = Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/CoreGraphics.framework; sourceTree = DEVELOPER_DIR; };
		B1DBC55E2452931E0011AE14 /* unitySpeedTools2020Icon@2x.png */ = {isa = PBXFileReference; lastKnownFileType = image.png; path = "unitySpeedTools2020Icon@2x.png"; sourceTree = "<group>"; };
		B1DBC55F2452931E0011AE14 /* unitySpeedTools2020.plist */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text.plist.xml; path = unitySpeedTools2020.plist; sourceTree = "<group>"; };
		B1DBC5602452931E0011AE14 /* unitySpeedTools2020Icon.png */ = {isa = PBXFileReference; lastKnownFileType = image.png; path = unitySpeedTools2020Icon.png; sourceTree = "<group>"; };
/* End PBXFileReference section */

/* Begin PBXFrameworksBuildPhase section */
		B1B0C21624519E0600F25F9D /* Frameworks */ = {
			isa = PBXFrameworksBuildPhase;
			buildActionMask = 2147483647;
			files = (
				B1B0C2962451B0BA00F25F9D /* CoreGraphics.framework in Frameworks */,
				B1B0C2942451B0B400F25F9D /* QuartzCore.framework in Frameworks */,
				B1B0C2902451B09700F25F9D /* UIKit.framework in Frameworks */,
				B1B0C21E24519E0600F25F9D /* Foundation.framework in Frameworks */,
				B1B0C2922451B09E00F25F9D /* libsubstrate.dylib in Frameworks */,
			);
			runOnlyForDeploymentPostprocessing = 0;
		};
/* End PBXFrameworksBuildPhase section */

/* Begin PBXGroup section */
		B1B0C20F24519E0600F25F9D = {
			isa = PBXGroup;
			children = (
				B1B0C21F24519E0600F25F9D /* unitySpeedTools2020 */,
				B1B0C21C24519E0600F25F9D /* Frameworks */,
				B1B0C21B24519E0600F25F9D /* Products */,
			);
			sourceTree = "<group>";
		};
		B1B0C21B24519E0600F25F9D /* Products */ = {
			isa = PBXGroup;
			children = (
				B1B0C21A24519E0600F25F9D /* unitySpeedTools2020.dylib */,
			);
			name = Products;
			sourceTree = "<group>";
		};
		B1B0C21C24519E0600F25F9D /* Frameworks */ = {
			isa = PBXGroup;
			children = (
				B1B0C2952451B0BA00F25F9D /* CoreGraphics.framework */,
				B1B0C2932451B0B400F25F9D /* QuartzCore.framework */,
				B1B0C2912451B09E00F25F9D /* libsubstrate.dylib */,
				B1B0C28F2451B09700F25F9D /* UIKit.framework */,
				B1B0C21D24519E0600F25F9D /* Foundation.framework */,
			);
			name = Frameworks;
			sourceTree = "<group>";
		};
		B1B0C21F24519E0600F25F9D /* unitySpeedTools2020 */ = {
			isa = PBXGroup;
			children = (
				B1B0C2422451A5A600F25F9D /* x5fPmw */,
				B1B0C22724519E0600F25F9D /* unitySpeedTools2020.xm */,
				B1B0C22824519E0600F25F9D /* unitySpeedTools2020.mm */,
				B1B0C27E2451A5DD00F25F9D /* getU3dsystemfunc.h */,
				B1B0C27F2451A5DE00F25F9D /* getU3dsystemfunc.mm */,
				B1B0C2812451A5DE00F25F9D /* p_inc.h */,
				B1B0C2802451A5DE00F25F9D /* spscapi.h */,
				B1B0C27A2451A5DD00F25F9D /* spscapi.mm */,
				B1B0C27D2451A5DD00F25F9D /* x5fPmc.h */,
				B1B0C27B2451A5DD00F25F9D /* x5fPmc.mm */,
				B1B0C27C2451A5DD00F25F9D /* x5fPmgd.h */,
				B1B0C22024519E0600F25F9D /* Package */,
				B1B0C22424519E0600F25F9D /* Supporting Files */,
			);
			path = unitySpeedTools2020;
			sourceTree = "<group>";
		};
		B1B0C22024519E0600F25F9D /* Package */ = {
			isa = PBXGroup;
			children = (
				B1B0C22124519E0600F25F9D /* DEBIAN */,
				B1B0C22A24519E0600F25F9D /* Library */,
			);
			path = Package;
			sourceTree = "<group>";
		};
		B1B0C22124519E0600F25F9D /* DEBIAN */ = {
			isa = PBXGroup;
			children = (
				B1B0C22224519E0600F25F9D /* control.txt */,
				B1B0C22324519E0600F25F9D /* control */,
			);
			path = DEBIAN;
			sourceTree = "<group>";
		};
		B1B0C22424519E0600F25F9D /* Supporting Files */ = {
			isa = PBXGroup;
			children = (
				B1B0C22524519E0600F25F9D /* PackageVersion.plist */,
				B1B0C22624519E0600F25F9D /* unitySpeedTools2020-Prefix.pch */,
			);
			path = "Supporting Files";
			sourceTree = "<group>";
		};
		B1B0C22A24519E0600F25F9D /* Library */ = {
			isa = PBXGroup;
			children = (
				B1B0C28A2451AB7A00F25F9D /* PreferenceLoader */,
				B1B0C22B24519E0600F25F9D /* MobileSubstrate */,
			);
			path = Library;
			sourceTree = "<group>";
		};
		B1B0C22B24519E0600F25F9D /* MobileSubstrate */ = {
			isa = PBXGroup;
			children = (
				B1B0C22C24519E0600F25F9D /* DynamicLibraries */,
			);
			path = MobileSubstrate;
			sourceTree = "<group>";
		};
		B1B0C22C24519E0600F25F9D /* DynamicLibraries */ = {
			isa = PBXGroup;
			children = (
				B1B0C22D24519E0600F25F9D /* unitySpeedTools2020.plist */,
			);
			path = DynamicLibraries;
			sourceTree = "<group>";
		};
		B1B0C2422451A5A600F25F9D /* x5fPmw */ = {
			isa = PBXGroup;
			children = (
				B1B0C2432451A5A600F25F9D /* Controller */,
				B1B0C24C2451A5A600F25F9D /* Model */,
				B1B0C24F2451A5A600F25F9D /* View */,
			);
			path = x5fPmw;
			sourceTree = "<group>";
		};
		B1B0C2432451A5A600F25F9D /* Controller */ = {
			isa = PBXGroup;
			children = (
				B1B0C2442451A5A600F25F9D /* x5fPmvc.m */,
				B1B0C2452451A5A600F25F9D /* x5fPmbvc.h */,
				B1B0C2462451A5A600F25F9D /* x5fPsvc.h */,
				B1B0C2472451A5A600F25F9D /* x5fPavc.h */,
				B1B0C2482451A5A600F25F9D /* x5fPmvc.h */,
				B1B0C2492451A5A600F25F9D /* x5fPmbvc.m */,
				B1B0C24A2451A5A600F25F9D /* x5fPsvc.m */,
				B1B0C24B2451A5A600F25F9D /* x5fPavc.m */,
			);
			path = Controller;
			sourceTree = "<group>";
		};
		B1B0C24C2451A5A600F25F9D /* Model */ = {
			isa = PBXGroup;
			children = (
				B1B0C24D2451A5A600F25F9D /* x5fPmco.m */,
				B1B0C24E2451A5A600F25F9D /* x5fPmco.h */,
			);
			path = Model;
			sourceTree = "<group>";
		};
		B1B0C24F2451A5A600F25F9D /* View */ = {
			isa = PBXGroup;
			children = (
				B1B0C2502451A5A600F25F9D /* x5fPdb.h */,
				B1B0C2512451A5A600F25F9D /* x5fPav.m */,
				B1B0C2522451A5A600F25F9D /* x5fPsc.m */,
				B1B0C2532451A5A600F25F9D /* HBView.m */,
				B1B0C2542451A5A600F25F9D /* x5fPb.m */,
				B1B0C2552451A5A600F25F9D /* x5fPl.m */,
				B1B0C2562451A5A600F25F9D /* HBWindow.m */,
				B1B0C2572451A5A600F25F9D /* x5fPavm.h */,
				B1B0C2582451A5A600F25F9D /* x5fPav.h */,
				B1B0C2592451A5A600F25F9D /* x5fPdb.m */,
				B1B0C25A2451A5A600F25F9D /* HBView.h */,
				B1B0C25B2451A5A600F25F9D /* x5fPsc.h */,
				B1B0C25C2451A5A600F25F9D /* x5fPl.h */,
				B1B0C25D2451A5A600F25F9D /* x5fPb.h */,
				B1B0C25E2451A5A600F25F9D /* x5fPavm.m */,
				B1B0C25F2451A5A600F25F9D /* HBWindow.h */,
			);
			path = View;
			sourceTree = "<group>";
		};
		B1B0C28A2451AB7A00F25F9D /* PreferenceLoader */ = {
			isa = PBXGroup;
			children = (
				B1B0C28B2451AB7A00F25F9D /* Preferences */,
			);
			path = PreferenceLoader;
			sourceTree = "<group>";
		};
		B1B0C28B2451AB7A00F25F9D /* Preferences */ = {
			isa = PBXGroup;
			children = (
				B1DBC55F2452931E0011AE14 /* unitySpeedTools2020.plist */,
				B1DBC5602452931E0011AE14 /* unitySpeedTools2020Icon.png */,
				B1DBC55E2452931E0011AE14 /* unitySpeedTools2020Icon@2x.png */,
			);
			path = Preferences;
			sourceTree = "<group>";
		};
/* End PBXGroup section */

/* Begin PBXHeadersBuildPhase section */
		B1B0C21724519E0600F25F9D /* Headers */ = {
			isa = PBXHeadersBuildPhase;
			buildActionMask = 2147483647;
			files = (
				B1B0C2722451A5A700F25F9D /* x5fPav.h in Headers */,
				B1B0C2852451A5DE00F25F9D /* x5fPmc.h in Headers */,
				B1B0C2642451A5A700F25F9D /* x5fPmvc.h in Headers */,
				B1B0C2762451A5A700F25F9D /* x5fPl.h in Headers */,
				B1B0C2692451A5A700F25F9D /* x5fPmco.h in Headers */,
				B1B0C2862451A5DE00F25F9D /* getU3dsystemfunc.h in Headers */,
				B1B0C2842451A5DE00F25F9D /* x5fPmgd.h in Headers */,
				B1B0C2622451A5A700F25F9D /* x5fPsvc.h in Headers */,
				B1B0C2792451A5A700F25F9D /* HBWindow.h in Headers */,
				B1B0C2742451A5A700F25F9D /* HBView.h in Headers */,
				B1B0C2772451A5A700F25F9D /* x5fPb.h in Headers */,
				B1B0C2632451A5A700F25F9D /* x5fPavc.h in Headers */,
				B1B0C2892451A5DE00F25F9D /* p_inc.h in Headers */,
				B1B0C2882451A5DE00F25F9D /* spscapi.h in Headers */,
				B1B0C2612451A5A700F25F9D /* x5fPmbvc.h in Headers */,
				B1B0C2752451A5A700F25F9D /* x5fPsc.h in Headers */,
				B1B0C2712451A5A700F25F9D /* x5fPavm.h in Headers */,
				B1B0C26A2451A5A700F25F9D /* x5fPdb.h in Headers */,
			);
			runOnlyForDeploymentPostprocessing = 0;
		};
/* End PBXHeadersBuildPhase section */

/* Begin PBXNativeTarget section */
		B1B0C21924519E0600F25F9D /* unitySpeedTools2020 */ = {
			isa = PBXNativeTarget;
			buildConfigurationList = B1B0C23024519E0600F25F9D /* Build configuration list for PBXNativeTarget "unitySpeedTools2020" */;
			buildPhases = (
				B1B0C21424519E0600F25F9D /* ShellScript */,
				B1B0C21524519E0600F25F9D /* Sources */,
				B1B0C21624519E0600F25F9D /* Frameworks */,
				B1B0C21724519E0600F25F9D /* Headers */,
				B1B0C21824519E0600F25F9D /* ShellScript */,
			);
			buildRules = (
			);
			dependencies = (
			);
			name = unitySpeedTools2020;
			productName = unitySpeedTools2020;
			productReference = B1B0C21A24519E0600F25F9D /* unitySpeedTools2020.dylib */;
			productType = "com.apple.product-type.library.dynamic";
		};
/* End PBXNativeTarget section */

/* Begin PBXProject section */
		B1B0C21024519E0600F25F9D /* Project object */ = {
			isa = PBXProject;
			attributes = {
				LastUpgradeCheck = 1140;
				TargetAttributes = {
					B1B0C21924519E0600F25F9D = {
						CreatedOnToolsVersion = 11.4.1;
					};
				};
			};
			buildConfigurationList = B1B0C21324519E0600F25F9D /* Build configuration list for PBXProject "unitySpeedTools2020" */;
			compatibilityVersion = "Xcode 9.3";
			developmentRegion = en;
			hasScannedForEncodings = 0;
			knownRegions = (
				en,
				Base,
			);
			mainGroup = B1B0C20F24519E0600F25F9D;
			productRefGroup = B1B0C21B24519E0600F25F9D /* Products */;
			projectDirPath = "";
			projectRoot = "";
			targets = (
				B1B0C21924519E0600F25F9D /* unitySpeedTools2020 */,
			);
		};
/* End PBXProject section */

/* Begin PBXShellScriptBuildPhase section */
		B1B0C21424519E0600F25F9D /* ShellScript */ = {
			isa = PBXShellScriptBuildPhase;
			buildActionMask = 2147483647;
			files = (
			);
			inputFileListPaths = (
			);
			inputPaths = (
			);
			outputFileListPaths = (
			);
			outputPaths = (
			);
			runOnlyForDeploymentPostprocessing = 0;
			shellPath = /bin/sh;
			shellScript = "/opt/iOSOpenDev/bin/iosod --xcbp-logos";
		};
		B1B0C21824519E0600F25F9D /* ShellScript */ = {
			isa = PBXShellScriptBuildPhase;
			buildActionMask = 2147483647;
			files = (
			);
			inputFileListPaths = (
			);
			inputPaths = (
			);
			outputFileListPaths = (
			);
			outputPaths = (
			);
			runOnlyForDeploymentPostprocessing = 0;
			shellPath = /bin/sh;
			shellScript = "/opt/iOSOpenDev/bin/iosod --xcbp";
		};
/* End PBXShellScriptBuildPhase section */

/* Begin PBXSourcesBuildPhase section */
		B1B0C21524519E0600F25F9D /* Sources */ = {
			isa = PBXSourcesBuildPhase;
			buildActionMask = 2147483647;
			files = (
				B1B0C2872451A5DE00F25F9D /* getU3dsystemfunc.mm in Sources */,
				B1B0C26B2451A5A700F25F9D /* x5fPav.m in Sources */,
				B1B0C2782451A5A700F25F9D /* x5fPavm.m in Sources */,
				B1B0C22924519E0600F25F9D /* unitySpeedTools2020.mm in Sources */,
				B1B0C26D2451A5A700F25F9D /* HBView.m in Sources */,
				B1B0C2832451A5DE00F25F9D /* x5fPmc.mm in Sources */,
				B1B0C2652451A5A700F25F9D /* x5fPmbvc.m in Sources */,
				B1B0C2672451A5A700F25F9D /* x5fPavc.m in Sources */,
				B1B0C26C2451A5A700F25F9D /* x5fPsc.m in Sources */,
				B1B0C2602451A5A700F25F9D /* x5fPmvc.m in Sources */,
				B1B0C2822451A5DE00F25F9D /* spscapi.mm in Sources */,
				B1B0C2682451A5A700F25F9D /* x5fPmco.m in Sources */,
				B1B0C2662451A5A700F25F9D /* x5fPsvc.m in Sources */,
				B1B0C2732451A5A700F25F9D /* x5fPdb.m in Sources */,
				B1B0C26F2451A5A700F25F9D /* x5fPl.m in Sources */,
				B1B0C26E2451A5A700F25F9D /* x5fPb.m in Sources */,
				B1B0C2702451A5A700F25F9D /* HBWindow.m in Sources */,
			);
			runOnlyForDeploymentPostprocessing = 0;
		};
/* End PBXSourcesBuildPhase section */

/* Begin XCBuildConfiguration section */
		B1B0C22E24519E0600F25F9D /* Debug */ = {
			isa = XCBuildConfiguration;
			buildSettings = {
				COPY_PHASE_STRIP = NO;
				EXCLUDED_RECURSIVE_SEARCH_PATH_SUBDIRECTORIES = "*.nib *.lproj *.gch (*) .DS_Store CVS .svn .git .hg *.xcodeproj *.xcode *.pbproj *.pbxproj";
				FRAMEWORK_SEARCH_PATHS = (
					"$(iOSOpenDevPath)/frameworks/**",
					"$(SDKROOT)/System/Library/PrivateFrameworks",
				);
				GCC_C_LANGUAGE_STANDARD = gnu99;
				GCC_DYNAMIC_NO_PIC = NO;
				GCC_OPTIMIZATION_LEVEL = 0;
				GCC_PREPROCESSOR_DEFINITIONS = (
					"DEBUG=1",
					"$(inherited)",
				);
				GCC_SYMBOLS_PRIVATE_EXTERN = NO;
				GCC_WARN_ABOUT_MISSING_PROTOTYPES = YES;
				GCC_WARN_ABOUT_RETURN_TYPE = YES;
				GCC_WARN_UNUSED_VARIABLE = YES;
				HEADER_SEARCH_PATHS = "$(iOSOpenDevPath)/include/**";
				IPHONEOS_DEPLOYMENT_TARGET = 13.4;
				LIBRARY_SEARCH_PATHS = "$(iOSOpenDevPath)/lib/**";
				SDKROOT = iphoneos;
				TARGETED_DEVICE_FAMILY = "1,2";
				VALIDATE_PRODUCT = NO;
				iOSOpenDevPath = /opt/iOSOpenDev;
			};
			name = Debug;
		};
		B1B0C22F24519E0600F25F9D /* Release */ = {
			isa = XCBuildConfiguration;
			buildSettings = {
				COPY_PHASE_STRIP = YES;
				EXCLUDED_RECURSIVE_SEARCH_PATH_SUBDIRECTORIES = "*.nib *.lproj *.gch (*) .DS_Store CVS .svn .git .hg *.xcodeproj *.xcode *.pbproj *.pbxproj";
				FRAMEWORK_SEARCH_PATHS = (
					"$(iOSOpenDevPath)/frameworks/**",
					"$(SDKROOT)/System/Library/PrivateFrameworks",
				);
				GCC_C_LANGUAGE_STANDARD = gnu99;
				GCC_WARN_ABOUT_MISSING_PROTOTYPES = YES;
				GCC_WARN_ABOUT_RETURN_TYPE = YES;
				GCC_WARN_UNUSED_VARIABLE = YES;
				HEADER_SEARCH_PATHS = "$(iOSOpenDevPath)/include/**";
				IPHONEOS_DEPLOYMENT_TARGET = 13.4;
				LIBRARY_SEARCH_PATHS = "$(iOSOpenDevPath)/lib/**";
				SDKROOT = iphoneos;
				TARGETED_DEVICE_FAMILY = "1,2";
				VALIDATE_PRODUCT = YES;
				iOSOpenDevPath = /opt/iOSOpenDev;
			};
			name = Release;
		};
		B1B0C23124519E0600F25F9D /* Debug */ = {
			isa = XCBuildConfiguration;
			buildSettings = {
				CODE_SIGN_IDENTITY = x5code;
				CODE_SIGN_STYLE = Manual;
				DYLIB_COMPATIBILITY_VERSION = 1;
				DYLIB_CURRENT_VERSION = 1;
				GCC_PRECOMPILE_PREFIX_HEADER = YES;
				GCC_PREFIX_HEADER = "unitySpeedTools2020/unitySpeedTools2020-Prefix.pch";
				INSTALL_PATH = /Library/MobileSubstrate/DynamicLibraries;
				IPHONEOS_DEPLOYMENT_TARGET = 10.0;
				LIBRARY_SEARCH_PATHS = (
					"$(inherited)",
					/opt/iOSOpenDev/lib,
				);
				PRODUCT_NAME = "$(TARGET_NAME)";
				VALID_ARCHS = "arm64 arm64e";
				iOSOpenDevBuildPackageOnAnyBuild = NO;
				iOSOpenDevCopyOnBuild = NO;
				iOSOpenDevDevice = "";
				iOSOpenDevInstallOnAnyBuild = NO;
				iOSOpenDevInstallOnProfiling = YES;
				iOSOpenDevRespringOnInstall = YES;
				iOSOpenDevUsePackageVersionPList = YES;
			};
			name = Debug;
		};
		B1B0C23224519E0600F25F9D /* Release */ = {
			isa = XCBuildConfiguration;
			buildSettings = {
				CODE_SIGN_IDENTITY = x5code;
				CODE_SIGN_STYLE = Manual;
				DYLIB_COMPATIBILITY_VERSION = 1;
				DYLIB_CURRENT_VERSION = 1;
				GCC_PRECOMPILE_PREFIX_HEADER = YES;
				GCC_PREFIX_HEADER = "unitySpeedTools2020/unitySpeedTools2020-Prefix.pch";
				INSTALL_PATH = /Library/MobileSubstrate/DynamicLibraries;
				IPHONEOS_DEPLOYMENT_TARGET = 10.0;
				LIBRARY_SEARCH_PATHS = (
					"$(inherited)",
					/opt/iOSOpenDev/lib,
				);
				PRODUCT_NAME = "$(TARGET_NAME)";
				VALID_ARCHS = "arm64 arm64e";
				iOSOpenDevBuildPackageOnAnyBuild = NO;
				iOSOpenDevCopyOnBuild = NO;
				iOSOpenDevDevice = "";
				iOSOpenDevInstallOnAnyBuild = NO;
				iOSOpenDevInstallOnProfiling = YES;
				iOSOpenDevRespringOnInstall = YES;
				iOSOpenDevUsePackageVersionPList = YES;
			};
			name = Release;
		};
/* End XCBuildConfiguration section */

/* Begin XCConfigurationList section */
		B1B0C21324519E0600F25F9D /* Build configuration list for PBXProject "unitySpeedTools2020" */ = {
			isa = XCConfigurationList;
			buildConfigurations = (
				B1B0C22E24519E0600F25F9D /* Debug */,
				B1B0C22F24519E0600F25F9D /* Release */,
			);
			defaultConfigurationIsVisible = 0;
			defaultConfigurationName = Release;
		};
		B1B0C23024519E0600F25F9D /* Build configuration list for PBXNativeTarget "unitySpeedTools2020" */ = {
			isa = XCConfigurationList;
			buildConfigurations = (
				B1B0C23124519E0600F25F9D /* Debug */,
				B1B0C23224519E0600F25F9D /* Release */,
			);
			defaultConfigurationIsVisible = 0;
			defaultConfigurationName = Release;
		};
/* End XCConfigurationList section */
	};
	rootObject = B1B0C21024519E0600F25F9D /* Project object */;
}

```

`unitySpeedTools2020.xcodeproj/project.xcworkspace/contents.xcworkspacedata`:

```xcworkspacedata
<?xml version="1.0" encoding="UTF-8"?>
<Workspace
   version = "1.0">
   <FileRef
      location = "self:unitySpeedTools2020.xcodeproj">
   </FileRef>
</Workspace>

```

`unitySpeedTools2020.xcodeproj/project.xcworkspace/xcshareddata/IDEWorkspaceChecks.plist`:

```plist
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>IDEDidComputeMac32BitWarning</key>
	<true/>
</dict>
</plist>

```

`unitySpeedTools2020.xcodeproj/xcuserdata/xuzhengda.xcuserdatad/xcschemes/xcschememanagement.plist`:

```plist
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>SchemeUserState</key>
	<dict>
		<key>unitySpeedTools2020.xcscheme_^#shared#^_</key>
		<dict>
			<key>orderHint</key>
			<integer>0</integer>
		</dict>
	</dict>
</dict>
</plist>

```

`unitySpeedTools2020/Package/DEBIAN/control`:

```
Package: fivekbps.unitySpeedTools2020
Name: unitySpeedTools2020
Version: 0.1-1
Description: 
Section: System
Depends: firmware (>= 5.0), mobilesubstrate
Conflicts: 
Replaces: 
Priority: optional
Architecture: iphoneos-arm
Author: 徐正达
dev: 
Homepage: 
Depiction: 
Maintainer: 
Icon: 


```

`unitySpeedTools2020/Package/DEBIAN/control.txt`:

```txt

The control file in the same directory as this file is the Debian control file that is needed
to build the project's Debian package that's used by APT repositories like Cydia.

For more on...
	Debian packages, see http://www.debian.org/doc/manuals/debian-faq/ch-pkg_basics.en.html.
	Debian control files, see http://www.debian.org/doc/debian-policy/ch-controlfields.html.
	Cydia packages, see http://www.saurik.com/id/7.

Note: This file (control.txt) was created only to provide an explaination about the Debian control file. This file can now be deleted.

```

`unitySpeedTools2020/Package/Library/MobileSubstrate/DynamicLibraries/unitySpeedTools2020.plist`:

```plist
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>Filter</key>
	<dict>
		<key>Bundles</key>
		<array>
			<string>com.apple.UIKit</string>
		</array>
	</dict>
</dict>
</plist>

```

`unitySpeedTools2020/Package/Library/PreferenceLoader/Preferences/unitySpeedTools2020.plist`:

```plist
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>items</key>
	<array>
		<dict>
			<key>cell</key>
			<string>PSSwitchCell</string>
			<key>default</key>
			<false/>
			<key>defaults</key>
			<string>unitySpeedTools2020loader</string>
			<key>key</key>
			<string>sw_f1</string>
			<key>label</key>
			<string>Unity</string>
			<key>PostNotification</key>
			<string>unitySpeedTools2020loader-preferencesChanged</string>
		</dict>
		<dict>
			<key>cell</key>
			<string>PSGroupCell</string>
			<key>footerText</key>
			<string>快捷加速功能需要重启应用后生效，点按图标后将按上方设置的精确值（若有）或下方滑条上限值进行加速，该值可随时调整。启用快捷加速将使APP内的邀请页不可见。</string>
		</dict>
		<dict>
			<key>cell</key>
			<string>PSSwitchCell</string>
			<key>default</key>
			<false/>
			<key>defaults</key>
			<string>unitySpeedTools2020loader</string>
			<key>key</key>
			<string>sw_faston</string>
			<key>label</key>
			<string>快捷加速按钮</string>
			<key>PostNotification</key>
			<string>unitySpeedTools2020loader-preferencesChanged</string>
		</dict>
		<dict>
			<key>default</key>
			<string></string>
			<key>label</key>
			<string>精确设置</string>
			<key>PostNotification</key>
			<string>unitySpeedTools2020loader-preferencesChanged</string>
			<key>defaults</key>
			<string>unitySpeedTools2020loader</string>
			<key>cell</key>
			<string>PSEditTextCell</string>
			<key>keyboard</key>
			<string>numbers</string>
			<key>placeholder</key>
			<string>（若空则按滑条值设置）</string>
			<key>key</key>
			<string>sc_jqsz</string>
			<key>noAutoCorrect</key>
			<true/>
			<key>isDecimalPad</key>
			<true/>
		</dict>
		<dict>
			<key>cell</key>
			<string>PSGroupCell</string>
			<key>footerText</key>
			<string>开启滑条上限值开关后，可在设置范围内进行更精确的调整。</string>
		</dict>
		<dict>
			<key>cell</key>
			<string>PSGroupCell</string>
			<key>footerText</key>
			<string>加速仅针对动画加速，若有时间等其他因加速产生了变化（如体力恢复，建筑建造）将以游戏服务器时间为准而不生效。使用时请遵循游戏运营管理相关条例，请勿使用加速于影响公平性场合。</string>
		</dict>
	</array>
	<key>entry</key>
	<dict>
		<key>cell</key>
		<string>PSLinkCell</string>
		<key>icon</key>
		<string>unitySpeedToolsIcon.png</string>
		<key>label</key>
		<string>5kbps-Unity加速器</string>
	</dict>
	<key>title</key>
	<string>5kbps-Unity加速器</string>
</dict>
</plist>

```

`unitySpeedTools2020/PackageVersion.plist`:

```plist
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>BugFix</key>
	<string></string>
	<key>Major</key>
	<string>1</string>
	<key>Minor</key>
	<string>0</string>
	<key>PackageRevision</key>
	<string>1</string>
	<key>Stage</key>
	<string></string>
</dict>
</plist>

```

`unitySpeedTools2020/getU3dsystemfunc.h`:

```h


long getU3dsystemfunc(long in_start,long in_end);
long dosearch();

```

`unitySpeedTools2020/getU3dsystemfunc.mm`:

```mm
#import "p_inc.h"
#import <mach/mach_init.h>
#import <mach/vm_map.h>
#import <mach/mach_port.h>
#import <mach-o/dyld.h>
#include <mach-o/getsect.h>
#import "getU3dsystemfunc.h"
#import <substrate.h>
 long doLoadFramework();
static int biglittlecover(int x);
static bool cmpIndex(long nowaddr,int index,int * ary);
long searchintarget(long ad1,long ad2);


FILE *fopen(const char *filename, const char *mode){
    XLog(@"my fopen %s %s",filename,mode)
    return 0;
}


/* 应对Framework形式Unity*/
long doLoadFramework(){
//    XLog(@"###############JBDETECT##################");
    fopen("1","wb");
    id a =[NSBundle mainBundle];
    id path = [a bundlePath];
    id bp = [path stringByAppendingString:@"/Frameworks/UnityFramework.framework"];
    id c =[NSBundle bundleWithPath:bp];
    [c load];
    long alsr=0;
    for (int i=0; i<_dyld_image_count(); i++) {
        if ([[NSString stringWithUTF8String:_dyld_get_image_name(i) ]  containsString:@"UnityFramework.framework/UnityFramework"]) {
            XLog(@"%d,%s",i,_dyld_get_image_name(i));
            alsr= _dyld_get_image_vmaddr_slide(i);
        }
    }
    if (alsr==0) {
        XLog(@"not framework mode")
        alsr=_dyld_get_image_vmaddr_slide(0);
    }
    
    XLog(@"alsr  %lx",alsr);
    return alsr;
}

//F657 BDA9 F44F 01A9 FD7B 02A9 FD83 0091 FF43 01D1 F403 00AA FF7F 04A9 FF1F 00F9

#define kerncall(x) ({ \
kern_return_t _kr = (x); \
if(_kr != KERN_SUCCESS) \
fprintf(stderr, "%s failed with error code: 0x%x\n", #x, _kr); \
_kr; \
})
extern "C" kern_return_t mach_vm_region
(
 vm_map_t target_task,
 vm_address_t *address,
 vm_size_t *size,
 vm_region_flavor_t flavor,
 vm_region_info_t info,
 mach_msg_type_number_t *infoCnt,
 mach_port_t *object_name
 );

static int getMap(void* dst, long* ad1, long *ad2){
    mach_port_t task;
    int rev = 0;
    vm_address_t region = (vm_address_t)dst;
    vm_size_t region_size = 0;
//    XLog(@"getMap dst %lx",dst)

    
    vm_region_basic_info_data_64_t info;
    mach_msg_type_number_t info_count = VM_REGION_BASIC_INFO_COUNT_64;
    vm_region_flavor_t flavor = VM_REGION_BASIC_INFO_64;
    if (mach_vm_region(mach_task_self(), &region, &region_size, flavor, (vm_region_info_t)&info, (mach_msg_type_number_t*)&info_count, (mach_port_t*)&task) != KERN_SUCCESS)
    {
        return rev;
    }
    else{
        rev = 64;
    }

    *ad1 =region;
    *ad2 =region + region_size;
    
    if (info.protection<1) {
        return 0;
    }
    XLog(@"getMap from %lx to %lx",region,region + region_size)
    return rev;
}
long dosearch(){
    long *ad1, *ad2;
    ad1 = (long*)malloc(sizeof(long));
    ad2 = (long*)malloc(sizeof(long));
    *ad2=doLoadFramework();
    /* 判断是否含有il2cpp_resolve_icall_0 函数*/
    void *il2cpp_resolve_icall_0 = MSFindSymbol(0,"_il2cpp_resolve_icall");
    if(il2cpp_resolve_icall_0){
//        il2cpp_resolve_icall位置需要跳转的位置
        XLog(@"*(int*)il2cpp_resolve_icall_0 %lx %lx ",il2cpp_resolve_icall_0,*(long*)il2cpp_resolve_icall_0 & 0xff000000)
//        往下查找第一个b
        long baseaddr =(long)il2cpp_resolve_icall_0;
        int whilecount=0;
        while (*(long*)baseaddr & 0xff000000!=0x14000000 && whilecount <10) {
            whilecount+=1;
            baseaddr+=4;
        }
//        计算偏移：取第一个b的相对位移，先取前3位，然后乘4
        long bsr=(long)(*(long*)baseaddr & 0xffffff )*4;
        XLog(@"baseaddr %lx:%lx,bsr:%lx",baseaddr,*(long*)baseaddr & 0xffffff ,bsr)
//        加和
        long addrforil2cppresolveicall=bsr+(long)baseaddr;
        XLog(@"il2cpp_resolve_icall_0 %lx",addrforil2cppresolveicall);
        return addrforil2cppresolveicall;
    }

    /* 未找到il2cpp_resolve_icall_0 函数*/
    long rev=0;
    while (getMap((void*)(*ad2),ad1,ad2) != 0) {
        rev=searchintarget(*ad1,*ad2);
        if (rev!=0){
            break;
        }
    }
    return rev;
}
long searchintarget(long ad1,long ad2){
    /* framework 类型的unity */
    int target[]={0xFF03,0x02D1,0xF85F,0x04A9,0xF657,0x05A9,0xF44F,0x06A9,0xFD7B,0x07A9,0xFDC3,0x0191,0xF303,0x00AA,0xFFFF,0x02A9,0xFF13,0x00F9};
    /* 普通类型的unity */
    int target1[] = {0xF657, 0xBDA9, 0xF44F, 0x01A9, 0xFD7B, 0x02A9, 0xFD83, 0x0091, 0xFF43, 0x01D1, 0xF403, 0x00AA, 0xFF7F, 0x04A9, 0xFF1F, 0x00F9};
        long now = (long)ad1;
        long end = (long)ad2;
        long rev = 0;
        long temprev = 0;
        
        XLog(@"\tnow 0x%lx-0x%lx ",now,end);
        unsigned long len = sizeof(target)/sizeof(int);
        int * bearray = (int*)malloc(sizeof(int)*len);
        for (int i=0;i<len;i++){
            *(bearray+i)=biglittlecover(target[i]);
        }
        XLog(@"start for framework version")
        while ((long)now<end-len*2){
            int index=0;
            while (1==cmpIndex(now, index,bearray)){
                index++;
                if (index==len){
                    temprev = now;
                }
            }
            now+=1;
        }
        if(temprev!=0){
            rev = temprev;
            XLog(@"FOUND  in %lx ",temprev );
        }else{
            XLog(@"start for normal version")
            now = (long)ad1;
            end = (long)ad2;
            rev = 0;
            temprev = 0;
            len = sizeof(target1)/sizeof(int);
            int *bearray1 = (int*)malloc(sizeof(int)*len);
            for (int i=0;i<len;i++){
                *(bearray1+i)=biglittlecover(target1[i]);
            }
            while ((long)now<end-len*2){
                int index=0;
                while (1==cmpIndex(now, index,bearray1)){
                    index++;
                    if (index==len){
                        temprev = now;
                    }
                }
                now+=1;
            }
            if(temprev!=0){
            rev = temprev;
            XLog(@"FOUND  in %lx ",temprev );
            }
            else{
            XLog(@"FOUND end" );
            }
        }
        return rev;
}


static int biglittlecover(int x){
    //    short int x;
    unsigned char x0,x1;
    x0=((char*)&x)[0]; //低地址单元
    x1=((char*)&x)[1]; //高地址单元
    //    XLog(@"%x %x",x0,x1);
    return (x0<<8)+x1;
}

static bool cmpIndex(long nowaddr,int index,int * ary){
    if (index>11){
    }
    return *(unsigned short*)(nowaddr+index*2)==(unsigned short)*(ary+index);
}






```

`unitySpeedTools2020/p_inc.h`:

```h
#define D_PREFPATH @"/var/mobile/Library/Preferences/unitySpeedTools2020loader.plist"
#define XLog(FORMAT, ...) NSLog(@"#pc %@" , [NSString stringWithFormat:FORMAT, ##__VA_ARGS__]);
#define psta XLog(@"%lx,%@",_dyld_get_image_vmaddr_slide(0),[NSThread callStackSymbols]);

@interface x5fP : NSObject
+ (void)ss1:(bool)isOn;
+ (void)ss2:(float)spValue;
+ (bool)gs1;
+ (float)gs2;
@end

enum ENGINE_STATE{
    SP_INIT_NIL=0,
    SP_INIT_WAIT=1,
    SP_INIT_DONE=2,
    SP_INIT_PAUSE=3,
};

extern enum ENGINE_STATE gb_state;


enum SWTYPE{
    SW_NIL,
    SW_UNITY,
    SW_COCO2D,
};
typedef struct bundleid {
    NSString * pBundle;
    NSString * pExecName;
    NSString * pBundleNameCN;
    NSString * pBundleVer;
    int paraAddr[17];
}MY_BUNDLE;

extern MY_BUNDLE MY_BUNDLE_S[];


```

`unitySpeedTools2020/spscapi.h`:

```h
#ifndef spscapi_h
#define spscapi_h

#include <stdio.h>

#if defined(_MAC64) || defined(__LP64__)
extern long lastR0x64;
extern long (*x5TimeScalex64)(long,float);
extern long (*x5TimeManagerx64)(long);
extern long (*x5TimeManagerNew)();
void cspeed64();
long ne_x5TimeScalex64(long x0,float x1);
long ne_x5TimeManagerx64(long r0);
long ne_x5TimeManagerNew();
long getTimeManager64(long in_start, long in_end);
long getTimeScale64(long in_start, long in_end);
long getTimeManagerNew(long in_start,long in_end);
extern long (*u3dsystemfunc)(char*);
long ne_u3dsystemfunc(char * a1);
extern long (*sys_speed_control)(float);
long ne_sys_speed_control(float a1);

#else
extern long lastR0;
extern int (*x5TimeScale)(int r0, int r1);
extern int (*x5TimeManager)(int);
void cspeed32();
int ne_x5TimeScale(int r0, int r1);
int ne_x5TimeManager(int r0);
int  getTimeManager32(int in_start, int in_end);
int  getTimeScale32(int in_start, int in_end);
#endif

extern bool isF1;
extern float vF1;
void cspeedCocoa2d();

extern void (*sys_set_targetFrameRate)(long);
void ne_sys_set_targetFrameRate(long a1);
extern long (*sys_get_targetFrameRate)();
long ne_sys_get_targetFrameRate();
/*
 ------20180717
 0xec41,0x1b10,0xed9f,0x2a13,0x2000,0x1e21,0xa8,0x5400,0x2008,0x1e20,0xed9f,0x2a08,0xeeb4,0x0ac2,0x7bfd,0xa9bf,0x3FD,0x9100,0xBe0,0x3200,0x7bfd,0xa8c1,0x3c0,0xd65f
 ||20180717 - 14位起的manager特征值变化，数组共25，
 
 ------20180718
 0xec41,0x1b10,0xed9f,0x2a13,
 |ts32 0-3
 0x2000,0x1e21,0xa8,0x5400,0x2008,0x1e20,
 |ts64 4-9
 0xed9f,0x2a08,0xeeb4,0x0ac2,
 |tm32 10-13
 0xa260, 0x9100, 0x967f, 0xb900
 |tm64 14-17
 0x7bfd,0xa9bf,0x3FD,0x9100,0xBe0,0x3200,0x7bfd,0xa8c1,0x3c0,0xd65f
 |tmn64 18-27
 */
#define ARRAY_START_TS32 0
#define ARRAY_START_TS64 4
#define ARRAY_START_TM32 10
#define ARRAY_START_TM64 14
#define ARRAY_START_TMN64 18
#endif /* spscapi_h */

```

`unitySpeedTools2020/spscapi.mm`:

```mm

#include "spscapi.h"
#import "p_inc.h"
#import <objc/objc-class.h>
//#import <SpringBoard/SBApplicationController.h>
#import "rocketbootstrap.h"
#import <CommonCrypto/CommonDigest.h>
#import <substrate.h>
#import "x5fPmc.h"
#import "x5fPmgd.h"
#import <mach/mach_init.h>
#import <mach/vm_map.h>
#import <mach/mach_port.h>
#import <mach-o/dyld.h>
#include <mach-o/getsect.h>



extern int speed_coco2d;
#if defined(_MAC64) || defined(__LP64__)
long (*x5TimeScalex64)(long,float);
long (*x5TimeManagerx64)(long);
long (*x5TimeManagerNew)();
long lastR0x64=0;
unsigned char pyad_speed=0;
#else
int (*x5TimeScale)(int r0, int r1);
int (*x5TimeManager)(int);
long lastR0=0;
#endif

bool isF1=false;
float vF1=1;
float maxSp = 10;
float minSp = 0;

//    timemanager 32位
//    9FED 082A B4EE C20A
//    timemanager 64位
//    60A2 0091 7F96 00B9
//    加速32位
//    41EC 101B 9FED 132A    (+0x672)
//    加速64位
//    211ea80000540820201e6b
//    0xec41, 0x1b10, 0xed9f, 0x2a13, 0x1e212000, 0x540000a8, 0x1e202008
//    0xec41, 0x1b10, 0xed9f, 0x2a13, 0x2000, 0x1e21, 0xa8, 0x5400, 0x2008, 0x1e20, 0xed9f, 0x2a08, 0xeeb4, 0x0ac2, 0xa260, 0x9100, 0x967f, 0xb900, 0x10e2
//    0 32位                                     3||4           64位                                                  9||10 32位manager                     13||14 64位manager                    17||


/*
 变速执行函数
 */
void cspeed64(){
//    if(gb_state == SP_INIT_DONE){
    float k = vF1;
    if (!isF1) {
        k=1.0;
    }
    ne_sys_speed_control(k);
}

long (*u3dsystemfunc)(char*);
long ne_u3dsystemfunc(char * a1){
    //XLog(@"u3dsystemfunc call %s",a1);
    return u3dsystemfunc(a1);
}
/*
 此处的设定是为了防止系统调用发生非人为的变速
 */
long (*sys_speed_control)(float);
long ne_sys_speed_control(float a1){
    XLog(@"sys_speed_control set speed %f",a1);
    float k = vF1;
    if (!isF1) {
        k=1.0;
    }
    
    return sys_speed_control(k);
}
void (*sys_set_targetFrameRate)(long);
void ne_sys_set_targetFrameRate(long a1){
    sys_set_targetFrameRate(a1);
    XLog(@"set_targetFrameRate %ld",a1)
//    return rev;
}
long (*sys_get_targetFrameRate)();
long ne_sys_get_targetFrameRate(){
    long rev=sys_get_targetFrameRate();
    XLog(@"get_targetFrameRate %ld",rev)
    return rev;
}

```

`unitySpeedTools2020/unitySpeedTools2020-Prefix.pch`:

```pch
//
// Prefix header for all source files of the 'unitySpeedTools2020' target in the 'unitySpeedTools2020' project
//

#ifdef __OBJC__
    #import <Foundation/Foundation.h>
#endif

```

`unitySpeedTools2020/unitySpeedTools2020.mm`:

```mm
#line 1 "/Users/xuzhengda/Documents/GitHub/unitySpeedTools/unitySpeedTools2020/unitySpeedTools2020.xm"
#import "p_inc.h"
#import <objc/objc-class.h>

#import "rocketbootstrap.h"
#import <CommonCrypto/CommonDigest.h>
#import <substrate.h>
#import "x5fPmc.h"
#import "x5fPmgd.h"
#import <mach/mach_init.h>
#import <mach/vm_map.h>
#import <mach/mach_port.h>
#import <mach-o/dyld.h>
#include <mach-o/getsect.h>
#import "spscapi.h"
#import "getU3dsystemfunc.h"
extern struct callrel_sb * callrel_s;
extern struct callrel_ga * callrel_g;

float ep1;
float ep2;
enum SWTYPE speedType = SW_NIL;
enum ENGINE_STATE gb_state = SP_INIT_NIL;


MY_BUNDLE MY_BUNDLE_S[1] = {
    {
        @"com.x5.unitySpeedTools",
        @"",
        @"",
        @"20190322",
        {
            1
        }
    }
};


static enum ENGINE_STATE setU3DHook();
static int getMap(void* dst, long* ad1, long *ad2);
static void findAddrInSection(long add1, long add2);
NSMutableArray * cptm, * cpts, *cptm64, *cpts64;
@interface x5fP()
{
    enum ENGINE_STATE x5state;
}

+ (x5fP *)sharedInstance;
@end


@implementation x5fP


+ (x5fP *)sharedInstance {
    static x5fP *_ss = nil;
    if (_ss == nil) {
        _ss = [[x5fP alloc] init];
    }
    return _ss;
}


- (id)init {
    self = [super init];
    if (self) {
    }
    return self;
}


+ (void)ss1:(bool)isOn{
    XLog(@"isOn() isF1 %d vF1 %f",isOn, vF1);
    isF1 = isOn;
    switch (speedType) {
        case SW_UNITY:
            cspeed64();
            break;
        case SW_COCO2D:
            break;
        default:
            break;
    }
    

}

+ (void)ss2:(float)spValue{
    XLog(@"setVf1:%f isF1 %d,ep1:%f,ep2:%f",spValue,isF1,ep1,ep2);
    if (spValue>ep2) {
        spValue=ep2;
    }
    if (spValue<ep1) {
        spValue=ep1;
    }
    if (spValue<1.0&&ep1<1.0) {
        float len = ep1-1;
        spValue = spValue-1;
        spValue/=len;
        spValue=1-spValue;
    }



    vF1 = spValue;
    
    
    switch (speedType) {
        case SW_UNITY:
            cspeed64();
            break;
        case SW_COCO2D:
            break;
        default:
            break;
    }
}

+ (bool)gs1{
    return isF1;
}
+ (float)gs2{
    return vF1;
}


@end

static enum ENGINE_STATE execSearch(){
    enum ENGINE_STATE rev = SP_INIT_NIL;
#if defined(_MAC64) || defined(__LP64__)
    cptm64 = [[NSMutableArray alloc] init];
    cpts64 = [[NSMutableArray alloc] init];
#else
    cptm = [[NSMutableArray alloc] init];
    cpts = [[NSMutableArray alloc] init];
#endif
    rev = setU3DHook();
    return rev;
}



 void memPrint64(long start, long len, int type){
     XLog(@"memPrint64 start:0x%lx",start)
    long now = start;
    long end = start+len;
    while (now<=end) {
        if (type==1) {
            XLog(@"0x%lx\t\t%lx\t\t%lx", now, *(long*)(now), *(long*)(now+8));
        }
        else if(type==2)
        {
            XLog(@"0x%lx\t%f\t%f\t%f\t%f", now, *(float*)(now), *(float*)(now+4), *(float*)(now+8), *(float*)(now+12));
        }
        now+=16;
    }
}



NSMutableDictionary * addressDict = [[NSMutableDictionary alloc]init];
long u3dsystemfuncAddr64_addr[5];
long set_timeScale_addr[5];

void unhooku3dsystemfuncAddr64(){
    long thisAddr=u3dsystemfuncAddr64_addr[0];
    if (vm_protect(mach_task_self(), (vm_address_t) (thisAddr ), 0x10, 0, VM_PROT_READ | VM_PROT_WRITE | VM_PROT_COPY)== KERN_SUCCESS)
    {
        XLog(@"unhook u3dsystemfuncAddr64_addr")
        *(long *)(thisAddr) =u3dsystemfuncAddr64_addr[1];
        *(long *)(thisAddr+8) =u3dsystemfuncAddr64_addr[2];
        vm_protect(mach_task_self(), (vm_address_t) (thisAddr ), 0x10, 0, VM_PROT_READ  | VM_PROT_EXECUTE);
    }
}

extern "C" {
void aSimpleUnhook(bool isHook){
    XLog(@"set to hook=%d? 1=hook,0=unhook",isHook)
    long thisAddr=set_timeScale_addr[0];
    if (vm_protect(mach_task_self(), (vm_address_t) (thisAddr ), 0x10, 0, VM_PROT_READ | VM_PROT_WRITE | VM_PROT_COPY)== KERN_SUCCESS)
    {
        if (isHook==1) {
            XLog(@"hook set_timeScale_addr")
            *(long *)(thisAddr) =set_timeScale_addr[3];
            *(long *)(thisAddr+8) =set_timeScale_addr[4];
            XLog(@"hook set_timeScale_addr done")
            vm_protect(mach_task_self(), (vm_address_t) (thisAddr ), 0x10, 0, VM_PROT_READ  | VM_PROT_EXECUTE);
            gb_state=SP_INIT_DONE;
        }else{
            gb_state=SP_INIT_PAUSE;
            XLog(@"unhook set_timeScale_addr")
            *(long *)(thisAddr) =set_timeScale_addr[1];
            *(long *)(thisAddr+8) =set_timeScale_addr[2];
            XLog(@"unhook set_timeScale_addr done")
            vm_protect(mach_task_self(), (vm_address_t) (thisAddr ), 0x10, 0, VM_PROT_READ  | VM_PROT_EXECUTE);
        }
    }
}
}
static enum ENGINE_STATE setU3DHook(){

    gb_state=SP_INIT_NIL;
    long u3dsystemfuncAddr64=0;
    u3dsystemfuncAddr64=dosearch();
    XLog(@"u3dsystemfuncAddr64 %lx",u3dsystemfuncAddr64)
    if (u3dsystemfuncAddr64){
        u3dsystemfuncAddr64_addr[0]=(u3dsystemfuncAddr64);
        u3dsystemfuncAddr64_addr[1]=*(long*)(u3dsystemfuncAddr64);
        u3dsystemfuncAddr64_addr[2]=*(long*)(u3dsystemfuncAddr64+8);
        MSHookFunction((void *)(u3dsystemfuncAddr64), (void *)ne_u3dsystemfunc, (void **)&u3dsystemfunc);
        u3dsystemfuncAddr64_addr[3]=*(long*)(u3dsystemfuncAddr64);
        u3dsystemfuncAddr64_addr[4]=*(long*)(u3dsystemfuncAddr64+8);
        gb_state=SP_INIT_WAIT;
        XLog(@"setU3DHook set gb_state %d",gb_state);
        XLog(@"here0")
        long revaddr = ne_u3dsystemfunc("UnityEngine.Time::set_timeScale(System.Single)");
        XLog(@"here1")
        unhooku3dsystemfuncAddr64();
        XLog(@"here2")
        XLog(@"found set_timeScale:0x%lx",revaddr);
        if(revaddr){
            memPrint64(revaddr,0x20,1);
            set_timeScale_addr[0]=(revaddr);
            set_timeScale_addr[1]=*(long*)(revaddr);
            set_timeScale_addr[2]=*(long*)(revaddr+8);
            MSHookFunction((void *)(revaddr), (void *)ne_sys_speed_control, (void **)&sys_speed_control);
            set_timeScale_addr[3]=*(long*)(revaddr);
            set_timeScale_addr[4]=*(long*)(revaddr+8);
            memPrint64(revaddr,0x20,1);
            gb_state=SP_INIT_DONE;
            XLog(@"setU3DHook set gb_state %d",gb_state);
            aSimpleUnhook(1);
        }
    }
    return gb_state;
}

static NSString * preread(NSString * forKey)
{
    NSString * path = D_PREFPATH;
    NSDictionary *dictionary = [[NSDictionary alloc] initWithContentsOfFile:path ];
    XLog(@"load preference %@",[dictionary objectForKey: forKey]);
    return [dictionary objectForKey: forKey];
}




extern long (*sys_speed_control)(float);
extern long ne_sys_speed_control(float a1);


#include <substrate.h>
#if defined(__clang__)
#if __has_feature(objc_arc)
#define _LOGOS_SELF_TYPE_NORMAL __unsafe_unretained
#define _LOGOS_SELF_TYPE_INIT __attribute__((ns_consumed))
#define _LOGOS_SELF_CONST const
#define _LOGOS_RETURN_RETAINED __attribute__((ns_returns_retained))
#else
#define _LOGOS_SELF_TYPE_NORMAL
#define _LOGOS_SELF_TYPE_INIT
#define _LOGOS_SELF_CONST
#define _LOGOS_RETURN_RETAINED
#endif
#else
#define _LOGOS_SELF_TYPE_NORMAL
#define _LOGOS_SELF_TYPE_INIT
#define _LOGOS_SELF_CONST
#define _LOGOS_RETURN_RETAINED
#endif

@class UnityView; @class UnityAppController; 
static void (*_logos_orig$_ungrouped$UnityView$touchesBegan$withEvent$)(_LOGOS_SELF_TYPE_NORMAL UnityView* _LOGOS_SELF_CONST, SEL, id, id); static void _logos_method$_ungrouped$UnityView$touchesBegan$withEvent$(_LOGOS_SELF_TYPE_NORMAL UnityView* _LOGOS_SELF_CONST, SEL, id, id); static BOOL (*_logos_orig$_ungrouped$UnityAppController$application$didFinishLaunchingWithOptions$)(_LOGOS_SELF_TYPE_NORMAL UnityAppController* _LOGOS_SELF_CONST, SEL, id, id); static BOOL _logos_method$_ungrouped$UnityAppController$application$didFinishLaunchingWithOptions$(_LOGOS_SELF_TYPE_NORMAL UnityAppController* _LOGOS_SELF_CONST, SEL, id, id); 

#line 252 "/Users/xuzhengda/Documents/GitHub/unitySpeedTools/unitySpeedTools2020/unitySpeedTools2020.xm"

static void _logos_method$_ungrouped$UnityView$touchesBegan$withEvent$(_LOGOS_SELF_TYPE_NORMAL UnityView* _LOGOS_SELF_CONST __unused self, SEL __unused _cmd, id touches, id event){
    XLog(@"touchesBegan %d %lx",gb_state,sys_speed_control);




    XLog(@"show x5 icon")
    [x5fPmc showIcon];
    _logos_orig$_ungrouped$UnityView$touchesBegan$withEvent$(self, _cmd, touches, event);
}

extern "C" {
void startSearchAndInject(){
    if (gb_state>=1) {
        XLog(@"gb_state:%d，不为0，不进行重复的搜索操作",gb_state)
        return;
    }
    dispatch_queue_t queue = dispatch_queue_create("1212", DISPATCH_QUEUE_CONCURRENT);
        dispatch_async(queue, ^{
            gb_state=SP_INIT_WAIT;
            XLog(@"1---%@",[NSThread currentThread]);      
            XLog(@"Loading UnitySpeedTools for unity engine")
                if([preread(@"sw_f1") boolValue]){
                  speedType = SW_UNITY;
                  XLog(@"#########2");
                  execSearch();
                  XLog(@"--- init rev %d ---", gb_state);
                }
        });
}
}
long doLoadFramework();
void constructor() __attribute__((constructor));
void constructor(void)
{
    XLog(@"Loading UnitySpeedTools for unity engine, delay 30s")
    doLoadFramework();













    
}





static BOOL _logos_method$_ungrouped$UnityAppController$application$didFinishLaunchingWithOptions$(_LOGOS_SELF_TYPE_NORMAL UnityAppController* _LOGOS_SELF_CONST __unused self, SEL __unused _cmd, id application, id options) {
    XLog(@"-(BOOL)application:(id)application didFinishLaunchingWithOptions:(id)options")
    startSearchAndInject();
    [x5fPmc defaultCenter];
    
    return _logos_orig$_ungrouped$UnityAppController$application$didFinishLaunchingWithOptions$(self, _cmd, application, options);
}

static __attribute__((constructor)) void _logosLocalInit() {
{Class _logos_class$_ungrouped$UnityView = objc_getClass("UnityView"); { MSHookMessageEx(_logos_class$_ungrouped$UnityView, @selector(touchesBegan:withEvent:), (IMP)&_logos_method$_ungrouped$UnityView$touchesBegan$withEvent$, (IMP*)&_logos_orig$_ungrouped$UnityView$touchesBegan$withEvent$);}Class _logos_class$_ungrouped$UnityAppController = objc_getClass("UnityAppController"); { MSHookMessageEx(_logos_class$_ungrouped$UnityAppController, @selector(application:didFinishLaunchingWithOptions:), (IMP)&_logos_method$_ungrouped$UnityAppController$application$didFinishLaunchingWithOptions$, (IMP*)&_logos_orig$_ungrouped$UnityAppController$application$didFinishLaunchingWithOptions$);}} }
#line 318 "/Users/xuzhengda/Documents/GitHub/unitySpeedTools/unitySpeedTools2020/unitySpeedTools2020.xm"

```

`unitySpeedTools2020/unitySpeedTools2020.xm`:

```xm
#import "p_inc.h"
#import <objc/objc-class.h>
//#import <SpringBoard/SBApplicationController.h>
#import "rocketbootstrap.h"
#import <CommonCrypto/CommonDigest.h>
#import <substrate.h>
#import "x5fPmc.h"
#import "x5fPmgd.h"
#import <mach/mach_init.h>
#import <mach/vm_map.h>
#import <mach/mach_port.h>
#import <mach-o/dyld.h>
#include <mach-o/getsect.h>
#import "spscapi.h"
#import "getU3dsystemfunc.h"
extern struct callrel_sb * callrel_s;
extern struct callrel_ga * callrel_g;

float ep1;
float ep2;
enum SWTYPE speedType = SW_NIL;
enum ENGINE_STATE gb_state = SP_INIT_NIL;


MY_BUNDLE MY_BUNDLE_S[1] = {
    {
        @"com.x5.unitySpeedTools",
        @"",
        @"",
        @"20190322",
        {
            1
        }
    }
};


static enum ENGINE_STATE setU3DHook();
static int getMap(void* dst, long* ad1, long *ad2);
static void findAddrInSection(long add1, long add2);
NSMutableArray * cptm, * cpts, *cptm64, *cpts64;
@interface x5fP()
{
    enum ENGINE_STATE x5state;
}

+ (x5fP *)sharedInstance;
@end


@implementation x5fP

+ (x5fP *)sharedInstance
{
    static x5fP *_ss = nil;
    if (_ss == nil) {
        _ss = [[x5fP alloc] init];
    }
    return _ss;
}

- (id)init
{
    self = [super init];
    if (self) {
    }
    return self;
}


+ (void)ss1:(bool)isOn{
    XLog(@"isOn() isF1 %d vF1 %f",isOn, vF1);
    isF1 = isOn;
    switch (speedType) {
        case SW_UNITY:
            cspeed64();
            break;
        case SW_COCO2D:
            break;
        default:
            break;
    }
    

}

+ (void)ss2:(float)spValue{
    XLog(@"setVf1:%f isF1 %d,ep1:%f,ep2:%f",spValue,isF1,ep1,ep2);
    if (spValue>ep2) {
        spValue=ep2;
    }
    if (spValue<ep1) {
        spValue=ep1;
    }
    if (spValue<1.0&&ep1<1.0) {
        float len = ep1-1;
        spValue = spValue-1;
        spValue/=len;
        spValue=1-spValue;
    }


//    XLog(@"setVf1:%f isF1 %d",spValue,isF1);
    vF1 = spValue;
    
    
    switch (speedType) {
        case SW_UNITY:
            cspeed64();
            break;
        case SW_COCO2D:
            break;
        default:
            break;
    }
}

+ (bool)gs1{
    return isF1;
}
+ (float)gs2{
    return vF1;
}


@end

static enum ENGINE_STATE execSearch(){
    enum ENGINE_STATE rev = SP_INIT_NIL;
#if defined(_MAC64) || defined(__LP64__)
    cptm64 = [[NSMutableArray alloc] init];
    cpts64 = [[NSMutableArray alloc] init];
#else
    cptm = [[NSMutableArray alloc] init];
    cpts = [[NSMutableArray alloc] init];
#endif
    rev = setU3DHook();
    return rev;
}



 void memPrint64(long start, long len, int type){
     XLog(@"memPrint64 start:0x%lx",start)
    long now = start;
    long end = start+len;
    while (now<=end) {
        if (type==1) {
            XLog(@"0x%lx\t\t%lx\t\t%lx", now, *(long*)(now), *(long*)(now+8));
        }
        else if(type==2)
        {
            XLog(@"0x%lx\t%f\t%f\t%f\t%f", now, *(float*)(now), *(float*)(now+4), *(float*)(now+8), *(float*)(now+12));
        }
        now+=16;
    }
}



NSMutableDictionary * addressDict = [[NSMutableDictionary alloc]init];
long u3dsystemfuncAddr64_addr[5];
long set_timeScale_addr[5];

void unhooku3dsystemfuncAddr64(){
    long thisAddr=u3dsystemfuncAddr64_addr[0];
    if (vm_protect(mach_task_self(), (vm_address_t) (thisAddr ), 0x10, 0, VM_PROT_READ | VM_PROT_WRITE | VM_PROT_COPY)== KERN_SUCCESS)
    {
        XLog(@"unhook u3dsystemfuncAddr64_addr")
        *(long *)(thisAddr) =u3dsystemfuncAddr64_addr[1];
        *(long *)(thisAddr+8) =u3dsystemfuncAddr64_addr[2];
        vm_protect(mach_task_self(), (vm_address_t) (thisAddr ), 0x10, 0, VM_PROT_READ  | VM_PROT_EXECUTE);
    }
}

extern "C" {
void aSimpleUnhook(bool isHook){
    XLog(@"set to hook=%d? 1=hook,0=unhook",isHook)
    long thisAddr=set_timeScale_addr[0];
    if (vm_protect(mach_task_self(), (vm_address_t) (thisAddr ), 0x10, 0, VM_PROT_READ | VM_PROT_WRITE | VM_PROT_COPY)== KERN_SUCCESS)
    {
        if (isHook==1) {
            XLog(@"hook set_timeScale_addr")
            *(long *)(thisAddr) =set_timeScale_addr[3];
            *(long *)(thisAddr+8) =set_timeScale_addr[4];
            XLog(@"hook set_timeScale_addr done")
            vm_protect(mach_task_self(), (vm_address_t) (thisAddr ), 0x10, 0, VM_PROT_READ  | VM_PROT_EXECUTE);
            gb_state=SP_INIT_DONE;
        }else{
            gb_state=SP_INIT_PAUSE;
            XLog(@"unhook set_timeScale_addr")
            *(long *)(thisAddr) =set_timeScale_addr[1];
            *(long *)(thisAddr+8) =set_timeScale_addr[2];
            XLog(@"unhook set_timeScale_addr done")
            vm_protect(mach_task_self(), (vm_address_t) (thisAddr ), 0x10, 0, VM_PROT_READ  | VM_PROT_EXECUTE);
        }
    }
}
}
static enum ENGINE_STATE setU3DHook(){
//    enum ENGINE_STATE rev = SP_INIT_NIL;
    gb_state=SP_INIT_NIL;
    long u3dsystemfuncAddr64=0;
    u3dsystemfuncAddr64=dosearch();
    XLog(@"u3dsystemfuncAddr64 %lx",u3dsystemfuncAddr64)
    if (u3dsystemfuncAddr64){
        u3dsystemfuncAddr64_addr[0]=(u3dsystemfuncAddr64);
        u3dsystemfuncAddr64_addr[1]=*(long*)(u3dsystemfuncAddr64);
        u3dsystemfuncAddr64_addr[2]=*(long*)(u3dsystemfuncAddr64+8);
        MSHookFunction((void *)(u3dsystemfuncAddr64), (void *)ne_u3dsystemfunc, (void **)&u3dsystemfunc);
        u3dsystemfuncAddr64_addr[3]=*(long*)(u3dsystemfuncAddr64);
        u3dsystemfuncAddr64_addr[4]=*(long*)(u3dsystemfuncAddr64+8);
        gb_state=SP_INIT_WAIT;
        XLog(@"setU3DHook set gb_state %d",gb_state);
        XLog(@"here0")
        long revaddr = ne_u3dsystemfunc("UnityEngine.Time::set_timeScale(System.Single)");
        XLog(@"here1")
        unhooku3dsystemfuncAddr64();
        XLog(@"here2")
        XLog(@"found set_timeScale:0x%lx",revaddr);
        if(revaddr){
            memPrint64(revaddr,0x20,1);
            set_timeScale_addr[0]=(revaddr);
            set_timeScale_addr[1]=*(long*)(revaddr);
            set_timeScale_addr[2]=*(long*)(revaddr+8);
            MSHookFunction((void *)(revaddr), (void *)ne_sys_speed_control, (void **)&sys_speed_control);
            set_timeScale_addr[3]=*(long*)(revaddr);
            set_timeScale_addr[4]=*(long*)(revaddr+8);
            memPrint64(revaddr,0x20,1);
            gb_state=SP_INIT_DONE;
            XLog(@"setU3DHook set gb_state %d",gb_state);
            aSimpleUnhook(1);
        }
    }
    return gb_state;
}

static NSString * preread(NSString * forKey)
{
    NSString * path = D_PREFPATH;
    NSDictionary *dictionary = [[NSDictionary alloc] initWithContentsOfFile:path ];
    XLog(@"load preference %@",[dictionary objectForKey: forKey]);
    return [dictionary objectForKey: forKey];
}


/***********************end******************************/

extern long (*sys_speed_control)(float);
extern long ne_sys_speed_control(float a1);
/*******************Hook Functions***********************/
%hook UnityView
- (void)touchesBegan:(id)touches withEvent:(id)event{
    XLog(@"touchesBegan %d %lx",gb_state,sys_speed_control);
//    if(gb_state==2 && sys_speed_control){
//        XLog(@"show x5 icon")
//        [x5fPmc showIcon];
//    }
    XLog(@"show x5 icon")
    [x5fPmc showIcon];
    %orig;
}
%end
extern "C" {
void startSearchAndInject(){
    if (gb_state>=1) {
        XLog(@"gb_state:%d，不为0，不进行重复的搜索操作",gb_state)
        return;
    }
    dispatch_queue_t queue = dispatch_queue_create("1212", DISPATCH_QUEUE_CONCURRENT);
        dispatch_async(queue, ^{
            gb_state=SP_INIT_WAIT;
            XLog(@"1---%@",[NSThread currentThread]);      // 打印当前线程
            XLog(@"Loading UnitySpeedTools for unity engine")
                if([preread(@"sw_f1") boolValue]){
                  speedType = SW_UNITY;
                  XLog(@"#########2");
                  execSearch();
                  XLog(@"--- init rev %d ---", gb_state);
                }
        });
}
}
long doLoadFramework();
void constructor() __attribute__((constructor));
void constructor(void)
{
    XLog(@"Loading UnitySpeedTools for unity engine, delay 30s")
    doLoadFramework();
//dispatch_queue_t queue = dispatch_queue_create("1212", DISPATCH_QUEUE_CONCURRENT);
//    dispatch_async(queue, ^{
//        // 追加任务 1
//        [NSThread sleepForTimeInterval:40];              // 模拟耗时操作
//        XLog(@"1---%@",[NSThread currentThread]);      // 打印当前线程
//        XLog(@"Loading UnitySpeedTools for unity engine")
//            if([preread(@"sw_f1") boolValue]){
//              speedType = SW_UNITY;
//              XLog(@"#########2");
//              execSearch();
//              XLog(@"--- init rev %d ---", gb_state);
//            }
//    });
    
}

//#import "/usr/include/Availability.h"
%hook UnityAppController
//
-(BOOL)application:(id)application didFinishLaunchingWithOptions:(id)options
{
    XLog(@"-(BOOL)application:(id)application didFinishLaunchingWithOptions:(id)options")
    startSearchAndInject();
    [x5fPmc defaultCenter];
    
    return %orig;
}
%end

```

`unitySpeedTools2020/x5fPmc.h`:

```h
#import <Foundation/Foundation.h>
#import "p_inc.h"
@interface x5fPmc : NSObject //XXModCenter
{
    int p1;
    int p2;
}
+ (x5fPmc *)defaultCenter;
+ (void)showIcon;
+ (void)hiddenIcon;
@end

```

`unitySpeedTools2020/x5fPmc.mm`:

```mm
#import "x5fPmc.h"
#import "HBWindow.h"
#import "x5fPsvc.h"
#import "x5fPmvc.h"
#import "x5fPmco.h"
#import "x5fPmgd.h"
#import "p_inc.h"

//extern struct callrel_sb * callrel_s;
//extern struct callrel_ga * callrel_g;
extern float ep1;
extern float ep2;
extern enum SWTYPE speedType;
@interface x5fPmc ()
<
x5fPsd
>
@property (retain, nonatomic) HBWindow *centerWindow;
@property (retain, nonatomic) x5fPmvc *modRootVC;
@property (retain, nonatomic) x5fPsvc *settingsVC;
@property (retain, nonatomic) NSArray *dataSource;
@end

@implementation x5fPmc
+ (x5fPmc *)defaultCenter
{
    static x5fPmc * sharedInstance;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        NSLog(@"defaultCenter 1");
        sharedInstance = [[self alloc] init];
        
    });
    return sharedInstance;
}
-(NSString * )preread:( NSString * )forKey
{
    NSString * path = D_PREFPATH;
    NSDictionary *dictionary = [[NSDictionary alloc] initWithContentsOfFile:path ];
    XLog(@"load preference %@",[dictionary objectForKey: forKey]);
    return [dictionary objectForKey: forKey];
}
-(int) getParaCfg
{
    p1 = -4;
    p2 = 10;
    ep1 = -4;
    ep2 = 10;
//    if ([[self preread:@"sw_f4"] boolValue]) {
//        if (p2>[[self preread:@"sc_f4"] intValue]) {
//            p2 = [[self preread:@"sc_f4"] intValue];
//        }
//    }
    NSLog(@"getParaCfg 6");
    return 0;
}

- (id)init
{
    NSLog(@"fpmc init");
    [self getParaCfg];
    self = [super init];
    if (self) {
       [self configuredDataSource];
        [self defaultSetting];
    }
    return self;
}

- (id)initWithSpport:(enum ENGINE_STATE)isSpport
{
    NSLog(@"initWithSpport %d",isSpport);
    switch (isSpport)
    {
        case SP_INIT_NIL:
            return NULL;
        case SP_INIT_WAIT:
            self = [super init];
            if (self) {
                [self configuredDataSource];
            }
            return self;
        case SP_INIT_DONE:{
            self = [super init];
            if (self) {
                [self configuredDataSource];
                [self defaultSetting];
            }
            return self;
        }
        default:
            return NULL;
    }
}

- (void)configuredDataSource
{
    XLog(@"configuredDataSource p1:%d,p2:%d",p1,p2)
    self.dataSource = @[];
    x5fPmco *object00 = [[x5fPmco alloc] initSwitchTypeWithTitle:kTextRowTitle00 toggle:NO];
//    x5fPmco *object01 = [[x5fPmco alloc] initSliderTypeWithTitle:kTextRowTitle01 value:1 defaultValue:1 minValue:0 maxValue:10];
    x5fPmco *object01 = [[x5fPmco alloc] initSliderTypeWithTitle:kTextRowTitle01 value:1 defaultValue:1 minValue:p1 maxValue:p2];
//    x5fPmco *object02 = [[x5fPmco alloc] initSwitchTypeWithTitle:kTextRowTitle02 toggle:YES];
    
    NSArray *section0 = @[object00,object01];
    self.dataSource = @[section0,];
}

+ (void)showIcon
{
    NSLog(@"set show");
    static x5fPmc * mc = [self defaultCenter];
    mc.centerWindow.hidden = NO;
    
}

+ (void)hiddenIcon
{
    NSLog(@"set hidden");
    static x5fPmc * mc = [self defaultCenter];
    mc.centerWindow.hidden = YES;
}

- (void)defaultSetting
{
    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(windowDidBecomeKeyNotification:) name:@"UIWindowDidBecomeKeyNotification" object:nil];
}

- (void)windowDidBecomeKeyNotification:(NSNotification *)notification
{
    if (!self.centerWindow) {
        
        self.centerWindow = [[HBWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];
        self.centerWindow.backgroundColor = [UIColor clearColor];
        
        self.modRootVC = [[x5fPmvc alloc] init];
        
        
        self.settingsVC = [[x5fPsvc alloc] initWithCells:self.dataSource];
        self.settingsVC.delegate = self;
        self.modRootVC.settingsVC = self.settingsVC;
        
        self.centerWindow.rootViewController = self.modRootVC;
        self.centerWindow.windowLevel = UIWindowLevelStatusBar;
        if (gb_state == SP_INIT_DONE) {
            self.centerWindow.hidden = NO;
        }
        
    }
}

- (void)dealloc
{
    [self.centerWindow release];
    [self.modRootVC release];
    [self.settingsVC release];
    [self.dataSource release];
    
    [super dealloc];
}

#pragma mark - Settings Delegate

- (NSString *)titleForHeaderInSection:(NSInteger)section
{
    return nil;
}

- (NSString *)titleForFooterInSection:(NSInteger)section
{
    return nil;
}

- (NSString *)detailsStringWithFormat:(NSString *)value indexPath:(NSIndexPath *)indexPath
{
    float a = [value floatValue];
    if (a<1.0) {
        float len = ep1-1;
        a = a-1;
        a/=len;
        a=1-a;
        return [NSString stringWithFormat:@"减速至%.3f倍",a];
    }
    else{
        return [NSString stringWithFormat:@"增速至%.3f倍",a];
    }
    
//    return [NSString stringWithFormat:@"%.3f倍",a];
    return nil;
}

//界面设置反馈调用
- (void)detailsValue:(x5fPmco *)value settingAtIndexPath:(NSIndexPath *)indexPath
{
    if (indexPath.section == 0)
    {
        switch (indexPath.row) {
            case 0:
                [x5fP ss1:value.toggleValue];
                break;
            case 1:
                XLog(@"detailsValue %f",value.sliderValue)
                [x5fP ss2:value.sliderValue];
                break;
//            case 2:
//                [x5fP ss3:value.toggleValue];
//                break;
            default:
                break;
        }
    }
}

@end

```

`unitySpeedTools2020/x5fPmgd.h`:

```h
#ifndef XXModGlobalDefines_H_Hubert
#define XXModGlobalDefines_H_Hubert

// UI Settings
#define kMainScreenWidth    [UIScreen mainScreen].bounds.size.width
#define kMainScreenHeight   [UIScreen mainScreen].bounds.size.height

#define kModMainPanelWidth      250.0f
#define kModMainPanelHeight     150.0f

#define kSettingsCellLeftMarge      10.0f //Settings Cell 左边文字的边距
#define kSettingsCellSectionFont    15.0f //Settings Cell Section Header/Footer Font
#define kSettingsCellHeight     42.0f //Settings Cell Section Header/Footer Font

#define kSettingsCellAccessoryRightMarge    (([[[UIDevice currentDevice] systemVersion] compare:@"7.0"] != NSOrderedAscending ) ? 30.0f : 40.0f)

#define kTextSectionHeader0   @" "
#define kTextRowTitle0N @""
#define kTextRowTitle00 @"开启变速"
#define kTextRowTitle01 @"速度倍数"


#define kTextAboutContent       @".. .."// 右上角感叹号里的文本内容

#define kTextNavTitle           @"通用游戏加速器"
#define kTextNavTitleAC         @"账号信息"
#define kTextHideMod            @" "
#define kTextOn                 @"打开"
#define kTextOff                @"关闭"
#define kTextNotAvailable       @"暂不可用稍后再试"
#define kTextSave               @"保存"
#define kTextCancel             @"取消"

#define kAlertNoticeTitleText   @" "
#define kAlertCancelText        @"取消"
#define kAlertHideText          @"隐藏"
#define kAlertHideContentText   @" "


#define cColorMainView [UIColor grayColor]


#endif

```

`unitySpeedTools2020/x5fPmw/Controller/x5fPavc.h`:

```h
#import <UIKit/UIKit.h>
#import "x5fPmbvc.h"

@interface x5fPavc : x5fPbvc  //XXAboutViewController

@end

```

`unitySpeedTools2020/x5fPmw/Controller/x5fPavc.m`:

```m

#import "x5fPavc.h"
#import "x5fPmgd.h"




@interface hcavc : NSObject <UIAlertViewDelegate>

@end
@implementation hcavc
- (void)alertView:(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex
{
    NSLog(@"1");
}
@end


@interface x5fPavc ()
{
    NSString * rcmsg;
    NSString * popmsg;
    NSString * bdmsg;
    bool isLoaded;
    bool isInvited;
    int dp;
    int invc;
    int invCount;
}
@end

@implementation x5fPavc

- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil
{
    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
    if (self) {
        // Custom initialization
    }
    return self;
}

- (void)viewDidLoad
{
    [self initView];
//    [self checkUIFS];
    UIScrollView *scrollView = [[[UIScrollView alloc] initWithFrame:CGRectMake((kModMainPanelWidth - 225.0f) / 2.0f, CGRectGetHeight(self.customNavBar.frame), 225.0f, kModMainPanelHeight - CGRectGetHeight(self.customNavBar.frame))] autorelease];
    scrollView.backgroundColor = cColorMainView;
    scrollView.showsVerticalScrollIndicator = NO;
    [self.view addSubview:scrollView];
    
    bdmsg = bdmsg==nil?@"NULL":bdmsg;
    CGFloat contentHeight =[self heightForText:bdmsg font:[UIFont systemFontOfSize:16.0f] constraintWidth:CGRectGetWidth(scrollView.frame)];
    
    UILabel *contentLabel = [[[UILabel alloc] initWithFrame:CGRectMake(0, 10, CGRectGetWidth(scrollView.frame), contentHeight)] autorelease];
    contentLabel.text = bdmsg;
    contentLabel.backgroundColor = cColorMainView;
    contentLabel.textColor = [UIColor whiteColor];
    contentLabel.font = [UIFont systemFontOfSize:16.0f];
    contentLabel.numberOfLines = 0;
    [self.view addSubview:contentLabel];

    scrollView.contentSize = CGSizeMake(CGRectGetWidth(scrollView.frame), contentHeight);
    [scrollView addSubview:contentLabel];
}

- (void)initView
{
    self.view.backgroundColor = cColorMainView;
    [self.navigationController setNavigationBarHidden:YES];
    self.navigationController.view.layer.cornerRadius = 2;
    self.navigationController.view.layer.borderColor = [self colorWithHexValue:0x999999 alpha:1].CGColor;
    self.navigationController.view.layer.borderWidth = 1.0f;
    self.navigationController.view.clipsToBounds = YES;
    
    self.customNavBar = [[UIView alloc] initWithFrame:CGRectMake(0, 0, kModMainPanelWidth, 41)];
    self.customNavBar.backgroundColor = cColorMainView;
    [self.view addSubview:self.customNavBar];
    
    UILabel *title = [[UILabel alloc] initWithFrame:self.customNavBar.frame];
    title.backgroundColor = cColorMainView;
    title.textColor = [UIColor whiteColor];
    title.textAlignment = NSTextAlignmentCenter;
    title.font = [UIFont boldSystemFontOfSize:18.0f];
    title.text = kTextNavTitleAC;
    [self.customNavBar addSubview:title];
    
    UIButton *btnClose = [UIButton buttonWithType:UIButtonTypeCustom];
    [btnClose setTitle:@"返回" forState:UIControlStateNormal];
    [btnClose setBackgroundColor:[UIColor clearColor]];
    btnClose.frame = CGRectMake(0, 0, 45, 41);
    [btnClose setContentVerticalAlignment:UIControlContentVerticalAlignmentCenter];
    [btnClose setContentHorizontalAlignment:UIControlContentHorizontalAlignmentCenter];
    [btnClose addTarget:self action:@selector(customNavigationBarLeftItemAction:) forControlEvents:UIControlEventTouchUpInside];
    [self.customNavBar addSubview:btnClose];
}

- (bool)isFirstLoad{
    return !isLoaded;
}

- (void)ainput:(NSString *)title msg:(NSString *)s cdele:(hcavc *)hack
{
    UIAlertView *alert = [[UIAlertView alloc] initWithTitle:title
                                                    message:s
                                                   delegate:hack
                                          cancelButtonTitle:@"OK"
                                          otherButtonTitles:nil];
    [alert setAlertViewStyle:UIAlertViewStylePlainTextInput];
    [alert show];
}

- (void)a:(NSString *)title  msg:(NSString *) s
{
    UIAlertView *alert = [[UIAlertView alloc] initWithTitle:title
                                                    message:s
                                                   delegate:nil
                                          cancelButtonTitle:@"OK"
                                          otherButtonTitles:nil];
    [alert show];
    [alert release];
}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (void)customNavigationBarLeftItemAction:(UIButton *)button
{
    [self.navigationController popViewControllerAnimated:YES];
}

@end

```

`unitySpeedTools2020/x5fPmw/Controller/x5fPmbvc.h`:

```h
#import <UIKit/UIKit.h>

@interface x5fPbvc : UIViewController

@property (nonatomic, retain) UIView *customNavBar;

- (void)initView;
- (void)customNavigationBarLeftItemAction:(UIButton *)button;

- (UIColor *)colorWithHexValue:(NSUInteger)hexValue alpha:(CGFloat)alpha;
- (CGFloat)heightForText:(NSString *)text font:(UIFont *)font constraintWidth:(CGFloat)width;

- (UIImage *)infoButtonBGImage;

@end

```

`unitySpeedTools2020/x5fPmw/Controller/x5fPmbvc.m`:

```m
#import "x5fPmbvc.h"
#import "x5fPmgd.h"
#import <QuartzCore/QuartzCore.h>

@interface x5fPbvc ()

@end

@implementation x5fPbvc

- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil
{
    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
    if (self) {
        // Custom initialization
    }
    return self;
}

- (void)viewDidLoad
{
    [super viewDidLoad];
    [self initView];
}

- (void)initView
{
    self.view.backgroundColor = [UIColor colorWithRed:0 green:0 blue:0 alpha:0.7];
    [self.navigationController setNavigationBarHidden:YES];
    self.navigationController.view.layer.cornerRadius = 2;
    self.navigationController.view.layer.borderColor = [self colorWithHexValue:0x999999 alpha:1].CGColor;
    self.navigationController.view.layer.borderWidth = 1.0f;
    self.navigationController.view.clipsToBounds = YES;
    
    self.customNavBar = [[UIView alloc] initWithFrame:CGRectMake(0, 0, kModMainPanelWidth, 41)];
    self.customNavBar.backgroundColor = [UIColor clearColor];
    [self.view addSubview:self.customNavBar];
    
    UILabel *title = [[UILabel alloc] initWithFrame:self.customNavBar.frame];
    title.backgroundColor = cColorMainView;
    title.textColor = [UIColor whiteColor];
    title.textAlignment = NSTextAlignmentCenter;
    title.font = [UIFont boldSystemFontOfSize:18.0f];
    title.text = kTextNavTitle;
    [self.customNavBar addSubview:title];
    
    UIButton *btnClose = [UIButton buttonWithType:UIButtonTypeCustom];
    [btnClose setImage:[self closeButtonBGImage] forState:UIControlStateNormal];
    [btnClose setBackgroundColor:[UIColor clearColor]];
    btnClose.frame = CGRectMake(0, 0, 45, 41);
    [btnClose setContentVerticalAlignment:UIControlContentVerticalAlignmentCenter];
    [btnClose setContentHorizontalAlignment:UIControlContentHorizontalAlignmentCenter];
    [btnClose addTarget:self action:@selector(customNavigationBarLeftItemAction:) forControlEvents:UIControlEventTouchUpInside];
    [self.customNavBar addSubview:btnClose];
}

- (void)dealloc
{
    [self.customNavBar release];
    
    [super dealloc];
}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (void)customNavigationBarLeftItemAction:(UIButton *)button
{
    
}

- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)toInterfaceOrientation
{
    if (UIInterfaceOrientationIsPortrait([UIApplication sharedApplication].statusBarOrientation)) {
        if (UI_USER_INTERFACE_IDIOM() == UIUserInterfaceIdiomPhone) {
            return (UIInterfaceOrientationPortrait == toInterfaceOrientation);
        }
        return (UIInterfaceOrientationPortrait == toInterfaceOrientation) | (UIInterfaceOrientationPortraitUpsideDown == toInterfaceOrientation);
    }
    else {
        return (UIInterfaceOrientationLandscapeLeft == toInterfaceOrientation) | (UIInterfaceOrientationLandscapeRight == toInterfaceOrientation);
    }
    return YES;
}

- (BOOL)shouldAutorotate
{
    return YES;
}

- (NSUInteger)supportedInterfaceOrientations
{
    if (UIInterfaceOrientationIsPortrait([UIApplication sharedApplication].statusBarOrientation)) {
        if (UI_USER_INTERFACE_IDIOM() == UIUserInterfaceIdiomPhone) {
            return UIInterfaceOrientationMaskPortrait;
        }
        return UIInterfaceOrientationMaskPortrait | UIInterfaceOrientationMaskPortraitUpsideDown;
    }
    else {
        return UIInterfaceOrientationMaskLandscape;
    }
}

#pragma mark - Helper

- (CGFloat)heightForText:(NSString *)text font:(UIFont *)font constraintWidth:(CGFloat)width
{
    CGSize size;
    CGSize constraint = CGSizeMake(width, 10000.0f);

    if ([text respondsToSelector:@selector(sizeWithFont:constrainedToSize:)]) {
        size = [text sizeWithFont:font constrainedToSize:constraint lineBreakMode:NSLineBreakByWordWrapping];
    }
    else {
        NSAttributedString *msgAttributedText = [[NSAttributedString alloc] initWithString:text attributes:@{NSFontAttributeName:font}];
        CGRect rect = [msgAttributedText boundingRectWithSize:constraint
                                                         options:NSStringDrawingUsesLineFragmentOrigin
                                                         context:nil];
        size = rect.size;
    }
    
    CGFloat height = size.height;

    return height;
}

- (UIColor *)colorWithHexValue:(NSUInteger)hexValue alpha:(CGFloat)alpha
{
    return [UIColor colorWithRed:((hexValue >> 16) & 0x000000FF)/255.0f
                           green:((hexValue >> 8) & 0x000000FF)/255.0f
                            blue:((hexValue) & 0x000000FF)/255.0
                           alpha:alpha];
}

- (UIImage *)closeButtonBGImage
{
    UIGraphicsBeginImageContextWithOptions(CGSizeMake(25,25), NO, 0);
    
    //// General Declarations
    CGContextRef context = UIGraphicsGetCurrentContext();
    
    //// Group 2
    {
        //// Bezier Drawing
        UIBezierPath* bezierPath = UIBezierPath.bezierPath;
        [bezierPath moveToPoint: CGPointMake(5.43, 5.43)];
        [bezierPath addCurveToPoint: CGPointMake(5.43, 19.57) controlPoint1: CGPointMake(1.52, 9.33) controlPoint2: CGPointMake(1.52, 15.67)];
        [bezierPath addCurveToPoint: CGPointMake(19.57, 19.57) controlPoint1: CGPointMake(9.33, 23.48) controlPoint2: CGPointMake(15.67, 23.48)];
        [bezierPath addCurveToPoint: CGPointMake(19.57, 5.43) controlPoint1: CGPointMake(23.48, 15.67) controlPoint2: CGPointMake(23.48, 9.33)];
        [bezierPath addCurveToPoint: CGPointMake(5.43, 5.43) controlPoint1: CGPointMake(15.67, 1.52) controlPoint2: CGPointMake(9.33, 1.52)];
        [bezierPath closePath];
        [bezierPath moveToPoint: CGPointMake(21.34, 3.66)];
        [bezierPath addCurveToPoint: CGPointMake(21.34, 21.34) controlPoint1: CGPointMake(26.22, 8.54) controlPoint2: CGPointMake(26.22, 16.46)];
        [bezierPath addCurveToPoint: CGPointMake(3.66, 21.34) controlPoint1: CGPointMake(16.46, 26.22) controlPoint2: CGPointMake(8.54, 26.22)];
        [bezierPath addCurveToPoint: CGPointMake(3.66, 3.66) controlPoint1: CGPointMake(-1.22, 16.46) controlPoint2: CGPointMake(-1.22, 8.54)];
        [bezierPath addCurveToPoint: CGPointMake(21.34, 3.66) controlPoint1: CGPointMake(8.54, -1.22) controlPoint2: CGPointMake(16.46, -1.22)];
        [bezierPath closePath];
        [UIColor.grayColor setFill];
        [bezierPath fill];
        
        
        //// Group
        {
            //// Rectangle Drawing
            CGContextSaveGState(context);
            CGContextTranslateCTM(context, 7, 16.17);
            CGContextRotateCTM(context, -45 * M_PI / 180);
            
            UIBezierPath* rectanglePath = [UIBezierPath bezierPathWithRoundedRect: CGRectMake(0, 0, 12.96, 2.59) cornerRadius: 1.3];
            [UIColor.grayColor setFill];
            [rectanglePath fill];
            
            CGContextRestoreGState(context);
            
            
            //// Rectangle 2 Drawing
            CGContextSaveGState(context);
            CGContextTranslateCTM(context, 8.83, 7);
            CGContextRotateCTM(context, 45 * M_PI / 180);
            
            UIBezierPath* rectangle2Path = [UIBezierPath bezierPathWithRoundedRect: CGRectMake(0, 0, 12.96, 2.59) cornerRadius: 1.3];
            [UIColor.grayColor setFill];
            [rectangle2Path fill];
            
            CGContextRestoreGState(context);
        }
    }
    
    UIImage* im = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    return im;
}

- (UIImage *)infoButtonBGImage
{
    UIGraphicsBeginImageContextWithOptions(CGSizeMake(25,25), NO, 0);
    //// Color Declarations
    UIColor* color5 = [UIColor colorWithRed: 0 green: 0.478 blue: 1 alpha: 1];
    
    //// Bezier 2 Drawing
    UIBezierPath* bezier2Path = UIBezierPath.bezierPath;
    [bezier2Path moveToPoint: CGPointMake(12.5, 5)];
    [bezier2Path addCurveToPoint: CGPointMake(11, 6.5) controlPoint1: CGPointMake(11.67, 5) controlPoint2: CGPointMake(11, 5.67)];
    [bezier2Path addLineToPoint: CGPointMake(11, 13.5)];
    [bezier2Path addCurveToPoint: CGPointMake(12.5, 15) controlPoint1: CGPointMake(11, 14.33) controlPoint2: CGPointMake(11.67, 15)];
    [bezier2Path addCurveToPoint: CGPointMake(14, 13.5) controlPoint1: CGPointMake(13.33, 15) controlPoint2: CGPointMake(14, 14.33)];
    [bezier2Path addLineToPoint: CGPointMake(14, 6.5)];
    [bezier2Path addCurveToPoint: CGPointMake(12.5, 5) controlPoint1: CGPointMake(14, 5.67) controlPoint2: CGPointMake(13.33, 5)];
    [bezier2Path closePath];
    [bezier2Path moveToPoint: CGPointMake(12.5, 16)];
    [bezier2Path addCurveToPoint: CGPointMake(11, 17.5) controlPoint1: CGPointMake(11.67, 16) controlPoint2: CGPointMake(11, 16.67)];
    [bezier2Path addCurveToPoint: CGPointMake(12.5, 19) controlPoint1: CGPointMake(11, 18.33) controlPoint2: CGPointMake(11.67, 19)];
    [bezier2Path addCurveToPoint: CGPointMake(14, 17.5) controlPoint1: CGPointMake(13.33, 19) controlPoint2: CGPointMake(14, 18.33)];
    [bezier2Path addCurveToPoint: CGPointMake(12.5, 16) controlPoint1: CGPointMake(14, 16.67) controlPoint2: CGPointMake(13.33, 16)];
    [bezier2Path closePath];
    [bezier2Path moveToPoint: CGPointMake(21.34, 3.66)];
    [bezier2Path addCurveToPoint: CGPointMake(21.34, 21.34) controlPoint1: CGPointMake(26.22, 8.54) controlPoint2: CGPointMake(26.22, 16.46)];
    [bezier2Path addCurveToPoint: CGPointMake(3.66, 21.34) controlPoint1: CGPointMake(16.46, 26.22) controlPoint2: CGPointMake(8.54, 26.22)];
    [bezier2Path addCurveToPoint: CGPointMake(3.66, 3.66) controlPoint1: CGPointMake(-1.22, 16.46) controlPoint2: CGPointMake(-1.22, 8.54)];
    [bezier2Path addCurveToPoint: CGPointMake(21.34, 3.66) controlPoint1: CGPointMake(8.54, -1.22) controlPoint2: CGPointMake(16.46, -1.22)];
    [bezier2Path closePath];
    [color5 setFill];
    [bezier2Path fill];

    UIImage* im = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    
    return im;
}

@end

```

`unitySpeedTools2020/x5fPmw/Controller/x5fPmvc.h`:

```h
#import <UIKit/UIKit.h>

@class x5fPsvc;

@interface x5fPmvc : UIViewController  //XXModViewController

@property (retain, nonatomic) x5fPsvc *settingsVC;

@end

```

`unitySpeedTools2020/x5fPmw/Controller/x5fPmvc.m`:

```m
#import "x5fPmvc.h"
#import "x5fPmgd.h"
#import "HBView.h"
#import "x5fPdb.h"
#import "x5fPsvc.h"
#import "p_inc.h"
//#import <HackClass.h>
extern struct callrel_sb * callrel_s;
extern struct callrel_ga * callrel_g;
extern float ep2;
extern float ep1;
extern float vF1;
bool autoSetSpeedOn = false;
bool switchAutoSpeed;
extern void startSearchAndInject();
extern void aSimpleUnhook(bool);
@interface x5fPmvc ()
<
UIGestureRecognizerDelegate,
x5fPsuicd
>
@property (retain, nonatomic) HBView *customView;
@property (retain, nonatomic) UIView *panelView;
@property (retain, nonatomic) x5fPdb *avatar;
@end

@implementation x5fPmvc

- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil
{
    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
    if (self) {
        // Custom initialization
    }
    switchAutoSpeed =  [[self preread:@"sw_faston"] boolValue];
//    switchAutoSpeed = 1;
    return self;
}

- (void)viewDidLoad
{
    [super viewDidLoad];
    CGRect bounds = [UIScreen mainScreen].bounds;

    self.view = [[HBView alloc] initWithFrame:self.view.frame];

    self.customView = [[HBView alloc] initWithFrame:bounds];
    self.customView.backgroundColor = [UIColor clearColor];
    self.customView.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight | UIViewAutoresizingFlexibleLeftMargin | UIViewAutoresizingFlexibleRightMargin
    | UIViewAutoresizingFlexibleTopMargin | UIViewAutoresizingFlexibleBottomMargin;
    [self.view addSubview:self.customView];
    XLog(@"1")
//    id<UIApplicationDelegate> app = [[UIApplication sharedApplication] delegate];
//    [app.window addSubview:self.customView];
    XLog(@"2")
    self.panelView = [[UIView alloc] initWithFrame:bounds];
    self.panelView.backgroundColor = [UIColor clearColor];
    self.panelView.hidden = YES;
    self.panelView.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight | UIViewAutoresizingFlexibleLeftMargin | UIViewAutoresizingFlexibleRightMargin
    | UIViewAutoresizingFlexibleTopMargin | UIViewAutoresizingFlexibleBottomMargin;
    [self.view addSubview:self.panelView];
//    [app.window addSubview:self.panelView];
//    [app.window addSubview:self.settingsVC.navigationController.view];
    [self.panelView addSubview:self.settingsVC.navigationController.view];
XLog(@"3")
    UITapGestureRecognizer *backgroundTap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(handlePanelViewBackgroundTapEvent:)];
    backgroundTap.numberOfTouchesRequired = 1;
    backgroundTap.numberOfTapsRequired = 1;
    backgroundTap.delegate = self;
    [self.panelView addGestureRecognizer:backgroundTap];
    [backgroundTap release];

    // 悬浮按钮
    
    self.avatar = [[x5fPdb alloc] initInView:self.customView WithFrame:CGRectMake(CGRectGetWidth(self.customView.frame) - 45.0f, CGRectGetHeight(self.customView.frame) / 2 - 150.0f, 50, 60.0f)];
    [self.avatar setImage:[self avatarGBImage] forState:UIControlStateNormal];
    self.avatar.autoDocking = NO;
    [self.avatar addTarget:self action:@selector(toggleAppearPanel:) forControlEvents:UIControlEventTouchUpInside];
}
//- (void)viewDidLoad
//{
//    [super viewDidLoad];
//    CGRect bounds = [UIScreen mainScreen].bounds;
//
//    self.view = [[HBView alloc] initWithFrame:self.view.frame];
//
//    self.customView = [[HBView alloc] initWithFrame:bounds];
//    self.customView.backgroundColor = [UIColor clearColor];
//    self.customView.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight | UIViewAutoresizingFlexibleLeftMargin | UIViewAutoresizingFlexibleRightMargin
//    | UIViewAutoresizingFlexibleTopMargin | UIViewAutoresizingFlexibleBottomMargin;
////    [self.view addSubview:self.customView];
//    XLog(@"1")
//    id<UIApplicationDelegate> app = [[UIApplication sharedApplication] delegate];
//    [app.window addSubview:self.customView];
//    XLog(@"2")
//    self.panelView = [[UIView alloc] initWithFrame:bounds];
//    self.panelView.backgroundColor = [UIColor clearColor];
//    self.panelView.hidden = YES;
//    self.panelView.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight | UIViewAutoresizingFlexibleLeftMargin | UIViewAutoresizingFlexibleRightMargin
//    | UIViewAutoresizingFlexibleTopMargin | UIViewAutoresizingFlexibleBottomMargin;
////    [self.view addSubview:self.panelView];
//    [app.window addSubview:self.panelView];
//    [app.window addSubview:self.settingsVC.navigationController.view];
////    [self.panelView addSubview:];
//XLog(@"3")
//    UITapGestureRecognizer *backgroundTap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(handlePanelViewBackgroundTapEvent:)];
//    backgroundTap.numberOfTouchesRequired = 1;
//    backgroundTap.numberOfTapsRequired = 1;
//    backgroundTap.delegate = self;
//    [self.panelView addGestureRecognizer:backgroundTap];
//    [backgroundTap release];
//
//    // 悬浮按钮
//
//    self.avatar = [[x5fPdb alloc] initInView:self.customView WithFrame:CGRectMake(CGRectGetWidth(self.customView.frame) - 45.0f, CGRectGetHeight(self.customView.frame) / 2 - 150.0f, 50, 60.0f)];
//    [self.avatar setImage:[self avatarGBImage] forState:UIControlStateNormal];
//    self.avatar.autoDocking = NO;
//    [self.avatar addTarget:self action:@selector(toggleAppearPanel:) forControlEvents:UIControlEventTouchUpInside];
//}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)toInterfaceOrientation
{
    if (UIInterfaceOrientationIsPortrait([UIApplication sharedApplication].statusBarOrientation)) {
        if (UI_USER_INTERFACE_IDIOM() == UIUserInterfaceIdiomPhone) {
            return (UIInterfaceOrientationPortrait == toInterfaceOrientation);
        }
        return (UIInterfaceOrientationPortrait == toInterfaceOrientation) | (UIInterfaceOrientationPortraitUpsideDown == toInterfaceOrientation);
    }
    else {
        return (UIInterfaceOrientationLandscapeLeft == toInterfaceOrientation) | (UIInterfaceOrientationLandscapeRight == toInterfaceOrientation);
    }
    return YES;
}

- (BOOL)shouldAutorotate
{
    return YES;
}

- (NSUInteger)supportedInterfaceOrientations
{
    if (UIInterfaceOrientationIsPortrait([UIApplication sharedApplication].statusBarOrientation)) {
        if (UI_USER_INTERFACE_IDIOM() == UIUserInterfaceIdiomPhone) {
            return UIInterfaceOrientationMaskPortrait;
        }
        return UIInterfaceOrientationMaskPortrait | UIInterfaceOrientationMaskPortraitUpsideDown;
    }
    else {
        return UIInterfaceOrientationMaskLandscape;
    }
}

#pragma mark - Seter

- (void)setSettingsVC:(x5fPsvc *)settingsVC
{
    if (![_settingsVC isEqual:settingsVC]) {
        _settingsVC = settingsVC;
        _settingsVC.uiDelegate = self;
        CGRect bounds = [UIScreen mainScreen].bounds;

        UINavigationController *nav = [[UINavigationController alloc] initWithRootViewController:_settingsVC];
        [self addChildViewController:nav];
        
        nav.view.frame = CGRectMake(
                                    (CGRectGetWidth(bounds) - kModMainPanelWidth) / 2.0f,
                                    (CGRectGetHeight(bounds) - kModMainPanelHeight) / 2.0f,
                                    kModMainPanelWidth,
                                    kModMainPanelHeight);
        nav.view.layer.cornerRadius = 5.0f;
        nav.view.autoresizingMask = UIViewAutoresizingFlexibleTopMargin | UIViewAutoresizingFlexibleLeftMargin | UIViewAutoresizingFlexibleRightMargin | UIViewAutoresizingFlexibleBottomMargin;

        [nav didMoveToParentViewController:self];
    }
}

#pragma mark - Action Handler

- (void)toggleAppearPanel:(id)sender
{
    if (self.avatar.isDragging) {
        return;
    }
    
    bool switchAutoSpeed =  [[self preread:@"sw_faston"] boolValue];
    
//    if (switchAutoSpeed) {
        XLog(@"touch button")
        XLog(@"gb_state:%d",gb_state)
        switch (gb_state) {
            case 0:{
                UIAlertView *alert = [[UIAlertView alloc] initWithTitle:nil
                                                                        message:@"Unity控速函数尚未确认，是否开始初始化？"
                                                                       delegate:self
                                                              cancelButtonTitle:@"确定"
                                                              otherButtonTitles:@"取消",nil];
                        [alert show];
                        [alert release];
            }
                break;
            case 1:{
                    UIAlertView *alert = [[UIAlertView alloc] initWithTitle:nil
                                                                            message:@"正在执行初始化，请稍后"
                                                                           delegate:nil
                                                                  cancelButtonTitle:@"确定"
                                                          otherButtonTitles:nil];
                            [alert show];
                            [alert release];
                }
                break;
            case 2:
            case 3:{
                if([[self preread:@"sw_faston"] boolValue]){
                    [self.avatar setImage:[self avatarGBImageSpeedBio] forState:UIControlStateNormal];
                }else{
                    [self.avatar setImage:[self avatarGBImage] forState:UIControlStateNormal];
                    if ([self.avatar isHidden] && ![self.panelView isHidden]) {
                        self.avatar.hidden = NO;
                        self.panelView.hidden = YES;
                    }
                    else if (![self.avatar isHidden] && [self.panelView isHidden]) {
                        self.avatar.hidden = YES;
                        self.panelView.hidden = NO;
                    }
                }
                break;
            }

        }
//    }
//    else{
//        [self.avatar setImage:[self avatarGBImage] forState:UIControlStateNormal];
//        if ([self.avatar isHidden] && ![self.panelView isHidden]) {
//            self.avatar.hidden = NO;
//            self.panelView.hidden = YES;
//        }
//        else if (![self.avatar isHidden] && [self.panelView isHidden]) {
//            self.avatar.hidden = YES;
//            self.panelView.hidden = NO;
//        }
//    }
}
- (void)alertView:(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex
{
    XLog(@"%ld", (long)buttonIndex);
    if (buttonIndex ==1 ){
        
        XLog(@"点击了取消")
    }
    else{
        XLog(@"开始执行注入")
        startSearchAndInject();
    }
    
}
- (void)handlePanelViewBackgroundTapEvent:(UITapGestureRecognizer *)sender
{
    CGPoint touch = [sender locationInView:self.panelView];

    CGRect validRect = self.settingsVC.navigationController.view.frame;
    if (!CGRectContainsPoint(validRect, touch)) {
        [self toggleAppearPanel:nil];
    }
}

#pragma mark - XXSetting Delegate
- (void)dismissSettingsViewControllerAction
{
    [self toggleAppearPanel:nil];
}

- (void)hideModeAction
{
    [self toggleAppearPanel:nil];
    self.avatar.hidden = YES;
}

#pragma mark - Gesture Recognizer Delegate
- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldReceiveTouch:(UITouch *)touch
{
    return ! ([touch.view isKindOfClass:[UIControl class]] || [NSStringFromClass([touch.view class]) isEqualToString:@"UITableViewCellContentView"] || [touch.view.superview isKindOfClass:[UIControl class]]);
}

#pragma mark - Image
- (UIImage *)avatarGBImage
{
    UIGraphicsBeginImageContextWithOptions(CGSizeMake(46,46), NO, 0);


    //// General Declarations
    CGContextRef context = UIGraphicsGetCurrentContext();
    
    //// Color Declarations
    UIColor* color = [UIColor colorWithCGColor:[UIColor redColor].CGColor];
    UIColor* color2 = [UIColor colorWithRed: 0 green: 0 blue: 0 alpha: 0];
    
    //// Shadow Declarations
    UIColor* shadow = [UIColor.blackColor colorWithAlphaComponent: 0.53];
    CGSize shadowOffset = CGSizeMake(1.1, 4.1);
    CGFloat shadowBlurRadius = 2;
    
    //// Oval Drawing
    UIBezierPath* ovalPath = [UIBezierPath bezierPathWithOvalInRect: CGRectMake(2, 1, 40, 40)];
    CGContextSaveGState(context);
    CGContextSetShadowWithColor(context, shadowOffset, shadowBlurRadius, [shadow CGColor]);
    [color2 setFill];
    [ovalPath fill];
    CGContextRestoreGState(context);
    
    [color setStroke];
    ovalPath.lineWidth = 2;
    [ovalPath stroke];
    
    
    //// Text Drawing
    CGRect textRect = CGRectMake(8, 14, 30, 17);
    [color setFill];
    [@"5KB" drawInRect: textRect withFont: [UIFont fontWithName: @"Helvetica-Bold" size: 13] lineBreakMode: NSLineBreakByWordWrapping alignment: NSTextAlignmentCenter];


    UIImage* im = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    
    return im;
}

-(NSString * )preread:( NSString * )forKey
{
    NSString * path = D_PREFPATH;
    NSDictionary *dictionary = [[NSDictionary alloc] initWithContentsOfFile:path ];
    XLog(@"load preference %@",[dictionary objectForKey: forKey]);
    return [dictionary objectForKey: forKey];
}

- (UIImage *)avatarGBImageSpeedBio
{
    UIGraphicsBeginImageContextWithOptions(CGSizeMake(46,46), NO, 0);
    
    
    //// General Declarations
    CGContextRef context = UIGraphicsGetCurrentContext();
    
    //// Color Declarations
    UIColor* color = [UIColor colorWithCGColor:[UIColor redColor].CGColor];
    UIColor* color2 = [UIColor colorWithRed: 0 green: 0 blue: 0 alpha: 0];
    
    //// Shadow Declarations
    UIColor* shadow = [UIColor.blackColor colorWithAlphaComponent: 0.53];
    CGSize shadowOffset = CGSizeMake(1.1, 4.1);
    CGFloat shadowBlurRadius = 2;
    
    //// Oval Drawing
    UIBezierPath* ovalPath = [UIBezierPath bezierPathWithOvalInRect: CGRectMake(2, 1, 40, 40)];
    CGContextSaveGState(context);
    CGContextSetShadowWithColor(context, shadowOffset, shadowBlurRadius, [shadow CGColor]);
    [color2 setFill];
    [ovalPath fill];
    CGContextRestoreGState(context);
    
    [color setStroke];
    ovalPath.lineWidth = 2;
    [ovalPath stroke];
    
    
    //// Text Drawing
    CGRect textRect = CGRectMake(8, 14, 30, 17);
    [color setFill];
    if (autoSetSpeedOn == false) {
        aSimpleUnhook(1);
        gb_state=SP_INIT_DONE;
        autoSetSpeedOn = true;
//        NSLog(@"%d %d",[(NSNumber*)callrel_g->FUNC_GETPREFERENCE(@"sw_faston") boolValue] ,[(NSNumber*)callrel_g->FUNC_GETPREFERENCE(@"sc_jqsz") intValue]);
        float sc_jqsz = [[self preread:@"sc_jqsz"] floatValue];
        if (
//            [[self preread:@"sw_faston"] boolValue] &&
            [[self preread:@"sc_jqsz"] floatValue]>0) {
            vF1 = sc_jqsz;
            NSLog(@"get speed setting 1 %f",vF1);
        }else{
            vF1 = [[self preread:@"sc_f4"] floatValue];
            NSLog(@"get speed setting 2 %f",vF1);
        }

        [[NSString stringWithFormat:@"%f",vF1] drawInRect: textRect withFont: [UIFont fontWithName: @"Helvetica-Bold" size: 10] lineBreakMode: NSLineBreakByWordWrapping alignment: NSTextAlignmentCenter];
        
        [x5fP ss1:1];
    }
    else{
        [x5fP ss1:0];
        autoSetSpeedOn = false;
        
        gb_state=SP_INIT_PAUSE;
        aSimpleUnhook(0);
        [@"暂停中" drawInRect: textRect withFont: [UIFont fontWithName: @"Helvetica-Bold" size: 10] lineBreakMode: NSLineBreakByWordWrapping alignment: NSTextAlignmentCenter];
        
    }
    
    
    
    UIImage* im = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    
    return im;
}

- (BOOL)prefersStatusBarHidden
{
//    NSLog(@"********HIDDEN*********");
    return YES; //返回NO表示要显示，返回YES将hiden
}

@end

```

`unitySpeedTools2020/x5fPmw/Controller/x5fPsvc.h`:

```h
#import <Foundation/Foundation.h>
#import "x5fPmbvc.h"

@class x5fPmco;

@protocol x5fPsd <NSObject> //XXSettingsDelegate

@optional

/**
 *  返回对应section的Header/Footer Title
 *
 *  @param section
 *
 *  @return 对应section的Header/Footer Title
 */
- (NSString *)titleForHeaderInSection:(NSInteger)section;
- (NSString *)titleForFooterInSection:(NSInteger)section;

/**
 *  自定义detail值的表现格式
 *  1、开关不需要处理
 *  2、输入框和滑动条（float），回转原值，格式需要自己转
 *  Example: "100倍" "100次"
 *
 *  @param value     输入框的返回输入值，滑动条的返回值是个float
 *  @param indexPath
 *
 *  @return 定义后的值
 */
- (NSString *)detailsStringWithFormat:(NSString *)value indexPath:(NSIndexPath *)indexPath;

/**
 *  用户设置后返回的值
 *
 *  @param value     返回值
 *  @param indexPath
 */
- (void)detailsValue:(x5fPmco *)value settingAtIndexPath:(NSIndexPath *)indexPath;

@end

@protocol x5fPsuicd <NSObject>   //XXSettingsUIControlDelegate

@optional

- (void)dismissSettingsViewControllerAction;
- (void)hideModeAction;

@end


@interface x5fPsvc : x5fPbvc   //XXSettingsViewController: XXModBaseViewController

@property (nonatomic, assign) id<x5fPsd> delegate;
@property (nonatomic, assign) id<x5fPsuicd> uiDelegate;

- (id)initWithCells:(NSArray *)cells;

@end

```

`unitySpeedTools2020/x5fPmw/Controller/x5fPsvc.m`:

```m
#import "p_inc.h"
#import "x5fPsvc.h"
#import "x5fPavc.h"
#import "x5fPmgd.h"
#import "x5fPmco.h"
#import "x5fPav.h"
#import "x5fPsc.h"
#import <QuartzCore/QuartzCore.h>

#define kTagAlertSliderView     100000
#define kTagAlertTextFieldView  200000

#define kTagAlertSlider         300000
#define kTagAlertSliderLabel    400000
#define kTagAlertTextField      500000

//extern bool gotAddr;

@interface x5fPsvc()
<
x5fPavd,  //XXAlertViewDelegate
UIAlertViewDelegate,
UITableViewDataSource,
UITableViewDelegate,
UITextFieldDelegate
>
@property (nonatomic, retain) NSArray *dataSource;
@property (nonatomic, retain) UITableView *tableView;
@property (nonatomic, retain) NSIndexPath *currentSelectIndexPath;
@property (nonatomic, retain) NSMutableArray *tableSectionHeaderHeight;
@property (nonatomic, retain) NSMutableArray *tableSectionFooterHeight;
@end

@implementation x5fPsvc

#pragma mark - viewcontroller
- (id)initWithCells:(NSArray *)cells
{
    self = [super init];
    if (self) {
        self.dataSource = cells;
    }
    return self;
}

- (void)viewDidLoad
{
    [super viewDidLoad];
}

- (void)initView
{
    [super initView];
#if 0
    UIButton *btnInfo = [UIButton buttonWithType:UIButtonTypeCustom];
    [btnInfo setTitle:@"账号" forState:UIControlStateNormal];
    [btnInfo setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
//    [btnInfo setImage:[self infoButtonBGImage] forState:UIControlStateNormal];
    btnInfo.frame = CGRectMake(CGRectGetWidth(self.customNavBar.frame) - 45, 0, 45, 41);
    [btnInfo addTarget:self action:@selector(customNavigationBarRightItemAction:) forControlEvents:UIControlEventTouchUpInside];
    [self.customNavBar addSubview:btnInfo];
#endif
    self.tableView = [[[UITableView alloc] initWithFrame:CGRectMake(0, CGRectGetHeight(self.customNavBar.frame), kModMainPanelWidth, kModMainPanelHeight - CGRectGetHeight(self.customNavBar.frame)) style:UITableViewStyleGrouped] autorelease];
    self.tableView.backgroundColor = cColorMainView;  //设置栏主框体颜色
    self.tableView.dataSource = self;
    self.tableView.delegate = self;
    self.tableView.backgroundView = nil;
    self.tableView.tableHeaderView = [[[UIView alloc] initWithFrame:CGRectMake(0.0f, 0.0f, self.tableView.bounds.size.width, 1.0f)] autorelease];
    if ([self.tableView respondsToSelector:@selector(setSeparatorInset:)]) {
        self.tableView.separatorInset = UIEdgeInsetsMake(0, kSettingsCellLeftMarge, 0, kSettingsCellLeftMarge);
    }
    [self.tableView setSeparatorStyle:UITableViewCellSeparatorStyleNone];
    self.tableView.showsVerticalScrollIndicator = NO;
    [self.view addSubview:self.tableView];

    // Table Footer View
    UIView *customFooterView = [[[UIView alloc] initWithFrame:CGRectMake(0, 0, CGRectGetWidth(self.tableView.frame), 40)] autorelease];
    customFooterView.backgroundColor = cColorMainView;
    self.tableView.tableFooterView = customFooterView;
    
    UIButton *btnHide = [UIButton buttonWithType:UIButtonTypeCustom];
    [btnHide setTitle:kTextHideMod forState:UIControlStateNormal];
    [btnHide setTitleColor:[self colorWithHexValue:0xfe0000 alpha:1] forState:UIControlStateNormal];
    btnHide.titleLabel.font = [UIFont systemFontOfSize:16.0f];
    [btnHide sizeToFit];
    btnHide.frame = CGRectMake((CGRectGetWidth(customFooterView.frame) - CGRectGetWidth(btnHide.frame)) / 2.0f,
                               (CGRectGetHeight(customFooterView.frame) - CGRectGetHeight(btnHide.frame)) / 2.0f,
                               CGRectGetWidth(btnHide.frame),
                               CGRectGetHeight(btnHide.frame));
    [btnHide addTarget:self action:@selector(hideModButtonAction:) forControlEvents:UIControlEventTouchUpInside];
    [customFooterView addSubview:btnHide];
    
    self.tableSectionHeaderHeight = @[].mutableCopy;
    self.tableSectionFooterHeight = @[].mutableCopy;
    
    // Section Header / Footer Height
    for (int i = 0; i < self.dataSource.count; i++) {
        CGFloat height = i == 0 ? 8 : 1;
        if ([self.delegate respondsToSelector:@selector(titleForHeaderInSection:)]) {
            NSString *header = [self.delegate titleForHeaderInSection:i];
            if (header && ![header isEqualToString:@""]) {
                height = [self heightForText:header font:[UIFont systemFontOfSize:14] constraintWidth:(kModMainPanelWidth - kSettingsCellLeftMarge*2)];
                height = height + 14.0f;
            }
        }
        [self.tableSectionHeaderHeight addObject:[NSNumber numberWithFloat:height]];
    }

    for (int i = 0; i < self.dataSource.count; i++) {
        CGFloat height = 8;
        if ([self.delegate respondsToSelector:@selector(titleForFooterInSection:)]) {
            NSString *footer = [self.delegate titleForFooterInSection:i];
            if (footer && ![footer isEqualToString:@""]) {
                height = [self heightForText:footer font:[UIFont systemFontOfSize:14] constraintWidth:(kModMainPanelWidth - kSettingsCellLeftMarge*2)];
                height = height + 14.0f;
            }
        }
        [self.tableSectionFooterHeight addObject:[NSNumber numberWithFloat:height]];
    }
}


#pragma mark - Helper

- (NSString *)configuredDetailsStringWithDelegateFormat:(NSString *)detailText indexPath:(NSIndexPath *)indexPath
{
    if ([self.delegate respondsToSelector:@selector(detailsStringWithFormat:indexPath:)]) {
        NSString *tempText = [self.delegate detailsStringWithFormat:detailText indexPath:indexPath];
        if (tempText && ![tempText isEqualToString:@""]) {
            detailText = tempText;
        }
    }
    return detailText;
}

#pragma mark - UITableView DataSource
- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView{
    return [self.dataSource count];
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    return [[self.dataSource objectAtIndex:section] count];
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    NSString *bundleID = @"XModCell";
    x5fPsc *cell = [tableView dequeueReusableCellWithIdentifier:bundleID];
    if (cell == nil) {
        cell = [[x5fPsc alloc] initWithStyle:UITableViewCellStyleValue1 reuseIdentifier:bundleID];
    }
    
    x5fPmco *object = (x5fPmco *)[[self.dataSource objectAtIndex:indexPath.section] objectAtIndex:indexPath.row];
    
    if (object.inputType == CellSelectTypeSwitch) {
//        cell.accessoryType = UITableViewCellAccessoryNone;
        cell.customAccessoryView.hidden = YES;
//        if (!gotAddr) {
//            [cell configuredCellWithLeftText:object.title rightText:kTextNotAvailable isDefault:!object.toggleValue];
//        }
//        else
            if (object.toggleValue) {
            [cell configuredCellWithLeftText:object.title rightText:kTextOn isDefault:!object.toggleValue];
        }
        else {
            [cell configuredCellWithLeftText:object.title rightText:kTextOff isDefault:!object.toggleValue];
        }
    }
    else if(object.inputType == CellSelectTypeTextField){
//        cell.accessoryType = UITableViewCellAccessoryDisclosureIndicator;
        cell.customAccessoryView.hidden = NO;
        NSString *detailText = [self configuredDetailsStringWithDelegateFormat:[NSString stringWithFormat:@"%d",object.inputValue] indexPath:indexPath];
        BOOL isDefault = (object.inputDefaultValue == [detailText integerValue]);
        [cell configuredCellWithLeftText:object.title rightText:detailText isDefault:isDefault];
    }
    else if(object.inputType == CellSelectTypeSlider){
//        cell.accessoryType = UITableViewCellAccessoryDisclosureIndicator;
        cell.customAccessoryView.hidden = NO;
        NSString *detailText = [self configuredDetailsStringWithDelegateFormat:[NSString stringWithFormat:@"%f",object.sliderValue] indexPath:indexPath];
        BOOL isDefault = (object.sliderDefaultValue == [detailText integerValue]);
        [cell configuredCellWithLeftText:object.title rightText:detailText isDefault:isDefault];
    }
    
    return cell;
}

#pragma mark - UITableView Delegate

- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{
    return kSettingsCellHeight;
}

- (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section
{
    return [_tableSectionHeaderHeight[section] floatValue];
}

- (CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section
{
    return [_tableSectionFooterHeight[section] floatValue];
}

- (UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section
{
    UIView *header = [[[UIView alloc] initWithFrame:CGRectMake(0, 0, kModMainPanelWidth, [_tableSectionHeaderHeight[section] floatValue])] autorelease];
    header.backgroundColor = cColorMainView;

    CALayer *bottomBorder = [CALayer layer];
    bottomBorder.frame = CGRectMake(kSettingsCellLeftMarge, CGRectGetHeight(header.frame) - 1.0f, kModMainPanelWidth - kSettingsCellLeftMarge*2, 1.0f);
    bottomBorder.backgroundColor = [UIColor colorWithWhite:1 alpha:0.3f].CGColor;
    
    [header.layer addSublayer:bottomBorder];

    if ([self.delegate respondsToSelector:@selector(titleForHeaderInSection:)]) {
        NSString *title = [self.delegate titleForHeaderInSection:section];
        if (title && ![title isEqualToString:@""]) {
            UILabel *label = [[[UILabel alloc] initWithFrame:CGRectMake(kSettingsCellLeftMarge, 0, kModMainPanelWidth - kSettingsCellLeftMarge*2, CGRectGetHeight(header.frame))] autorelease];
            label.textColor = [self colorWithHexValue:0xbfbfbf alpha:1];
            label.backgroundColor = [UIColor clearColor];
            label.font = [UIFont systemFontOfSize:14];
            label.numberOfLines = 0;
            label.text = title;
            
            [header addSubview:label];
            return header;
        }
    }
    return header;
}

- (UIView *)tableView:(UITableView *)tableView viewForFooterInSection:(NSInteger)section
{
    UIView *footer = [[[UIView alloc] initWithFrame:CGRectMake(0, 0, kModMainPanelWidth, [_tableSectionFooterHeight[section] floatValue])] autorelease];
    footer.backgroundColor = [UIColor clearColor];

    if ([self.delegate respondsToSelector:@selector(titleForFooterInSection:)]) {
        NSString *title = [self.delegate titleForFooterInSection:section];
        if (title && ![title isEqualToString:@""]) {
            
            UILabel *label = [[[UILabel alloc] initWithFrame:CGRectMake(kSettingsCellLeftMarge, 0, kModMainPanelWidth - kSettingsCellLeftMarge*2, CGRectGetHeight(footer.frame))] autorelease];
            label.textColor = [self colorWithHexValue:0xbfbfbf alpha:1];
            label.backgroundColor = [UIColor clearColor];
            label.font = [UIFont systemFontOfSize:14];
            label.text = title;
            label.numberOfLines = 0;

            [footer addSubview:label];
            return footer;
        }
    }
    return footer;
}

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    [tableView deselectRowAtIndexPath:indexPath animated:YES];
    self.currentSelectIndexPath = indexPath;
    x5fPmco *object = (x5fPmco *)[[self.dataSource objectAtIndex:indexPath.section] objectAtIndex:indexPath.row];
    if (object.inputType == CellSelectTypeSwitch) {
        //更改设置
//        if (!gotAddr) {
//
//        }
//        else{
            object.toggleValue = !object.toggleValue;
//        }
        [self.delegate detailsValue:object settingAtIndexPath:indexPath];
        [tableView reloadRowsAtIndexPaths:[NSArray arrayWithObject:indexPath] withRowAnimation:UITableViewRowAnimationNone];
    }
    else if (object.inputType == CellSelectTypeSlider){
        //弹出选择通知框
//        if (!gotAddr) {
//            
//        }
//        else{
            [self showInputSliderForSection:indexPath.section forRow:indexPath.row];
//        }
    }
    else if (object.inputType == CellSelectTypeTextField){
        //弹出输入通知框
        [self showInputTextFieldForSection:indexPath.section forRow:indexPath.row];
    }
}

- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath
{
    cell.backgroundColor = [UIColor clearColor];
}

#pragma mark - AlertView delegate

- (void)x5fPav:(x5fPav *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex
{
    if (buttonIndex != alertView.cancelButtonIndex) {
        if (alertView.tag == kTagAlertTextFieldView) {
            // TextInput
            NSString *value = ((UITextField *)[alertView viewWithTag:kTagAlertTextField]).text;
            if (!value || [value isEqualToString:@""]) {
                return;
            }
            x5fPmco *object = (x5fPmco *)[[self.dataSource objectAtIndex:_currentSelectIndexPath.section] objectAtIndex:_currentSelectIndexPath.row];
            object.inputValue = [value integerValue];
            XLog(@"x5fPav %@:%ld",object,object.inputValue)
            [self.delegate detailsValue:object settingAtIndexPath:_currentSelectIndexPath];
            
            [self.tableView reloadRowsAtIndexPaths:[NSArray arrayWithObject:_currentSelectIndexPath] withRowAnimation:UITableViewRowAnimationNone];
        }
        else if (alertView.tag == kTagAlertSliderView) {
            // Slider
            float value = ((UISlider *)[alertView viewWithTag:kTagAlertSlider]).value;
            x5fPmco *object = (x5fPmco *)[[self.dataSource objectAtIndex:_currentSelectIndexPath.section] objectAtIndex:_currentSelectIndexPath.row];
            object.sliderValue = value;
            [self.delegate detailsValue:object settingAtIndexPath:_currentSelectIndexPath];
            
            [self.tableView reloadRowsAtIndexPaths:[NSArray arrayWithObject:_currentSelectIndexPath] withRowAnimation:UITableViewRowAnimationNone];
        }
    }
}

- (void)alertView:(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex
{
    if (buttonIndex != alertView.cancelButtonIndex) {
        if ([self.uiDelegate respondsToSelector:@selector(hideModeAction)]) {
            [self.uiDelegate hideModeAction];
        }
    }
}

#pragma mark - Action Handler

- (void)showInputTextFieldForSection:(NSInteger)section forRow:(NSInteger)row
{
    x5fPmco *object = (x5fPmco *)[[self.dataSource objectAtIndex:section] objectAtIndex:row];
    x5fPav *alertView = [[x5fPav alloc] initWithTitle:object.title message:@"\n\n" delegate:self cancelButtonTitle:kTextCancel otherButtonTitles:kTextSave, nil];
    alertView.tag = kTagAlertTextFieldView;
    
    UITextField *textField = [[[UITextField alloc] initWithFrame:CGRectMake(30, 65, 200, 30)] autorelease];
    textField.borderStyle = UITextBorderStyleRoundedRect;
    [textField setClearButtonMode:UITextFieldViewModeWhileEditing];
    textField.contentVerticalAlignment = UIControlContentVerticalAlignmentCenter;
    textField.delegate = self;
    textField.font = [UIFont systemFontOfSize:15];
    textField.keyboardType = UIKeyboardTypeNumberPad;
    textField.tag = kTagAlertTextField;
    [alertView addSubview:textField];
    
    alertView.frame = CGRectOffset(alertView.frame, 0, -kOffsetYWhenSubViewIsTextField);

    [alertView show];
    [alertView release];
}

- (void)showInputSliderForSection:(NSInteger)section forRow:(NSInteger)row
{
    x5fPmco *object = (x5fPmco *)[[self.dataSource objectAtIndex:section] objectAtIndex:row];
    x5fPav *alertView = [[x5fPav alloc] initWithTitle:object.title message:@"\n\n" delegate:self cancelButtonTitle:kTextCancel otherButtonTitles:kTextSave, nil];
    alertView.tag = kTagAlertSliderView;
    
    UISlider *slider = [[[UISlider alloc] initWithFrame:CGRectMake(30, 70, 200, 20)] autorelease];
    slider.minimumValue = object.sliderMinimumValue;
    slider.maximumValue = object.sliderMaximumValue;
    slider.value = object.sliderValue;
    [slider addTarget:self action:@selector(sliderUpdateValueAction:) forControlEvents:UIControlEventValueChanged];
    [alertView addSubview:slider];
    slider.tag = kTagAlertSlider;
    
    UILabel *sliderValueLabel = [[[UILabel alloc] initWithFrame:CGRectZero] autorelease];
    sliderValueLabel.backgroundColor = [UIColor clearColor];
    sliderValueLabel.textAlignment = NSTextAlignmentRight;
    sliderValueLabel.font = [UIFont systemFontOfSize:15.0f];
    sliderValueLabel.tag = kTagAlertSliderLabel;
    sliderValueLabel.textColor = kAlertViewButtonTitleColorNormal;
    sliderValueLabel.text = [self configuredDetailsStringWithDelegateFormat:[NSString stringWithFormat:@"%f",object.sliderValue]
                                                                  indexPath:[NSIndexPath indexPathForRow:row inSection:section]];
    [sliderValueLabel sizeToFit];
    sliderValueLabel.frame = CGRectMake(CGRectGetMinX(slider.frame),
                                        CGRectGetMinY(slider.frame) - CGRectGetHeight(sliderValueLabel.frame) - 4.0f,
                                        CGRectGetWidth(slider.frame), CGRectGetHeight(sliderValueLabel.frame));
    [alertView addSubview:sliderValueLabel];
    [alertView show];
    [alertView release];
}

- (void)sliderUpdateValueAction:(UISlider *)sender
{
    x5fPav *alertView = (x5fPav *)sender.superview;
    UILabel *sliderValueLabel = (UILabel *)[alertView viewWithTag:kTagAlertSliderLabel];
    sliderValueLabel.text = [self configuredDetailsStringWithDelegateFormat:[NSString stringWithFormat:@"%f",sender.value]
                                                                  indexPath:_currentSelectIndexPath];
}

- (void)customNavigationBarLeftItemAction:(UIButton *)button
{
    if ([self.uiDelegate respondsToSelector:@selector(dismissSettingsViewControllerAction)]) {
        [self.uiDelegate dismissSettingsViewControllerAction];
    }
}

- (void)customNavigationBarRightItemAction:(UIButton *)button
{
    x5fPavc *aboutVC = [[x5fPavc alloc] init];
    [self.navigationController pushViewController:aboutVC animated:YES];
}

- (void)hideModButtonAction:(UIButton *)button
{
    UIAlertView *alertView = [[UIAlertView alloc] initWithTitle:kAlertNoticeTitleText
                                                        message:kAlertHideContentText
                                                       delegate:self
                                              cancelButtonTitle:kAlertCancelText
                                              otherButtonTitles:kAlertHideText, nil];
    [alertView show];
    [alertView release];
}

- (BOOL)prefersStatusBarHidden
{
//    NSLog(@"********HIDDEN svc*********");
    return YES; //返回NO表示要显示，返回YES将hiden
}

@end

```

`unitySpeedTools2020/x5fPmw/Model/x5fPmco.h`:

```h
#import <Foundation/Foundation.h>

typedef enum{
    CellSelectTypeSwitch      = 0,
    CellSelectTypeTextField   = 1,
    CellSelectTypeSlider = 2,
    CellSelectTypeNone,
}CellSelectType;

@interface x5fPmco : NSObject

@property (nonatomic, retain) NSString *title;
@property (nonatomic, assign) CellSelectType inputType;

// Toggle
@property (nonatomic, assign) BOOL toggleValue;

// Input TextField
@property (nonatomic, assign) NSInteger inputValue;
@property (nonatomic, assign) NSInteger inputDefaultValue; // Default值时显示灰色，其余显示绿色

// UISlider
@property (nonatomic, assign) float sliderMinimumValue;
@property (nonatomic, assign) float sliderMaximumValue;
@property (nonatomic, assign) float sliderValue;
@property (nonatomic, assign) float sliderDefaultValue; // Default值时显示灰色，其余显示绿色


- (id)initWithTitle:(NSString *)title withInputType:(CellSelectType)type;

- (id)initSwitchTypeWithTitle:(NSString *)title toggle:(BOOL)toggleValue;   // 开关
- (id)initInputTypeWithTitle:(NSString *)title value:(NSInteger)value defaultValue:(NSInteger)defaultValue;    // 输入框
- (id)initSliderTypeWithTitle:(NSString *)title value:(float)value defaultValue:(float)defaultValue minValue:(float)min maxValue:(float)max;   // 滑动条

@end

```

`unitySpeedTools2020/x5fPmw/Model/x5fPmco.m`:

```m
#import "x5fPmco.h"

@implementation x5fPmco

- (id)initWithTitle:(NSString *)title withInputType:(CellSelectType)type
{
    self = [super init];
    if (self) {
        self.title = title;
        self.inputType = type;
    }
    return self;
}

- (id)init
{
    self = [super init];
    
    if (self) {
        self.title = @"Default";
        self.inputType = CellSelectTypeSwitch;
    }
    return self;
}

- (id)initSwitchTypeWithTitle:(NSString *)title toggle:(BOOL)toggleValue
{
    self = [super init];
    
    if (self) {
        self.title = title;
        self.inputType = CellSelectTypeSwitch;
        self.toggleValue = toggleValue;
    }
    return self;
}

- (id)initInputTypeWithTitle:(NSString *)title value:(NSInteger)value defaultValue:(NSInteger)defaultValue
{
    self = [super init];
    
    if (self) {
        self.title = title;
        self.inputType = CellSelectTypeTextField;
        self.inputValue = value;
        self.inputDefaultValue = defaultValue;
    }
    return self;
}

- (id)initSliderTypeWithTitle:(NSString *)title value:(float)value defaultValue:(float)defaultValue minValue:(float)min maxValue:(float)max
{
    self = [super init];
    
    if (self) {
        self.title = title;
        self.inputType = CellSelectTypeSlider;
        self.sliderValue = value;
        self.sliderDefaultValue = defaultValue;
        self.sliderMinimumValue = min;
        self.sliderMaximumValue = max;
    }
    return self;
}


@end

```

`unitySpeedTools2020/x5fPmw/View/HBView.h`:

```h
#import <UIKit/UIKit.h>

@interface HBView : UIView

@end

```

`unitySpeedTools2020/x5fPmw/View/HBView.m`:

```m
#import "HBView.h"

@implementation HBView

- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
    }
    return self;
}


/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect
{
    // Drawing code
}
*/

- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event
{
    id hitView = [super hitTest:point withEvent:event];
    if (hitView == self) {
        return nil;
    }
    else {
        return hitView;
    }
}

@end

```

`unitySpeedTools2020/x5fPmw/View/HBWindow.h`:

```h
#import <UIKit/UIKit.h>

@interface HBWindow : UIWindow

@end

```

`unitySpeedTools2020/x5fPmw/View/HBWindow.m`:

```m
#import "HBWindow.h"

@implementation HBWindow

- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
        // Initialization code
    }
    return self;
}

/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect
{
    // Drawing code
}
*/

- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event
{
    id hitView = [super hitTest:point withEvent:event];
    if (hitView == self) {
        return nil;
    }
    else {
        return hitView;
    }
}

@end

```

`unitySpeedTools2020/x5fPmw/View/x5fPav.h`:

```h
#import <UIKit/UIKit.h>
//[UIColor colorWithCGColor:[UIColor redColor].CGColor]
// alertView背景颜色
#define kAlertViewBackgroundColor           [UIColor colorWithWhite:0xe7/255.0 alpha:1]
// 标题颜色
#define kAlertViewTitleTextColor            [UIColor colorWithRed:0x0/255.0f green:0x0/255.0f blue:0x0/255.0f alpha:0.8]
// 内容颜色
#define kAlertViewMessageTextColor          [UIColor colorWithRed:0x0/255.0f green:0x0/255.0f blue:0x0/255.0f alpha:0.8]
// 按钮默认颜色
#define kAlertViewButtonColorNormal         kAlertViewBackgroundColor
// 按钮高亮颜色
#define kAlertViewButtonColorHighlighted    [UIColor colorWithWhite:0xe1/255.0 alpha:1]
// 按钮字体颜色
#define kAlertViewButtonTitleColorNormal    [UIColor colorWithRed:0x15/255.0f green:0x7d/255.0f blue:0xfb/255.0f alpha:1]
// 按钮分割线颜色
#define kAlertViewButtonSeparatorLineColor  [UIColor colorWithRed:0xad/255.0f green:0xae/255.0f blue:0xb0/255.0f alpha:1.0f]


#define kAlertViewTitleFontSize     18.0f           // title字体大小
#define kAlertViewMessageFontSize   16.0f  // message字体大小
#define kAlertViewButtonFontSize    16.0f   // button字体大小

#define kAlertViewWidth             266 // alertView宽度
#define kAlertViewMinHeight         133 // alertView高度

#define kAlertViewHorizontalPadding 20  // alertView水平padding(内边距)
#define kAlertViewTopPadding        20  // alertView顶部padding
#define kAlertViewBottomPadding     22  // alertView底部padding
#define kAlertViewMiddleSpacing     9   // title和message中间的距离

#define kAlertViewTitleLabelHeight  20  // 标题高度
#define kAlertViewButtonHeight      48  // 按钮高度

#define kOffsetYWhenSubViewIsTextField  140.0f

@protocol x5fPavd;  //XXAlertViewDelegate

@interface x5fPav : UIView   //XXAlertView
{
    id/*<XXAlertViewDelegate>*/ _delegate;
    BOOL _autoDismissWhenEnteringBackground;
    
    NSString *_title;
    NSString *_message;
    
    NSInteger _cancelButtonIndex;
    NSInteger _firstOtherButtonIndex;
    NSInteger _clickedButtonIndex;
    
    UIWindow *_dimWindow;
    UILabel *_titleLabel;
    UILabel *_messageLabel;
    NSMutableArray *_buttonArray;
}
@property(nonatomic,assign) id/*<XXAlertViewDelegate>*/ delegate;
@property(nonatomic,assign) BOOL autoDismissWhenEnteringBackground; // 进入后台时是否自动消失，默认为NO

@property(nonatomic,retain) UILabel *titleLabel;    // changed to public
@property(nonatomic,retain) UILabel *messageLabel;  // changed to public
@property(nonatomic,copy)   NSString *title;
@property(nonatomic,copy)   NSString *message;

@property(nonatomic,readonly) NSUInteger numberOfButtons;
@property(nonatomic,readonly) NSInteger cancelButtonIndex;
@property(nonatomic,readonly) NSInteger firstOtherButtonIndex;

- (id)initWithTitle:(NSString *)title message:(NSString *)message delegate:(id)delegate cancelButtonTitle:(NSString *)cancelButtonTitle otherButtonTitles:(NSString *)otherButtonTitles, ... NS_REQUIRES_NIL_TERMINATION;
- (NSUInteger)numberOfButtons;
- (NSString *)buttonTitleAtIndex:(NSInteger)buttonIndex;
- (UIButton *)buttonAtIndex:(NSInteger)buttonIndex;

- (void)setAutoDismissWhenEnteringBackground;

- (void)show;
- (void)showImmediately;
- (void)dismissWithClickedButtonIndex:(NSInteger)buttonIndex animated:(BOOL)animated;

- (void)clearDelegateAndDismiss;

@end



@interface x5fPav (Animations)
// 灰色背景淡入
+ (CAAnimation *)animationForShowingDimWindow;
// alertView弹出动画
+ (CAAnimation *)animationForShowingAlertView;
// 灰色背景淡出
+ (CAAnimation *)animationForDismissingDimWindow;
// alertView消失动画
+ (CAAnimation *)animationForDismissingAlertView;
@end



@protocol x5fPavd <NSObject>
@optional
- (void)x5fPav:(x5fPav *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex;
- (void)x5fPav:(x5fPav *)alertView willDismissWithButtonIndex:(NSInteger)buttonIndex;
- (void)x5fPav:(x5fPav *)alertView didDismissWithButtonIndex:(NSInteger)buttonIndex;
@end

```

`unitySpeedTools2020/x5fPmw/View/x5fPav.m`:

```m
#import "x5fPav.h"
#import "x5fPavm.h"
#import "x5fPl.h"
#import <QuartzCore/QuartzCore.h>
#import "x5fPb.h"

#define kAlertViewAutoDismissButtonIndex    -999

#define kAlertViewDismissAnimationSymbol    @"AlertViewDismissAnimation"
#define kAlertViewAnimationTypeKey          @"AlertViewAnimationTypeKey"
#define kAlertViewAnimationButtonIndexKey   @"AlertViewAnimationButtonIndexKey"

#pragma mark - x5fPav (Animations)
#pragma mark -

@interface x5vc : UIViewController

@end
@implementation x5vc

- (BOOL)prefersStatusBarHidden
{
//    NSLog(@"********HIDDEN x5vc*********");
    return YES; //返回NO表示要显示，返回YES将hiden
}
@end

@implementation x5fPav (Animations)

// 灰色背景淡入
+ (CAAnimation *)animationForShowingDimWindow
{
    CABasicAnimation *backgroundAnimation = [CABasicAnimation animationWithKeyPath:@"backgroundColor"];
    backgroundAnimation.duration = 0.2;
    backgroundAnimation.removedOnCompletion = YES;
    backgroundAnimation.fromValue = (id)[UIColor colorWithWhite:0 alpha:0.0f].CGColor;
    backgroundAnimation.toValue = (id)[UIColor colorWithWhite:0 alpha:0.3f].CGColor;
    backgroundAnimation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn];
    return backgroundAnimation;
}

// alertView弹出动画
+ (CAAnimation *)animationForShowingAlertView
{
    CGFloat duration = 0.3;
    // 淡入
    CAKeyframeAnimation *opacityAnimation = [CAKeyframeAnimation animationWithKeyPath:@"opacity"];
    opacityAnimation.removedOnCompletion = YES;
    opacityAnimation.fillMode = kCAFillModeForwards;
    opacityAnimation.duration = duration;
    opacityAnimation.values = @[ @(0.0), @(1.0) ];
    opacityAnimation.keyTimes = @[ @(0.0), @(0.9) ];
    opacityAnimation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];
    // 放大缩小
    CAKeyframeAnimation *popupAnimation = [CAKeyframeAnimation animationWithKeyPath:@"transform"];
    popupAnimation.removedOnCompletion = YES;
    popupAnimation.fillMode = kCAFillModeForwards;
    popupAnimation.duration = duration;
    popupAnimation.values = @[ [NSValue valueWithCATransform3D:CATransform3DMakeScale(1.19, 1.19, 1.19)],
                               [NSValue valueWithCATransform3D:CATransform3DMakeScale(1.2, 1.2, 1.2)],
                               [NSValue valueWithCATransform3D:CATransform3DMakeScale(1.0, 1.0, 1.0)] ];
    popupAnimation.keyTimes = @[ @(0.0), @(0.15), @(0.9) ];
    popupAnimation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];
    // 动画组合
    CAAnimationGroup *animation = [CAAnimationGroup animation];
    animation.removedOnCompletion = YES;
    animation.animations = @[ opacityAnimation, popupAnimation ];
    animation.duration = duration;
    animation.removedOnCompletion = YES;
    
    return animation;
}

// 灰色背景淡出
+ (CAAnimation *)animationForDismissingDimWindow
{
    CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@"opacity"];
    animation.removedOnCompletion = NO;
    animation.fillMode = kCAFillModeForwards;
    animation.duration = 0.15;
    animation.fromValue = [NSNumber numberWithFloat:1.0];
    animation.toValue = [NSNumber numberWithFloat:0.0];
    animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];
    return animation;
}

// alertView消失动画
+ (CAAnimation *)animationForDismissingAlertView
{
    CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@"transform.scale"];
    animation.removedOnCompletion = NO;
    animation.fillMode = kCAFillModeForwards;
    animation.duration = 0.2;
    animation.fromValue = [NSNumber numberWithFloat:1];
    animation.toValue = [NSNumber numberWithFloat:0.8];
    animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];
    return animation;
}

@end

#pragma mark - x5fPav
#pragma mark -

@interface x5fPav () {
    BOOL _dismissed; // 是否已经消失，避免两次调用dismiss导致crash
}
@property(nonatomic,retain) UIWindow *dimWindow;
@property(nonatomic,retain) NSMutableArray *buttonArray;
@end

@implementation x5fPav

@synthesize delegate = _delegate;
@synthesize autoDismissWhenEnteringBackground = _autoDismissWhenEnteringBackground;

@synthesize title = _title;
@synthesize message = _message;

@synthesize cancelButtonIndex = _cancelButtonIndex;
@synthesize firstOtherButtonIndex = _firstOtherButtonIndex;

@synthesize dimWindow = _dimWindow;
@synthesize titleLabel = _titleLabel;
@synthesize messageLabel = _messageLabel;
@synthesize buttonArray = _buttonArray;

- (id)initWithTitle:(NSString *)title message:(NSString *)message delegate:(id)delegate cancelButtonTitle:(NSString *)cancelButtonTitle otherButtonTitles:(NSString *)otherButtonTitles, ...
{
    self = [super initWithFrame:CGRectZero];
    if (self) {
        self.autoresizingMask = UIViewAutoresizingFlexibleBottomMargin | UIViewAutoresizingFlexibleTopMargin | UIViewAutoresizingFlexibleLeftMargin | UIViewAutoresizingFlexibleRightMargin;
        self.backgroundColor = kAlertViewBackgroundColor;
        self.layer.cornerRadius = 6;
        self.clipsToBounds = YES;
        self.delegate = delegate;
        self.title = title;
        self.message = message;
        _cancelButtonIndex = -1;
        _firstOtherButtonIndex = -1;
        _clickedButtonIndex = -1;
        NSMutableArray *buttonArray = [[NSMutableArray alloc] init];
        self.buttonArray = buttonArray;
        [buttonArray release];
        
        [self loadDimWindow];
        [self loadMainView];
        [self loadTitleLabel:title];
        [self loadMessageLabel:message];
        
        if (cancelButtonTitle != nil) {
            _cancelButtonIndex = [self addButtonWithTitle:cancelButtonTitle];
        }
        va_list args;
        va_start(args, otherButtonTitles);
        for (NSString *otherButtonTitle = otherButtonTitles; otherButtonTitle != nil; otherButtonTitle = va_arg(args, NSString*)) {
            NSInteger buttonIndex = [self addButtonWithTitle:otherButtonTitle];
            if (_firstOtherButtonIndex == -1) {
                _firstOtherButtonIndex = buttonIndex;
            }
        }
        va_end(args);
        [self layoutButtons];
        
        [self layoutMainView];
    }
    
    return self;
}

- (void)dealloc
{
    self.delegate = nil;
    
    self.title = nil;
    self.message = nil;
    
    self.dimWindow = nil;
    self.titleLabel = nil;
    self.messageLabel = nil;
    self.buttonArray = nil;
    [super dealloc];
}

/*
 // Only override drawRect: if you perform custom drawing.
 // An empty implementation adversely affects performance during animation.
 - (void)drawRect:(CGRect)rect
 {
 // Drawing code
 }
 */

#pragma mark - load views methods

- (void)loadDimWindow
{
    if (self.dimWindow == nil) {
        x5vc *temp = [[x5vc alloc] init];
        
//        UIView *tempBGView = [[UIView alloc] initWithFrame:temp.view.frame];
//        tempBGView.autoresizingMask = UIViewAutoresizingFlexibleBottomMargin | UIViewAutoresizingFlexibleTopMargin | UIViewAutoresizingFlexibleLeftMargin | UIViewAutoresizingFlexibleRightMargin | UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;
//        tempBGView.backgroundColor = [UIColor lightGrayColor];
//        [temp.view addSubview:tempBGView];
        temp.view.backgroundColor = [UIColor clearColor];
//        [tempBGView addSubview:self];
        [temp.view addSubview:self];
        
        UIWindow *dimWindow = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];
        dimWindow.windowLevel = UIWindowLevelAlert - 10;
        dimWindow.userInteractionEnabled = NO;
        dimWindow.rootViewController = temp;
        dimWindow.backgroundColor = [UIColor colorWithWhite:0 alpha:0.3f];
        self.dimWindow = dimWindow;
        [dimWindow release];
    }
}

- (NSInteger)addButtonWithTitle:(NSString *)title
{
    x5fPb *button = [x5fPb buttonWithType:x5fPbsc];
    button.exclusiveTouch = YES;
    button.titleLabel.font = [UIFont systemFontOfSize:kAlertViewButtonFontSize];
    [button setTitle:title forState:UIControlStateNormal];
    [button setTitleColor:kAlertViewButtonTitleColorNormal forState:UIControlStateNormal];
    [button setBackgroundColor:kAlertViewButtonColorNormal forState:UIControlStateNormal];
    [button setBackgroundColor:kAlertViewButtonColorHighlighted forState:UIControlStateHighlighted];
    button.tag = [self.buttonArray count];
    button.autoresizingMask = UIViewAutoresizingFlexibleTopMargin;
    [button addTarget:self action:@selector(buttonClicked:) forControlEvents:UIControlEventTouchUpInside];
    [_buttonArray addObject:button];
    [self addSubview:button];
    return button.tag;
}

- (void)loadMainView
{
    CGRect frame = CGRectMake((CGRectGetWidth(self.dimWindow.frame)-kAlertViewWidth)/2, (CGRectGetHeight(self.dimWindow.frame)-kAlertViewMinHeight)/2, kAlertViewWidth, kAlertViewMinHeight);
    self.frame = frame;
}

- (void)loadTitleLabel:(NSString *)title
{
    if (title == nil || [title length] == 0) {
        return;
    }
    
    CGFloat width = kAlertViewWidth - kAlertViewHorizontalPadding * 2;
    
    UILabel *titleLabel = [[UILabel alloc] initWithFrame:CGRectMake(kAlertViewHorizontalPadding, kAlertViewTopPadding, width, kAlertViewTitleLabelHeight)];
    titleLabel.clipsToBounds = NO;
    titleLabel.backgroundColor = [UIColor clearColor];
    titleLabel.autoresizingMask = UIViewAutoresizingFlexibleBottomMargin;
    titleLabel.textAlignment = UITextAlignmentCenter;
    titleLabel.textColor = kAlertViewTitleTextColor;
    titleLabel.font = [UIFont boldSystemFontOfSize:kAlertViewTitleFontSize];
    titleLabel.text = title;
    self.titleLabel = titleLabel;
    [titleLabel release];
    [self addSubview:self.titleLabel];
}

- (void)loadMessageLabel:(NSString *)message
{
    if (message == nil || [message length] == 0) {
        return;
    }
    
    CGFloat width = kAlertViewWidth - kAlertViewHorizontalPadding * 2;
    CGFloat y = kAlertViewTopPadding;
    if (_titleLabel) {
        y += (CGRectGetHeight(_titleLabel.frame) + kAlertViewMiddleSpacing);
    }
    
    UILabel *messageLabel = [[UILabel alloc] initWithFrame:CGRectMake(kAlertViewHorizontalPadding, y, width, 0)];
    messageLabel.backgroundColor = [UIColor clearColor];
    messageLabel.autoresizingMask = UIViewAutoresizingFlexibleBottomMargin;
    messageLabel.numberOfLines = 0;
    messageLabel.textAlignment = UITextAlignmentCenter;
    messageLabel.textColor = kAlertViewMessageTextColor;
    messageLabel.font = [UIFont systemFontOfSize:kAlertViewMessageFontSize];
    messageLabel.text = message;
    [messageLabel sizeToFit];
    
    if (CGRectGetWidth(messageLabel.frame) < width) {
        CGRect frame = messageLabel.frame;
        frame.size.width = width;
        messageLabel.frame = frame;
    }
    
    if (CGRectGetHeight(messageLabel.frame) > 300) {
        CGRect frame = messageLabel.frame;
        frame.size.height = 300;
        messageLabel.frame = frame;
    }
    self.messageLabel = messageLabel;
    [messageLabel release];
    [self addSubview:self.messageLabel];
}

- (void)addSeparatorLineOnButton:(UIButton *)button extensional:(BOOL)extensional
{
    // 顶部线
    x5fPl *topSeparatorLine = [[x5fPl alloc] initWithFrame:CGRectMake(0, 0, button.frame.size.width, 1)];
    topSeparatorLine.closedType = x5fPlctt;
    topSeparatorLine.lineColor = kAlertViewButtonSeparatorLineColor;
    topSeparatorLine.autoresizingMask = UIViewAutoresizingFlexibleBottomMargin | UIViewAutoresizingFlexibleWidth;
    [button addSubview:topSeparatorLine];
    [topSeparatorLine release];
    
    if (extensional) {
        // 两个按钮时的中线
        x5fPl *middleSeparatorLine = [[x5fPl alloc] initWithFrame:CGRectMake(0, 0, 1, button.frame.size.height)];
        middleSeparatorLine.closedType = x5fPlctl;
        middleSeparatorLine.lineColor = kAlertViewButtonSeparatorLineColor;
        middleSeparatorLine.autoresizingMask = UIViewAutoresizingFlexibleRightMargin | UIViewAutoresizingFlexibleHeight;
        [button addSubview:middleSeparatorLine];
        [middleSeparatorLine release];
    }
}

- (void)layoutButtons
{
    NSUInteger numberOfButtons = self.numberOfButtons;
    CGFloat buttonWidth = 0;
    CGFloat buttonY = 0;
    if (numberOfButtons == 1) { // 一个按钮
        UIButton *button = [_buttonArray objectAtIndex:0];
        buttonWidth = kAlertViewWidth;
        buttonY = self.frame.size.height - kAlertViewButtonHeight;
        button.frame = CGRectMake(0, buttonY, buttonWidth, kAlertViewButtonHeight);
        button.titleLabel.font = [UIFont boldSystemFontOfSize:kAlertViewButtonFontSize]; // 一个按钮一定加粗
        // separator line
        [self addSeparatorLineOnButton:button extensional:NO];
    } else if (numberOfButtons == 2) { // 两个按钮，并排分布
        buttonWidth = kAlertViewWidth / 2;
        buttonY = self.frame.size.height - kAlertViewButtonHeight;
        CGFloat buttonX = 0;
        for (UIButton *button in _buttonArray) {
            button.frame = CGRectMake(buttonX, buttonY, buttonWidth, kAlertViewButtonHeight);
            if (buttonX == 0) { // 两个按钮，右边的按钮加粗
                button.titleLabel.font = [UIFont systemFontOfSize:kAlertViewButtonFontSize];
            } else {
                button.titleLabel.font = [UIFont boldSystemFontOfSize:kAlertViewButtonFontSize];
            }
            // separator line
            [self addSeparatorLineOnButton:button extensional:(buttonX != 0)];
            
            buttonX += buttonWidth;
        }
    } else if (numberOfButtons >= 3) { // 等于或大于三个按钮，垂直分布
        buttonWidth = kAlertViewWidth;
        buttonY = self.frame.size.height - kAlertViewButtonHeight;
        CGRect buttonFrame = CGRectMake(0, buttonY, buttonWidth, kAlertViewButtonHeight);
        UIButton *button = nil;
        BOOL setBold = NO; // 是否已设置一个按钮为加粗，三个按钮以上，最底的按钮加粗
        if (self.cancelButtonIndex != -1) {
            button = [_buttonArray objectAtIndex:self.cancelButtonIndex];
            button.frame = buttonFrame;
            // 三个按钮以上，最底的按钮加粗
            button.titleLabel.font = [UIFont boldSystemFontOfSize:kAlertViewButtonFontSize];
            setBold = YES;
            // separator line
            [self addSeparatorLineOnButton:button extensional:NO];
            
            buttonFrame.origin.y -= kAlertViewButtonHeight;
        }
        // 其他按钮，从最下面的按钮往上遍历
        for (NSInteger i = numberOfButtons - 1; i >= _firstOtherButtonIndex; i--) {
            button = [_buttonArray objectAtIndex:i];
            button.frame = buttonFrame;
            // 三个按钮以上，最底的按钮加粗
            if (setBold == NO) {
                button.titleLabel.font = [UIFont boldSystemFontOfSize:kAlertViewButtonFontSize];
                setBold = YES;
            } else {
                button.titleLabel.font = [UIFont systemFontOfSize:kAlertViewButtonFontSize];
            }
            // separator line
            [self addSeparatorLineOnButton:button extensional:NO];
            
            buttonFrame.origin.y -= kAlertViewButtonHeight;
        }
    }
}

- (void)layoutMainView
{
    CGFloat mainViewHeight = kAlertViewTopPadding;
    // title
    if (_titleLabel != nil) {
        mainViewHeight += _titleLabel.frame.size.height;
        mainViewHeight += kAlertViewMiddleSpacing;
    }
    // message
    if (_messageLabel != nil) {
        mainViewHeight += _messageLabel.frame.size.height;
    } else {
        mainViewHeight -= kAlertViewMiddleSpacing;
    }
    mainViewHeight += kAlertViewBottomPadding;
    // buttons
    NSUInteger numberOfButtons = self.numberOfButtons;
    if (numberOfButtons >= 3) { // 等于大于3个按钮
        UIButton *topButton = (_cancelButtonIndex == -1) ? [_buttonArray objectAtIndex:0] : [_buttonArray objectAtIndex:1];
        mainViewHeight += CGRectGetHeight(self.frame) - CGRectGetMinY(topButton.frame);
    } else if (numberOfButtons > 0) { // 1-2个按钮
        mainViewHeight += kAlertViewButtonHeight;
    } else { // 没有按钮
        
    }
    CGRect frame = self.frame;
    frame.size.height = mainViewHeight;
    frame.origin.y = (CGRectGetHeight(self.dimWindow.frame) - mainViewHeight) / 2;
    self.frame = CGRectIntegral(frame);
    
}

#pragma mark - public methods

- (NSUInteger)numberOfButtons
{
    return [self.buttonArray count];
}

- (NSString *)buttonTitleAtIndex:(NSInteger)buttonIndex
{
    if (buttonIndex >= 0 && buttonIndex < [_buttonArray count]) {
        UIButton *button = [_buttonArray objectAtIndex:buttonIndex];
        return [button titleForState:UIControlStateNormal];
    } else {
        return nil;
    }
}

- (UIButton *)buttonAtIndex:(NSInteger)buttonIndex
{
    UIButton *button = nil;
    for (UIButton *elem in self.buttonArray) {
        if (elem.tag == buttonIndex) {
            button = elem;
            break;
        }
    }
    return button;
}

- (void)show
{
    [[x5fPavm shareAlertViewManager] showAlertView:self];
}

- (void)showImmediately
{
    if ([[[UIApplication sharedApplication] delegate] respondsToSelector:@selector(window)]){
        UIWindow *window = [[[UIApplication sharedApplication] delegate] performSelector:@selector(window)];
        [self cancelEventsForView:window];
    }
    
    self.dimWindow.userInteractionEnabled = YES;
    [self.dimWindow makeKeyAndVisible];
    
    // 背景变灰动画
    CAAnimation *backgroundAnimation = [[self class] animationForShowingDimWindow];
    [self.dimWindow.layer addAnimation:backgroundAnimation forKey:nil];
    
    // 弹框弹下弹下的动画
    if (UIInterfaceOrientationIsPortrait([UIApplication sharedApplication].statusBarOrientation)) {
        CAAnimation *animation = [[self class] animationForShowingAlertView];
        [self.layer addAnimation:animation forKey:nil];
    }
    
//    [self.dimWindow addSubview:self];
    
    [self activeTextField];
}

- (void)dismissWithClickedButtonIndex:(NSInteger)buttonIndex animated:(BOOL)animated
{
    // 防止两次dismiss
    if (_dismissed) {
        return;
    } else {
        _dismissed = YES;
    }
    
    [self willDismissWithButtonIndex:buttonIndex];
    
    if (animated) {
        // 动画事务
        [CATransaction begin];
        // 显式动画
        [CATransaction setDisableActions:YES];
        // 背景淡出动画
        self.dimWindow.layer.opacity = 0.1; // 如果是0，就会相当于 .hidden == YES，则不会挡住用户操作
        CAAnimation *backgroundAnimation = [[self class] animationForDismissingDimWindow];
        backgroundAnimation.delegate = self;
        [backgroundAnimation setValue:kAlertViewDismissAnimationSymbol forKey:kAlertViewAnimationTypeKey];
        [backgroundAnimation setValue:@(buttonIndex) forKey:kAlertViewAnimationButtonIndexKey];
        [self.dimWindow.layer addAnimation:backgroundAnimation forKey:nil];
        // 弹框消失动画
        CAAnimation *animation = [[self class] animationForDismissingAlertView];
        [self.layer addAnimation:animation forKey:nil];
        
        [CATransaction commit];
    } else {
        [self didDismissWithButtonIndex:buttonIndex];
    }
    
}

- (void)willDismissWithButtonIndex:(NSInteger)buttonIndex
{
    //    [[XXAlertViewManager shareAlertViewManager] alertViewWillDismiss:self];
    
    if ([self.delegate respondsToSelector:@selector(x5fPav:willDismissWithButtonIndex:)]) {
        [self.delegate x5fPav:self willDismissWithButtonIndex:buttonIndex];
    }
}

- (void)didDismissWithButtonIndex:(NSInteger)buttonIndex
{
    self.dimWindow.userInteractionEnabled = NO;
    self.dimWindow = nil;
    
    if ([self.delegate respondsToSelector:@selector(x5fPav:didDismissWithButtonIndex:)]) {
        [self.delegate x5fPav:self didDismissWithButtonIndex:buttonIndex];
    }
    [self removeFromSuperview];
    
    [[x5fPavm shareAlertViewManager] alertViewDidDismiss:self];
}

- (void)setAutoDismissWhenEnteringBackground
{
    self.autoDismissWhenEnteringBackground = YES;
}

- (void)clearDelegateAndDismiss
{
    self.delegate = nil;
    [self dismissWithClickedButtonIndex:kAlertViewAutoDismissButtonIndex animated:NO];
}

#pragma mark - Animation Delegate methods

- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag
{
    NSString *animationKey = [anim valueForKey:kAlertViewAnimationTypeKey];
    if ([animationKey isEqualToString:kAlertViewDismissAnimationSymbol]) {
        [self didDismissWithButtonIndex:[[anim valueForKey:kAlertViewAnimationButtonIndexKey] integerValue]];
    }
}

#pragma mark - private methods

- (void)cancelEventsForView:(UIView *)view
{
    NSArray *gestureRecognizers = view.gestureRecognizers;
    if ([gestureRecognizers count] > 0) {
        // 检查手势，有的话需要cancel掉当前的手势，例如UISwitch的subviews的手势
        for (UIGestureRecognizer *gesture in gestureRecognizers) {
            if (gesture.enabled) {
                gesture.enabled = NO;   // cancel
                gesture.enabled = YES;  // restore
            }
        }
    }
    for (UIView *subview in [view subviews]) {
        if ([subview isKindOfClass:[UITextField class]]) {
            //            [(UITextField *)subview resignFirstResponder];
        } else if ([subview isKindOfClass:[UITextView class]]) {
            //            [(UITextView *)subview resignFirstResponder];
        } else if ([subview isKindOfClass:[UIControl class]]) {
            [(UIControl *)subview cancelTrackingWithEvent:nil];
        }
        [self cancelEventsForView:subview];
    }
}

- (void)activeTextField
{
    for (UIView *subview in [self subviews]) {
        if ([subview isKindOfClass:[UITextField class]]) {
            UITextField *textField = (UITextField *)subview;
            if (textField.enabled && !textField.hidden) {
                [textField becomeFirstResponder];
                break;
            }
        }
    }
}

#pragma mark - buttons events methods

- (void)buttonClicked:(UIButton *)button
{
    self.userInteractionEnabled = NO;
    _clickedButtonIndex = button.tag;
    
    if ([self.delegate respondsToSelector:@selector(x5fPav:clickedButtonAtIndex:)]) {
        [self.delegate x5fPav:self clickedButtonAtIndex:_clickedButtonIndex];
    }
    [self dismissWithClickedButtonIndex:_clickedButtonIndex animated:YES];
}
- (BOOL)prefersStatusBarHidden
{
//    NSLog(@"********HIDDEN av*********");
    return YES; //返回NO表示要显示，返回YES将hiden
}
@end

```

`unitySpeedTools2020/x5fPmw/View/x5fPavm.h`:

```h
#import <Foundation/Foundation.h>
#import <UIKit/UIKit.h>

@class x5fPav;

@interface x5fPavm : NSObject //XXAlertViewManager
{
    UIWindow        *_lastKeyWindow;
    NSMutableArray  *_displayQueue;
    x5fPav    *_currentAlertView;
    id               _delegateOfCurrentAlertView;
}

+ (x5fPavm *)shareAlertViewManager;

- (void)showAlertView:(x5fPav *)alertView;
- (void)alertViewDidDismiss:(x5fPav *)alertView;

@end

```

`unitySpeedTools2020/x5fPmw/View/x5fPavm.m`:

```m
#import "x5fPavm.h"
#import "x5fPav.h"

@interface x5fPavm ()
@property(nonatomic,retain) UIWindow *lastKeyWindow;
@property(nonatomic,retain) x5fPav *currentAlertView;
@property(nonatomic,retain) id delegateOfCurrentAlertView;  // 备份alertView的delegate，防止autoDismissWhenEnterBackground时delegate被清空导致crash的情况
@end

@implementation x5fPavm

@synthesize lastKeyWindow = _lastKeyWindow;
@synthesize currentAlertView = _currentAlertView;
@synthesize delegateOfCurrentAlertView = _delegateOfCurrentAlertView;

+ (x5fPavm *)shareAlertViewManager
{
    static x5fPavm *sharedAlertViewManager = nil;
    @synchronized(self) {
        if (sharedAlertViewManager == nil) {
            sharedAlertViewManager = [[x5fPavm alloc] init];
        }
    }
    return sharedAlertViewManager;
}

- (id)init
{
    self = [super init];
    if (self) {
        _displayQueue = [[NSMutableArray alloc] init];
        [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(applicationDidEnterBackground:) name:UIApplicationDidEnterBackgroundNotification object:nil];
    }
    return self;
}

- (void)dealloc
{
    [[NSNotificationCenter defaultCenter] removeObserver:self name:UIApplicationDidEnterBackgroundNotification object:nil];
    self.lastKeyWindow = nil;
    self.currentAlertView = nil;
    self.delegateOfCurrentAlertView = nil;
    [_displayQueue release];
    _displayQueue = nil;
    
    [super dealloc];
}

- (void)applicationDidEnterBackground:(NSNotification *)notification
{
    @synchronized(_displayQueue) {
        // 把队列里要autoDismissWhenEnteringBackground的都移除
        NSMutableArray *alertViewsShouldBeRemoved = [[NSMutableArray alloc] init];
        for (x5fPav *alertView in _displayQueue) {
            if (alertView.autoDismissWhenEnteringBackground) {
                alertView.delegate = nil;
                [alertViewsShouldBeRemoved addObject:alertView];
            }
        }
        [_displayQueue removeObjectsInArray:alertViewsShouldBeRemoved];
        [alertViewsShouldBeRemoved release];
    }
    
    if (self.currentAlertView && self.currentAlertView.autoDismissWhenEnteringBackground) {
        [self.currentAlertView clearDelegateAndDismiss];
    }
}

#pragma mark -

- (void)firstAlertViewWillShow
{
    self.lastKeyWindow = [UIApplication sharedApplication].keyWindow;
    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(windowDidBecomeKey:) name:UIWindowDidBecomeKeyNotification object:nil];
}

- (void)lastAlertViewWillDismiss
{
    [[NSNotificationCenter defaultCenter] removeObserver:self name:UIWindowDidBecomeKeyNotification object:nil];
    if (self.lastKeyWindow) {
        [self.lastKeyWindow makeKeyWindow];
        self.lastKeyWindow = nil;
    } else {
        id delegate = [UIApplication sharedApplication].delegate;
        if ([delegate respondsToSelector:@selector(window)]) {
            UIWindow *mainWindow = [delegate performSelector:@selector(window)];
            [mainWindow makeKeyWindow];
        }
    }
    self.currentAlertView = nil;
    self.delegateOfCurrentAlertView = nil;
}

- (void)windowDidBecomeKey:(NSNotification *)notification
{
    UIWindow *nKeyWindow = notification.object;
    UIWindow *windowOfCurrentAlertView = nil;
    if ([self.currentAlertView respondsToSelector:@selector(dimWindow)]) {
        windowOfCurrentAlertView = [self.currentAlertView performSelector:@selector(dimWindow)];
    }
    if (windowOfCurrentAlertView && nKeyWindow != windowOfCurrentAlertView) {
        if (nKeyWindow.windowLevel <= windowOfCurrentAlertView.windowLevel) {
            self.lastKeyWindow = nKeyWindow;
            [windowOfCurrentAlertView makeKeyWindow];
        }
    }
}

#pragma mark -

- (void)showAlertView:(x5fPav *)alertView
{
    @synchronized(_displayQueue) {
        if (alertView) {
            if ([_displayQueue count] == 0) {
                [self firstAlertViewWillShow];
                [_displayQueue addObject:alertView];
                
                self.currentAlertView = alertView;
                if (alertView.autoDismissWhenEnteringBackground) {
                    self.delegateOfCurrentAlertView = alertView.delegate;
                } else {
                    self.delegateOfCurrentAlertView = nil;
                }
                [self.currentAlertView showImmediately];
            } else if (![_displayQueue containsObject:alertView]) {
                [_displayQueue addObject:alertView];
            }
        }
        
    }
}

- (void)alertViewDidDismiss:(x5fPav *)alertView
{
    @synchronized(_displayQueue) {
        if (alertView) {
            [_displayQueue removeObject:alertView];
        }
        if ([_displayQueue count] > 0) {
            x5fPav *nextAlertView = [_displayQueue objectAtIndex:0];
            
            self.currentAlertView = nextAlertView;
            if (alertView.autoDismissWhenEnteringBackground) {
                self.delegateOfCurrentAlertView = alertView.delegate;
            } else {
                self.delegateOfCurrentAlertView = nil;
            }
            [self.currentAlertView showImmediately];
        } else {
            [self lastAlertViewWillDismiss];
        }
    }
}

@end

```

`unitySpeedTools2020/x5fPmw/View/x5fPb.h`:

```h
#import <UIKit/UIKit.h>
//XXButtonType
typedef NS_ENUM(NSUInteger, x5fPbt){
    x5fPbsc,  //XXButtonStyleCustom
};

@interface x5fPb : UIButton //XXButton
{
    NSMutableDictionary *_backgroundColorForStates; // key: @(UIControlState), value: (UIColor *)
}
+ (id)buttonWithType:(x5fPbt)style;
- (void)setBackgroundColor:(UIColor *)color forState:(UIControlState)state;
@end

```

`unitySpeedTools2020/x5fPmw/View/x5fPb.m`:

```m
#import "x5fPb.h"
@interface x5fPb ()
@property(nonatomic,retain) UIColor *normalBackgroundColor;
// background color for normal state
// 备份用，在找不到state相应的backgroundColor时使用normal background color
@end

@implementation x5fPb
+ (id)buttonWithType:(x5fPbt)style {
    x5fPb* button = [super buttonWithType:UIButtonTypeCustom];
    
    switch (style) {
        case x5fPbsc:
        { // 自定义风格，求别搞
        }
            break;
    }
    
    return button;
}

- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
    }
    return self;
}

- (void)dealloc
{
    self.normalBackgroundColor = nil;
    [_backgroundColorForStates release];
    _backgroundColorForStates = nil;
    
    [super dealloc];
}

#pragma mark -

- (void)setSelected:(BOOL)selected
{
    [super setSelected:selected];
    // code for -[XXButton setBackgroundColor:forState:]
    [self refreshBackgroundColorForCurrentState];
}

- (void)setHighlighted:(BOOL)highlighted
{
    [super setHighlighted:highlighted];
    // code for -[XXButton setBackgroundColor:forState:]
    [self refreshBackgroundColorForCurrentState];

}

- (void)setEnabled:(BOOL)enabled
{
    [super setEnabled:enabled];
    // code for -[XXButton setBackgroundColor:forState:]
    [self refreshBackgroundColorForCurrentState];
    // line / border
}

- (void)setBackgroundColor:(UIColor *)backgroundColor
{
    [super setBackgroundColor:backgroundColor];
    // code for -[XXButton setBackgroundColor:forState:]
    // 非 -[XXButton setBackgroundColor:forState:] 相关方法调用，作为normal保存起来
    // 以便找不到backgroundColorForStates时恢复normal颜色
    self.normalBackgroundColor = backgroundColor;
}


#pragma mark - methods for -[x5fPb setBackgroundColor:forState:]

- (void)setBackgroundColor:(UIColor *)color forState:(UIControlState)state
{
    if (_backgroundColorForStates == nil) {
        _backgroundColorForStates = [[NSMutableDictionary alloc] init];
    }
    
    if (color) {
        [_backgroundColorForStates setObject:color forKey:@(state)];
    } else {
        [_backgroundColorForStates removeObjectForKey:@(state)];
    }
    // normal state
    if (state == UIControlStateNormal) {
        self.normalBackgroundColor = color;
    }
    // 如果与当前状态一致，立即更改
    if (self.state == state) {
        super.backgroundColor = color ? color : self.normalBackgroundColor; // super set background color
    }
}

- (void)refreshBackgroundColorForCurrentState
{
    if (_backgroundColorForStates) {
        UIColor *color = [_backgroundColorForStates objectForKey:@(self.state)];
        if (color) {
            // 找到相关backgroundColor
            super.backgroundColor = color; // super set background color
        } else {
            // 找不到
            super.backgroundColor = self.normalBackgroundColor;
        }
    }
}

@end

```

`unitySpeedTools2020/x5fPmw/View/x5fPdb.h`:

```h
#import <UIKit/UIKit.h>

@interface x5fPdb : UIButton  //XXDraggableButton
{
    BOOL _isDragging;
    BOOL _singleTapBeenCanceled;
    CGPoint _beginLocation;
    UILongPressGestureRecognizer *_longPressGestureRecognizer;
}

@property (nonatomic) BOOL draggable;
@property (nonatomic) BOOL autoDocking;

@property (nonatomic) CGPoint dockPoint;
@property (nonatomic) CGFloat limitedDistance;

@property (nonatomic, copy) void(^longPressBlock)(x5fPdb *button);
@property (nonatomic, copy) void(^tapBlock)(x5fPdb *button);
@property (nonatomic, copy) void(^doubleTapBlock)(x5fPdb *button);

@property (nonatomic, copy) void(^draggingBlock)(x5fPdb *button);
@property (nonatomic, copy) void(^dragDoneBlock)(x5fPdb *button);

@property (nonatomic, copy) void(^autoDockingBlock)(x5fPdb *button);
@property (nonatomic, copy) void(^autoDockingDoneBlock)(x5fPdb *button);

- (id)initInView:(id)view WithFrame:(CGRect)frame;

- (BOOL)isDragging;

+ (NSArray *)itemsInView:(id)view;
- (BOOL)isInView:(id)view;


@end

```

`unitySpeedTools2020/x5fPmw/View/x5fPdb.m`:

```m
#import "x5fPdb.h"

#define XX_WAITING_KEYWINDOW_AVAILABLE 0.f
#define XX_AUTODOCKING_ANIMATE_DURATION 0.25f
#define XX_DOUBLE_TAP_TIME_INTERVAL 0.36f
#define XX_BUTTON_CLEAR_TIME_INTERVAL 4.0f
#define XX_BUTTON_CLEAR_ANIMATE_DURATION 0.15f

#define XX_POINT_NULL CGPointMake(MAXFLOAT, -MAXFLOAT)


@interface x5fPdb ()

@property (retain, nonatomic) NSTimer *timer;

- (BOOL)isInsideRect:(CGRect)rect;
- (BOOL)isIntersectsRect:(CGRect)rect;
- (BOOL)isCrossedRect:(CGRect)rect;

- (void)removeAllCodeBlocks;

+ (void)removeAllFromView:(id)superView;

+ (void)removeFromView:(id)superView withTag:(NSInteger)tag;
+ (void)removeFromView:(id)superView withTags:(NSArray *)tags;

+ (void)removeAllFromView:(id)view insideRect:(CGRect)rect;
- (void)removeFromSuperviewInsideRect:(CGRect)rect;

+ (void)removeAllFromView:(id)view intersectsRect:(CGRect)rect;
- (void)removeFromSuperviewIntersectsRect:(CGRect)rect;

+ (void)removeAllFromView:(id)view crossedRect:(CGRect)rect;
- (void)removeFromSuperviewCrossedRect:(CGRect)rect;

@end

@implementation x5fPdb

- (id)initWithFrame:(CGRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        [self defaultSetting];
    }
    return self;
}

- (id)init {
    self = [super init];
    if (self) {
        [self defaultSetting];
    }
    return self;
}

- (id)initInView:(id)view WithFrame:(CGRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        if (view) {
            [view addSubview:self];
        }
//        else {
//            [self performSelector:@selector(addButtonToKeyWindow) withObject:nil afterDelay:XX_WAITING_KEYWINDOW_AVAILABLE];
//        }
        [self defaultSetting];
    }
    return self;
}

- (void)defaultSetting {
//    [self.layer setCornerRadius:self.frame.size.height / 2];
//    [self.layer setBorderColor:[UIColor lightGrayColor].CGColor];
//    [self.layer setBorderWidth:0.5];
//    [self.layer setMasksToBounds:YES];
    
    self.autoresizingMask = UIViewAutoresizingFlexibleLeftMargin | UIViewAutoresizingFlexibleTopMargin | UIViewAutoresizingFlexibleBottomMargin;
    
    _draggable = YES;
    _autoDocking = YES;
    _singleTapBeenCanceled = NO;
    
    _longPressGestureRecognizer = [[UILongPressGestureRecognizer alloc] init];
    [_longPressGestureRecognizer addTarget:self action:@selector(gestureRecognizerHandle:)];
    [_longPressGestureRecognizer setAllowableMovement:0];
    [self addGestureRecognizer:_longPressGestureRecognizer];
    
    [self setDockPoint:XX_POINT_NULL];
    
    [self setLimitedDistance: -1.f];
    

    CGAffineTransform transform;
    if ([UIApplication sharedApplication].statusBarOrientation == UIInterfaceOrientationPortrait) {
        transform = CGAffineTransformMakeRotation(0);
    }
    else if ([UIApplication sharedApplication].statusBarOrientation == UIInterfaceOrientationPortraitUpsideDown) {
        transform = CGAffineTransformMakeRotation(180 * M_PI / 180.0);
    }
    else if ([UIApplication sharedApplication].statusBarOrientation == UIInterfaceOrientationLandscapeRight) {
        transform = CGAffineTransformMakeRotation(90 * M_PI / 180.0);
    }
    else if ([UIApplication sharedApplication].statusBarOrientation == UIInterfaceOrientationLandscapeLeft) {
        transform = CGAffineTransformMakeRotation(270 * M_PI / 180.0);
    }
    
//    [self setTransform:transform];
//    
//    [[NSNotificationCenter defaultCenter] addObserver:self
//                                             selector:@selector(orientationChange:)
//                                                 name:UIApplicationWillChangeStatusBarOrientationNotification
//                                               object:nil];
 
}

- (void)orientationChange:(NSNotification *)notification
{
    int newOrientation = [[notification.userInfo objectForKey:UIApplicationStatusBarOrientationUserInfoKey] integerValue];
    
    CGAffineTransform transform;
    if (newOrientation == UIInterfaceOrientationPortrait) {
        transform = CGAffineTransformMakeRotation(0);
    }
    else if (newOrientation == UIInterfaceOrientationPortraitUpsideDown) {
        transform = CGAffineTransformMakeRotation(180 * M_PI / 180.0);
    }
    else if (newOrientation == UIInterfaceOrientationLandscapeRight) {
        transform = CGAffineTransformMakeRotation(90 * M_PI / 180.0);
    }
    else if (newOrientation == UIInterfaceOrientationLandscapeLeft ){
        transform = CGAffineTransformMakeRotation(270 * M_PI / 180.0);
    }

    [self setTransform:transform];
}

- (void)addButtonToKeyWindow {
    [[UIApplication sharedApplication].keyWindow addSubview:self];
}

#pragma mark - Timer handle
- (void)hideWithAlpha
{
    [UIView animateWithDuration:XX_BUTTON_CLEAR_ANIMATE_DURATION animations:^{
        self.alpha = 0.5;
    }];
}

- (void)showWithAlpha
{
    if (self.alpha < 1) {
        [UIView animateWithDuration:XX_BUTTON_CLEAR_ANIMATE_DURATION animations:^{
            self.alpha = 1;
        }];
    }
}

- (void)clearTimer
{
    [self.timer invalidate];
    self.timer = nil;
}

- (void)startTimer
{
    
}

#pragma mark - Gesture recognizer handle

- (void)gestureRecognizerHandle:(UILongPressGestureRecognizer *)gestureRecognizer {
    switch ([gestureRecognizer state]) {
        case UIGestureRecognizerStateBegan: {
            if (_longPressBlock) {
                _longPressBlock(self);
            }
        }
            break;
            
        default:
            break;
    }
    
}

#pragma mark - Blocks
#pragma mark Touch Blocks

- (void)setTapBlock:(void (^)(x5fPdb *))tapBlock {
    _tapBlock = tapBlock;
    
    if (_tapBlock) {
        [self addTarget:self action:@selector(buttonTouched) forControlEvents:UIControlEventTouchUpInside];
    }
}

#pragma mark - Touch

- (void)buttonTouched {
    [self showWithAlpha];
    [self performSelector:@selector(executeButtonTouchedBlock) withObject:nil afterDelay:(_doubleTapBlock ? XX_DOUBLE_TAP_TIME_INTERVAL : 0)];
}

- (void)executeButtonTouchedBlock {
    if (!_singleTapBeenCanceled && _tapBlock && !_isDragging) {
        _tapBlock(self);
        [self clearTimer];
    }
}

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event{
    _isDragging = NO;
    [super touchesBegan:touches withEvent:event];
    UITouch *touch = [touches anyObject];
    if (touch.tapCount == 2) {
        if (_doubleTapBlock) {
            _singleTapBeenCanceled = YES;
            _doubleTapBlock(self);
        }
    } else {
        _singleTapBeenCanceled = NO;
    }
    _beginLocation = [[touches anyObject] locationInView:self];
}

- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event{
    if (_draggable) {
        _isDragging = YES;
        
        UITouch *touch = [touches anyObject];
        /*
         * 原方法可适用各种SIZE的super view
         *
        CGPoint currentLocation = [touch locationInView:self];
        
        float offsetX = currentLocation.x - _beginLocation.x;
        float offsetY = currentLocation.y - _beginLocation.y;
        
        self.center = CGPointMake(self.center.x + offsetX, self.center.y + offsetY);
        */
        self.center = [touch locationInView:self.superview];
        if ([self isdockPointAvailable] && [self isLimitedDistanceAvailable]) {
            [self checkIfExceedingLimitedDistanceThenFixIt];
        } else {
            [self checkIfOutOfBorderThenFixIt];
        }
        
        if (_draggingBlock) {
            _draggingBlock(self);
        }
    }
}

- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event
{
    [super touchesEnded: touches withEvent: event];
    /* 
     * hubert
     * 当滑动完不执行点击事件
     */
    if (_isDragging) {
        _singleTapBeenCanceled = YES;
    }
    if (_isDragging && _dragDoneBlock) {
        _dragDoneBlock(self);
        _singleTapBeenCanceled = YES;
    }
    
    if (_isDragging && _autoDocking) {
        if ( ![self isdockPointAvailable]) {
            [self dockingToBorder];
        } else {
            [self dockingToPoint];
        }
    }
    
    _isDragging = NO;
}

- (void)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event
{
    _isDragging = NO;
    [super touchesCancelled:touches withEvent:event];
}

- (BOOL)isDragging {
    return _isDragging;
}

#pragma mark - Docking

- (BOOL)isdockPointAvailable {
    return !CGPointEqualToPoint(self.dockPoint, XX_POINT_NULL);
}

- (void)dockingToBorder {
    CGRect superviewFrame = self.superview.frame;
    CGRect frame = self.frame;
    CGFloat middleX = superviewFrame.size.width / 2;
    CGFloat middleY = superviewFrame.size.height / 2;
    CGPoint resultPoint;
    
    CGFloat minX = MIN(CGRectGetMidX(frame), CGRectGetWidth(superviewFrame) - CGRectGetMidX(frame));
    CGFloat minY = MIN(CGRectGetMidY(frame), CGRectGetHeight(superviewFrame) - CGRectGetMidY(frame));

    if (UIInterfaceOrientationIsPortrait([UIApplication sharedApplication].statusBarOrientation)) {
        if (minY < 80.0) {
            if (minX < minY) {
                if (self.center.x >= middleX) {
                    resultPoint = CGPointMake(superviewFrame.size.width - frame.size.width / 2, self.center.y);
                } else {
                    resultPoint = CGPointMake(frame.size.width / 2, self.center.y);
                }
            } else {
                if (self.center.y >= middleY) {
                    resultPoint = CGPointMake(self.center.x, CGRectGetHeight(superviewFrame) - CGRectGetHeight(frame) / 2);
                } else {
                    resultPoint = CGPointMake(self.center.x, CGRectGetHeight(frame) / 2);
                }
                
            }
        } else {
            if (self.center.x >= middleX) {
                resultPoint = CGPointMake(superviewFrame.size.width - frame.size.width / 2, self.center.y);
            } else {
                resultPoint = CGPointMake(frame.size.width / 2, self.center.y);
            }
        }
    }
    else if (UIInterfaceOrientationIsLandscape([UIApplication sharedApplication].statusBarOrientation)) {
        if (minX < 80.0f) {
            if (minX < minY) {
                if (self.center.x >= middleX) {
                    resultPoint = CGPointMake(superviewFrame.size.width - frame.size.width / 2, self.center.y);
                } else {
                    resultPoint = CGPointMake(frame.size.width / 2, self.center.y);
                }
            } else {
                if (self.center.y >= middleY) {
                    resultPoint = CGPointMake(self.center.x, CGRectGetHeight(superviewFrame) - CGRectGetHeight(frame) / 2);
                } else {
                    resultPoint = CGPointMake(self.center.x, CGRectGetHeight(frame) / 2);
                }
                
            }
        } else {
            if (self.center.y >= middleY) {
                resultPoint = CGPointMake(self.center.x, CGRectGetHeight(superviewFrame) - CGRectGetHeight(frame) / 2);
            } else {
                resultPoint = CGPointMake(self.center.x, CGRectGetHeight(frame) / 2);
            }
        }
    }

    [UIView animateWithDuration:XX_AUTODOCKING_ANIMATE_DURATION animations:^{
        self.center = resultPoint;
        if (_autoDockingBlock) {
            _autoDockingBlock(self);
        }
    } completion:^(BOOL finished) {
        if (_autoDockingDoneBlock) {
            _autoDockingDoneBlock(self);
        }
    }];
    
    
    
}

- (void)dockingToPoint {
    [UIView animateWithDuration:XX_AUTODOCKING_ANIMATE_DURATION animations:^{
        self.center = self.dockPoint;
        if (_autoDockingBlock) {
            _autoDockingBlock(self);
        }
    } completion:^(BOOL finished) {
        if (_autoDockingDoneBlock) {
            _autoDockingDoneBlock(self);
        }
    }];
}

#pragma mark - Dragging

- (BOOL)isLimitedDistanceAvailable {
    return (self.limitedDistance > 0);
}

- (BOOL)checkIfExceedingLimitedDistanceThenFixIt {
    CGPoint tmpDPoint = CGPointMake(self.center.x - self.dockPoint.x, self.center.y - self.dockPoint.y);
    
    CGFloat distance = hypotf(tmpDPoint.x, tmpDPoint.y);
    
    BOOL willExceedingLimitedDistance = distance >= self.limitedDistance;
    
    if (willExceedingLimitedDistance) {
        self.center = CGPointMake(tmpDPoint.x * self.limitedDistance / distance + self.dockPoint.x, tmpDPoint.y * self.limitedDistance / distance + self.dockPoint.y);
    }
    
    return willExceedingLimitedDistance;
}

- (BOOL)checkIfOutOfBorderThenFixIt {
    BOOL willOutOfBorder = NO;
    
    CGRect superviewFrame = self.superview.frame;
    CGRect frame = self.frame;
    CGFloat leftLimitX = frame.size.width / 2;
    CGFloat rightLimitX = superviewFrame.size.width - leftLimitX;
    CGFloat topLimitY = frame.size.height / 2;
    CGFloat bottomLimitY = superviewFrame.size.height - topLimitY;
    
    if (self.center.x > rightLimitX) {
        willOutOfBorder = YES;
        self.center = CGPointMake(rightLimitX, self.center.y);
    }else if (self.center.x <= leftLimitX) {
        willOutOfBorder = YES;
        self.center = CGPointMake(leftLimitX, self.center.y);
    }
    
    if (self.center.y > bottomLimitY) {
        willOutOfBorder = YES;
        self.center = CGPointMake(self.center.x, bottomLimitY);
    }else if (self.center.y <= topLimitY){
        willOutOfBorder = YES;
        self.center = CGPointMake(self.center.x, topLimitY);
    }
    
    return willOutOfBorder;
}

#pragma mark - Common Tools

#pragma mark Items In View

+ (NSArray *)itemsInView:(id)view {
    NSMutableArray *subviews = [NSMutableArray arrayWithArray:[view subviews]];
    
    if (! subviews) {
        subviews = [NSMutableArray arrayWithArray:[[UIApplication sharedApplication].keyWindow subviews]];
    }
    
    for (id view in subviews) {
        if ( ![view isKindOfClass:[x5fPdb class]]) {
            [subviews removeObject:view];
        }
    }
    
    return subviews;
}

- (BOOL)isInView:(id)view {
    return [self.superview isEqual:view];
}

#pragma mark Rect Detecter

- (BOOL)isInsideRect:(CGRect)rect {
    return  CGRectContainsRect(rect, self.frame);
}

- (BOOL)isIntersectsRect:(CGRect)rect {
    return  CGRectIntersectsRect(rect, self.frame);
}

- (BOOL)isCrossedRect:(CGRect)rect {
    return  [self isIntersectsRect:rect] && ![self isInsideRect:rect];
}

#pragma mark Remove All Code Blocks

- (void)removeAllCodeBlocks {
    self.longPressBlock = nil;
    self.tapBlock = nil;
    self.doubleTapBlock = nil;
    
    self.draggingBlock = nil;
    self.dragDoneBlock = nil;
    
    self.autoDockingBlock = nil;
    self.autoDockingDoneBlock = nil;
}

#pragma mark - Remove all from view

+ (void)removeAllFromView:(id)superView {
    for (id view in [self itemsInView:superView]) {
        [view removeFromSuperview];
    }
}

#pragma mark - Remove from view with tag(s)

+ (void)removeFromView:(id)superView withTag:(NSInteger)tag {
    for (id view in [self itemsInView:superView]) {
        if (((x5fPdb *)view).tag == tag) {
            [view removeFromSuperview];
        }
    }
}

+ (void)removeFromView:(id)superView withTags:(NSArray *)tags {
    for (NSNumber *tag in tags) {
        [x5fPdb removeFromView:superView withTag:[tag intValue]];
    }
}

#pragma mark - Remove from view inside rect

+ (void)removeAllFromView:(id)view insideRect:(CGRect)rect {
    for (id subview in [self itemsInView:view]) {
        if ([subview isInsideRect:rect]) {
            [subview removeFromSuperview];
        }
    }
}

- (void)removeFromSuperviewInsideRect:(CGRect)rect {
    if (self.superview && [self isInsideRect:rect]) {
        [self removeFromSuperview];
        [self removeAllCodeBlocks];
    }
}

#pragma mark - Remove From View Overlapped Rect

+ (void)removeAllFromView:(id)view intersectsRect:(CGRect)rect {
    for (id subview in [self itemsInView:view]) {
        if ([subview isIntersectsRect:rect]) {
            [subview removeFromSuperview];
        }
    }
}

- (void)removeFromSuperviewIntersectsRect:(CGRect)rect {
    if (self.superview && [self isIntersectsRect:rect]) {
        [self removeFromSuperview];
    }
}

#pragma mark - Remove From View Crossed Rect

+ (void)removeAllFromView:(id)view crossedRect:(CGRect)rect {
    for (id subview in [self itemsInView:view]) {
        if ([subview isCrossedRect:rect]) {
            [subview removeFromSuperview];
        }
    }
}

- (void)removeFromSuperviewCrossedRect:(CGRect)rect {
    if (self.superview && [self isInsideRect:rect]) {
        [self removeFromSuperview];
    }
}


@end

```

`unitySpeedTools2020/x5fPmw/View/x5fPl.h`:

```h
#import <UIKit/UIKit.h>

#define XX_LINE_DEFAULT_COLOR  [UIColor colorWithCGColor:[UIColor redColor].CGColor]
//XXLineClosedType
//typedef NS_ENUM(NSInteger, x5fPlct) {
//    XXLineClosedTypeTop = 0,       // 线条靠近顶部
//    XXLineClosedTypeBottom = 1,    // 线条靠近底部
//    XXLineClosedTypeLeft = 2,      // 线条靠近左边
//    XXLineClosedTypeRight = 3      // 线条靠近右边
//};
typedef NS_ENUM(NSInteger, x5fPlct) {
    x5fPlctt = 0,       // 线条靠近顶部
    x5fPlctb = 1,    // 线条靠近底部
    x5fPlctl = 2,      // 线条靠近左边
    x5fPlctr = 3      // 线条靠近右边
};

@interface x5fPl : UIView //XXLine
{
    UIColor *_lineColor;
    x5fPlct _closedType;
}
@property(nonatomic,retain) UIColor *lineColor; // 线条颜色，默认为XX_LINE_DEFAULT_COLOR
@property(nonatomic,assign) x5fPlct closedType; // 默认为XXLineClosedTypeTop
@property(nonatomic,assign) float width; // 默认为XXLineClosedTypeTop

@end

```

`unitySpeedTools2020/x5fPmw/View/x5fPl.m`:

```m
#import "x5fPl.h"

@implementation x5fPl

@synthesize lineColor = _lineColor;
@synthesize closedType = _closedType;

- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self) {
        self.clipsToBounds = YES;
        self.opaque = NO;
        self.closedType = x5fPlctt;
        self.width = 1;
    }
    return self;
}

- (void)dealloc
{
    self.lineColor = nil;
    
    [super dealloc];
}

- (UIColor *)lineColor
{
    if (_lineColor == nil) {
        self.lineColor = XX_LINE_DEFAULT_COLOR;
    }
    return _lineColor;
}

// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect
{
    [super drawRect:rect];
    
    // context init
    CGContextRef context = UIGraphicsGetCurrentContext();
    CGContextSetStrokeColorWithColor(context, self.lineColor.CGColor);
    CGContextSetLineWidth(context, self.width);
    // add points
    CGFloat x = (_closedType == x5fPlctr) ? 1 : 0;
    CGFloat y = (_closedType == x5fPlctb) ? 1 : 0;
    CGContextMoveToPoint(context, x, y);
    if (_closedType == x5fPlctt || _closedType == x5fPlctb) {
        x = self.frame.size.width;
    } else {
        y = self.frame.size.height;
    }
    CGContextAddLineToPoint(context, x, y);
    // context finish
    CGContextStrokePath(context);
}

@end

```

`unitySpeedTools2020/x5fPmw/View/x5fPsc.h`:

```h
#import <UIKit/UIKit.h>

@interface x5fPsc : UITableViewCell

@property (nonatomic, retain) UIImageView *customAccessoryView;

- (void)configuredCellWithLeftText:(NSString *)left rightText:(NSString *)right isDefault:(BOOL)isDefault;

@end

```

`unitySpeedTools2020/x5fPmw/View/x5fPsc.m`:

```m
#import "x5fPsc.h"
#import "x5fPmgd.h"

@interface x5fPsc () //XXSettingsCell

@property (nonatomic, retain) UILabel *leftLabel;
@property (nonatomic, retain) UILabel *rightLabel;

@end

@implementation x5fPsc

- (id)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier
{
    self = [super initWithStyle:style reuseIdentifier:reuseIdentifier];
    if (self) {
        self.leftLabel = [[UILabel alloc] initWithFrame:CGRectMake(kSettingsCellLeftMarge, 11.0f, 0, 0)];
        self.leftLabel.backgroundColor = [UIColor clearColor];
        self.leftLabel.font = [UIFont systemFontOfSize:16.0f];
        self.leftLabel.textColor = [UIColor whiteColor];
        self.leftLabel.shadowColor = [UIColor colorWithWhite:0 alpha:0.8];
        self.leftLabel.shadowOffset = CGSizeMake(1, -1);
        [self addSubview:self.leftLabel];
        
        self.rightLabel = [[UILabel alloc] initWithFrame:CGRectZero];
        self.rightLabel.backgroundColor = [UIColor clearColor];
        self.rightLabel.textAlignment = NSTextAlignmentRight;
        self.rightLabel.font = [UIFont systemFontOfSize:15.0f];
        self.rightLabel.textColor = [self colorWithHexValue:0xbfbfbf alpha:1];
        [self addSubview:self.rightLabel];
        
        UIView *backgroundView = [[UIView alloc] initWithFrame:self.bounds];
        backgroundView.backgroundColor = [UIColor clearColor];
        backgroundView.clipsToBounds = YES;
        backgroundView.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;
        self.backgroundView = backgroundView;
        [backgroundView release];
        
        UIView *selectedBackgroundView = [[UIView alloc] initWithFrame:self.bounds];
        selectedBackgroundView.backgroundColor = [UIColor grayColor];
        selectedBackgroundView.clipsToBounds = YES;
        selectedBackgroundView.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;
        self.selectedBackgroundView = selectedBackgroundView;
        [selectedBackgroundView release];
        
        self.customAccessoryView = [[UIImageView alloc] initWithFrame:CGRectMake(kModMainPanelWidth - kSettingsCellAccessoryRightMarge + 6, (kSettingsCellHeight - 13.0) / 2.0, 8.0, 13.0)];
        self.customAccessoryView.image = [self customAccessoryViewNormalImage];
        self.customAccessoryView.highlightedImage = [self customAccessoryViewHighlightedImage];
        [self.contentView addSubview:self.customAccessoryView];

        CALayer *bottomBorder = [CALayer layer];
        bottomBorder.frame = CGRectMake(kSettingsCellLeftMarge, kSettingsCellHeight - 1.0f, kModMainPanelWidth - kSettingsCellLeftMarge * 2, 1.0f);
//        bottomBorder.backgroundColor = [UIColor colorWithWhite:1 alpha:0.3f].CGColor;

        [self.layer addSublayer:bottomBorder];
    }
    return self;
}

- (void)setSelected:(BOOL)selected animated:(BOOL)animated
{
    [super setSelected:selected animated:animated];

    // Configure the view for the selected state
}

- (void)configuredCellWithLeftText:(NSString *)left rightText:(NSString *)right isDefault:(BOOL)isDefault
{
    self.rightLabel.text = right;
    [self.rightLabel sizeToFit];

    if ([self.customAccessoryView isHidden]) {
        self.rightLabel.frame = CGRectMake(kModMainPanelWidth - CGRectGetWidth(self.rightLabel.frame) - kSettingsCellAccessoryRightMarge + 12.0f,
                                           (kSettingsCellHeight - CGRectGetHeight(self.rightLabel.frame)) / 2.0f,
                                           CGRectGetWidth(self.rightLabel.frame), CGRectGetHeight(self.rightLabel.frame));
    }
    else {
        self.rightLabel.frame = CGRectMake(kModMainPanelWidth - CGRectGetWidth(self.rightLabel.frame) - kSettingsCellAccessoryRightMarge,
                                           (kSettingsCellHeight - CGRectGetHeight(self.rightLabel.frame)) / 2.0f,
                                           CGRectGetWidth(self.rightLabel.frame), CGRectGetHeight(self.rightLabel.frame));
    }

    self.leftLabel.text = left;
    [self.leftLabel sizeToFit];
    
    if ((CGRectGetMaxX(self.leftLabel.frame) +10.0f) > CGRectGetMinX(self.rightLabel.frame)) {
        self.leftLabel.frame = CGRectMake(CGRectGetMinX(self.leftLabel.frame), CGRectGetMinY(self.leftLabel.frame), CGRectGetMinX(self.rightLabel.frame) - CGRectGetMinX(self.leftLabel.frame)*2, CGRectGetHeight(self.leftLabel.frame));
    }
    
    if (isDefault) {
        self.rightLabel.textColor = [self colorWithHexValue:0xbfbfbf alpha:1];
    }
    else {
        self.rightLabel.textColor = [self colorWithHexValue:0x00ff01 alpha:1];
    }
}

- (UIColor *)colorWithHexValue:(NSUInteger)hexValue alpha:(CGFloat)alpha
{
    return [UIColor colorWithRed:((hexValue >> 16) & 0x000000FF)/255.0f
                           green:((hexValue >> 8) & 0x000000FF)/255.0f
                            blue:((hexValue) & 0x000000FF)/255.0
                           alpha:alpha];
}

- (UIImage *)customAccessoryViewNormalImage
{
    UIGraphicsBeginImageContextWithOptions(CGSizeMake(8,13), NO, 0);
    
    //// Color Declarations
    UIColor* color2 = [UIColor colorWithRed: 0.718 green: 0.718 blue: 0.718 alpha: 1];
    
    //// Bezier Drawing
    UIBezierPath* bezierPath = UIBezierPath.bezierPath;
    [bezierPath moveToPoint: CGPointMake(1.45, 0)];
    [bezierPath addLineToPoint: CGPointMake(8, 6.5)];
    [bezierPath addLineToPoint: CGPointMake(1.45, 13)];
    [bezierPath addLineToPoint: CGPointMake(0, 11.63)];
    [bezierPath addLineToPoint: CGPointMake(5.09, 6.5)];
    [bezierPath addLineToPoint: CGPointMake(0, 1.37)];
    [bezierPath addLineToPoint: CGPointMake(1.45, 0)];
    [bezierPath closePath];
    [color2 setFill];
    [bezierPath fill];
    
    UIImage* im = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    return im;
}

- (UIImage *)customAccessoryViewHighlightedImage
{
    UIGraphicsBeginImageContextWithOptions(CGSizeMake(8,13), NO, 0);

    //// Color Declarations
    UIColor* color2 = [UIColor colorWithRed: 0.962 green: 0.962 blue: 0.962 alpha: 1];
    
    //// Bezier Drawing
    UIBezierPath* bezierPath = UIBezierPath.bezierPath;
    [bezierPath moveToPoint: CGPointMake(1.45, 0)];
    [bezierPath addLineToPoint: CGPointMake(8, 6.5)];
    [bezierPath addLineToPoint: CGPointMake(1.45, 13)];
    [bezierPath addLineToPoint: CGPointMake(0, 11.63)];
    [bezierPath addLineToPoint: CGPointMake(5.09, 6.5)];
    [bezierPath addLineToPoint: CGPointMake(0, 1.37)];
    [bezierPath addLineToPoint: CGPointMake(1.45, 0)];
    [bezierPath closePath];
    [color2 setFill];
    [bezierPath fill];

    UIImage* im = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    
    return im;
}

@end

```