Project Path: arc_gmh5225_obfuscator_c4k1g_93

Source Tree:

```txt
arc_gmh5225_obfuscator_c4k1g_93
├── CommentObfuscator.cpp
├── CommentObfuscator.h
├── LineObfuscator.cpp
├── LineObfuscator.h
├── Obfuscator.cpp
├── Obfuscator.h
├── VarObfuscator.cpp
├── VarObfuscator.h
└── main.cpp

```

`CommentObfuscator.cpp`:

```cpp
#include"CommentObfuscator.h"


/*  The obfuscator receive a file and convert it to a array of strings, then obfuscate the code by deleting all the comments in the file and adding random comments in random places in the fileName
    Finaly, take the obfuscated code (array of strings) and convert it to a new file.
*/
  void CommentObfuscator::obfuscate (string fileName)
  {
    int commentsAdded = 0;
    int mainLine = 0;
    string *toObfuscate = parseFile (fileName);
    string randomComments[5];
    randomComments[0] = "// This code will conquer the world.";
    randomComments[1] = "// Here, we have no clue how it worked.";
    randomComments[2] = "// Best code ever.";
    randomComments[3] = "// No way this is working.";
    randomComments[4] = "// // If true == false, the world we know has changed.";




    for (int i = 0; toObfuscate[i] != "endArr"; i++) {
        int found = toObfuscate[i].find("main");
        if (found != string::npos)
        mainLine = i;
    }

    for (int i = 0; toObfuscate[i] != "endArr"; i++)
      {
	int found = toObfuscate[i].find ("//");
	if (found != string::npos)
	    toObfuscate[i] = toObfuscate[i].substr (0, found);
      }


    while (commentsAdded == 0){
            int randCommentsAmout = (rand () % 10 )+ 1;
    for (int i = mainLine; i < randCommentsAmout; i++) {
        if ((rand() )% 3 == 0 && i > mainLine){
        toObfuscate[i] += randomComments[rand()%5];
            commentsAdded++;
        }
    }}

      writeToFile(toObfuscate);
  };

```

`CommentObfuscator.h`:

```h
#ifndef COMMENTOBFUSCATOR_H
#define COMMENTOBFUSCATOR_H
#include "Obfuscator.h"



class CommentObfuscator:public Obfuscator
{
public:
  void obfuscate (string fileName);
};


#endif
```

`LineObfuscator.cpp`:

```cpp
#include"LineObfuscator.h"

/*  Line obfuscator create a variable with random name and insert it in a random place and initialize it with a random sum of two random numbers and insert the initialize in a random place in the code
    Finaly, take the obfuscated code (array of strings) and convert it to a new file.
*/
void
LineObfuscator::obfuscate (string fileName)
{
  string *toObfuscate = parseFile (fileName);
  int count = 0;
  string main = "main";
  int mainLine = 0;
  for (int i = 0; toObfuscate[i] != "endArr"; i++)
    {
      count++;
      int found = toObfuscate[i].find (main);
      if (found != string::npos)
	mainLine = i;
    }

  int randomLine = rand () % (count - 2);
  while (randomLine < mainLine + 1)
    {
      randomLine = rand () % (count - 2);
      if (randomLine > 1)
	{
	  int forFound = toObfuscate[randomLine - 1].find ("for");
	  if (forFound != string::npos)
	    randomLine = mainLine;
	}
    }
  string randomVar = generateRandomVar ();
  toObfuscate[mainLine + 1] += "\nint " + randomVar + ";";
  toObfuscate[randomLine] +=
    "\n" + randomVar + " = " + to_string ((rand () % 1000)) + " + " +
    to_string ((rand () % 1000)) + ";";
  writeToFile (toObfuscate);
};


```

`LineObfuscator.h`:

```h
#ifndef LINEOBFUSCATOR_H
#define LINEOBFUSCATOR_H
#include "Obfuscator.h"

class LineObfuscator:public Obfuscator
{
public:
 void obfuscate (string fileName);

};


#endif

```

`Obfuscator.cpp`:

```cpp
#include"Obfuscator.h"
#include<iostream>
#include <fstream>
#include <time.h>
using namespace std;


// Private function receive a boolean in order to know if the char is first or last char of the string, and return a random valid variable char.
char
Obfuscator::randomChar (bool invalidPlace)
{
  int randInt = rand ();
  if (invalidPlace == true)
    {
      char randChar = (randInt % 26) + 97;
      return randChar;
    }
  if ((randInt % 6) <= 2 && (randInt % 6) >= 0)
    {
      return (char) (randInt % 26) + 97;
    }
  if ((randInt % 6) <= 4 && (randInt % 6) >= 3)
    {
      char randChar = (randInt % 10) + 48;
      return randChar;
      if (randInt % 6 == 5)
	return '_';
    }
  return '_';
}

// Function generate a random variable name (using private function randomChar) and return it as a string.
string
Obfuscator::generateRandomVar ()
{
  char randChar;
  int randNum = (rand () % 10) + 1;
  string randomVar = "";
  bool invalidPlace = true;
  for (int i = 0; i < randNum; i++)
    {
      randomVar += randomChar (invalidPlace);
      invalidPlace = false;
      if (i == randNum - 2)
	invalidPlace = true;
    }
  return randomVar;
}


// Function receive a file name as a String, if the file cannot be open, exit(1), else -> reading each line and inserting it into array of string, finaly return the array.
string *
Obfuscator::parseFile (string filename)
{
  ifstream indata;
  indata.open (filename);
  if (!indata)
    {
      cout << "Cannot open file!" << endl;
      exit (1);
    }
  int length = 0;
  string line;
  while (getline (indata, line))
    {
      length++;
    }
  string *strArr = new string[length + 1];
  int i = 0;
  indata.clear ();
  indata.seekg (0);
  while (getline (indata, line))
    {
      strArr[i] = line;
      i++;
    }
  strArr[length] = "endArr";
  indata.close ();
  return strArr;
}
// Function receive a pointer to strings array and writing each string in a different line into a new file
void
Obfuscator::writeToFile (string * codeArray)
{
  ofstream outdata;
  outdata.open (OUT);
  int length = 0;
  for (int i = 0; codeArray[i] != "endArr"; i++)
    length++;
  for (int i = 0; i < length; i++)
    {
      outdata << codeArray[i] << endl;
    }
  outdata.close ();
  delete[] codeArray;
}


```

`Obfuscator.h`:

```h
#ifndef OBFUSCATOR_H
#define OBFUSCATOR_H
#include <string>


using namespace std;
class Obfuscator
{
public:
 virtual void obfuscate (string fileName) = 0;
  const std::string OUT = "newCode.c";
  string generateRandomVar ();
  string *parseFile (string filename);
  void writeToFile (string * codeArray);
private:
  char randomChar (bool invalidPlace);
};

#endif

```

`VarObfuscator.cpp`:

```cpp
#include"VarObfuscator.h"

// Method replace between 2 strings 
void
VarObfuscator::ReplaceString (string & str, string search, string replace)
{
  int pos = str.find (search);
  if (pos != string::npos)
    {
      str.replace (pos, search.length (), replace);
    }
};


/* Var obfuscator receive a file name and converting it into an array of strings
 The obfuscator choose one random int and change it name to a random name and goes all over the code and change it in all the places it appear
 Finaly, take the obfuscated code (array of strings) and convert it to a new file.
 */
void
VarObfuscator::obfuscate (string fileName)
{
  string *toObfuscate = parseFile (fileName);
  string integers[100];
  int count = 0;
  for (int i = 0; toObfuscate[i] != "endArr"; i++)
    {
      int found = toObfuscate[i].find ("int ");
      int found2 = toObfuscate[i].find ("for");
      int found3 = toObfuscate[i].find ("main");
      if (found != string::npos && found2 == string::npos && found3 == string::npos)
	{
	  integers[count] =
	    toObfuscate[i].substr (toObfuscate[i].find ("int ") + 4,
				   toObfuscate[i].find (";") - 7);
	  int equalMark = integers[count].find("=");
	  if (equalMark != string::npos){
	      integers[count] = integers[count].substr (0, equalMark);
	  }
	  count++;
	}
    }
  int randomNum = rand () % count;
  string randomVar = integers[randomNum];
  string newRandomVar = generateRandomVar ();
  for (int i = 0; i < count; i++)
    {

      for (int i = 0; toObfuscate[i] != "endArr"; i++)
	ReplaceString (toObfuscate[i], randomVar, newRandomVar);
    }
  writeToFile (toObfuscate);
};

```

`VarObfuscator.h`:

```h
#ifndef VAROBFUSCATOR_H
#define VAROBFUSCATOR_H
#include "Obfuscator.h"

class VarObfuscator:public Obfuscator
{
private:
  void ReplaceString (string & str, string search, string replace);
public:
  void obfuscate (string fileName);
};

#endif

```

`main.cpp`:

```cpp
#include <iostream>
#include <string>
#include "Obfuscator.h"
#include "LineObfuscator.h"
#include "VarObfuscator.h"
#include "CommentObfuscator.h"
using namespace std;
int main()
{
srand (time(NULL));
     Obfuscator* obfs[3];
    obfs[0] = new VarObfuscator();
    obfs[1] = new LineObfuscator();
    obfs[2] = new CommentObfuscator();
    obfs[0]->obfuscate("Test.txt");
    for(int i = 1; i < 3; i++) 
	obfs[i]->obfuscate(obfs[i-1]->OUT);


    return 0;
}

```