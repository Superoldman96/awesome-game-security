Project Path: arc_gmh5225_ghidra-frida-hook-gen_phkw35wu

Source Tree:

```txt
arc_gmh5225_ghidra-frida-hook-gen_phkw35wu
├── LICENSE
├── Module.manifest
├── README.md
├── build.gradle
├── data
│   └── README.txt
├── dist
│   └── ghidra_10.1.4_PUBLIC_20220804_frida_hook_generator.zip
├── extension.properties
├── ghidra_scripts
│   └── README.txt
├── images
│   └── Hook_demo.png
├── lib
│   └── README.txt
└── src
    ├── main
    │   ├── help
    │   │   └── help
    │   │       ├── TOC_Source.xml
    │   │       ├── shared
    │   │       │   └── Frontpage.css
    │   │       └── topics
    │   │           └── frida_hook_generator
    │   │               └── help.html
    │   ├── java
    │   │   └── frida_hook_generator
    │   │       └── frida_hook_generatorPlugin.java
    │   └── resources
    │       └── images
    │           └── README.txt
    └── test
        └── java
            └── README.test.txt

```

`LICENSE`:

```
BSD 2-Clause License

Copyright (c) 2022, CENSUS
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.

2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

```

`README.md`:

```md
## Frida Hook generator for Ghidra



This plugin provides two new options in the right-click menu of the Listing Window in Ghidra:

![Hook-demo](images/Hook_demo.png)



- Copy Frida Hook Script: This one creates a valid frida script that generates a hook for the target address or function, and puts it into the clipboard. 
- Copy Frida Hook Snippet: This one creates a snippet that is meant to be put inside a generated script, and hooks the target address or function using the (assumed) predefined variables of that script. It is not a valid frida script in itself.

This extension supports both function-level hooking (when hooking the first address of a function), as well as arbitrary address hooking (when hooking inside a function).

It should be noted that the right-click should be done when hovering over the instruction address in the Listing Window. If for example it is done when hovering over a function name that the current instruction calls, the hook will be generated for that function, and not the current instruction.



#### Installation:

- Decompress the ghidra\_\<version\>\_PUBLIC\_\<date\>_frida_hook_generator.zip file which is inside dist/ , in a folder
- Change the extension.properties file inside that folder, to reflect your Ghidra version (if it is not 10.1.4)
- Ghidra (before opening a tool) -> File -> Install Extensions -> + sign -> Select the folder -> Make sure the frida_hook_generator is checked in the list of extensions
- Restart Ghidra
- Open CodeBrowser tool and analyze a binary. When asked if the new plugin should be configured, press "Yes" and make sure it is ticked. 



#### Usage:

- Open CodeBrowser tool and analyze a binary. If it is the first time after the installation, you will be asked if the new plugin should be configured. Press "Yes" and make sure it is ticked. 
- Right click at the Listing Window on an address and select one of the two Frida Hook available options.
- Paste the copied text into a file. Typically the first hook will be generated by the "Copy Script" option, and subsequent hooks by the "Copy Snippet" option.
- Run the binary through frida, for example `frida -f <binary> -l script.js --no-pause` 



#### Notes:

- The "Copy Script" option introduces a 2-second delay for registering the interceptors. The reason for that is that a typical mobile application will not have all the dynamic libraries readily available at launch, for frida to hook into. As a quick fix, the script waits for a little and then tries to register the interceptors.  In certain cases, this means that the functions may be executed before frida hooks on them. While there is a plan to implement a more automated way to register interceptors as soon as a library is loaded, a current solution would be to either reduce the wait delay, or manually find the position where the library is loaded, hook that, and at that point register the new interceptors.
- The generated script attempts to display a hooked function's parameters when it is called. However, usually the "Listing" window which contains the assembly code, does not reflect that parameter number. As such, the generated script will not contain code to print the correct number of parameters (usually it does not recognize any parameter, and as such it does not print anything). The solution to fix this is to right click on a function's name on the Ghidra "Decompiler" window, and select "Commit Params/Return". Then, the "Listing" window will recognize the correct number of parameters.

```

`build.gradle`:

```gradle
/* BSD 2-Clause License
 *
 * Copyright (c) 2022, CENSUS
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */
// Builds a Ghidra Extension for a given Ghidra installation.
//
// An absolute path to the Ghidra installation directory must be supplied either by setting the 
// GHIDRA_INSTALL_DIR environment variable or Gradle project property:
//
//     > export GHIDRA_INSTALL_DIR=<Absolute path to Ghidra> 
//     > gradle
//
//         or
//
//     > gradle -PGHIDRA_INSTALL_DIR=<Absolute path to Ghidra>
//
// Gradle should be invoked from the directory of the project to build.  Please see the
// application.gradle.version property in <GHIDRA_INSTALL_DIR>/Ghidra/application.properties
// for the correction version of Gradle to use for the Ghidra installation you specify.

//----------------------START "DO NOT MODIFY" SECTION------------------------------
def ghidraInstallDir

if (System.env.GHIDRA_INSTALL_DIR) {
	ghidraInstallDir = System.env.GHIDRA_INSTALL_DIR
}
else if (project.hasProperty("GHIDRA_INSTALL_DIR")) {
	ghidraInstallDir = project.getProperty("GHIDRA_INSTALL_DIR")
}

if (ghidraInstallDir) {
	apply from: new File(ghidraInstallDir).getCanonicalPath() + "/support/buildExtension.gradle"
}
else {
	throw new GradleException("GHIDRA_INSTALL_DIR is not defined!")
}
//----------------------END "DO NOT MODIFY" SECTION-------------------------------

repositories {
	// Declare dependency repositories here.  This is not needed if dependencies are manually 
	// dropped into the lib/ directory.
	// See https://docs.gradle.org/current/userguide/declaring_repositories.html for more info.
	// Ex: mavenCentral()
}

dependencies {
	// Any external dependencies added here will automatically be copied to the lib/ directory when
	// this extension is built.	
}

```

`data/README.txt`:

```txt
The "data" directory is intended to hold data files that will be used by this module and will
not end up in the .jar file, but will be present in the zip or tar file.  Typically, data
files are placed here rather than in the resources directory if the user may need to edit them.

An optional data/languages directory can exist for the purpose of containing various Sleigh language
specification files and importer opinion files.  

The data/buildLanguage.xml is used for building the contents of the data/languages directory.

The skel language definition has been commented-out within the skel.ldefs file so that the 
skeleton language does not show-up within Ghidra.

See the Sleigh language documentation (docs/languages/index.html) for details Sleigh language 
specification syntax.
 
```

`extension.properties`:

```properties
name=@extname@
description=The extension description can be customized by editing the extension.properties file.
author=
createdOn=
version=@extversion@

```

`ghidra_scripts/README.txt`:

```txt
Java source directory to hold module-specific Ghidra scripts.

```

`lib/README.txt`:

```txt
The "lib" directory is intended to hold Jar files which this module is dependent upon.  Jar files 
may be placed in this directory manually, or automatically by maven via the dependencies block
of this module's build.gradle file.
```

`src/main/help/help/TOC_Source.xml`:

```xml
<?xml version='1.0' encoding='ISO-8859-1' ?>
<!-- 

	This is an XML file intended to be parsed by the Ghidra help system.  It is loosely based 
	upon the JavaHelp table of contents document format.  The Ghidra help system uses a 
	TOC_Source.xml file to allow a module with help to define how its contents appear in the 
	Ghidra help viewer's table of contents.  The main document (in the Base module) 
	defines a basic structure for the 
	Ghidra table of contents system.  Other TOC_Source.xml files may use this structure to insert
	their files directly into this structure (and optionally define a substructure).
	
	
	In this document, a tag can be either a <tocdef> or a <tocref>.  The former is a definition
	of an XML item that may have a link and may contain other <tocdef> and <tocref> children.  
	<tocdef> items may be referred to in other documents by using a <tocref> tag with the 
	appropriate id attribute value.  Using these two tags allows any module to define a place 
	in the table of contents system (<tocdef>), which also provides a place for 
	other TOC_Source.xml files to insert content (<tocref>).  
	
	During the help build time, all TOC_Source.xml files will be parsed and	validated to ensure
	that all <tocref> tags point to valid <tocdef> tags.  From these files will be generated
	<module name>_TOC.xml files, which are table of contents files written in the format 
	desired by the JavaHelp system.   Additionally, the genated files will be merged together
	as they are loaded by the JavaHelp system.  In the end, when displaying help in the Ghidra
	help GUI, there will be on table of contents that has been created from the definitions in 
	all of the modules' TOC_Source.xml files.

	
	Tags and Attributes
	
	<tocdef>
	-id          - the name of the definition (this must be unique across all TOC_Source.xml files)	
	-text        - the display text of the node, as seen in the help GUI
	-target**    - the file to display when the node is clicked in the GUI
	-sortgroup   - this is a string that defines where a given node should appear under a given
	               parent.  The string values will be sorted by the JavaHelp system using
	               a javax.text.RulesBasedCollator.  If this attribute is not specified, then
	               the text of attribute will be used.

	<tocref>
	-id			 - The id of the <tocdef> that this reference points to 
	
	**The URL for the target is relative and should start with 'help/topics'.  This text is 
	used by the Ghidra help system to provide a universal starting point for all links so that
	they can be resolved at runtime, across modules.
	
	
-->


<tocroot>
	<!-- Uncomment and adjust fields to add help topic to help system's Table of Contents
	<tocref id="Ghidra Functionality">
		<tocdef id="HelpAnchor" text="My Feature" target="help/topics/my_topic/help.html" />
	</tocref>
	-->
</tocroot>

```

`src/main/help/help/shared/Frontpage.css`:

```css
/* ###
 * IP: GHIDRA
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *      http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*
									WARNING!
    This file is copied to all help directories.  If you change this file, you must copy it 
    to each src/main/help/help/shared directory.									
									
	
	Java Help Note:  JavaHelp does not accept sizes (like in 'margin-top') in anything but 
	px (pixel) or with no type marking. 

*/ 

body { margin-bottom: 50px; margin-left: 10px; margin-right: 10px; margin-top: 10px; } /* some padding to improve readability */ 
li { font-family:times new roman; font-size:14pt; }
h1 { color:#000080; font-family:times new roman; font-size:36pt; font-style:italic; font-weight:bold; text-align:center; }
h2 { margin: 10px; margin-top: 20px; color:#984c4c; font-family:times new roman; font-size:18pt; font-weight:bold; }
h3 { margin-left: 10px; margin-top: 20px; color:#0000ff; font-family:times new roman; `font-size:14pt; font-weight:bold;  }
h4 { margin-left: 10px; margin-top: 20px; font-family:times new roman; font-size:14pt; font-style:italic; }
 
/*
	 P tag code.  Most of the help files nest P tags inside of blockquote tags (the was the 
	 way it had been done in the beginning).  The net effect is that the text is indented.  In 
	 modern HTML we would use CSS to do this.  We need to support the Ghidra P tags, nested in
	 blockquote tags, as well as naked P tags.  The following two lines accomplish this.  Note
	 that the 'blockquote p' definition will inherit from the first 'p' definition.
*/
p { margin-left: 40px; font-family:times new roman; font-size:14pt; }
blockquote p { margin-left: 10px; }

p.providedbyplugin { color:#7f7f7f; margin-left: 10px; font-size:14pt; margin-top:100px  }
p.ProvidedByPlugin { color:#7f7f7f; margin-left: 10px; font-size:14pt; margin-top:100px }
p.relatedtopic { color:#800080; margin-left: 10px; font-size:14pt; }
p.RelatedTopic { color:#800080; margin-left: 10px; font-size:14pt; }

/* 
	We wish for a tables to have space between it and the preceding element, so that text
	is not too close to the top of the table.  Also, nest the table a bit so that it is clear
	the table relates to the preceding text.
*/
table { margin-left: 20px; margin-top: 10px; width: 80%;}
td { font-family:times new roman; font-size:14pt; vertical-align: top; }
th { font-family:times new roman; font-size:14pt; font-weight:bold; background-color: #EDF3FE; }

/*
	Code-like formatting for things such as file system paths and proper names of classes, 
	methods, etc.  To apply this to a file path, use this syntax:
		<CODE CLASS="path">...</CODE>
*/
code { color: black; font-weight: bold; font-family: courier new, monospace; font-size: 14pt; white-space: nowrap; }
code.path { color: #4682B4; font-weight: bold; font-family: courier new, monospace; font-size: 14pt; white-space: nowrap; }

```

`src/main/help/help/topics/frida_hook_generator/help.html`:

```html
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>
  <HEAD>
    <META name="generator" content=
    "HTML Tidy for Java (vers. 2009-12-01), see jtidy.sourceforge.net">
    <META http-equiv="Content-Language" content="en-us">
    <META http-equiv="Content-Type" content="text/html; charset=windows-1252">
    <META name="GENERATOR" content="Microsoft FrontPage 4.0">
    <META name="ProgId" content="FrontPage.Editor.Document">

    <TITLE>Skeleton Help File for a Module</TITLE>
    <LINK rel="stylesheet" type="text/css" href="../../shared/Frontpage.css">
  </HEAD>

  <BODY>
    <H1><a name="HelpAnchor"></a>Skeleton Help File for a Module</H1>

    <P>This is a simple skeleton help topic. For a better description of what should and should not
    go in here, see the "sample" Ghidra extension in the Extensions/Ghidra directory, or see your 
    favorite help topic. In general, language modules do not have their own help topics.</P>
  </BODY>
</HTML>

```

`src/main/java/frida_hook_generator/frida_hook_generatorPlugin.java`:

```java
/* 
 * BSD 2-Clause License
 *
 * Copyright (c) 2022, CENSUS
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

package frida_hook_generator;


import ghidra.app.plugin.PluginCategoryNames;
import ghidra.app.plugin.ProgramPlugin;
import ghidra.app.services.ConsoleService;
import ghidra.framework.model.ToolServices;
import ghidra.framework.plugintool.*;
import ghidra.framework.plugintool.util.PluginStatus;
import ghidra.util.HelpLocation;
import ghidra.util.Msg;
import resources.Icons;

import java.awt.datatransfer.StringSelection;
import java.util.List;
import java.awt.Toolkit;
import java.awt.Window;
import java.awt.datatransfer.Clipboard;


import docking.action.MenuData;

import ghidra.app.context.ListingActionContext;
import ghidra.app.context.ListingContextAction;
import ghidra.framework.plugintool.PluginTool;
import ghidra.program.model.address.Address;
import ghidra.program.model.data.DataType;
import ghidra.program.model.lang.Language;
import ghidra.program.model.lang.Processor;
import ghidra.program.model.listing.Function;
import ghidra.program.model.listing.Instruction;
import ghidra.program.model.listing.Listing;
import ghidra.program.model.listing.Program;
import ghidra.program.model.symbol.Reference;
import ghidra.program.model.symbol.ReferenceIterator;
import ghidra.program.util.OperandFieldLocation;
import ghidra.program.util.ProgramLocation;


/**
 * TODO: Provide class-level documentation that describes what this plugin does.
 */
//@formatter:off
@PluginInfo(
	status = PluginStatus.STABLE,
	packageName = "Frida Hook Generator",
	category = PluginCategoryNames.MISC,
	shortDescription = "This plugin generates a frida hook for a specified address.",
	description = "This plugin generates a frida hook for a specified address in the binary, which can be run through frida, and report when the code reaches that point. When the address is the start of a function, the plugin generates a hook with Interceptor's onEnter()/onLeave() calls. When the code is not at the start of the function, the plugin generates hooks without these calls."
	//servicesRequired = { ConsoleService.class}
)
//@formatter:on
public class frida_hook_generatorPlugin extends ProgramPlugin {

	GenerateFridaHookScriptAction FridaHookScriptAction;
	GenerateFridaHookScriptAction FridaHookSnippetAction;

	/**
	 * Plugin constructor.
	 * 
	 * @param tool The plugin tool that this plugin is added to.
	 */
	public frida_hook_generatorPlugin(PluginTool tool) {
		super(tool, true, true);

		String pluginName = getName();
		Boolean isSnippet=false;
		//first, create the class for script
		FridaHookScriptAction = new GenerateFridaHookScriptAction(tool, pluginName,isSnippet);
		tool.addAction(FridaHookScriptAction);
		
		isSnippet=true;
		//second, create the class for snippet
		FridaHookSnippetAction = new GenerateFridaHookScriptAction(tool, pluginName,isSnippet);
		tool.addAction(FridaHookSnippetAction);

		// TODO: Customize help (or remove if help is not desired)
		String topicName = this.getClass().getPackage().getName();
		String anchorName = "HelpAnchor for FridaHookAction";
		FridaHookScriptAction.setHelpLocation(new HelpLocation(topicName, anchorName));
	}

	@Override
	public void init() {
		super.init();

		// TODO: Acquire services if necessary
	}
	
	
	
	public class GenerateFridaHookScriptAction extends ListingContextAction {

		private  PluginTool incoming_plugintool;
		private  Boolean isSnippet;
		private  ConsoleService consoleService;
		
		private  Program current_program; 
		private  String current_program_name;
		private  String current_program_name_sanitized;
		private  Listing current_program_listing;
		private  Language current_program_language;
		private  Address image_base;
		private  Processor current_program_processor;
		private  String characters_allowed_in_variable_name="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_";

		public GenerateFridaHookScriptAction(PluginTool tool, String owner, Boolean isSnippet) {
			super("Copy Frida Hook Script or Snippet", owner);
			this.incoming_plugintool = tool;
			this.isSnippet = isSnippet;
			if (isSnippet) {
				setPopupMenuData(new MenuData(new String[] { "Copy Frida Hook Snippet" },null,"Frida-Hook"));
			}
			else
			{
				setPopupMenuData(new MenuData(new String[] { "Copy Frida Hook Script" },null,"Frida-Hook"));
				//setKeyBindingData(new KeyBindingData(KeyEvent.VK_H, 0));
			}

		}

		@Override
		protected boolean isEnabledForContext(ListingActionContext context) {
			return context.getAddress() != null;
		}

		@Override
		protected void actionPerformed(ListingActionContext context) {
			System.out.println("Called Action Performed");
			
			Address addr = context.getAddress();
			ProgramLocation location = context.getLocation();
			if (location instanceof OperandFieldLocation) {
				Address a = ((OperandFieldLocation) location).getRefAddress();
				if (a != null) {
					addr = a;
				}
			}
			System.out.println("Address:"+addr);
			System.out.println("Location:"+location);
			System.out.println("Program:"+context.getProgram());
			
			//System.out.println("Code unit:"+context.getCodeUnit());
			//System.out.println("Global Context:"+context.getGlobalContext());
			//System.out.println("Source component:"+context.getSourceComponent());
			
			//Initialize the console
			this.consoleService=this.incoming_plugintool.getService(ConsoleService.class); //Note: If this line is called when initializing the tool (in the constructor), then the consoleService will be null

			
			this.current_program = context.getProgram();
			this.current_program_name = this.current_program.getName();
			Function current_function = this.current_program.getFunctionManager().getFunctionContaining(addr);
			this.current_program_listing = this.current_program.getListing();
			this.current_program_name_sanitized = this.current_program_name.replaceAll("[^"+this.characters_allowed_in_variable_name+"]", "_");
			this.image_base = this.current_program.getImageBase();
			this.current_program_language = this.current_program.getLanguage();
			this.current_program_processor = this.current_program_language.getProcessor();

			
			if (current_function != null)
			{
				Address current_function_entry_point=current_function.getEntryPoint();

				String hook_str="";
				
				Boolean we_are_at_start_of_function=current_function_entry_point.equals(addr);
				
				//Create the prologue
				if (!this.isSnippet)
				{
					hook_str+="var module_name_"+this.current_program_name_sanitized+"='"+this.current_program_name+"';\n";
					hook_str+="\n";
					hook_str+="function start_timer_for_intercept() {\n"
							+ "  setTimeout(\n"
							+ "    function() {\n"
							+ "      console.log(\"Registering interceptors...\")\n";
					hook_str+="      \n";
					hook_str+="      \n";
				}
			
				
				hook_str=hook_str.concat(generate_snippet_hook_for_address(context,addr,true));
				

				//now the epilogue
				if (!this.isSnippet)
				{
					hook_str+="      \n";
					hook_str+="      console.log(\"Registered interceptors\")\n"
							+ "    }, 2000);//milliseconds\n"
							+ "}\n"
							+ "start_timer_for_intercept();\n";
				}
				System.out.println(hook_str);
				
				//Copy to clipboard
				StringSelection stringSelection = new StringSelection(hook_str);
				Clipboard clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
				clipboard.setContents(stringSelection, null);
								
				
				//Print to Console	
				if (this.consoleService!=null)
				{
					this.consoleService.print(hook_str);
				}
				else
				{
					System.out.println("Can't print to console because consoleService is null");
				}
				
				
			}
			else
			{
				System.out.println("No hook generated, current function==NULL");
				Msg.showInfo(getClass(), context.getComponentProvider().getComponent(), "Hook generation error", "No hook generated, current function is NULL.");
			}
			
		}
		
		
		
		
		

		protected String generate_snippet_hook_for_address(ListingActionContext context, Address addr, Boolean print_debug) {
			
			//Try to recalculate the parameters
			Function current_function = this.current_program.getFunctionManager().getFunctionContaining(addr);
			
			if (current_function==null)
			{
				return ("//Address:"+addr+", not in a function\n");
			}

			Address current_function_entry_point=current_function.getEntryPoint();

			
			if (print_debug)
			{
				System.out.println("Address:"+addr);
				System.out.println("Program name:"+this.current_program_name);
				System.out.println("Program base:"+this.image_base);
				System.out.println("Program language:"+this.current_program_language);
				System.out.println("Program processor:"+this.current_program_processor);
				System.out.println("Current function:"+current_function);
				System.out.println("Current function entry point:"+current_function_entry_point);
			}

			
			String hook_str="";
			
			Boolean we_are_at_start_of_function=current_function_entry_point.equals(addr);
			
			/*for when we are at the start of a function*/
			String current_function_name_sanitized="";
			String function_name_with_current_addr="";
				
			if (we_are_at_start_of_function)
			{
				//We are at the start of the function	
				
				current_function_name_sanitized=current_function.getName().replaceAll("[^"+this.characters_allowed_in_variable_name+"]", "_");
				function_name_with_current_addr=current_function_name_sanitized+"_"+addr;
				int parameter_count=current_function.getParameterCount(); //May not always work, decompiler must commit the params first
				DataType current_function_returntype=current_function.getReturnType();
				String current_function_callingconventionname=current_function.getCallingConventionName();
				
				if (print_debug)
				{
					System.out.println("Current function name sanitized:"+current_function_name_sanitized);
					System.out.println("function_name_with_current_addr:"+function_name_with_current_addr);
					System.out.println("Current function parameter count:"+parameter_count); 
					System.out.println("Current function return type:"+current_function_returntype); 
					System.out.println("Current function calling convention name:"+current_function_callingconventionname);
				}

				//String.concat() is the fastest, but "+" is also used for code clarity. During multiple hook generations in a loop, these concatenations take the most time.
				hook_str=hook_str.concat("      var offset_of_"+function_name_with_current_addr+"=0x"+Long.toHexString(addr.getOffset()-this.image_base.getOffset())+";\n")
								 .concat("      var dynamic_address_of_"+function_name_with_current_addr+"=Module.findBaseAddress(module_name_"+this.current_program_name_sanitized+").add(offset_of_"+function_name_with_current_addr+");\n")
				
								 .concat("      Interceptor.attach(dynamic_address_of_"+function_name_with_current_addr+", {\n")
								 .concat("                 onEnter: function(args) {\n")
								 .concat("                    console.log(\"Entered "+function_name_with_current_addr+"\");\n");
				
				if (parameter_count>=1) {
							   hook_str+="                    console.log('";
							   for (int i=0;i<parameter_count;i++)
							   {
								   hook_str+="args["+i+"]='+args["+i+"]";
								   if (i<parameter_count-1) { hook_str+="+' , "; }
								   else { hook_str+=");\n"; }
							   }
				}
				hook_str=hook_str.concat("                    // this.context.x0=0x1;\n")
								 .concat("                  },\n")
								 .concat("                  onLeave: function(retval) {\n")
								 .concat("                    console.log(\"Exited "+function_name_with_current_addr+", retval:\"+retval);\n")
								 .concat("                    // retval.replace(0x1);\n")
								 .concat("                  }\n")
								 .concat("       });\n\n");
							
			}
			else
			{
				//String.concat() is the fastest, but "+" is also used for code clarity. During multiple hook generations in a loop, these concatenations take the most time.
				hook_str=hook_str.concat("      var offset_of_"+addr+"=0x"+Long.toHexString(addr.getOffset()-this.image_base.getOffset())+";\n")
								 .concat("      var dynamic_address_of_"+addr+"=Module.findBaseAddress(module_name_"+this.current_program_name_sanitized+").add(offset_of_"+addr+");\n")
				
								 .concat("      function function_to_call_when_code_reaches_"+addr+"(){\n")
								 .concat("         console.log('Reached address 0x"+addr+"');\n")
								 .concat("         //this.context.x0=0x1;\n")
								 .concat("      }\n")

								 .concat("      Interceptor.attach(dynamic_address_of_"+addr+", function_to_call_when_code_reaches_"+addr+");\n\n");

			}
				

			return hook_str;
			
			
			
		}
		

	}
	
		
}



```

`src/main/resources/images/README.txt`:

```txt
The "src/resources/images" directory is intended to hold all image/icon files used by
this module.

```

`src/test/java/README.test.txt`:

```txt
The "test" directory is intended to hold unit test cases.  The package structure within
this folder should correspond to that found in the "src" folder.

```