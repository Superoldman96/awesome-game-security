Project Path: arc_gmh5225_windows-forensic-artifacts_rbr0kgoq

Source Tree:

```txt
arc_gmh5225_windows-forensic-artifacts_rbr0kgoq
├── LICENSE
├── README.md
├── account
│   ├── evtx-4624-successful-logon.md
│   ├── evtx-4625-failed-logon.md
│   ├── evtx-4648-explicit-credentials.md
│   ├── evtx-4720-account-created.md
│   ├── group-membership-key.md
│   ├── profile-list-key.md
│   └── sam-hive.md
├── browser
│   └── firefox-places-sqlite.md
├── enumeration
│   ├── computer-name.md
│   ├── current-version.md
│   ├── interfaces.md
│   ├── network-cards.md
│   ├── select.md
│   └── time-zone-information.md
├── execution
│   ├── amcache.md
│   ├── bam-dam.md
│   ├── evtx-4104-script-block-logging.md
│   ├── evtx-4688-process-created.md
│   ├── evtx-9707-shell-core.md
│   ├── prefetch.md
│   ├── program-compatibility-assistant.md
│   ├── shimcache.md
│   ├── srum-db.md
│   └── wer-files.md
├── file-activity
│   ├── automatic-destinations.md
│   ├── detectionhistory.md
│   ├── mft.md
│   ├── recycle-bin-files.md
│   ├── usn-journal.md
│   └── zone-identifier.md
├── media
│   ├── examples
│   │   ├── bam.png
│   │   ├── evtx-1024-example.png
│   │   ├── ifeo.png
│   │   ├── srum_dump_output.png
│   │   └── wmi.png
│   └── title-2.png
├── network
│   ├── evtx-1024-rdp-activex.md
│   ├── evtx-2004-firewall.md
│   ├── evtx-2005-firewall.md
│   ├── evtx-2006-firewall.md
│   ├── evtx-2052-firewall-windows-11.md
│   ├── evtx-2071-firewall-windows-11.md
│   ├── evtx-2073-firewall-windows-11.md
│   ├── evtx-4778-session-reconnected.md
│   ├── evtx-5156-wfp-permitted.md
│   ├── evtx-8001-wlan-connect.md
│   ├── evtx-8003-wlan-disconnect.md
│   ├── rdp-bitmap-cache.md
│   ├── terminal-server-client-keys.md
│   ├── terminal-services-local-21.md
│   ├── terminal-services-local-24.md
│   ├── terminal-services-remote-1149.md
│   └── tracing-keys.md
├── persistence
│   ├── evtx-5861-event-consumer-created.md
│   ├── evtx-7045-service-install.md
│   ├── image-file-execution-options.md
│   ├── reg-run-runonce.md
│   ├── registry-services.md
│   ├── task-scheduler-files.md
│   └── task-scheduler-operational-log.md
└── user-activity
    └── wordwheelquery.md

```

`LICENSE`:

```
MIT License

Copyright (c) 2022 Psmth

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

```

`README.md`:

```md
<a name="readme-top"></a>
![Windows Forensic Artifacts Guide](/media/title-2.png)
<p align="center">
  <img src="https://img.shields.io/github/license/Psmths/windows-forensic-artifacts.svg">
  <img src="https://www.repostatus.org/badges/latest/wip.svg">
  <img src="https://img.shields.io/badge/Forensic%20Artifacts-57-brightgreen">
</p>

This repository provides an in-depth guide to the various Windows forensic artifacts that can be utilized when conducting an investigation. Detailed information is provided for each artifact, including its location, available parsing tools, and instructions for interpreting the results of a forensic data extraction. Furthermore, the repository seeks to provide a comprehensive resource for those seeking to expand their understanding of Windows forensics artifacts and how to properly leverage them during a forensic investigation.

# Contents
 - [Types of Windows Artifacts](#types-of-windows-artifacts)
 - [How to Use this Guide](#how-to-use-this-guide)
 - [Artifacts by Category](#artifacts-by-category)
   * [Execution](#execution)
     - [Command Line Options](#execution---command-line-options)
     - [First Executed](#execution---first-executed)
     - [Last Executed](#execution---last-executed)
     - [Permissions/Account](#execution---permissions--account)
     - [Process Geneaology/Tree](#execution---process-tree)
     - [Execution Time](#execution---time)
     - [Evidence of Execution](#execution---evidence-of-execution)
   * [Account Activity](#account-activity)
     - [Account Creation Time](#account---creation-time)
     - [Group Membership](#account---group-membership)
     - [Last Login](#account---last-login)
     - [Login History](#account---login-history)
     - [Logon ID](#account---logon-id)
     - [Relative Identifier (RID)](#account---relative-identifier-rid)
     - [Security Identifier (SID)](#account---security-identifier-sid)
     - [Username](#account---username)
   * [File Activity](#file-activity)
     - [Creation](#file---creation)
     - [Deletion](#file---deletion)
     - [Hash](#file---hash)
     - [Last Modified](#file---last-modified)
     - [Origin](#file---origin)
     - [Path](#file---path)
     - [Size](#file---size)
   * [Network Activity](#network-activity)
     - [Evidence of Network Activity](#network-activity---evidence-of-network-activity)
     - [Destination Identification](#network-activity---destination-identification)
     - [Source Identification](#network-activity---source-identification)
     - [Transmit Volume](#network-activity---transmit-volume)
     - [Browser Activity](#network-activity---browser-activity)
     - [Firewall Activity](#network-activity---firewall-activity)
     - [Wireless Activity](#network-activity---wireless-activity)
   * [Browser Activity](#browser-activity)
     - [History](#browser-activity---history)
     - [Bookmarks](#browser-activity---bookmarks)
   * [User Activity](#user-activity)
 - [System Enumeration Artifacts](#enumeration-artifacts)
 - [Artifact Behavioral Mappings](#artifact-behavioral-mappings) 
   * [TA0002 - Execution](#ta0002-execution)
   * [TA0003 - Persistence](#ta0003-persistence)
   * [TA0008 - Lateral Movement](#ta0008-lateral-movement)

<p align="right">(<a href="#readme-top">back to top</a>)</p>

# Types of Windows Artifacts
Forensic artifacts on the Windows operatying system can generally be split into four main categories:

 1. Registry 
 2. Filesystem
 3. Event Log
 4. Memory

**Registry** artifacts are found in the Windows registry, which is loaded into memory while a system is in operation and written to disk during shutdown. The registry stores low-level configuration settings for the operating system and contains a wealth of forensic artifacts of interest to an analyst.

**Filesystem** artifacts are artifacts that arise due to the operation of Windows' filesystem - NTFS (New Technology File System).

**Event log** artifacts are found in the Windows event log and consist primarily of audit logs from the operating system and its applications. 

**Memory** artifacts are those artifacts found in the endpoint's memory while it is operational. These artifacts must be collected from a live system, and are generally not applicable to dead disk forensics with certain exceptions such as page files and hibernation files that consist of memory that has been written to the disk. 

A complete forensic analysis of a Windows endpoint will consist of one or all of these artifacts. They may be collected and parsed individually at the analyst's discretion, or consolidated into "super timelines" with forensic software such as [log2timeline](https://github.com/log2timeline).

<p align="right">(<a href="#readme-top">back to top</a>)</p>

# How to Use this Guide

This guide was created to classify the numerous Windows forensic artifacts and provide a concise list of what information they respectively provide. While it may be used as a general reference, it shines when it comes time to tie separate artifacts together based on mutual/shared datapoints.

For instance, if it is known that an attacker has logged into an endpoint around a certain time, an analyst may want to determine what activity on the endpoint can be attributed to this session. For this, the analyst might begin by looking at 4624 Login events and pull the `Logon ID` from this artifact. This guide provides a list of every artifact that has the `Logon ID` field present, providing a quick way to correlate logon activity with other activity on the endpoint filed under the section [Logon ID](#account---logon-id).

As another example, say for instance you are aware that an endpoint may have a malicious file on it. Maybe you want to see [when the file was created](#file---creation), or [when it was first executed](#execution---first-executed). What about determining [what Logon ID is associated with the execution with 4688 events?](#account---logon-id)

Building a visual map in your mind of the relationships between all the artifacts present in Windows is necessary to allow for an analyst to efficiently pivot their focus during an investigation, this guide simply lays it all out and provides useful analysis tips collected during years of forensic experience while doing so.

<p align="right">(<a href="#readme-top">back to top</a>)</p>

# Artifacts by Category

The forensic artifacts described in this repository are split into the following categories:

 - [Execution](#execution)
 - [Account Activity](#account-activity)
 - [File Activity](#file-activity)
 - [Network Activity](#network-activity)

## Execution
Execution artifacts may provide the following information:

### Execution - Command Line Options
>What command line was used to spawn this process?

 - [Security/4688: A new process has been created](execution/evtx-4688-process-created.md)
 - [Scheduled Task Files](persistence/task-scheduler-files.md)
 - [TaskScheduler/Operational Log](persistence/task-scheduler-operational-log.md)
 - [Detection History Files](file-activity/detectionhistory.md)
 - [Microsoft-Windows-Shell-Core/Operational/9707: Command Execution Started](execution/evtx-9707-shell-core.md)

### Execution - First Executed
>When was this executable furst run?
 - [Prefetch](execution/prefetch.md)
 - [AmCache.hve](execution/amcache.md)
 - [Scheduled Task Files](persistence/task-scheduler-files.md)
 - [TaskScheduler/Operational Log](persistence/task-scheduler-operational-log.md)
 - [Microsoft-Windows-PowerShell/Operational/4104: PowerShell Script Block Logging](execution/evtx-4104-script-block-logging.md)
 - [AutomaticDestinations Jumplists](file-activity/automatic-destinations.md)

### Execution - Last Executed
>When was the last time this executable was run?
 - [Prefetch](execution/prefetch.md)
 - [Scheduled Task Files](persistence/task-scheduler-files.md)
 - [TaskScheduler/Operational Log](persistence/task-scheduler-operational-log.md)
 - [Background Activity Montitor](execution/bam-dam.md)
 - [Program Compatibility Assistant (PCA) - PcaAppLaunchDic.txt](execution/program-compatibility-assistant.md)
 - [AutomaticDestinations Jumplists](file-activity/automatic-destinations.md)

### Execution - Permissions / Account
>What permissions does the process have?
>What account launced the process?
 - [Security/4688: A new process has been created](execution/evtx-4688-process-created.md)
 - [Scheduled Task Files](persistence/task-scheduler-files.md)
 - [Background Activity Montitor](execution/bam-dam.md)
 - [SRUM Database](execution/srum-db.md)
 - [Microsoft-Windows-Shell-Core/Operational/9707: Command Execution Started](execution/evtx-9707-shell-core.md)
 - [AutomaticDestinations Jumplists](file-activity/automatic-destinations.md)

### Execution - Process Tree
>How did this process come to be? What spawned this process? Is the ProcessID available?
 - [Security/4688: A new process has been created](execution/evtx-4688-process-created.md)
 - [Microsoft-Windows-PowerShell/Operational/4104: PowerShell Script Block Logging](execution/evtx-4104-script-block-logging.md)
 - [TerminalServices-RDPClient/Operational/1024: RDP ClientActiveX is trying to connect to the server](network/evtx-1024-rdp-activex.md)
 - [Microsoft-Windows-Shell-Core/Operational/9707: Command Execution Started](execution/evtx-9707-shell-core.md)

### Execution - Time
>When was this process spawned?
 - [Security/4688: A new process has been created](execution/evtx-4688-process-created.md)
 - [Scheduled Task Files](persistence/task-scheduler-files.md)
 - [TaskScheduler/Operational Log](persistence/task-scheduler-operational-log.md)
 - [Microsoft-Windows-Shell-Core/Operational/9707: Command Execution Started](execution/evtx-9707-shell-core.md)

### Execution - Evidence of Execution
>Was a process spawned?
 - [AmCache.hve](execution/amcache.md)
 - [Background Activity Montitor](execution/bam-dam.md)
 - [Security/4688: A new process has been created](execution/evtx-4688-process-created.md)
 - [Prefetch](execution/prefetch.md)
 - [ShimCache](execution/shimcache.md)
 - [SRUM Database](execution/srum-db.md)
 - [Detection History Files](file-activity/detectionhistory.md)
 - [Scheduled Task Files](persistence/task-scheduler-files.md)
 - [TaskScheduler/Operational Log](persistence/task-scheduler-operational-log.md)
 - [Program Compatibility Assistant (PCA) - PcaAppLaunchDic.txt](execution/program-compatibility-assistant.md)
 - [Tracing Registry Keys](network/tracing-keys.md)
 - [Microsoft-Windows-Shell-Core/Operational/9707: Command Execution Started](execution/evtx-9707-shell-core.md)
 - [Security/5156: The Windows Filtering Platform has permitted a connection](network/evtx-5156-wfp-permitted.md)
 - [AutomaticDestinations Jumplists](file-activity/automatic-destinations.md)
 - [Windows Error Reporting Files (.WER)](execution/wer-files.md)

<p align="right">(<a href="#readme-top">back to top</a>)</p>

## Account Activity
Account activity artifacts may provide the following information:
### Account - Creation Time
> When was this account created?
 - [SAM Hive](account/sam-hive.md)
 - [Security/4720: A user account was created](account/evtx-4720-account-created.md)

### Account - Group Membership
> What groups is the account a member of?
 - [SAM Hive](account/sam-hive.md)
 - [Group Membership Registry Key](account/group-membership-key.md)

### Account - Last Login
> When did this account last log in?
 - [SAM Hive](account/sam-hive.md)

### Account - Login History
> Identification of specific instances of account logins
 - [Security/4778: Session reconnected](network/evtx-4778-session-reconnected.md)
 - [Security/4648: Logon using explicit credentials](account/evtx-4648-explicit-credentials.md)
 - [Security/4624: An account was successfully logged on](account/evtx-4624-successful-logon.md)
 - [Security/4625: An account failed to log on](account/evtx-4625-failed-logon.md)

### Account - Logon ID
> Certain activity can be tied to login sessions by means of a `Logon ID`
 - [Security/4688: A new process has been created](execution/evtx-4688-process-created.md)
 - [Security/4720: A user account was created](account/evtx-4720-account-created.md)
 - [Security/4778: Session reconnected](network/evtx-4778-session-reconnected.md)
 - [Security/4648: Logon using explicit credentials](account/evtx-4648-explicit-credentials.md)
 - [Security/4624: An account was successfully logged on](account/evtx-4624-successful-logon.md)

### Account - Relative Identifier (RID)
> What is the account's [Relative Identifier](https://en.wikipedia.org/wiki/Relative_identifier)?
 - [SAM Hive](account/sam-hive.md)

### Account - Security Identifier (SID)
> What is the account's [Security Identifier](https://en.wikipedia.org/wiki/Security_Identifier)?
 - [SAM Hive](account/sam-hive.md)
 - [Security/4720: A user account was created](account/evtx-4720-account-created.md)
 - [Security/4778: Session reconnected](network/evtx-4778-session-reconnected.md)
 - [TerminalServices-RDPClient/Operational/1024: RDP ClientActiveX is trying to connect to the server](network/evtx-1024-rdp-activex.md)
 - [Security/4648: Logon using explicit credentials](account/evtx-4648-explicit-credentials.md)
 - [Security/4624: An account was successfully logged on](account/evtx-4624-successful-logon.md)
 - [Security/4625: An account failed to log on](account/evtx-4625-failed-logon.md)
 - [WMI-Activity/Operational/5861: New WMI Event Consumer](persistence/evtx-5861-event-consumer-created.md)
 - [SRUM Database](execution/srum-db.md)
 - [ProfileList](account/profile-list-key.md)
 - [Microsoft-Windows-PowerShell/Operational/4104: PowerShell Script Block Logging](execution/evtx-4104-script-block-logging.md)
 - [Recycle Bin $I/$R Files](file-activity/recycle-bin-files.md)
 - [Background Activity Montitor](execution/bam-dam.md)
 - [Microsoft-Windows-Shell-Core/Operational/9707: Command Execution Started](execution/evtx-9707-shell-core.md)
 - [Security/7045: Service Installed](persistence/evtx-7045-service-install.md)

### Account - Username
> Determining the username attached to a particular SID, or artifacts where you would expect to find a username
 - [ProfileList](account/profile-list-key.md)
 - [AutomaticDestinations Jumplists](file-activity/automatic-destinations.md)
 - [Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational/1149](network/terminal-services-remote-1149.md)
 - [Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/21: Session logon succeeded](network/terminal-services-local-21.md)
 - [Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/24: Session has been disconnected](network/terminal-services-local-24.md)

<p align="right">(<a href="#readme-top">back to top</a>)</p>

## File Activity
File activity artifacts may provide the following information:

### File - Creation
> When was the file created?
 - [Zone.Identifier](file-activity/zone-identifier.md)
 - [USN Journal](file-activity/usn-journal.md)

### File - Deletion
> When was the file deleted?
 - [USN Journal](file-activity/usn-journal.md)
 - [Recycle Bin $I/$R Files](file-activity/recycle-bin-files.md)

### File - Hash
> What is the hash of this file?
 - [AmCache.hve](execution/amcache.md)
 - [Detection History Files](file-activity/detectionhistory.md)

### File - Last Modified
> When was the file last modified?
 - [ShimCache](execution/shimcache.md)
 - [USN Journal](file-activity/usn-journal.md)

### File - Origin
> Where did the file come from?
 - [Zone.Identifier](file-activity/zone-identifier.md)

### File - Path
> Where is the file located?
 - [ShimCache](execution/shimcache.md)
 - [AmCache.hve](execution/amcache.md)
 - [Run/RunOnce Keys](persistence/reg-run-runonce.md)
 - [USN Journal](file-activity/usn-journal.md)
 - [Scheduled Task Files](persistence/task-scheduler-files.md)
 - [TaskScheduler/Operational Log](persistence/task-scheduler-operational-log.md)
 - [Background Activity Montitor](execution/bam-dam.md)
 - [SRUM Database](execution/srum-db.md)
 - [Detection History Files](file-activity/detectionhistory.md)
 - [Image File Execution Options](persistence/image-file-execution-options.md)
 - [Program Compatibility Assistant (PCA) - PcaAppLaunchDic.txt](execution/program-compatibility-assistant.md)
 - [Microsoft-Windows-PowerShell/Operational/4104: PowerShell Script Block Logging](execution/evtx-4104-script-block-logging.md)
 - [Recycle Bin $I/$R Files](file-activity/recycle-bin-files.md)
 - [Services Registry Keys](persistence/registry-services.md)
 - [Security/7045: Service Installed](persistence/evtx-7045-service-install.md)
 - [Security/5156: The Windows Filtering Platform has permitted a connection](network/evtx-5156-wfp-permitted.md)
 - [AutomaticDestinations Jumplists](file-activity/automatic-destinations.md)
 - [Windows Error Reporting Files (.WER)](execution/wer-files.md)

### File - Size
> What is the file's size on disk?
 - [ShimCache](execution/shimcache.md)
 - [USN Journal](file-activity/usn-journal.md)
 - [Recycle Bin $I/$R Files](file-activity/recycle-bin-files.md)


<p align="right">(<a href="#readme-top">back to top</a>)</p>

## Network Activity
Network activity artifacts may provide the following information:

### Network Activity - Evidence of Network Activity
> Is there evidence of network activity?
 - [TerminalServices-RDPClient/Operational/1024: RDP ClientActiveX is trying to connect to the server](network/evtx-1024-rdp-activex.md)
 - [Tracing Registry Keys](network/tracing-keys.md)
 - [Microsoft-Windows-WLAN-AutoConfig/Operational/8001: Successfully Connected to a Wireless Network](network/evtx-8001-wlan-connect.md)
 - [Microsoft-Windows-WLAN-AutoConfig/Operational/8003: Successfully Disconnected from a Wireless Network](network/evtx-8003-wlan-disconnect.md)
 - [Security/5156: The Windows Filtering Platform has permitted a connection](network/evtx-5156-wfp-permitted.md)
 - [Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational/1149](network/terminal-services-remote-1149.md)
 - [Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/21: Session logon succeeded](network/terminal-services-local-21.md)
 - [Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/24: Session has been disconnected](network/terminal-services-local-24.md)
 - [RDP Persistent Bitmap Cache](network/rdp-bitmap-cache.md)
 - [Terminal Server Client Registry Keys](network/terminal-server-client-keys.md)

### Network Activity - Destination Identification
> Can the destination for this activity be identified?
 - [TerminalServices-RDPClient/Operational/1024: RDP ClientActiveX is trying to connect to the server](network/evtx-1024-rdp-activex.md)
 - [Security/4648: Logon using explicit credentials](account/evtx-4648-explicit-credentials.md)
 - [Security/5156: The Windows Filtering Platform has permitted a connection](network/evtx-5156-wfp-permitted.md)

### Network Activity - Source Identification
> Can the source of this activity be identified?
 - [TaskScheduler/Operational Log](persistence/task-scheduler-operational-log.md)
 - [Scheduled Task Files](persistence/task-scheduler-files.md)
 - [Security/4778: Session reconnected](network/evtx-4778-session-reconnected.md)
 - [Security/4624: An account was successfully logged on](account/evtx-4624-successful-logon.md)
 - [Security/4625: An account failed to log on](account/evtx-4625-failed-logon.md)
 - [Security/5156: The Windows Filtering Platform has permitted a connection](network/evtx-5156-wfp-permitted.md)
 - [Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational/1149](network/terminal-services-remote-1149.md)
 - [Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/21: Session logon succeeded](network/terminal-services-local-21.md)
 - [Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/24: Session has been disconnected](network/terminal-services-local-24.md)

### Network Activity - Transmit Volume
> Can the amount of data sent or received be determined?
 - [SRUM Database](execution/srum-db.md)

### Network Activity - Browser Activity
> Artifacts supporting general forensic analysis for browser activity on an endpoint
 - [places.sqlite](browser/firefox-places-sqlite.md)

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### Network Activity - Firewall Activity
> Artifacts supporting general forensic analysis of events pertaining to the Windows Firewall
 - [Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2004: Firewall Rule Added](network/evtx-2004-firewall.md)
 - [Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2071: Firewall Rule Added](network/evtx-2071-firewall-windows-11.md)
 - [Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2005: Firewall Rule Modified](network/evtx-2005-firewall.md)
 - [Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2073: Firewall Rule Modified](network/evtx-2073-firewall-windows-11.md)
 - [Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2006: Firewall Rule Deleted](network/evtx-2006-firewall.md)
 - [Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2052: Firewall Rule Deleted](network/evtx-2052-firewall-windows-11.md)
 - [Security/5156: The Windows Filtering Platform has permitted a connection](network/evtx-5156-wfp-permitted.md)

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### Network Activity - Wireless Activity
> Artifacts providing evidence of wireless network activity
 - [Microsoft-Windows-WLAN-AutoConfig/Operational/8001: Successfully Connected to a Wireless Network](network/evtx-8001-wlan-connect.md)
 - [Microsoft-Windows-WLAN-AutoConfig/Operational/8003: Successfully Disconnected from a Wireless Network](network/evtx-8003-wlan-disconnect.md)

<p align="right">(<a href="#readme-top">back to top</a>)</p>

## Browser Activity
Network activity artifacts may provide the following information:

### Browser Activity - History
 - [Firefox places.sqlite Database](browser/firefox-places-sqlite.md)

### Browser Activity - Bookmarks
 - [Firefox places.sqlite Database](browser/firefox-places-sqlite.md)
 
<p align="right">(<a href="#readme-top">back to top</a>)</p>

# User Activity
> These miscellaneous artifacts may provide an analyst information regarding certain actions that a user took on a system.
 - [WordWheelQuery](/user-activity/wordwheelquery.md)

<p align="right">(<a href="#readme-top">back to top</a>)</p>

# Enumeration Artifacts
> These artifacts may be leveraged by an analyst to enumerate information from an endpoint that may prove useful during an investigation. While some of these artifacts may not necessarily be looked at for evidence of activity, they may be analyzed to obtain information important to an investigation. 

| Arifact | Information | 
| - | - | 
| [Select](enumeration/select.md) | <ul><li>CurrentControlSet</li></ul> |
| [CurrentVersion](enumeration/current-version.md) | <ul><li>OS Version</li><li>Installation Timestamp</li></ul> |
| [TimeZoneInformation](enumeration/time-zone-information.md) | <ul><li>System Time Zone</li></ul> |
| [ComputerName](enumeration/computer-name.md) | <ul><li>System Name</li></ul> |
| [Interfaces](enumeration/interfaces.md) | <ul><li>IP configuration</li></ul> |
| [Network Cards](enumeration/network-cards.md) | <ul><li>Network Adapter Enumeration</li></ul> |
| [Group Membership Registry Key](account/group-membership-key.md) | <ul><li>Local account group membership enumeration</li></ul> |

<p align="right">(<a href="#readme-top">back to top</a>)</p>

# Artifact Behavioral Mappings

Additionally, these artifacts may be roughly mapped to the MITRE ATT&CK framework to perform analysis on a behavioral basis:

 - [TA0002 - Execution](#ta0002-execution)
 - [TA0003 - Persistence](#ta0003-persistence)
 - [TA0008 - Lateral Movement](#ta0008-lateral-movement)

## TA0002 Execution
The below artifacts are related to [execution](https://attack.mitre.org/tactics/TA0002/). Execution is defined by MITRE as:

> ...techniques that result in adversary-controlled code running on a local or remote system. 

The below artifacts may prove useful in identifying instances of execution on an endpoint:

| Arifact Type | Artifact |
| - | - |
| Filesystem | [Prefetch](execution/prefetch.md) |
| Eventlog | [Security/4688: A new process has been created](execution/evtx-4688-process-created.md) |
| Registry/Memory | [ShimCache](execution/shimcache.md) |
| Registry | [AmCache.hve](execution/amcache.md) |
| Filesystem | [Scheduled Task Files](persistence/task-scheduler-files.md) |
| Eventlog | [TaskScheduler/Operational Log](persistence/task-scheduler-operational-log.md) |
| Registry/Filesystem | [SRUM Database](execution/srum-db.md) |
| Filesystem | [Program Compatibility Assistant (PCA) - PcaAppLaunchDic.txt](execution/program-compatibility-assistant.md) |
| Registry | [Background Activity Montitor](execution/bam-dam.md) |
| Filesystem | [Detection History Files](file-activity/detectionhistory.md) |
| Filesystem | [Program Compatibility Assistant (PCA) - PcaAppLaunchDic.txt](execution/program-compatibility-assistant.md) |
| Registry | [Tracing Registry Keys](network/tracing-keys.md) |
| Eventlog | [Microsoft-Windows-Shell-Core/Operational/9707: Command Execution Started](execution/evtx-9707-shell-core.md) |
| Filesystem | [AutomaticDestinations Jumplists](file-activity/automatic-destinations.md) |
| Filesystem | [Windows Error Reporting Files (.WER)](execution/wer-files.md) |


## TA0003 Persistence
The below artifacts are related to [persistence activities](https://attack.mitre.org/tactics/TA0003/). Persistence is defined by MITRE as:

> Persistence consists of techniques that adversaries use to keep access to systems across restarts, changed credentials, and other interruptions that could cut off their access. 

The below artifacts may prove useful in identifying instances of persistence on an endpoint:

| Arifact Type | Artifact |
| - | - |
| Registry | [Run/RunOnce Keys](persistence/reg-run-runonce.md) |
| Eventlog | [TaskScheduler/Operational Log](persistence/task-scheduler-operational-log.md) |
| Filesystem | [Scheduled Task Files](persistence/task-scheduler-files.md) |
| Eventlog | [Security/4720: A user account was created](account/evtx-4720-account-created.md) |
| Eventlog | [WMI-Activity/Operational/5861: New WMI Event Consumer](persistence/evtx-5861-event-consumer-created.md) |
| Registry | [Image File Execution Options](persistence/image-file-execution-options.md) |
| Eventlog | [Microsoft-Windows-Shell-Core/Operational/9707: Command Execution Started](execution/evtx-9707-shell-core.md) |
| Registry | [Services Registry Keys](persistence/registry-services.md) |
| Eventlog | [Security/7045: Service Installed](persistence/evtx-7045-service-install.md) |
| Registry | [Image File Execution Options](persistence/image-file-execution-options.md) |
| Eventlog | [Microsoft-Windows-Shell-Core/Operational/9707: Command Execution Started](execution/evtx-9707-shell-core.md) |

## TA0008 Lateral Movement
The below artifacts are related to [lateral movement activities](https://attack.mitre.org/tactics/TA0008/). Lateral movement is defined by MITRE as:

> techniques that adversaries use to enter and control remote systems on a network.

The below artifacts may prove useful in identifying instances of lateral movement to or from an endpoint:

| Arifact Type | Artifact |
| - | - |
| Eventlog | [TaskScheduler/Operational Log](persistence/task-scheduler-operational-log.md) |
| Filesystem | [Scheduled Task Files](persistence/task-scheduler-files.md) |
| Eventlog | [Security/4778: Session reconnected](network/evtx-4778-session-reconnected.md) |
| Eventlog | [TerminalServices-RDPClient/Operational/1024: RDP ClientActiveX is trying to connect to the server](network/evtx-1024-rdp-activex.md) |
| Eventlog | [Security/4648: Logon using explicit credentials](account/evtx-4648-explicit-credentials.md) |
| Eventlog | [Security/4624: An account was successfully logged on](account/evtx-4624-successful-logon.md) |
| Eventlog | [Security/4625: An account failed to log on](account/evtx-4625-failed-logon.md) |
| Filesystem | [RDP Persistent Bitmap Cache](network/rdp-bitmap-cache.md) |
| Registry | [Terminal Server Client Registry Keys](network/terminal-server-client-keys.md) |
| Eventlog | [Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational/1149](network/terminal-services-remote-1149.md) |
| Eventlog | [Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/21: Session logon succeeded](network/terminal-services-local-21.md) |
| Eventlog | [Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/24: Session has been disconnected](network/terminal-services-local-24.md) |

<p align="right">(<a href="#readme-top">back to top</a>)</p>

```

`account/evtx-4624-successful-logon.md`:

```md
# Security/4624: An account was successfully logged on
This event indicates an account has successfuly authenticated to the endpoint. It is logged on the **destination** endpoint. 

This event is a **Logon Event**, meaning it is logged on the system that is being authenticated to. 

> [!NOTE]
> In windows XP, the corresponding Event ID is `528`.

### Behavioral Indications
 - [x] Behavioral - Lateral Movement (TA0008)

### Analysis Value
 - [x] Account - Login History
 - [x] Account - Logon ID
 - [x] Account - Security Identifier (SID)
 - [x] Account - Username
 - [x] Network Activity - Source Identification


## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Security.evtx`

## Artifact Interpretation

### Account - Security Identifier (SID)
The `EventData/TargetUserSid` field contains the SID of the account that authenticated. 

### Account - Logon ID
The `EventData/TargetLogonId` field contains the [Logon ID](/README.md/#account---logon-id) of the session that was authenticated. This field is of interest as it can be used to cross-reference other events found in the Windows Event Log and tie activity to a particular logon session.

### Account - Username
The `EventData/TargetUserName` will contain the username associated with the authenticating account. 

### Network Activity - Source Identification
The `EventData/IpAddress` field of this event will contain the **source** address for the session. 

 - For local logons, such as the user signing into the system through native keyboard and mouse, the `EventData/IpAddress` will be `127.0.0.1` or a null value. 

## Analysis Tips

### Analysis of LogonType
The `EventData/LogonType` provides information regarding what type of logon occurred. The following `LogonType` values are available:

| Logon Type | Description |
| - | - |
| 2 | **Interactive** (user loggong on through screen or virtual console) |
| 3 | **Network** (RDP with NLA enabled) |
| 7 | **Unlock** (RDP reconnects or interactive unlocking) |
| 9 | **Explicit** credentials (`runas`) |
| 10 | **Remote** Interactive (RDP with NLA diasbled) |

Some analysis tips for certain situations:

# Local/Physical User Logon
When a user authenticates physically to the system, the resulting `LogonType` will typically be 2, or in the event that cached credentials were used to authenticate the session, 11. If the user has unlocked the system, there will be a logon type 7 event. 

For example, a physical logon would result in the following event being logged,

Note the values of the following fields:

| Field | Value |
| - | - |
| EventData/LogonType | 2 |
| EventData/ProcessName | C:\Windows\System32\svchost.exe |
| EventData/IpAddress | 127.0.0.1 |

```
- 
<Event
	xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
-   <EventData>
		<Data Name="SubjectUserSid">S-1-5-18</Data>
		<Data Name="SubjectUserName">HLPC01$</Data>
		<Data Name="SubjectDomainName">WORKGROUP</Data>
		<Data Name="SubjectLogonId">0x3e7</Data>
		<Data Name="TargetUserSid">S-1-5-21-3471133136-2963561160-3931775028-1001</Data>
		<Data Name="TargetUserName">user</Data>
		<Data Name="TargetDomainName">HLPC01</Data>
		<Data Name="TargetLogonId">0x34358d</Data>
		<Data Name="LogonType">2</Data>
		<Data Name="LogonProcessName">User32</Data>
		<Data Name="AuthenticationPackageName">Negotiate</Data>
		<Data Name="WorkstationName">HLPC01</Data>
		<Data Name="LogonGuid">{00000000-0000-0000-0000-000000000000}</Data>
		<Data Name="TransmittedServices">-</Data>
		<Data Name="LmPackageName">-</Data>
		<Data Name="KeyLength">0</Data>
		<Data Name="ProcessId">0x7e4</Data>
		<Data Name="ProcessName">C:\Windows\System32\svchost.exe</Data>
		<Data Name="IpAddress">127.0.0.1</Data>
		<Data Name="IpPort">0</Data>
		<Data Name="ImpersonationLevel">%%1833</Data>
		<Data Name="RestrictedAdminMode">-</Data>
		<Data Name="TargetOutboundUserName">-</Data>
		<Data Name="TargetOutboundDomainName">-</Data>
		<Data Name="VirtualAccount">%%1843</Data>
		<Data Name="TargetLinkedLogonId">0x3435b7</Data>
		<Data Name="ElevatedToken">%%1842</Data>
	</EventData>
</Event>
```

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

In situations when cached credentials were used to authenticate a session, the physical logon might look like this:

| Field | Value |
| - | - |
| EventData/LogonType | 11 |
| EventData/ProcessName | C:\Windows\System32\svchost.exe |
| EventData/IpAddress | 127.0.0.1 |

```
- 
<Event
	xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
-   <EventData>
		<Data Name="SubjectUserSid">S-1-5-18</Data>
		<Data Name="SubjectUserName">WKS10-01$</Data>
		<Data Name="SubjectDomainName">HLAB</Data>
		<Data Name="SubjectLogonId">0x3e7</Data>
		<Data Name="TargetUserSid">S-1-5-21-3829912423-625253200-3062624365-1107</Data>
		<Data Name="TargetUserName">ablaser</Data>
		<Data Name="TargetDomainName">HLAB</Data>
		<Data Name="TargetLogonId">0x4d742</Data>
		<Data Name="LogonType">11</Data>
		<Data Name="LogonProcessName">User32</Data>
		<Data Name="AuthenticationPackageName">Negotiate</Data>
		<Data Name="WorkstationName">WKS10-01</Data>
		<Data Name="LogonGuid">{00000000-0000-0000-0000-000000000000}</Data>
		<Data Name="TransmittedServices">-</Data>
		<Data Name="LmPackageName">-</Data>
		<Data Name="KeyLength">0</Data>
		<Data Name="ProcessId">0x6ec</Data>
		<Data Name="ProcessName">C:\Windows\System32\svchost.exe</Data>
		<Data Name="IpAddress">127.0.0.1</Data>
		<Data Name="IpPort">0</Data>
		<Data Name="ImpersonationLevel">%%1833</Data>
		<Data Name="RestrictedAdminMode">-</Data>
		<Data Name="TargetOutboundUserName">-</Data>
		<Data Name="TargetOutboundDomainName">-</Data>
		<Data Name="VirtualAccount">%%1843</Data>
		<Data Name="TargetLinkedLogonId">0x0</Data>
		<Data Name="ElevatedToken">%%1843</Data>
	</EventData>
</Event>
```

<sup><sub>This example was produced on Windows 10 Pro, Version 10.0.19044 Build 19044</sub></sup>

# RunAs Activity
`RunAs` is a command-line utility used to execute programs with different permissions. Using `RunAs` to perform this action will also result in a type 2 logon. In the following example, take note of the `EventData/SubjectUserName` field, which indicated what user executed `RunAs`. The `EventData/TargetUserName` field contains the account name whose credentials were used. In addition, the `EventData/SubjectLogonId` is the same as the `EventData/TargetLogonId` in the previous example of cached credential authentication. This indicates that `HLAB\ablaser` authenticated to the system, and then used `RunAs` to run a command as `HLAB\mvanburanadm`.

```
- 
<Event
	xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
-   <EventData>
		<Data Name="SubjectUserSid">S-1-5-21-3829912423-625253200-3062624365-1107</Data>
		<Data Name="SubjectUserName">ablaser</Data>
		<Data Name="SubjectDomainName">HLAB</Data>
		<Data Name="SubjectLogonId">0x4d742</Data>
		<Data Name="TargetUserSid">S-1-5-21-3829912423-625253200-3062624365-1105</Data>
		<Data Name="TargetUserName">mvanburanadm</Data>
		<Data Name="TargetDomainName">HLAB</Data>
		<Data Name="TargetLogonId">0xc0cd5</Data>
		<Data Name="LogonType">2</Data>
		<Data Name="LogonProcessName">seclogo</Data>
		<Data Name="AuthenticationPackageName">Negotiate</Data>
		<Data Name="WorkstationName">WKS10-01</Data>
		<Data Name="LogonGuid">{22acd001-6c49-8d9e-8c4f-c1fd908d1c0e}</Data>
		<Data Name="TransmittedServices">-</Data>
		<Data Name="LmPackageName">-</Data>
		<Data Name="KeyLength">0</Data>
		<Data Name="ProcessId">0x2108</Data>
		<Data Name="ProcessName">C:\Windows\System32\svchost.exe</Data>
		<Data Name="IpAddress">::1</Data>
		<Data Name="IpPort">0</Data>
		<Data Name="ImpersonationLevel">%%1833</Data>
		<Data Name="RestrictedAdminMode">-</Data>
		<Data Name="TargetOutboundUserName">-</Data>
		<Data Name="TargetOutboundDomainName">-</Data>
		<Data Name="VirtualAccount">%%1843</Data>
		<Data Name="TargetLinkedLogonId">0xc0f24</Data>
		<Data Name="ElevatedToken">%%1842</Data>
	</EventData>
</Event>
```

<sup><sub>This example was produced on Windows 10 Pro, Version 10.0.19044 Build 19044</sub></sup>

# Remote Desktop Activity
The appearance of Remote Desktop activity from this artifact depends on several factors:

 - For new RDP logons, a type 10 logon event is logged
 - For pre-existing logons, a type 7 logon event is logged
 - Assuming Network Level Authentication (NLA) is required on the system for RDP, there will be a type 3 logon event preceeding either the type 7 or type 10 event

For example, an RDP session from another system on the local network (172.16.200.2), with NLA enabled, and with a previous RDP session that was not formally logged out would create the following two events:

Type 3 Logon Event
```
- 
<Event
	xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
-   <EventData>
		<Data Name="SubjectUserSid">S-1-0-0</Data>
		<Data Name="SubjectUserName">-</Data>
		<Data Name="SubjectDomainName">-</Data>
		<Data Name="SubjectLogonId">0x0</Data>
		<Data Name="TargetUserSid">S-1-5-21-3829912423-625253200-3062624365-1105</Data>
		<Data Name="TargetUserName">mvanburanadm</Data>
		<Data Name="TargetDomainName">HLAB</Data>
		<Data Name="TargetLogonId">0x4f5277</Data>
		<Data Name="LogonType">3</Data>
		<Data Name="LogonProcessName">NtLmSsp</Data>
		<Data Name="AuthenticationPackageName">NTLM</Data>
		<Data Name="WorkstationName">HLNAS01-WS2K19</Data>
		<Data Name="LogonGuid">{00000000-0000-0000-0000-000000000000}</Data>
		<Data Name="TransmittedServices">-</Data>
		<Data Name="LmPackageName">NTLM V2</Data>
		<Data Name="KeyLength">128</Data>
		<Data Name="ProcessId">0x0</Data>
		<Data Name="ProcessName">-</Data>
		<Data Name="IpAddress">172.16.200.2</Data>
		<Data Name="IpPort">0</Data>
		<Data Name="ImpersonationLevel">%%1833</Data>
		<Data Name="RestrictedAdminMode">-</Data>
		<Data Name="TargetOutboundUserName">-</Data>
		<Data Name="TargetOutboundDomainName">-</Data>
		<Data Name="VirtualAccount">%%1843</Data>
		<Data Name="TargetLinkedLogonId">0x0</Data>
		<Data Name="ElevatedToken">%%1842</Data>
	</EventData>
</Event>
```

Type 7 Logon Event (Unlocked)
```
- 
<Event
	xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <EventData>
		<Data Name="SubjectUserSid">S-1-5-18</Data>
		<Data Name="SubjectUserName">WKS10-01$</Data>
		<Data Name="SubjectDomainName">HLAB</Data>
		<Data Name="SubjectLogonId">0x3e7</Data>
		<Data Name="TargetUserSid">S-1-5-21-3829912423-625253200-3062624365-1105</Data>
		<Data Name="TargetUserName">mvanburanadm</Data>
		<Data Name="TargetDomainName">HLAB</Data>
		<Data Name="TargetLogonId">0x4fbf34</Data>
		<Data Name="LogonType">7</Data>
		<Data Name="LogonProcessName">User32</Data>
		<Data Name="AuthenticationPackageName">Negotiate</Data>
		<Data Name="WorkstationName">WKS10-01</Data>
		<Data Name="LogonGuid">{00000000-0000-0000-0000-000000000000}</Data>
		<Data Name="TransmittedServices">-</Data>
		<Data Name="LmPackageName">-</Data>
		<Data Name="KeyLength">0</Data>
		<Data Name="ProcessId">0x6ec</Data>
		<Data Name="ProcessName">C:\Windows\System32\svchost.exe</Data>
		<Data Name="IpAddress">172.16.200.2</Data>
		<Data Name="IpPort">0</Data>
		<Data Name="ImpersonationLevel">%%1833</Data>
		<Data Name="RestrictedAdminMode">-</Data>
		<Data Name="TargetOutboundUserName">-</Data>
		<Data Name="TargetOutboundDomainName">-</Data>
		<Data Name="VirtualAccount">%%1843</Data>
		<Data Name="TargetLinkedLogonId">0x4fbf85</Data>
		<Data Name="ElevatedToken">%%1842</Data>
	</EventData>
</Event>
```

<sup><sub>This example was produced on Windows Server 2019 Standard, Version 10.0.17763 Build 17763</sub></sup>

If there was not a previous and still active RDP connection, the Type 7 Logon event would have instead been logged as a Type 10 Logon event. 

# File Server Access
In the event that a remote system authenticates to a file server to access file shares, the resulting Logon event will be of Type 3, with the IP address of the authenticating system in the `EventData\IpAddress` field. This can be useful for auditing potential file access on network shares.
```

`account/evtx-4625-failed-logon.md`:

```md
# Security/4625: An account failed to log on 
This logon event indicates an account has failed to authenticate to the endpoint. It is logged on the **destination** endpoint. It closely mirrors the information logged for the event [4624: An account was successfully logged on](/account/evtx-4624-successful-logon.md).

> [!NOTE]
> This event is a **Logon Event**, meaning it is logged on the system that is being authenticated to. 

### Behavioral Indications
 - [x] Behavioral - Lateral Movement (TA0008)

### Analysis Value
 - [x] Account - Login History
 - [x] Account - Security Identifier (SID)
 - [x] Network Activity - Source Identification

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Security.evtx`

## Artifact Interpretation
The following fields may be interpreted from this artifact:

| Field Name | Interpretation |
| - | - |
| Logon Type | Logon type. See [Logon Types](#logon-types) |
| Account For Which Logon Failed / Security ID | SID of account that authenticated |
| Account For Which Logon Failed / Account Name | Name of account that authenticated |
| Network Information / Source Network Address | IP address of source endpoint |

> [!NOTE]
> The SID may be translated by event viewer. To view the raw SID, look at the event's XML data, which has the following fields available:

| XML Field Name | Interpretation |
| - | - |
| EventData/LogonType | Logon type. See [Logon Types](#logon-types) |
| EventData/TargetUserSid | SID of account that authenticated |
| EventData/TargetUserName | Name of account that authenticated |
| EventData/IpAddress | IP address of source endpoint |

### Logon Types
The following logon types are commonly seen:

| Logon Type | Description |
| - | - |
| 2 | **Interactive** (user loggong on through screen or virtual console) |
| 3 | **Network** (RDP with NLA enabled) |
| 7 | **Unlock** (RDP reconnects or interactive unlocking) |
| 9 | **Explicit** credentials (`runas`) |
| 10 | **Remote** Interactive (RDP with NLA diasbled) |
```

`account/evtx-4648-explicit-credentials.md`:

```md
# Security/4648: Logon using explicit credentials
This event, logged to the Security channel, indicates a logon was completed using explicit credentials. Explicit credentials refers to credentials that are not currently active and have been explicitly selected by an attacker. It is logged on the **source** system and may indicate lateral movement tactics such as the use of `runas` or access to remote file shares.

> [!NOTE]
> In windows XP, the corresponding Event ID is `552`.

### Behavioral Indications
 - [x] Behavioral - Lateral Movement (TA0008)

### Analysis Value
 - [x] Account - Login History
 - [x] Account - Logon ID
 - [x] Account - Security Identifier (SID)
 - [x] Network Activity - Destination Identification

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Security.evtx`

## Artifact Interpretation
The following fields may be interpreted from this artifact:

| Field Name | Interpretation |
| - | - |
| Subject / Security ID | SID of account that used the explicit credentials |
| Subject / Account Name | Name of account that used the explicit credentials |
| Subject / Logon ID | [Logon ID](/README.md/#account---logon-id) of session for account that used the explicit credentials |
| Account Whose Credentials Were Used / Account Name | Account name for the explicit credentials |
| Target Server / Target Server Name | The name of the **destination** endpoint the credentials were used on |
| Process Information / Process ID | Hex PID of the process that used the explicit credentials |
| Process Information / Process Name | The command line of the process that used the explicit credentials |
| Network Information / Network Address | IP address of **source** endpoint |

> [!NOTE]
> The SID may be translated by event viewer. To view the raw SID, look at the event's XML data, which has the following fields available:

This event may be correlated with events found on the destination endpoint, such as event [4624: An account was successfully logged on](/account/evtx-4624-successful-logon.md). In the case of runas activity, a 4624 event will be registered with Logon type 9.
```

`account/evtx-4720-account-created.md`:

```md
# Security/4720: A user account was created
This event, logged to the Security channel, indicates a new user account was created on the endpoint.

> [!NOTE]
> In windows XP, the corresponding Event ID is `624`.

### Behavioral Indications
 - [x] Behavioral - Persistence (TA0003)

### Analysis Value
 - [x] Account - Creation Time
 - [x] Account - Logon ID
 - [x] Account - Security Identifier (SID)

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Security.evtx`

## Artifact Interpretation
The following fields may be interpreted from this artifact:

| Field Name | Interpretation |
| - | - |
| Subject / Security ID | SID of account that created the new account |
| Subject / Account Name | Account name of account that created the new account |
| Subject / Logon ID | [Logon ID](/README.md/#account---logon-id) of session for account that created the new account |
| New Account / Security ID | SID of the new account |
| New Account / Account Name | Name of the new account |

> [!NOTE]
> The SID may be translated by event viewer. To view the raw SID, look at the event's XML data, which has the following fields available:

When parsing the event's XML data:

| XML Path | Interpretation |
| - | - |
| EventData/TargetUserName | New account name |
| EventData/TargetSid | New account SID |
| EventData/SubjectUserSid | SID of account that created the new account |
| EventData/SubjectUserName | Account name of account that created the new account |
| EventData/SubjectLogonId | [Logon ID](/README.md/#account---logon-id) of session for account that created the new account |


```

`account/group-membership-key.md`:

```md
# Group Membership Registry Key
The Group Membership Registry Key is a registry key that stores information about all the groups a user is a part of. It is located in the Windows registry under a user's profile and contains the group security identifiers (SIDs) and a count of how many groups a user is joined to.

### Analysis Value
 - [x] Account - Group Membership
 - [x] Endpoint - Enumeration

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP

## Artifact Location(s)
This registry key resides in the NTUSER.DAT file, and on a live system is loaded into HKEY_USERS.

🔋 Live System:
- `HKEY_USERS\{USER_SID}\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\GroupMembership`

🔌 Offline system:
- File: `%UserProfile%\NTUSER.DAT`
- Key: `SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\GroupMembership`

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
Two distinct values are present within this key. The `Count` REG_DWORD value is a count of how many groups the user is a member of. 

The corresponding Group Security Identifiers (SIDs) are enumerated as REG_SZ values of the format `GroupX`. 

## Example
```
PS> New-PSDrive -PSProvider Registry -Name HKU -Root HKEY_USERS
PS> > Get-ItemProperty -Path "HKU:\S-1-5-21-3471133136-2963561160-3931775028-1001\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\GroupMembership" -Name *

Group0       : S-1-5-21-3471133136-2963561160-3931775028-513
Group1       : S-1-1-0
Group2       : S-1-5-114
Group3       : S-1-5-32-544
Group4       : S-1-5-32-559
Group5       : S-1-5-32-545
Group6       : S-1-5-4
Group7       : S-1-2-1
Group8       : S-1-5-11
Group9       : S-1-5-15
Group10      : S-1-5-113
Group11      : S-1-2-0
Group12      : S-1-5-64-10
Group13      : S-1-16-12288
Count        : 14
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`account/profile-list-key.md`:

```md
# ProfileList Registry Key
The ProfileList Registry Key is a registry key that contains subkeys named by user SIDs present on the endpoint. Within each SID subkey are values that can assist in matching SIDs to usernames during dead-disk forensics. 

### Analysis Value
 - [x] Account - Security Identifier (SID)
 - [x] Account - Username

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP

## Artifact Location(s)
🔋 Live System:
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\{USER_SID}`

🔌 Offline system:
- File: `%SystemRoot%\System32\Config\SOFTWARE`
- Key: `SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\{USER_SID}`

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
The value `ProfileImagePath` of type `REG_EXPAND_SZ` contains the full path to a user's home directory, which will typically be named after the user. 

The value `Sid` of type `REG_BINARY` will contain the binary representation of the user's SID. 

## Example
The following example shows how the username `user` maps to the SID `S-1-5-21-3471133136-2963561160-3931775028-1001`.
```
PS> Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\S-1-5-21-3471133136-2963561160-3931775028-1001" -Name *

ProfileImagePath                        : C:\Users\user1
Flags                                   : 0
FullProfile                             : 1
State                                   : 256
Sid                                     : {1, 5, 0, 0...}
LocalProfileLoadTimeLow                 : 1077375513
LocalProfileLoadTimeHigh                : 31041204
ProfileAttemptedProfileDownloadTimeLow  : 0
ProfileAttemptedProfileDownloadTimeHigh : 0
ProfileLoadTimeLow                      : 0
ProfileLoadTimeHigh                     : 0
LocalProfileUnloadTimeLow               : 4123181936
LocalProfileUnloadTimeHigh              : 31029421
RunLogonScriptSync                      : 0
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`account/sam-hive.md`:

```md
# SAM Hive
The SAM hive contains a wealth of information that can be used to profile an endpoint's accounts. For domain-joined endpoints, the SAM hive will be present on the domain controller. Non-domain joined endpoints will have a resident SAM hive. 

### Behavioral Indications
 - [x] Behavioral - Persistence (TA0003)

### Analysis Value
 - [x] Account - Creation Time
 - [x] Account - Group Membership
 - [x] Account - Last Login
 - [x] Account - Relative Identifier (RID)

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP

## Artifact Location(s)
- File: `%SystemRoot%\System32\config\SAM`

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
Within the SAM hive, the registry key located at `SAM\Domains\Accounts\Users` will contain the following values for each account:

 - Relative Identifier (RID)
 - CreatedOn time (Time the account was created)
 - Logon Count
 - Username
 - Password reset questions
 - Password Hints
 - Last Login Time
 - Last Failed Login Time
 - Last Password Change Time

> [!NOTE]
> If the account in question is authenticating using Microsoft Live, the Logon Count will be 0.
```

`browser/firefox-places-sqlite.md`:

```md
# Firefox places.sqlite Database

`places.sqlite` is the SQLite database file that stores history for Mozilla's Firefox browser. It also stores additional data such as favicons, bookmarks, and input history (used for autofill).

### Analysis Value
 - [x] Browser - History
 - [x] Browser - Bookmarks

## Operating System Availability

* Systems with Mozilla Firefox installed

## Artifact Location(s)

* `%UserProfile%\AppData\Roaming\Mozilla\Firefox\Profiles\{FIREFOX_PROFILE}\places.sqlite*`

## Artifact Parsers

* KAPE (Extraction and Parsing)
* [DB Browser for SQLite](https://sqlitebrowser.org/)

## Artifact Interpretation

The following tables are present in this SQLite database:

| Database Table     | Information                                                              |
| ------------------ | ------------------------------------------------------------------------ |
| moz\_bookmarks     | Bookmarks                                                                |
| moz\_favicons      | Favicon store. Provides URLs for each stored favicon.                    |
| moz\_historyvisits | Firefox history                                                          |
| moz\_inputhistory  | Input history for the URL/search bar                                     |
| moz\_places        | Stores URLs and some metadata regarding each URL such as visit frequency |

> [!NOTE]
> In newer versions of Firefox (Firefox 55.0+), the `moz_favicons` table has been moved to its own unique database under the same directory, `favicons.sqlite`.&#x20;

## Firefox Bookmarks

The browser bookmark data for Firefox is stored in the `moz_bookmarks` table of this database. It has the following structure:

<table><thead><tr><th width="176">Field</th><th width="156.33333333333331">Type</th><th>Interpretation</th></tr></thead><tbody><tr><td>fk</td><td>INT</td><td>Points to <code>id</code> in <code>moz_places</code> table, provides the URL for the bookmark.</td></tr><tr><td>title</td><td>LONGVARCHAR</td><td>The user-assigned name for the bookmark</td></tr><tr><td>dateAdded</td><td>INT</td><td>UNIX timestamp indicating when the bookmark was added</td></tr><tr><td>lastModified</td><td>INT</td><td>UNIX timestamp indicating when the bookmark was last modified</td></tr></tbody></table>

## Firefox Favicons

The stored favicons for visited websites are stored either in the `places.sqlite` database for Firefox versions below 55.0, and in its own separate SQLite database `favicons.sqlite` for versions afterwards. The structure is as follows:

<table><thead><tr><th width="172.33333333333331">Field</th><th width="166">Type</th><th>Interpretation</th></tr></thead><tbody><tr><td>icon_url</td><td>TEXT</td><td>The URL of the original favicon</td></tr><tr><td>expire_ms</td><td>INT</td><td>UNIX timestamp representing the expiration time/date for the stored favicon. By default seems to be one week from the last visit. </td></tr><tr><td>data</td><td>BLOB</td><td>The raw favicon data</td></tr></tbody></table>

## Firefox History

The browsing history for a particular Firefox profile can be extracted from the `moz_historyvisits` table. It has the following structure:

<table><thead><tr><th width="170.33333333333331">Field</th><th width="165">Type</th><th>Interpretation</th></tr></thead><tbody><tr><td>place_id</td><td>INT</td><td>Foreign key pointing to an entry in the <code>moz_places</code> table, which can be used to determine the URL that was visited</td></tr><tr><td>visit_date</td><td>INT</td><td>UNIX timestamp representing the time of the visit</td></tr><tr><td>visit_type</td><td>INT</td><td>Enumerated value, the type of visit</td></tr></tbody></table>

The following `visit_type` enumerations can provide additional information regarding how the site was visited:

1. Link followed to visit the URL
2. URL was typed and visited, or selected from an autocomplete result in the search bar
3. URL was visited through a bookmark
4. URL was embedded on another page
5. URL visited through a permanent redirect (HTTP 301)
6. URL visited through a temporary redirect (HTTP 307)
7. URL is a downloaded resource
8. URL was visited in a frame
9. URL was visited because the page was reloaded




```

`enumeration/computer-name.md`:

```md
# ComputerName Registry Key
The `ComputerName` registry key will provide the Computer Name of the endpoint. 

### Analysis Value
 - [x] Endpoint - Enumeration

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2008
 - [x] Windows Server 2003 R2
 - [x] Windows Server 2003

## Artifact Location(s)
🔋 Live System:
- `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName`

🔌 Offline system:
- File: `%SystemRoot%\System32\config\SYSTEM`
- Key: `SYSTEM\{CURRENT_CONTROL_SET}\Control\ComputerName\ComputerName`

> [!NOTE]
> More information on [{CURRENT_CONTROL_SET}](/enumeration/select.md)

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
The `ComputerName` value's data field will provide the system's configured Computer Name. 

## Example
```
PS> Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName" -Name *

ComputerName : HLPC01
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`enumeration/current-version.md`:

```md
# CurrentVersion Registry Key
The `CurrentVersion` registry key will provide you with the current operating system's version, service pack, and date of installation.

### Analysis Value
 - [x] Endpoint - Enumeration

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2008
 - [x] Windows Server 2003 R2
 - [x] Windows Server 2003

## Artifact Location(s)
🔋 Live System:
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion`

🔌 Offline system:
- File: `%SystemRoot%\System32\config\SOFTWARE`
- Key: `SOFTWARE\Microsoft\Windows NT\CurrentVersion`

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
The `ProductName` value will provide the OS, such as `Windows Server 2019`.

The `ReleaseId` value will provide the version of the specified OS. 

The `InstallDate` is an Epoch timestamp of when the OS was either first installed or received a major update, or was reset. 

## Example
```
PS> Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion" -Name *

SystemRoot                : C:\Windows
BaseBuildRevisionNumber   : 1
BuildBranch               : vb_release
BuildGUID                 : ffffffff-ffff-ffff-ffff-ffffffffffff
BuildLab                  : 19041.vb_release.191206-1406
BuildLabEx                : 19041.1.amd64fre.vb_release.191206-1406
CompositionEditionID      : Enterprise
CurrentBuild              : 19044
CurrentBuildNumber        : 19044
CurrentMajorVersionNumber : 10
CurrentMinorVersionNumber : 0
CurrentType               : Multiprocessor Free
CurrentVersion            : 6.3
EditionID                 : Professional
EditionSubManufacturer    :
EditionSubstring          :
EditionSubVersion         :
InstallationType          : Client
InstallDate               : 1666804042
ProductName               : Windows 10 Pro
ReleaseId                 : 2009
SoftwareType              : System
UBR                       : 3086
PathName                  : C:\Windows
ProductId                 : 00330-80000-00000-AA949
DisplayVersion            : 21H2
RegisteredOwner           : user1
RegisteredOrganization    :
InstallTime               : 133112776429018501
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`enumeration/interfaces.md`:

```md
# Interfaces Registry Key
The `Interfaces` registry key will provide information regarding the systems attached network interface adatpers, such as IP address and MAC address. 

### Analysis Value
 - [x] Endpoint - Enumeration

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2008
 - [x] Windows Server 2003 R2
 - [x] Windows Server 2003

## Artifact Location(s)
🔋 Live System:
- `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\{INTERFACE_GUID}`

🔌 Offline system:
- File: `%SystemRoot%\System32\config\SYSTEM`
- Key: `SYSTEM\{CURRENT_CONTROL_SET}\Services\Tcpip\Parameters\Interfaces\{INTERFACE_GUID}`

> [!NOTE]
> More information on [{CURRENT_CONTROL_SET}](/enumeration/select.md)

> [!NOTE]
> More information on [{INTERFACE_GUID}](/enumeration/network-cards.md)

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
Each interface will have its own dedicated registry key, and may contain the following values of interest:

| value               | type      | information                                                          |
| ------------------- | --------- | -------------------------------------------------------------------- |
| DhcpDomain          | REG_SZ    | DHCP option 15 - the domain name of the endpoints FQDN               |
| DhcpIPAddress       | REG_SZ    | The DHCP - provided IP address of the endpoint                       |
| DhcpServer          | REG_SZ    | The DHCP server that provided the endpoint its network configuration |
| EnableDHCP          | REG_DWORD | 0x0 if DHCP is disabled and 0x1 if DHCP is enabled                   |
| LeaseObtainedTime   | REG_DWORD | FILETIME timestamp of when the endpoint received a DHCP lease        |
| LeaseTerminatesTime | REG_DWORD | FILETIME timestamp of when the endpoint's DHCP lease expires    |

## Example
```
PS> Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\{a7d8885d-10c1-43d4-9e1e-0a7b2678f020}" -Name *

EnableDHCP                 : 1
Domain                     :
NameServer                 :
DhcpServer                 : 10.100.0.1
Lease                      : 172800
LeaseObtainedTime          : 1687622031
T1                         : 1687708431
T2                         : 1687773231
LeaseTerminatesTime        : 1687794831
AddressType                : 0
IsServerNapAware           : 0
DhcpConnForceBroadcastFlag : 0
IPAddress                  : {}
SubnetMask                 : {}
DefaultGateway             : {}
DefaultGatewayMetric       : {}
RegistrationEnabled        : 1
RegisterAdapterName        : 0
DhcpInterfaceOptions       : {252, 0, 0, 0...}
DhcpDefaultGateway         : {10.100.0.1}
DhcpNameServer             : 10.100.0.10 10.100.0.10
DhcpSubnetMaskOpt          : {255.255.0.0}
DhcpIPAddress              : 10.100.65.234
DhcpSubnetMask             : 255.255.0.0
DhcpGatewayHardware        : {10, 100, 0, 1...}
DhcpGatewayHardwareCount   : 1
```

Correlating with the [NetworkCards](/enumeration/network-cards.md) registry key:
```
PS> Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkCards\" -Name *

ServiceName  : {A7D8885D-10C1-43D4-9E1E-0A7B2678F020}
Description  : Intel(R) Wi-Fi 6 AX200 160MHz
PSPath       : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkCards\5
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`enumeration/network-cards.md`:

```md
# NetworkCards Registry Key
The `NetworkCards` registry key will provide the name and interface GUID of the system's attached network interface adatpers.

### Analysis Value
 - [x] Endpoint - Enumeration

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2008
 - [x] Windows Server 2003 R2
 - [x] Windows Server 2003

## Artifact Location(s)
🔋 Live System:
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkCards\*`

🔌 Offline system:
- File: `%SystemRoot%\System32\config\SOFTWARE`
- Key: `SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkCards\*`


## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
Each network interface adapter will have its own subkey with the following values:

 - `Description`: The name of the network adapter
 - `ServiceName`: The GUID of the network adapter

## Examples

```
Description     REG_SZ      Microsoft Hyper-V Network Adapter
ServiceName     REG_SZ      {4C7FB48D-33EB-4277-A3FB-37D5EF39C990}
```

<sup><sub>This example was produced on Windows Server 2019 Standard, Version 10.0.17763 Build 17763</sub></sup>


```
Description     REG_SZ      Realtek USB GbE Family Controller
ServiceName     REG_SZ      {737FB1FE-88FF-4F5E-943A-A46C057E68B9}
```

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>


```

`enumeration/select.md`:

```md
# Select Registry Key
The `Select` registry key provides the number of the system's `CurrentControlSet`. The `CurrentControlSet` contains important configuration for the Windows operating system, and several different Control Sets may be available within a system's registry. 

In general, `ControlSet001` will be the most recent Control Set that has been booted under, whereas `ControlSet002` functions as a backup of a known-good state for the Control Set. 

### Analysis Value
 - [x] Endpoint - Enumeration

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2008
 - [x] Windows Server 2003 R2
 - [x] Windows Server 2003

## Artifact Location(s)
🔋 Live System:
- `HKEY_LOCAL_MACHINE\SYSTEM\Select`

🔌 Offline system:
- File: `%SystemRoot%\System32\config\SYSTEM`
- Key: `SYSTEM\Select`

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
Within the `Select` key, the value named `Current` identifies the `CurrentControlSet` by an integer. If the value is `1` for instance, that means that the `CurrentControlSet` on a live system will point to `ControlSet001`. 

## Example
In the following example, the `Select` value's data is `1`, indicating that the CurrentControlSet is `ControlSet001`.
```
PS> Get-ItemProperty -Path "HKLM:\SYSTEM\Select" -Name *

Current       : 1
Default       : 1
Failed        : 0
LastKnownGood : 1
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`enumeration/time-zone-information.md`:

```md
# TimeZoneInformation Registry Key
The `TimeZoneInformation` registry key provides the current system time zone. This is useful for consolidating separate artifacts found on a system to align with one time zone, such as UTC. 

### Analysis Value
 - [x] Endpoint - Enumeration

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2008
 - [x] Windows Server 2003 R2
 - [x] Windows Server 2003

## Artifact Location(s)
🔋 Live System:
- `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\TimeZoneInformation`

🔌 Offline system:
- File: `%SystemRoot%\System32\config\SYSTEM`
- Key: `SYSTEM\{CURRENT_CONTROL_SET}\Control\TimeZoneInformation`

> [!NOTE]
> More information on [{CURRENT_CONTROL_SET}](/enumeration/select.md)

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
Within the `TimeZoneInformation` registry key, the value name `TimeZoneKeyName` will contain the current system time zone. 

For examples of what this may look like, execute the command `Get-TimeZone -ListAvailable` in PowerShell and look at the `Id` key. 

The `Bias` key contains the numer of minutes between UTC and the system's selected time zone, such that `UTC = Local System Time + Bias`.

## Example
```
PS> Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\TimeZoneInformation" -Name *

Bias                        : 360
DaylightBias                : 4294967236
DaylightName                : @tzres.dll,-161
DaylightStart               : {0, 0, 3, 0...}
StandardBias                : 0
StandardName                : @tzres.dll,-162
StandardStart               : {0, 0, 11, 0...}
TimeZoneKeyName             : Central Standard Time
DynamicDaylightTimeDisabled : 0
ActiveTimeBias              : 300
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`execution/amcache.md`:

```md
# Amcache.hve
The Amcache hive stores metadata regarding executables/installed programs present on an endpoint. Typically, only those that have been executed (or executables associated with installed software) will appear in this registry hive. This artifact has seen numerous revisions, and it is therefore important to first gather information regarding the specific version of Windows that you are analyzing before proceeding with Amcache analysis. You can find a system's OS version and build number information in the [CurrentVersion](/enumeration/current-version.md) registry key, using the `CurrentMajorVersionNumber`, `CurrentMinorVersionNumber`, and `CurrentBuildNumber` values.

### Behavioral Indications
 - [x] Behavioral - Execution (TA0002)

### Analysis Value
 - [x] Execution - First Executed
 - [x] Execution - Evidence of Execution
 - [x] File - Hash
 - [x] File - Path

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7 ⚠️
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2

> [!IMPORTANT]  
> Windows 7 requires update KB2952664 for the Amcache hive to be present. Amcache is available on Windows Server starting from Windows Server 2008 R2.
 
## Artifact Location(s)
- `%SystemRoot%\AppCompat\Programs\Amcache.hve`

Additional LOG files:
- `%SystemRoot%\AppCompat\Programs\Amcache.hve.*LOG1`
- `%SystemRoot%\AppCompat\Programs\Amcache.hve.*LOG2`

## Artifact Parsers
 - amcacheparser.exe (Eric Zimmerman)
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
Within the Amcache hive there are multiple registry keys, each containing different information. The most common keys to analyze are:

 - InventoryApplication
 - InventoryApplicationFile
 - InventoryDriverBinary
 - InventoryApplicationShortcut

### InventoryApplication (Windows 10 Build 10.0.14393 +)
The `InventoryApplication` key stores information about installed software on the system. This key contains a value named `LastScanTime` that corresponds to the last time the Microsoft Compatibility Appraiser has run. This is a scheduled task that executes the `compattelrunner.exe` binary. **The information contained in this key should only be updated when this task is executed. Software installed since this task has last run may not appear in this key!** This value is in Windows FileTime format.

This key contains subkeys for each installed software, the key names being the software's `ProgramId`. It contains the following values of interest:

| Value | Description |
| ----- | ----------- |
| ProgramId | The installed software's ProgramId |
| Name | Name of the installed software |
| Version | Version of the installed software |
| Publisher | The installed software's publisher |
| Source | `AddRemoveProgram` or `Msi` or `File` or `AppXPackage` |
| InstallDate | The date the software was installed. This seems to only populate for AddRemoveProgram/Msi software installations |
| RootDirPath | The path to the root directory of the software |
| RegistryKeyPath | The path to the `Uninstall` registry key in the SOFTWARE hive |

The `Source` value can give information regarding how software was installed on the system:

 - AddRemoveProgram: Software installed via an executable
 - Msi: Software installed via a .msi file using the Windows Installer service
 - AppXPackage: Software installed via the Windows Store of the `Get-AppxPackage` PowerShell command

### InventoryApplicationFile (Windows 10 Build 10.0.14393 +)
This registry key contains information about the executables tied to installed software, as well as executables that have run on the system. A single software installation may drop multiple executables to a system, and they should all be tracked here. Like the `InventoryApplication` key, this key also only updates when the Microsoft Compatibility Appraiser task has run.

The subkeys will contain the executable name, and a hash separated by a `|` character. The most interesting values to analyze within this key are:

| Value | Description |
| ----- | ----------- |
| ProgramId | The ProgramId that this executable is tied to, which can be found in `InventoryApplication`. If the executable was not installed as part of a software installation, this ProgramId will not be found in `InventoryApplication` |
| FileId | Stripping the four leading 0s, the SHA-1 hash of the executable |
| LowerCaseLongPath | The path to the executable |
| Name | The filename of the executable |
| BinaryType | 32/64bit indicator |
| Size | The size, in bytes, of the executable |

> [!WARNING]
> **There is a limit to the size of the data that gets hashed to produce this artifact's SHA-1 hash in the `FileId` value.** If the size of the binary exceeds approximately 30MB in size, only the first 30MB will be hashed. The result is that the SHA-1 hash will not be valid for that binary. ⚠️

## Example
Installing a new software, CrystalDiskMark on a system and manually running `compattelrunner.exe` updated the Amcache Hive with the following key (named `00001d78ebb0f68947e39952c24983d564390000ffff`) under `InventoryApplication`:

```
[
    {
        "Data": "00001d78ebb0f68947e39952c24983d564390000ffff",
        "ValueName": "ProgramId",
        "ValueType": "RegSz",
    },
    {
        "Data": "00006141a84b1e5f3b60561c7be664657764da598522",
        "ValueName": "ProgramInstanceId",
        "ValueType": "RegSz",
    },
    {
        "Data": "CrystalDiskMark 8.0.4c",
        "ValueName": "Name",
        "ValueType": "RegSz",
    },
    {
        "Data": "8.0.4c",
        "ValueName": "Version",
        "ValueType": "RegSz",
    },
    {
        "Data": "Crystal Dew World",
        "ValueName": "Publisher",
        "ValueType": "RegSz",
    },
    {
        "Data": "65535",
        "ValueName": "Language",
        "ValueType": "RegDword",
    },
    {
        "Data": "AddRemoveProgram",
        "ValueName": "Source",
        "ValueType": "RegSz",
    },
    {
        "Data": "Application",
        "ValueName": "Type",
        "ValueType": "RegSz",
    },
    {
        "Data": "",
        "ValueName": "StoreAppType",
        "ValueType": "RegSz",
    },
    {
        "Data": "",
        "ValueName": "MsiPackageCode",
        "ValueType": "RegSz",
    },
    {
        "Data": "",
        "ValueName": "MsiProductCode",
        "ValueType": "RegSz",
    },
    {
        "Data": "0",
        "ValueName": "HiddenArp",
        "ValueType": "RegDword",
    },
    {
        "Data": "0",
        "ValueName": "InboxModernApp",
        "ValueType": "RegDword",
    },
    {
        "Data": "10.0.0.19044",
        "ValueName": "OSVersionAtInstallTime",
        "ValueType": "RegSz",
    },
    {
        "Data": "10/18/2023 00:00:00",
        "ValueName": "InstallDate",
        "ValueType": "RegSz",
    },
    {
        "Data": "",
        "ValueName": "PackageFullName",
        "ValueType": "RegSz",
    },
    {
        "Data": "",
        "ValueName": "ManifestPath",
        "ValueType": "RegSz",
    },
    {
        "Data": "",
        "ValueName": "BundleManifestPath",
        "ValueType": "RegSz",
    },
    {
        "Data": "C:\\Program Files\\CrystalDiskMark8\\",
        "ValueName": "RootDirPath",
        "ValueType": "RegSz",
    },
    {
        "Data": "\"C:\\Program Files\\CrystalDiskMark8\\unins000.exe\"",
        "ValueName": "UninstallString",
        "ValueType": "RegSz",
    },
    {
        "Data": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\CrystalDiskMark8_is1",
        "ValueName": "RegistryKeyPath",
        "ValueType": "RegSz",
    },
    {
        "Data": "0",
        "ValueName": "SentDetailedInv",
        "ValueType": "RegDword",
    }
]
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

The software was installed via an executable, leading the `Source` value to be `AddRemoveProgram`. Note the `ProgramId` value of `00001d78ebb0f68947e39952c24983d564390000ffff`.

Additionally, several keys were created under `InventoryApplicationFile`, one example (`diskmark32.exe|51ddc7c2637fbb8d`):

```
[
    {
        "Data": "00001d78ebb0f68947e39952c24983d564390000ffff",
        "ValueName": "ProgramId",
        "ValueType": "RegSz",
    },
    {
        "Data": "00009d1e062ff187c9a920a3fcc511911d4fc0e820ce",
        "ValueName": "FileId",
        "ValueType": "RegSz",
    },
    {
        "Data": "c:\program files\crystaldiskmark8\diskmark32.exe",
        "ValueName": "LowerCaseLongPath",
        "ValueType": "RegSz",
    },
    {
        "Data": "diskmark32.exe|51ddc7c2637fbb8d",
        "ValueName": "LongPathHash",
        "ValueType": "RegSz",
    },
    {
        "Data": "DiskMark32.exe",
        "ValueName": "Name",
        "ValueType": "RegSz",
    },
    {
        "Data": "crystal dew world",
        "ValueName": "Publisher",
        "ValueType": "RegSz",
    },
    {
        "Data": "pe32_i386",
        "ValueName": "BinaryType",
        "ValueType": "RegSz",
    },
    {
        "Data": "crystaldiskmark8",
        "ValueName": "ProductName",
        "ValueType": "RegSz",
    },
    {
        "Data": "8.0.4.0",
        "ValueName": "ProductVersion",
        "ValueType": "RegSz",
    },
    {
        "Data": "07/11/2021 06:58:40",
        "ValueName": "LinkDate",
        "ValueType": "RegSz",
    },
    {
        "Data": "8.0.4.0",
        "ValueName": "BinProductVersion",
        "ValueType": "RegSz",
    },
    {
        "Data": "698912",
        "ValueName": "Size",
        "ValueType": "RegQword",
    },
    {
        "Data": "1041",
        "ValueName": "Language",
        "ValueType": "RegDword",
    },
    {
        "Data": "60189208",
        "ValueName": "Usn",
        "ValueType": "RegQword",
    }
]
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

From this example, we can see that the `ProgramId` between the two Amcache keys correspond to each other. 

```

`execution/bam-dam.md`:

```md
# Background Activity Montitor
The Background Activity Monitor and Desktop Activity Montior registry artifacts provide evidence of execution on an endpoint. It is only available in Windows 10 and Windows 11.

### Behavioral Indications
 - [x] Behavioral - Execution (TA0002)

### Analysis Value
 - [x] Account - Security Identifier (SID)
 - [x] Execution - Last Executed
 - [x] Execution - Permissions / Account
 - [x] Execution - Evidence of Execution
 - [x] File - Path
 
## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10 (⚠️ 1709 and later)


## Artifact Location(s)
🔋 Live System:

> Newer Windows 10 Versions
- BAM: `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\bam\state\UserSettings\{USER_SID}`
- DAM: `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\dam\state\UserSettings\{USER_SID}`

> Older Windows 10 Versions
- BAM: `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\bam\UserSettings\{USER_SID}`
- DAM: `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\dam\UserSettings\{USER_SID}`

🔌 Offline system:

> Newer Windows 10 Versions
- File: `%SystemRoot%\System32\config\SYSTEM`
- BAM: `SYSTEM\{CURRENT_CONTROL_SET}\Services\bam\state\UserSettings\{USER_SID}`
- DAM: `SYSTEM\{CURRENT_CONTROL_SET}\Services\dam\state\UserSettings\{USER_SID}`

> Older Windows 10 Versions
- File: `%SystemRoot%\System32\config\SYSTEM`
- BAM: `SYSTEM\{CURRENT_CONTROL_SET}\Services\bam\UserSettings\{USER_SID}`
- DAM: `SYSTEM\{CURRENT_CONTROL_SET}\Services\dam\UserSettings\{USER_SID}`

> [!NOTE]
> More information on [{CURRENT_CONTROL_SET}](/enumeration/select.md)


## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
The `Execution Time` as seen in RegistryExplorer represents the most recent time of execution for the binary in UTC. The `Program` field represents the full path the the binary. 

> [!NOTE]
> Based on testing, this execution time is written upon process creation, and again on termination.

In the event that you are parsing or interpreting this artifact manually, the following CyberChef recipe can be used to convert Windows FILETIME timestamps to a date and time:

```
[
  { "op": "From Hex",
    "args": ["Auto"] },
  { "op": "To Hex",
    "args": ["None", 0] },
  { "op": "Windows Filetime to UNIX Timestamp",
    "args": ["Milliseconds (ms)", "Hex (little endian)"] },
  { "op": "From UNIX Timestamp",
    "args": ["Milliseconds (ms)"] }
]
```

### Example: Execution Timestamp
- Path: `HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\bam\State\UserSettings\S-1-5-21-3471133136-2963561160-3931775028-1001`
- Key: `\Device\HarddiskVolume4\Program Files\PuTTY\putty.exe`
- Type: `REG_BINARY`
- Value: `60-9F-62-A8-FB-6C-D9-01-00-00-00-00-00-00-00-00-00-00-00-00-02-00-00-00`

The 64-Bit FILETIME timestamp `60-9F-62-A8-FB-6C-D9-01` resolves to `Wed 12 April 2023 05:00:10 UTC`, which is the last known execution of the binary `putty.exe`.

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

## Caveats
Console applications that are launched through a command line interface will not have BAM/DAM entries. 

## Analysis Tips

### Executables in Suspicious Locations
Search for BAM entries for executables that reside in suspicious locations, such as:

 - User `Downloads` directories
 - Other user profile directories such as `Desktop` or `Documents`
 - `C:\Temp`
 - `C:\PerfLogs`

## Example
![Example Image](/media/examples/bam.png)
```

`execution/evtx-4104-script-block-logging.md`:

```md
# Microsoft-Windows-PowerShell/Operational/4104: PowerShell Script Block Logging
Now enabled by default, this event is logged whenever a script is run through PowerShell. 

### Behavioral Indications
 - [x] Behavioral - Execution (TA0002)

### Analysis Value
 - [x] Execution - Process Tree
 - [x] Execution - First Executed
 - [x] File - Path
 - [x] Account - Security Identifier (SID)
 
## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-PowerShell%4Operational.evtx`

## Artifact Interpretation

The `Level` field (available in PowerShell5.0) may indicate a suspicious script. If its value is `Warning` this indicates the script was flagged as suspicious based on its contents. 

The `ScriptBlock ID` is used to uniquely identify a script across multiple `4104` events. Large scripts may be split across multiple events, to reconstruct the full script, concatenate all the events with this unique ID together. 

The `Path` field indicates the full path to the executed script. 

The `ProcessID` field indicates the parent process ID (PID) that executed the script. 

The `UserID` field contains the SID of the user that executed the script. 

### Time of Execution
The timestamp of the event indicates the time at which the script, identified by the field `ScriptBlock ID` was executed for the first time. 

### Process Genealogy
The `Creator Process ID` field may be cross-referenced with [Security/4688: A new process has been created](execution/evtx-4688-process-created.md).

## Caveats
This event is only logged the first time that a script is executed.

This event will not capture the resultant output of an executed script as module logging does. 

## Example

```
- <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <System>
  <Provider Name="Microsoft-Windows-PowerShell" Guid="{a0c1853b-5c40-4b15-8766-3cf1c58f985a}" /> 
  <EventID>4104</EventID> 
  <Version>1</Version> 
  <Level>5</Level> 
  <Task>2</Task> 
  <Opcode>15</Opcode> 
  <Keywords>0x0</Keywords> 
  <TimeCreated SystemTime="2023-11-06T20:24:01.8911267Z" /> 
  <EventRecordID>194</EventRecordID> 
  <Correlation ActivityID="{7af08a74-10ed-0003-e08b-f07aed10da01}" /> 
  <Execution ProcessID="4328" ThreadID="4600" /> 
  <Channel>Microsoft-Windows-PowerShell/Operational</Channel> 
  <Computer>DESKTOP-TUMSOE7</Computer> 
  <Security UserID="S-1-5-21-1392459375-2353216063-1350843065-1001" /> 
  </System>
- <EventData>
  <Data Name="MessageNumber">1</Data> 
  <Data Name="MessageTotal">1</Data> 
  <Data Name="ScriptBlockText">Invoke-WebRequest -Uri "https://example.com" -OutFile "C:\Temp\test.exe"</Data> 
  <Data Name="ScriptBlockId">808e4d85-977e-4418-9218-59dd2aa1b0ef</Data> 
  <Data Name="Path" /> 
  </EventData>
  </Event>
```
```

`execution/evtx-4688-process-created.md`:

```md
# Security/4688: A new process has been created
This event, logged to the Security channel, indicates a process was created on the system.

> [!NOTE]  
> In windows XP/Windows Server 2003, the corresponding Event ID is `592`.

> [!NOTE]  
>  These events require the `Audit Process Creation` policy to be configured, which is by default not configured. 

> [!NOTE]  
>  For the events to contain the full command line for each logged process, an additional policy called `Include command line in process creation events` must also be configured. 

### Behavioral Indications
 - [x] Behavioral - Execution (TA0002)

### Analysis Value
 - [x] Account - Logon ID
 - [x] Account - Security Identifier (SID)
 - [x] Execution - Command Line Options (⚠️ Requires audit policy configuration)
 - [x] Execution - Permissions / Account
 - [x] Execution - Process Tree
 - [x] Execution - Evidence of Execution
 - [x] Execution - Time

## Operating System Availability
 - [x] Windows 11 (⚠️ Requires audit policy configuration)
 - [x] Windows 10 (⚠️ Requires audit policy configuration)
 - [x] Windows 8 (⚠️ Requires audit policy configuration)
 - [x] Windows 7 (⚠️ Requires audit policy configuration)
 - [x] Windows Vista (⚠️ Requires audit policy configuration)
 - [x] Windows XP (⚠️ Requires audit policy configuration, Event ID `592`)
 - [x] Windows Server 2019 (⚠️ Requires audit policy configuration)
 - [x] Windows Server 2016 (⚠️ Requires audit policy configuration)
 - [x] Windows Server 2012 R2 (⚠️ Requires audit policy configuration)
 - [x] Windows Server 2012 (⚠️ Requires audit policy configuration)
 - [x] Windows Server 2008 R2 (⚠️ Requires audit policy configuration)
 - [x] Windows Server 2008 (⚠️ Requires audit policy configuration)
 - [x] Windows Server 2003 R2 (⚠️ Requires audit policy configuration, Event ID `592`)
 - [x] Windows Server 2003 (⚠️ Requires audit policy configuration, Event ID `592`)

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Security.evtx`

## Artifact Interpretation

### Account - Logon ID
The `EventData/SubjectLogonId` field contains the [Logon ID](/README.md/#account---logon-id), which may be used to correlate this activity with a logon session recorded by event IDs such as:

 - [4624: An account was successfully logged on](/account/evtx-4624-successful-logon.md)
 - `4647: User initiated logoff `
 - `4634: An account was logged off `

### Execution - Evidence of Execution
The presence of a `4688` event indicates that the application listed in the field `EventData\NewProcessName` was executed. 

### Execution - Time
The timestamp of the event indicates the time at which the process listed in the field `EventData\NewProcessName` was executed.

### Execution - Permissions / Account
The following fields can be used to determine what account spawned the process:

| XML Path                  | Interpretation                                                            |
| ------------------------- | ------------------------------------------------------------------------- |
| EventData/SubjectUserSid | The [Security ID](/README.md/#account---security-identifier-sid) of the account that executed the process |
| EventData/SubjectUserName | The username of the account that executed the process |
| EventData/SubjectDomainName | The domain name of the account that executed the process |

The `EventData\TokenElevationType` field relates to UAC. The following interpretations are made possible by this field:

 - `%%1936` indicates that UAC is disabled on the system, or that the local administrator account launched the process.
 - `%%1937` indicates that the user manually ran the process as an administrator, or that the program requested administrative privileges upon execution.
 - `%%1938` indicates that the process did not run with administrator privileges. 

> [!NOTE]  
>  In the event that UAC was used to elevate permissions in order to execute an application, this information will be stored in the `Target` fields instead. 

### Execution - Command Line Options
In the event that Process Tracking is enabled (defaults to disabled), the full command line will be available in the `Process Command Line` field. 

In order for this to be available, the system's policy must be enabled under `Computer Configuration/Administrative Templates/System/Audit Process Creation/Include command line in process creation events`.

### Execution - Process Tree
The `New Process ID` and `Creator Process ID` fields may be used to create a timeline of processes.

## Examples
In the following example, `notepad.exe` was launched by a user through Explorer.

```
- <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <System>
  <Provider Name="Microsoft-Windows-Security-Auditing" Guid="{54849625-5478-4994-a5ba-3e3b0328c30d}" /> 
  <EventID>4688</EventID> 
  <Version>2</Version> 
  <Level>0</Level> 
  <Task>13312</Task> 
  <Opcode>0</Opcode> 
  <Keywords>0x8020000000000000</Keywords> 
  <TimeCreated SystemTime="2023-06-25T19:46:45.3571632Z" /> 
  <EventRecordID>16044222</EventRecordID> 
  <Correlation /> 
  <Execution ProcessID="4" ThreadID="7776" /> 
  <Channel>Security</Channel> 
  <Computer>HLPC01</Computer> 
  <Security /> 
  </System>
- <EventData>
  <Data Name="SubjectUserSid">S-1-5-21-3471133136-2963561160-3931775028-1001</Data> 
  <Data Name="SubjectUserName">john.doe</Data> 
  <Data Name="SubjectDomainName">HLPC01</Data> 
  <Data Name="SubjectLogonId">0xd91ae</Data> 
  <Data Name="NewProcessId">0x5194</Data> 
  <Data Name="NewProcessName">C:\Windows\System32\notepad.exe</Data> 
  <Data Name="TokenElevationType">%%1938</Data> 
  <Data Name="ProcessId">0x25d0</Data> 
  <Data Name="CommandLine">"C:\Windows\system32\notepad.exe"</Data> 
  <Data Name="TargetUserSid">S-1-0-0</Data> 
  <Data Name="TargetUserName">-</Data> 
  <Data Name="TargetDomainName">-</Data> 
  <Data Name="TargetLogonId">0x0</Data> 
  <Data Name="ParentProcessName">C:\Windows\explorer.exe</Data> 
  <Data Name="MandatoryLabel">S-1-16-8192</Data> 
  </EventData>
  </Event>
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

In the following example, `regedit.exe` was launched by a user through the command line. Note the `TokenElevationType` has a value of `%%1937`, indicating they were likely prompted for administrative credentials/permissions. This also causes the user information to be stored in the `Target` fields, as opposed to the `Subject` fields as seen in the previous example.
```
- <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <System>
  <Provider Name="Microsoft-Windows-Security-Auditing" Guid="{54849625-5478-4994-a5ba-3e3b0328c30d}" /> 
  <EventID>4688</EventID> 
  <Version>2</Version> 
  <Level>0</Level> 
  <Task>13312</Task> 
  <Opcode>0</Opcode> 
  <Keywords>0x8020000000000000</Keywords> 
  <TimeCreated SystemTime="2023-06-25T19:48:53.8848049Z" /> 
  <EventRecordID>16044760</EventRecordID> 
  <Correlation /> 
  <Execution ProcessID="4" ThreadID="9852" /> 
  <Channel>Security</Channel> 
  <Computer>HLPC01</Computer> 
  <Security /> 
  </System>
- <EventData>
  <Data Name="SubjectUserSid">S-1-5-18</Data> 
  <Data Name="SubjectUserName">HLPC01$</Data> 
  <Data Name="SubjectDomainName">WORKGROUP</Data> 
  <Data Name="SubjectLogonId">0x3e7</Data> 
  <Data Name="NewProcessId">0x4c7c</Data> 
  <Data Name="NewProcessName">C:\Windows\regedit.exe</Data> 
  <Data Name="TokenElevationType">%%1937</Data> 
  <Data Name="ProcessId">0x4e24</Data> 
  <Data Name="CommandLine">"C:\Windows\regedit.exe"</Data> 
  <Data Name="TargetUserSid">S-1-5-21-3471133136-2963561160-3931775028-1001</Data> 
  <Data Name="TargetUserName">john.doe</Data> 
  <Data Name="TargetDomainName">HLPC01</Data> 
  <Data Name="TargetLogonId">0xd9173</Data> 
  <Data Name="ParentProcessName">C:\Windows\System32\cmd.exe</Data> 
  <Data Name="MandatoryLabel">S-1-16-12288</Data> 
  </EventData>
  </Event>
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

```

`execution/evtx-9707-shell-core.md`:

```md
# Microsoft-Windows-Shell-Core/Operational/9707: Command Execution Started
This event indicates that a logon task, found in [Run/RunOnce Keys](/persistence/reg-run-runonce.md) has executed.

### Behavioral Indications
 - [x] Behavioral - Execution (TA0002)
 - [x] Behavioral - Persistence (TA0003)

### Analysis Value
 - [x] Account - Security Identifier (SID)
 - [x] Execution - Command Line Options
 - [x] Execution - Permissions / Account
 - [x] Execution - Process Tree
 - [x] Execution - Evidence of Execution
 - [x] Execution - Time

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista


## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-Shell-Core%4Operational.evtx`

## Artifact Interpretation

### Account - Security Identifier (SID)
The `System/Security/UserID` field of this command provides the [Security Identifier (SID)](/README.md/#account---security-identifier-sid) of the account that triggered the command to run.

### Execution - Command Line Options
The full command line options for the command that was run will be available in the `EventData/Command` field of this event. 

### Execution - Process Tree
The Process and Thread ID of the command that was run will be available in the `System/Execution/ProcessID` and `System/Execution/ThreadID` fields of this event, respectively. 

### Execution - Evidence of Execution
The presence of this event indicates that the given command was run and that an entry either exists as a [Run Key](/persistence/reg-run-runonce.md) or existed as a [RunOnce Key](/persistence/reg-run-runonce.md).

### Execution - Time
The timestamp of the event indicates the time at which the command was run.

## Example
On an example system, the following registry key exists:

```
Path: HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\exampletask
Value: "C:\Temp\example.exe" -silent
```

During a user logon, the following `Microsoft-Windows-Shell-Core/Operational/9707` event is logged:

```
- 
<Event
	xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
-   <System>
		<Provider Name="Microsoft-Windows-Shell-Core" Guid="{30336ed4-e327-447c-9de0-51b652c86108}" />
		<EventID>9707</EventID>
		<Version>0</Version>
		<Level>4</Level>
		<Task>9707</Task>
		<Opcode>1</Opcode>
		<Keywords>0x2000000004010000</Keywords>
		<TimeCreated SystemTime="2023-04-30T15:57:41.0345751Z" />
		<EventRecordID>21933</EventRecordID>
		<Correlation />
		<Execution ProcessID="5072" ThreadID="11548" />
		<Channel>Microsoft-Windows-Shell-Core/Operational</Channel>
		<Computer>HLPC01</Computer>
		<Security UserID="S-1-5-21-3471133136-2963561160-3931775028-1001" />
	</System>
-   <EventData>
		<Data Name="Command">example.exe" -silent</Data>
	</EventData>
</Event>
```

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`execution/prefetch.md`:

```md
# Prefetch
Windows Prefetch is utilized to improve application performance by pre-loading resources when an application is launched.

In addition to providing evidence of execution, the prefetch artifact provides a list of modules/files that have been accessed by the process in the 10 seconds following spawning. 

### Behavioral Indications
 - [x] Behavioral - Execution (TA0002)

### Analysis Value
 - [x] Execution - First Executed
 - [x] Execution - Last Executed
 - [x] Execution - Evidence of Execution
 - [x] Execution - Full Path
 - [x] File - Path

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP
 - [x] Windows Server 2019 (⚠️ Requires manual enable)
 - [x] Windows Server 2016 (⚠️ Requires manual enable)
 - [x] Windows Server 2012 R2 (⚠️ Requires manual enable)
 - [x] Windows Server 2012 (⚠️ Requires manual enable)
 - [x] Windows Server 2008 R2 (⚠️ Requires manual enable)
 - [x] Windows Server 2008 (⚠️ Requires manual enable)
 - [x] Windows Server 2003 R2 (⚠️ Requires manual enable)
 - [x] Windows Server 2003 (⚠️ Requires manual enable)

## Artifact Location(s)
- `%SystemRoot%\Prefetch`

## Artifact Parsers
 - PECmd.exe (Eric Zimmerman)
 - pf.exe (TZWorks)

## Artifact Interpretation
The name of the prefetch file takes on the format: `{executable_name}-{hash}.pf`, where `executable_name` is the name of the executable file that was run, and `hash` provides a hash of the executable's path and the command line used to launch the executable. If the same executable was run with different command line options, or the executable was moved and then run again, this essentially means there will be more than one prefetch entry for it. 

### Earliest Execution
The creation timestamp of the prefetch file indicates the **potential** *earliest* time the executable was run on the system. This is because the amount of prefetch files stored on the system is limited, and older files are rotated out. 

### Last Executed
The most recent execution is indicated by the modification timestamp of the prefetch file. Additionally, on Windows 8/10, the last 8 execution times are stored within the prefetch file and can be parsed. 

## Full Path
The artifact, when parsed, provides the full path to the executable that was run.

## Caveats
Prefetch files are written approximately 10 seconds after execution. Subtract 10 seconds from the prefetch filesystem timestamps to get an approximate time.

Regarding the "potential" earliest/first execution: Because Windows only stores the last 128 entries (Windows XP/Vista/7) or 1024 entries (Windows 8/10), applications that haven't been run after some time may be rolled out of this directory, and re-created when they are run again.

You may see multiple entries for the same executable on a system. This indicates that the executable was with different command line options, or (less likely) existed in different directories when executed. 

## Analysis Tips

### Evidence of Deleted Files
Because the Prefetch artifact stores files referenced by a program, it may be used to identify deleted files as they will persist in this artifact.

## Example
In the following example, the SysInternals utility `ADExplorer64` was executed from two separate locations, once from the system's disk under `C:\Temp` and once from a connected USB device, resulting in two prefetch files:

 - `ADEXPLORER64.EXE-9B0EE190.pf` : Executed three times from a connected USB device
 - `ADEXPLORER64.EXE-67B06AB8.pf` : Executed once on local disk

The files when parsed through PECmd, resulted in the following outputs:

```
Processing ADEXPLORER64.EXE-67B06AB8.pf

Created on: 2023-05-10 16:29:15
Modified on: 2023-05-10 16:28:35
Last accessed on: 2023-05-10 16:31:26

Executable name: ADEXPLORER64.EXE
Hash: 67B06AB8
File size (bytes): 32,418
Version: Windows 10 or Windows 11

Run count: 1
Last run: 2023-05-10 16:28:32

Volume information:

#0: Name: \VOLUME{01d8e97614061ec7-7c141bd8} Serial: 7C141BD8 Created: 2022-10-26 20:03:55 Directories: 9 File references: 58

Directories referenced: 9

00: \VOLUME{01d8e97614061ec7-7c141bd8}\TEMP (Keyword True)
01: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS
02: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\APPPATCH
03: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\FONTS
04: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\GLOBALIZATION
05: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\GLOBALIZATION\SORTING
06: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32
07: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\EN-US
08: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\WINSXS\AMD64_MICROSOFT.WINDOWS.COMMON-CONTROLS_6595B64144CCF1DF_6.0.19041.1110_NONE_60B5254171F9507E

Files referenced: 49

00: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\NTDLL.DLL
01: \VOLUME{01d8e97614061ec7-7c141bd8}\TEMP\ADEXPLORER64.EXE (Executable: True)
02: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\KERNEL32.DLL
03: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\KERNELBASE.DLL
04: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\LOCALE.NLS
05: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\APPHELP.DLL
06: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\APPPATCH\SYSMAIN.SDB
07: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\RPCRT4.DLL
08: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\USER32.DLL
...
```

In the case where ADExplorer64 was run from a USB device, note the presence of two volume entries. Additionally, since the executable was run three times, there are additional execution timestamps for these events as well!
```
Processing ADEXPLORER64.EXE-9B0EE190.pf

Created on: 2023-05-10 16:44:17
Modified on: 2023-05-10 16:43:59
Last accessed on: 2023-05-10 16:44:32

Executable name: ADEXPLORER64.EXE
Hash: 9B0EE190
File size (bytes): 32,266
Version: Windows 10 or Windows 11

Run count: 3
Last run: 2023-05-10 16:43:57
Other run times: 2023-05-10 16:43:54, 2023-05-10 16:43:51

Volume information:

#0: Name: \VOLUME{0000000000000000-340060b2} Serial: 340060B2 Created: 1601-01-01 00:00:00 Directories: 0 File references: 1
#1: Name: \VOLUME{01d8e97614061ec7-7c141bd8} Serial: 7C141BD8 Created: 2022-10-26 20:03:55 Directories: 7 File references: 52

Directories referenced: 7

00: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS
01: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\FONTS
02: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\GLOBALIZATION
03: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\GLOBALIZATION\SORTING
04: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32
05: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\EN-US
06: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\WINSXS\AMD64_MICROSOFT.WINDOWS.COMMON-CONTROLS_6595B64144CCF1DF_6.0.19041.1110_NONE_60B5254171F9507E

Files referenced: 48

00: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\NTDLL.DLL
01: \VOLUME{0000000000000000-340060b2}\ADEXPLORER64.EXE (Executable: True)
02: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\KERNEL32.DLL
03: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\KERNELBASE.DLL
04: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\LOCALE.NLS
05: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\RPCRT4.DLL
06: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\USER32.DLL
07: \VOLUME{01d8e97614061ec7-7c141bd8}\WINDOWS\SYSTEM32\NETAPI32.DLL
...
```
```

`execution/program-compatibility-assistant.md`:

```md
# Program Compatibility Assistant (PCA) - PcaAppLaunchDic.txt
Program Compatibility Assistant (PCA) is a feature introduced since Windows 8 intended for application compatibility purposes. New to Windows 11 (22H2 Update) is the ability to extract detailed evidence of execution from it. 

### Behavioral Indications
 - [x] Behavioral - Execution (TA0002)

### Analysis Value
 - [x] Execution - Evidence of Execution
 - [x] Execution - Last Executed
 - [x] File - Path

## Operating System Availability
 - [x] Windows 11 (⚠️ Recent builds only)

## Artifact Location(s)
- `%SystemRoot%\AppCompat\pca\PcaAppLaunchDic.txt`

## Artifact Interpretation - PcaAppLaunchDic.txt
This is a pipe-delimited text file that contains the following information:

`{Executable Full Path}|{Most Recent Execution Timestamp}`

The `{Executable Full Path}` provides the full path to the executable that was run. 

The `{Most Recent Execution Timestamp}` execution timestamp is in UTC and represents the last time the specified executable was run.

Any executable format, such as `.scr` and `.exe` may be logged in this location. This artifact will also log executables run from file shares and USB devices.

## Examples

```
\\NAS01-WS2K19\sysinternals\accesschk.exe|2023-05-03 01:55:27.884
C:\Users\user1.domain\Desktop\accesschk.exe|2023-05-03 01:56:00.799
```

<sup><sub>This example was produced on Windows 11 Pro, Version 10.0.22621 Build 22621</sub></sup>

## Caveats
Based on testing on Windows 11 Pro Build 22621, it seems that executions from the command line are not logged to this artifact.
```

`execution/shimcache.md`:

```md
# ShimCache / Application Compatibility Cache
ShimCache is a registry artifact of the application compatibility database to provide backwards-compatibility between operating system versions. It may provide forensic evidence of execution on a system.

### Behavioral Indications
 - [x] Behavioral - Execution (TA0002)

### Analysis Value
 - [x] Execution - Evidence of Execution
 - [x] File - Last Modified
 - [x] File - Path
 - [x] File - Size

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2008
 - [x] Windows Server 2003 R2
 - [x] Windows Server 2003

## Artifact Location(s)
🔋 Live System:
 - Windows XP: `SYSTEM\CurrentControlSet\Control\SessionManager\AppCompatibility\AppCompatCache`
 - Windows Vista/7/8/10/11: `SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache\AppCompatCache`

🔌 Offline system:
 - File: `%SystemRoot%\System32\config\SYSTEM`
 - Windows XP: `SYSTEM\{CURRENT_CONTROL_SET}\Control\SessionManager\AppCompatibility\AppCompatCache`
 - Windows Vista/7/8/10: `SYSTEM\{CURRENT_CONTROL_SET}\Control\Session Manager\AppCompatCache\AppCompatCache`

> [!NOTE]
> More information on [{CURRENT_CONTROL_SET}](/enumeration/select.md)

## Artifact Parsers
 - [ShimCacheParser.py](https://github.com/mandiant/ShimCacheParser)
 - Volatility's shimcachemem plugin

## Caveats
An entry into the ShimCache alone is not conclusive enough to prove execution, and this artifact should be cross-referenced with other similar artifacts to be certain of execution.

The ShimCache registry data is written on system shutdown only and the data extracted directly from the registry may be incomplete. Under these circumstances it is necessary to procure a memory dump to exctract a complete dataset from this forensic artifact. 

```

`execution/srum-db.md`:

```md
# System Resource Usage Monitor (SRUM)
The SRUM database is a forensic artifact that provides evidence of execution and network activity. It is used by Windows to provide telemetry regarding applications that run on an endpoint. It provides 30-60 days of resolution. 

> [!NOTE]
> This artifact is present in both the **registry** as well as the **filesystem**, as an ESE database.

### Behavioral Indications
 - [x] Behavioral - TA0002 - Execution

### Analysis Value
 - [x] Execution - Permissions/Account
 - [x] Execution - Evidence of Execution
 - [x] File - Path
 - [x] Account - Security Identifier (SID)
 - [x] Network Activity - Transmit Volume

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows Server 2019
 
## Artifact Location(s)
 - Filesystem: `%SystemRoot%\System32\sru\SRUDB.dat`
 - Registry: `SOFTWARE\Microsoft\Windows NT\Current Version\SRUM\Extensions`

## Artifact Parsers
 - [srum-dump](https://github.com/MarkBaggett/srum-dump)
 - ESEDatabaseView
 - Registry Explorer

## Artifact Interpretation
The recommended method to interpret this artifact is to use the srum-dump parser. It will allow you to specify the path the the SRUDB.dat file, the SOFTWARE registry hive, and easily convert the information into a presentable format in an Excel spreadsheet.

The SRUM database records information from a number of providers. If you are parsing this manually, you will encounter the following IDs:

| Key | Provider |
| - | - |
| `{973F5D5C-1D90-4944-BE8E-24B94231A174}` | Network Data Usage Monitor |
| `{D10CA2FE-6FCF-4F6D-848E-B2E99266FA86}` | Push Notification Provider |
| `{D10CA2FE-6FCF-4F6D-848E-B2E99266FA89}` | Application Resource Usage Provider |
| `{DD6636C4-8929-4683-974E-22C046A43763}` | Network Connectivity Usage Monitor |
| `{FEE4E14F-02A9-4550-B5CE-5FA2DA202E37}` | Energy Usage Provider |

The following information is available from these providers:

 - Network Data Usage Monitor
   - *Tracks network usage on a per-application basis*
   - Application ID
   - User SID
   - Type of interface network traffic traversed (i.e., Ethernet, loopback, IEEE 802.11 wireless, etc.)
   - Bytes sent and received
 - Push Notification Provider
   - *Tracks push notification (WPM) activity on a per-application basis*
   - Application Name
   - User SID
   - Push notification payload size
 - Application Resource Usage
   - Application Name
   - User SID
   - Performance metrics such as CPU time, disk write/read bytes, etc.
 - Network Connectivity Usage Monitor
   - *Tracks each network the endpoint has been connected to.*
   - Time of first connection
   - Duration of connection
   - Type of interface network traffic traversed (i.e., Ethernet, loopback, IEEE 802.11 wireless, etc.)

### Network Data Usage Monitor
This artifact is useful for identifying potential data exfiltration events from Windows systems, as it captures network utilization over time, providing insight into the magnitude of the data transfer. Note that this artifact provides an **hourly, bucketed** count of how many bytes were sent and received by an application, therefore, the first and last SRUM entry will not correspond exactly to the first and last execution time. This can, however, be used to provide a rough estimate of the timeline of execution for an application. 

## Caveats
Data collected is written to the SRUM database on the filesystem once per hour to reflect what is stored in the registry, or during system shutdown/reboot events. 

In the event that a proper shutdown was not conducted, the SRUM filesystem database may need to be repaired using a utility such as `esentutl`.

## Examples
![Example Image](/media/examples/srum_dump_output.png)
*Example srum-dump output showing network usage*
```

`execution/wer-files.md`:

```md
# Windows Error Reporting Files (.WER)
Windows Error Reporting is a component of Windows that allows for users to send crash reports to Microsoft. Windows Error Reporting files provide information about the crash and are useful to a forensic analysis to provide evidence of execution.

### Behavioral Indications
 - [x] Behavioral - Execution (TA0002)
 
### Analysis Value
 - [x] Execution - Evidence of Execution
 - [x] File - Path

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2008

## Artifact Location(s)
 - `%ProgramData%\Microsoft\Windows\WER\ReportArchive`
 - `%ProgramData%\Microsoft\Windows\WER\ReportQueue`
 - `%UserProfile%\AppData\Local\Microsoft\Windows\WER\ReportArchive`
 - `%UserProfile%\AppData\Local\Microsoft\Windows\WER\ReportQueue`

## Artifact Interpretation
Within the aforementioned directories, folders containing .WER files may be found. 

These are created when either:

 - A user-mode applications crashes (AppCrash_ ...)
 - A user-mode application hangs (AppHang_ ...)
 - A kernel crash occurs (Kernel_ ...)

For evidence of execution, the AppCrash and AppHang folders are most interesting. The folders contain the application name, for example, `AppHang_Bginfo64.exe_cf919d50e71d613a2bddb1a116ff8eebb4e5c_140e09f3_c2b585e7-ac5d-4cf9-bd79-7b6d4fe6075c`.

Each folder represents one instance of an application crashing or hanging, and may contain a variety of files apart from the .WER file, such as minidumps. The .WER files contain information about crash reports that occurred and mirror closely the information represented in the Windows Reliability History control panel page.

The .WER file will contain a wealth of information, such as:

 - The full path to the application that crashed or froze
 - The modules that the application loaded
 - Application metadata, such as version, name, etc.
 - OS metadata such as OS version, architecture, etc.

## Example
The following example shows the result of an application, `WinSCP.exe`, experiencing a fault and crashing (it has been reduced to include the most interesting information from this artifact):

Note the `EventTime` is a Windows Filetime timestamp. In this example, it translates to `Sat 18 February 2023 05:14:17 UTC`, which corresponds to the creation time of this .WER file. From this we can confirm that the application located at `C:\Program Files (x86)\WinSCP\WinSCP.exe` was executed sometime before it crashed at `2023-02-18T05:14:17.000Z`.

```
Version=1
EventType=APPCRASH
EventTime=133211708571634483
NsAppName=WinSCP.exe
OriginalFilename=winscp.exe
Sig[0].Name=Application Name
Sig[0].Value=WinSCP.exe
Sig[1].Name=Application Version
Sig[1].Value=5.21.5.12858
Sig[2].Name=Application Timestamp
Sig[2].Value=00000000
Sig[3].Name=Fault Module Name
Sig[3].Value=MSHTML.dll
Sig[4].Name=Fault Module Version
Sig[4].Value=11.0.19041.2604
Sig[5].Name=Fault Module Timestamp
Sig[5].Value=709ac760
Sig[6].Name=Exception Code
Sig[6].Value=c0000005
Sig[7].Name=Exception Offset
Sig[7].Value=0035c570
DynamicSig[1].Name=OS Version
DynamicSig[1].Value=10.0.19044.2.0.0.256.48
UI[2]=C:\Program Files (x86)\WinSCP\WinSCP.exe
LoadedModule[0]=C:\Program Files (x86)\WinSCP\WinSCP.exe
LoadedModule[1]=C:\Windows\SYSTEM32\ntdll.dll
LoadedModule[2]=C:\Windows\System32\KERNEL32.DLL
LoadedModule[3]=C:\Windows\System32\KERNELBASE.dll
LoadedModule[4]=C:\Windows\System32\WS2_32.DLL
LoadedModule[5]=C:\Windows\System32\RPCRT4.dll
LoadedModule[6]=C:\Windows\System32\CRYPT32.DLL
LoadedModule[7]=C:\Windows\System32\ucrtbase.dll
LoadedModule[8]=C:\Windows\System32\SHLWAPI.DLL
OsInfo[29].Key=osver
OsInfo[29].Value=10.0.19041.2604.amd64fre.vb_release.191206-1406
OsInfo[31].Key=edition
OsInfo[31].Value=Professional
FriendlyEventName=Stopped working
ConsentKey=APPCRASH
AppName=WinSCP: SFTP, FTP, WebDAV, S3 and SCP client
AppPath=C:\Program Files (x86)\WinSCP\WinSCP.exe
ApplicationIdentity=45B3D2BB4FABCE88A748DFBEF7254C79
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`file-activity/automatic-destinations.md`:

```md
# AutomaticDestinations Jumplists
AutomaticDestinations are jumplist files created by Windows when an application is launched. As these are jumplist files, they are in a binary format known as Object Linking and Embedding Compound File (OLECF). AutomaticDestinations can be thought of as containers for different LNK files from which forensic evidence may be recovered. 

Jumplists are used to store common/recent locations and "tasks" on the taskbar for individual programs. From a forensic perspective they are useful in identifying files and folders that were created or accessed by users. 

### Behavioral Indications
 - [x] Behavioral - Execution (TA0002)
 
### Analysis Value
 - [x] Execution - First Executed ⚠️
 - [x] Execution - Last Executed ⚠️
 - [x] Execution - Permissions / Account
 - [x] Execution - Evidence of Execution
 - [x] Account - Username
 - [x] File - Path

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7

## Artifact Location(s)
 - `%USERPROFILE%\AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations`

## Artifact Parsers
 - JLECmd (Eric Zimmerman)

## Artifact Interpretation
The file name for these artifacts are based on the AppID of the program they are related to. For example, an AutomaticDestinations entry for `explorer.exe` will have the prefix `F01B4D95CF55D32A`. Thus, the full file name would be `f01b4d95cf55d32a.automaticDestinations-ms`. A good resource to leverage to translate AppIDs by Eric Zimmerman can be found [here](https://github.com/EricZimmerman/JumpList/blob/master/JumpList/Resources/AppIDs.txt).

### Execution - First Executed
The creation time of each AutomaticDestinations file corresponds to the first known time that an application **opened a file** while being executed. For instance, if a user simply opens Excel, but never opens a file, there will be no AutomaticDestinations file created. If, however, they proceed to open a file (or save a new file), an AutomaticDestinations file will be created with a creation timestamp corresponding to the time the first file was opened (or a new file was saved). 

### Execution - Last Executed
The modification time of each AutomaticDestinations file corresponds to the last known time that an application was executed **and opened a file**. For instance, the modification timestamp will change under the following example set of circumstances:

 - A user navigated to a directory using explorer and opened an Excel workbook by double-clicking on it
 - A user went to Excel on the taskbar and opened an Excel workbook listed under the `Recent` list. 
 - A user opened Excel, and then opened a workbook from within Excel.
 - A user opened Excel, and saved a new workbook from within Excel.

The timestamp will not be updated in the case that a user simply opened Excel without opening another file. 

### Execution - Permissions / Account
Given that the AutomaticDestinations files are stored in a user's %AppData% directory, this effectively ties execution of an application to a particular user account. For instance, if the AutomaticDestinations file for Excel exists in the following path: `C:\Users\john.doe\AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations\b8ab77100df80ab2.automaticDestinations-ms`, this implies that the user `john.doe` executed `Microsoft Office Excel x64`.

### Execution - Evidence of Execution
The presence of an AutomaticDestinations file for an application implies that the application was executed and was used to open a file or save a new file.

### File - Path
Within each AutomaticDestinations file is a list of recent files that were accessed, as well as a count of how many times each file was accessed using that specific application. Alongside this is the timestamp corresponding to the last known time each file was accessed by the application. 

For instance, when using JLECmd.exe (Eric Zimmerman) to analyze an AutomaticDestinations file for Excel, the following is seen:

```
Processing C:\Users\john.doe\AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations\b8ab77100df80ab2.automaticDestinations-ms

--- AppId information ---
  AppID: b8ab77100df80ab2
  Description: Microsoft Office Excel x64

--- DestList entries ---
Entry #: 2
  MRU: 0
  Path: C:\temp\test.xlsx
  Pinned: False
  Created on:    2023-06-24 15:53:43
  Last modified: 2023-06-24 17:56:09
  Hostname: HLPC01
  Interaction count: 2

--- Lnk information ---
  Absolute path: My Computer\C:\temp\test.xlsx
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

We can conclude:
 - `Microsoft Office Excel x64` was executed
 - `C:\temp\test.xlsx` existed at some point on the local disk
 - The user `john.doe` executed Excel and accessed `C:\temp\test.xlsx`
 - `C:\temp\test.xlsx` was opened using `Microsoft Office Excel x64`
 - `C:\temp\test.xlsx` was accessed twice using Excel
 - The last known time Excel was used to access `C:\temp\test.xlsx` was at `2023-06-24 17:56:09`

We can gather more information given the Creation/Modification timestamps of the AutomaticDestinations file `b8ab77100df80ab2.automaticDestinations-ms` itself:

 - The creation timestamp of the file `b8ab77100df80ab2.automaticDestinations-ms` is `2022-02-12 15:22:00`, indicating that (given the AutomaticDestinations files were not deleted) Excel was first used to access files at `2022-02-12 15:22:00`
 - The modification timestamp of the file is `2023-06-24 17:56:09`, indicating that this was the last time Excel was used to access a file. As this is the `Last modified` timestamp of the entry for `C:\temp\test.xlsx`, we can conclude this is the last known file that Excel accessed on this system, corroborated by its `MRU` value of 0. 

As the AutomaticDestinations file is a collection of LNK files, JLECmd offers an additional option to parse these as well through the `--ld` flag. We can get a lot more information this way, for example, accessing a file (`Y:\Documents\new.xlsx`) on a mapped network share (at `192.168.0.20`):

```
Entry #: 3
  MRU: 0
  Path: Y:\Documents\new.xlsx
  Pinned: False
  Created on:    1582-10-15 00:00:00
  Last modified: 2023-06-24 18:06:38
  Hostname:
  Mac Address: fc:0c:00:00:00:00
  Interaction count: 4

--- Lnk information ---

--- Link information ---
Flags: CommonNetworkRelativeLinkAndPathSuffix

  Network share information
    Device name: Y:
    Share name: \\192.168.0.20\Documents
    Provider type: WnncNetLanman
    Share flags: 3

  Common path: Documents\new.xlsx
  Absolute path: My Computer\Y:\Documents\new.xlsx
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

In this case, the file was accessed 4 times, and the most recent time it was accessed using Excel was at `2023-06-24 18:06:38`.
```

`file-activity/detectionhistory.md`:

```md
# Windows Defender Detection History Files
Detection history files are an artifact present on endpoints with Windows Defender installed and with Real-Time Protection enabled. In the event that defender quarantines/removes a potentially malicious item, a detection history file is created to record the event.

### Behavioral Indications
 - [x] Behavioral - Execution (TA0002)

### Analysis Value
 - [x] Execution - Evidence of Execution
 - [x] File - Path
 - [x] File - Hash

## Operating System Availability
 - Windows Defender

## Artifact Location(s)
 - `%ProgramData%\Microsoft\Windows Defender\Scans\History\Service\DetectionHistory\[0-9]*\`

## Artifact Parsers
 - KAPE (Extraction and Parsing)
 - [defender-detectionhistory-parser](https://github.com/jklepsercyber/defender-detectionhistory-parser)

## Artifact Interpretation
The presence of this artifact indicates that the file the artifact was created for existed on the disk, and that it was flagged as malicious and quarantined/removed by Windows Defender. When parsed, it provides basic information such as what class of threat (Trojan, RAT, etc.) the file is, as well as additional metadata such as:

 - The file's SHA-256 and MD5 hash
 - The user responsible for the file's creation
 - The process responsible for the file's creation

In the event that the malicious item is a registry key, the registry key will be present in this artifact.

More detailed information regarding the structure of this artifact can be found [here](https://github.com/libyal/dtformats/blob/main/documentation/Windows%20Defender%20scan%20DetectionHistory%20file%20format.asciidoc).
```

`file-activity/mft.md`:

```md
# Master File Table
The Mast File Table (MFT) is a forensic artifact present on NTFS volumes that maintains a record of every file on the volume (inlcuding itself), providing detailed timestamps, size information, alternate data streams, access control lists, and more. In some cases, the MFT may even include "resident" files that can be extracted directly from the MFT without having the rest of the volume. 

### Analysis Value
 - [x] File - Creation
 - [x] File - Last Modified
 - [x] File - Path
 - [x] File - Size

## Operating System Availability
 - NTFS Volumes

## Artifact Location(s)
 - `$MFT`

## Artifact Parsers
 - Velociraptor
 - jp (TZWorks)
 - MFTEcmd (Eric Zimmerman)
 - KAPE can be used to extract

## Artifact Interpretation

WIP

### Resident Files
Depending on certain filesystem variables, some files may be "resident" within the MFT, meaning the entire file's contents are contained in its MFT entry. The maximum size limit is typically around 600 bytes. 

## Caveats
The MFT when extracted may not show deleted (deallocated) files. Consider searching MFTs located in Volume Shadow Copies for evidence of deleted files, or the USN Journal if the time range is appropriate. 
```

`file-activity/recycle-bin-files.md`:

```md
# Recycle Bin $I/$R Files
In modern versions of Windows, when a file is deleted, it is sent to the Recycle Bin first. Under the hood this constitutes the creation of two unique files prepended by `$I` and `$R` and appended with the original file's extension such as:

 - `$RMYY8AS.txt`
 - `$IMYY8AS.txt`

The `$I` file contains information about the deleted file. The `$R` file contains the full contents of that deleted file.

### Analysis Value
 - [x] Account - Security Identifier (SID)
 - [x] File - Deletion
 - [x] File - Size
 - [x] File - Path

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista

## Artifact Location(s)
 - `C:\$Recycle.Bin\{USER_SID}`

## Artifact Parsers
 - KAPE (Extraction and Parsing)
 - [RBCmd](https://github.com/EricZimmerman/RBCmd)

## Artifact Interpretation
The presence of this artifact indicates that a file was deleted and sent to the recycle bin.

The user who deleted the file will have their SID shown as the parent directory for the `$I` and `$R` files, for example:

 - `C:\$Recycle.Bin\S-1-5-21-3471133136-2963561160-3931775028-1000\$RMYY8AS.txt`
 - `C:\$Recycle.Bin\S-1-5-21-3471133136-2963561160-3931775028-1000\$IMYY8AS.txt`

In this case, `S-1-5-21-3471133136-2963561160-3931775028-1000` is the User SID. 

The `$R` file contains the full contents of the original deleted file. 

The `$I` file contains the following data:

 - Size of the original file
 - Full path of the original file
 - Deletion time and date

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`file-activity/usn-journal.md`:

```md
# USN Journal
The USN Journal is an artifact present on NTFS volumes that functions as the filesystem's journal. This artifact contains high-level records of operations taken on the filesystem. This artifact is present in volume shadow copies which may provide additional historical data. 

### Analysis Value
 - [x] File - Creation
 - [x] File - Deletion
 - [x] File - Last Modified
 - [x] File - Path
 - [x] File - Size

## Operating System Availability
 - NTFS Volumes

## Artifact Location(s)
 - `$Extend\$UsnJrnl\$J`

## Artifact Parsers
 - Velociraptor
 - jp (TZWorks)
 - MFTEcmd (Eric Zimmerman)
 - KAPE can be used to extract

## Artifact Interpretation
Below are several common USN Journal events:

| Event Code | Value | Description |
| - | - | - |
| USN_REASON_FILE_CREATE | 0x00000100 | File or directory has been created |
| USN_REASON_FILE_DELETE | 0x00000200 | File or directory has been deleted |
| USN_REASON_RENAME_NEW_NAME | 0x00002000 | File has been renamed (provides the new name) |
| USN_REASON_RENAME_OLD_NAME | 0x00001000 | File has been renamed (provides the old name) |
| USN_REASON_STREAM_CHANGE | 0x00200000 | An Alternate Data Stream has been added or removed or renamed from a file |
| USN_REASON_NAMED_DATA_EXTEND | 0x00000020 | An Alternate Data Stream has been added to |
| USN_REASON_DATA_EXTEND | 0x00000002 | File modification |
| USN_REASON_DATA_OVERWRITE | 0x00000001 | File modification |
| USN_REASON_DATA_TRUNCATION | 0x00000004 | File modification |
| USN_REASON_BASIC_INFO_CHANGE | 0x00008000 | File attributes have been modified |
| USN_REASON_SECURITY_CHANGE | 0x00000800 | File ownership/access writes have been modified |

### Example: File Creation and Deletion
In this example, we created a file `test.txt`, modified its contents, and then deleted it. The resulting information from the USN Journal is as follows:

| Timestamp              | Filename              | Update Reason               |
| ---------------------- | --------------------- | --------------------------- |
| 2023-04-26 23:51:09.09 | New Text Document.txt | FileCreate                  |
| 2023-04-26 23:51:09.09 | New Text Document.txt | FileCreate,Close            |
| 2023-04-26 23:51:16.16 | New Text Document.txt | RenameOldName               |
| 2023-04-26 23:51:16.16 | test.txt              | RenameNewName               |
| 2023-04-26 23:51:16.16 | test.txt              | RenameNewName,Close         |
| 2023-04-26 23:51:22.22 | test.txt              | DataExtend                  |
| 2023-04-26 23:51:22.22 | test.txt              | DataExtend,Close            |
| 2023-04-26 23:51:29.29 | $I4NTH4K.txt          | FileCreate                  |
| 2023-04-26 23:51:29.29 | $I4NTH4K.txt          | DataExtend,FileCreate       |
| 2023-04-26 23:51:29.29 | $I4NTH4K.txt          | DataExtend,FileCreate,Close |
| 2023-04-26 23:51:29.29 | test.txt              | RenameOldName               |
| 2023-04-26 23:51:29.29 | $R4NTH4K.txt          | RenameNewName               |
| 2023-04-26 23:51:29.29 | $R4NTH4K.txt          | RenameNewName,Close         |
| 2023-04-26 23:51:29.29 | $R4NTH4K.txt          | SecurityChange              |
| 2023-04-26 23:51:29.29 | $R4NTH4K.txt          | SecurityChange,Close        |

In this example, we first see that a new text file is created, called `New Text Document.txt` (`FileCreate`), indicating that it was likely created by right-clicking in Explorer. It is then renamed to `test.txt` (`RenameNewName`). Afterwards, its contents are modified (`DataExtend`). The file is then "deleted," being sent to the recycle bin. This is evidenced by the creation of the `$I` and `$R` files. As expected, the `$R4NTH4K.txt` file should contain the full contents of the deleted file, and we see that Windows simply renames the original file to this. 

> [!NOTE]
> More information on [Recycle Bin $I/$R Files](/file-activity/recycle-bin-files.md)

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

### Example: Moving a File
In this example, a file has been moved to a different directory. In this instance, while the filename remains the same, we see that the update reasons `RenameOldName` and `RenameNewName` are present. The parent entry numbers (as well as the parent sequence numbers, not shown in this table) change, indicating that the file has been moved to a different directory. 

| Timestamp              | Parent Entry Number | Filename              | Update Reason        |
| ---------------------- | ------------------- | --------------------- | -------------------- |
| 2023-04-26 23:51:41.41 | 114291              | test2.txt             | RenameOldName        |
| 2023-04-26 23:51:41.41 | 101882              | test2.txt             | RenameNewName        |
| 2023-04-26 23:51:41.41 | 101882              | test2.txt             | RenameNewName,Close  |
| 2023-04-26 23:51:41.41 | 101882              | test2.txt             | SecurityChange       |
| 2023-04-26 23:51:41.41 | 101882              | test2.txt             | SecurityChange,Close |

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

### Example: Correlation with Prefetch
| UpdateTimestamp        | Name                    | UpdateReasons                   |
| ---------------------- | ----------------------- | ------------------------------- |
| 2023-04-26 23:51:16.16 | New Text Document.txt   | RenameOldName                   |
| 2023-04-26 23:51:16.16 | test.txt                | RenameNewName                   |
| 2023-04-26 23:51:22.22 | test.txt                | DataExtend                      |
| 2023-04-26 23:51:22.22 | test.txt                | DataExtend,Close                |
| 2023-04-26 23:51:23.23 | NOTEPAD.EXE-9FB27C0E.pf | DataTruncation                  |
| 2023-04-26 23:51:23.23 | NOTEPAD.EXE-9FB27C0E.pf | DataExtend,DataTruncation       |
| 2023-04-26 23:51:23.23 | NOTEPAD.EXE-9FB27C0E.pf | DataExtend,DataTruncation,Close |


In this example, we see that `notepad.exe` was likely executed to edit `text.txt`. This is particularly valuable as the [Prefetch](/execution/prefetch.md) artifact only stores the last 8 execution timestamps of an application, but it is updated for each execution, meaning the USN Journal may provide additional execution timestamps that have rolled out of the Prefetch file. 

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

## Caveats
The USN Journal is limited in size and therefore only recent activity will be reflected in this file. Depending on the amount of filesystem activity on a volume this artifact may only provide several days (or even hours) of coverage. A potential workaround to obtain more history from this artifact would be to extract a copy of it from any available Volume Shadow Copies present on the NTFS volume. 
```

`file-activity/zone-identifier.md`:

```md
# NTFS Zone Identifiers
Zone Identifiers are an artifact that reside in alternate data streams within an NTFS volume. This artifact is used to determine the origins of a file on a disk.

> [!NOTE]
> In Windows XP, only executable files will be tagged with a Zone Identifier. Later operating systems will tag all files.

### Analysis Value
 - [x] File - Creation
 - [x] File - Origin

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP

## Artifact Location(s)
This artifact is present in an alternate data stream (ADS) of the file of interest for analysis. 

## Artifact Parsers
 - FTK Imager
 - KAPE
 - MFTEcmd

## Artifact Interpretation
The following Zone IDs are available:

| Zone ID | Description |
| - | - |
| -1 | No Zone |
| 0 | My Computer |
| 1 | Intranet |
| 2 | Trusted |
| 3 | Internet (AKA Mark of the Web) |
| 4 | Untrusted |

A Zone Identifier of 4 indicates that Microsoft SmartScreen has determined a file is suspicious.

As an example, a Zone.Identifier file may look like this:

```
[ZoneTransfer]
ZoneId=3
ReferrerUrl=http://example.com/example.exe
HostUrl=http://example.com/example.exe
```

In this example, in addition to the Zone Identifier being present, the associated URLs are also noted as well. This behavior is dependent on the application used to download the file. Browsers such as Chrome and Microsoft Edge will append this information to the Zone.Identifier file.

> [!IMPORTANT]
> Some software does not assign Zone Identifiers to files that originate from the internet, such as git. Other software, such as 7zip, may or may not assign Zone Identifiers. 
```

`network/evtx-1024-rdp-activex.md`:

```md
# TerminalServices-RDPClient/Operational/1024: RDP ClientActiveX is trying to connect to the server
This event, logged to the TerminalServices-RDPClient/Operational channel, is logged when an RDP session is attempted to a remote endpoint. 

> [!IMPORTANT]  
> This event is logged on the **source** endpoint. 

### Behavioral Indications
 - [x] Behavioral - Lateral Movement (TA0008)

### Analysis Value
 - [x] Execution - Process Tree
 - [x] Account - Security Identifier (SID)
 - [x] Network - Evidence of Network Activity
 - [x] Network Activity - Destination Identification

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-TerminalServices-RDPClient%4Operational.evtx`

## Artifact Interpretation
This artifact can provide the **destination** IP address (or hostname) of an *attempted* RDP session. It will also provide the SID of the user who initiated the *attempted* connection, as well as the ProcessID associated with this activity. 

## Caveats
This event is logged regardless of success or failure of the RDP session, and must be cross-referenced with other events such as [4624: An account was successfully logged on](/account/evtx-4624-successful-logon.md) on the destination host.

If available, a successful RDP authentication is indicated by the event ID `TerminalServices-RDPClient/Operational/1027: Connected to domain`. To correlate these two Event IDs, compare their `Correlation ActivityID` field values.

When the RDP session is ended, either due to a failure to connect, a failure to successfully authenticate, or a manual close of the session, `TerminalServices-RDPClient/Operational/1105: The multi-transport connection has been disconnected` and `TerminalServices-RDPClient/Operational/1026: RDP ClientActiveX has been disconnected` should be logged, and is likewise able to be correlated by its `Correlation ActivityID` field. This allows for determining a time span during which an RDP session was in progress.

## Example
In the following example, the user with SID `S-1-5-21-3471133136-2963561160-3931775028-1001` attempted to RDP to a system at IP address `192.168.116.74`. The connection was not successfull, resulting in `TerminalServices-RDPClient/Operational/1026: RDP ClientActiveX has been disconnected` being logged with the same `Correlation ActivityID` value of `{780cf827-0ed1-4f4b-924c-3b14e7660000}`. 

```
- <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <System>
  <Provider Name="Microsoft-Windows-TerminalServices-ClientActiveXCore" Guid="{28aa95bb-d444-4719-a36f-40462168127e}" /> 
  <EventID>1024</EventID> 
  <Version>0</Version> 
  <Level>4</Level> 
  <Task>101</Task> 
  <Opcode>10</Opcode> 
  <Keywords>0x4000000000000000</Keywords> 
  <TimeCreated SystemTime="2023-07-14T14:06:31.9398747Z" /> 
  <EventRecordID>1641</EventRecordID> 
  <Correlation ActivityID="{780cf827-0ed1-4f4b-924c-3b14e7660000}" /> 
  <Execution ProcessID="11136" ThreadID="3624" /> 
  <Channel>Microsoft-Windows-TerminalServices-RDPClient/Operational</Channel> 
  <Computer>HLPC01</Computer> 
  <Security UserID="S-1-5-21-3471133136-2963561160-3931775028-1001" /> 
  </System>
- <EventData>
  <Data Name="Name">Server Name</Data> 
  <Data Name="Value">192.168.116.74</Data> 
  <Data Name="CustomLevel">Info</Data> 
  </EventData>
  </Event>
```

```
- <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <System>
  <Provider Name="Microsoft-Windows-TerminalServices-ClientActiveXCore" Guid="{28aa95bb-d444-4719-a36f-40462168127e}" /> 
  <EventID>1026</EventID> 
  <Version>0</Version> 
  <Level>4</Level> 
  <Task>101</Task> 
  <Opcode>11</Opcode> 
  <Keywords>0x4000000000000000</Keywords> 
  <TimeCreated SystemTime="2023-07-14T14:06:33.6543161Z" /> 
  <EventRecordID>1643</EventRecordID> 
  <Correlation ActivityID="{780cf827-0ed1-4f4b-924c-3b14e7660000}" /> 
  <Execution ProcessID="11136" ThreadID="3624" /> 
  <Channel>Microsoft-Windows-TerminalServices-RDPClient/Operational</Channel> 
  <Computer>HLPC01</Computer> 
  <Security UserID="S-1-5-21-3471133136-2963561160-3931775028-1001" /> 
  </System>
- <EventData>
  <Data Name="Name">Disconnect Reason</Data> 
  <Data Name="Value">1</Data> 
  <Data Name="CustomLevel">Info</Data> 
  </EventData>
  </Event>
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`network/evtx-2004-firewall.md`:

```md
# Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2004: Firewall Rule Added
This event indicates that a new firewall rule has been added to the Windows Firewall.

> [!NOTE]
> In recent builds of Windows 11, this event has been replaced by a new event ID, [Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2071: Firewall Rule Added](/network/evtx-2071-firewall-windows-11.md).

### Analysis Value
 - [x] Account - Security Identifier (SID)
 - [x] Execution - Full Path
 - [x] Execution - Permissions / Account
 - [x] Execution - Process Tree
 - [x] Execution - Evidence of Execution
 - [x] Network Activity - Firewall Activity

## Operating System Availability
 - [x] Windows 11 (⚠️ Event ID changed to 2071)
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-Windows Firewall With Advanced Security%4Firewall.evtx`

## Artifact Interpretation
### Account - Security Identifier (SID)
The `System/Security/UserID` and `EventData/ModifyingUser` fields of this event provides the [Security Identifier (SID)](/README.md/#account---security-identifier-sid) of the account that added the new firewall rule.

### Execution - Full Path
The full image path for the process that added the new firewall rule will be available in the `EventData/ModifyingApplication` field of this event. 

### Execution - Permissions / Account
The `System/Security/UserID` and `EventData/ModifyingUser` fields of this event provides the [Security Identifier (SID)](/README.md/#account---security-identifier-sid) of the account that added the new firewall rule.

### Execution - Process Tree
The Process and Thread ID of the process that created the new firewall rule will be available in the `System/Execution/ProcessID` and `System/Execution/ThreadID` fields of this event, respectively. 

### Execution - Evidence of Execution
The presence of this event indicates that the executable present in the `EventData/ModifyingApplication` field of this event was run.

### Network Activity - Firewall Activity
The presence of this event indicates that the firewall was modified by adding a new rule. This may be indicative of attacker activity. There are many legitimate processes such as `svchost.exe` that will be observed modifying the Windows Firewall, so this event should be correlated with others.

### Additional Fields
The following additional fields are available in this event:

| XML Path                  | Interpretation                                                            |
| ------------------------- | ------------------------------------------------------------------------- |
| EventData/RuleId          | A GUID for the new firewall rule                                          |
| EventData/RuleName        | The name for the firewall rule as it appears in the Windows Firewall      |
| EventData/Direction       | 1 for inbound rules and 2 for outbound rules                              |
| EventData/Profiles        | What profiles (Private/Domain/Public) this rule applies to.               |
| EventData/Active          | 0 for disabled rules and 1 for enabled rules                              |
| EventData/Action          | 3 for allow and 2 for block                                               |
| EventData/SecurityOptions | 0 for none and 1 for require authentication                               |
| EventData/ApplicationPath | If the rule applies only to a specific application it will be listed here |
| EventData/ServiceName     | If the rule applies only to a specific service it will be listed here     |


## Example - Windows 10
On an example system, a new Windows Firewall rule was added from the command line, causing the following event to be logged:

```
- 
<Event
	xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
-   <System>
		<Provider Name="Microsoft-Windows-Windows Firewall With Advanced Security" Guid="{d1bc9aff-2abf-4d71-9146-ecb2a986eb85}" />
		<EventID>2004</EventID>
		<Version>0</Version>
		<Level>4</Level>
		<Task>0</Task>
		<Opcode>0</Opcode>
		<Keywords>0x8000020000000000</Keywords>
		<TimeCreated SystemTime="2023-05-04T17:01:45.8409961Z" />
		<EventRecordID>6661</EventRecordID>
		<Correlation />
		<Execution ProcessID="2352" ThreadID="19044" />
		<Channel>Microsoft-Windows-Windows Firewall With Advanced Security/Firewall</Channel>
		<Computer>HLPC01</Computer>
		<Security UserID="S-1-5-19" />
	</System>
-   <EventData>
		<Data Name="RuleId">{8736B31E-8792-452E-8D2D-C45621F236AF}</Data>
		<Data Name="RuleName">Open SSH Port 22</Data>
		<Data Name="Origin">1</Data>
		<Data Name="ApplicationPath" />
		<Data Name="ServiceName" />
		<Data Name="Direction">1</Data>
		<Data Name="Protocol">6</Data>
		<Data Name="LocalPorts">22</Data>
		<Data Name="RemotePorts">*</Data>
		<Data Name="Action">3</Data>
		<Data Name="Profiles">2147483647</Data>
		<Data Name="LocalAddresses">*</Data>
		<Data Name="RemoteAddresses">*</Data>
		<Data Name="RemoteMachineAuthorizationList" />
		<Data Name="RemoteUserAuthorizationList" />
		<Data Name="EmbeddedContext" />
		<Data Name="Flags">1</Data>
		<Data Name="Active">1</Data>
		<Data Name="EdgeTraversal">0</Data>
		<Data Name="LooseSourceMapped">0</Data>
		<Data Name="SecurityOptions">0</Data>
		<Data Name="ModifyingUser">S-1-5-21-3471133136-2963561160-3931775028-1001</Data>
		<Data Name="ModifyingApplication">C:\Windows\System32\netsh.exe</Data>
		<Data Name="SchemaVersion">542</Data>
		<Data Name="RuleStatus">65536</Data>
		<Data Name="LocalOnlyMapped">0</Data>
	</EventData>
</Event>
```

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

The following command was executed to create the new firewall rule:

```
netsh advfirewall firewall add rule name="Open SSH Port 22" dir=in action=allow protocol=TCP localport=22 remoteip=any
```

## Example - Windows 11
The same command, when executed on a Windows 11 system, results in the following event being logged:

```
- 
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
-   <System>
		<Provider Name="Microsoft-Windows-Windows Firewall With Advanced Security" Guid="{d1bc9aff-2abf-4d71-9146-ecb2a986eb85}" />
		<EventID>2071</EventID>
		<Version>0</Version>
		<Level>4</Level>
		<Task>0</Task>
		<Opcode>0</Opcode>
		<Keywords>0x8000020000000000</Keywords>
		<TimeCreated SystemTime="2023-09-27T01:09:12.7137288Z" />
		<EventRecordID>545</EventRecordID>
		<Correlation />
		<Execution ProcessID="2704" ThreadID="3624" />
		<Channel>Microsoft-Windows-Windows Firewall With Advanced Security/Firewall</Channel>
		<Computer>W11</Computer>
		<Security UserID="S-1-5-19" />
	</System>
-   <EventData>
		<Data Name="RuleId">{0D458E97-4EC5-4C5C-A5A4-F9F73E769168}</Data>
		<Data Name="RuleName">Open SSH Port 22</Data>
		<Data Name="Origin">1</Data>
		<Data Name="ApplicationPath" />
		<Data Name="ServiceName" />
		<Data Name="Direction">1</Data>
		<Data Name="Protocol">6</Data>
		<Data Name="LocalPorts">22</Data>
		<Data Name="RemotePorts">*</Data>
		<Data Name="Action">3</Data>
		<Data Name="Profiles">2147483647</Data>
		<Data Name="LocalAddresses">*</Data>
		<Data Name="RemoteAddresses">*</Data>
		<Data Name="RemoteMachineAuthorizationList" />
		<Data Name="RemoteUserAuthorizationList" />
		<Data Name="EmbeddedContext" />
		<Data Name="Flags">1</Data>
		<Data Name="Active">1</Data>
		<Data Name="EdgeTraversal">0</Data>
		<Data Name="LooseSourceMapped">0</Data>
		<Data Name="SecurityOptions">0</Data>
		<Data Name="ModifyingUser">S-1-5-21-937911350-1118943250-2293061635-1001</Data>
		<Data Name="ModifyingApplication">C:\Windows\System32\netsh.exe</Data>
		<Data Name="SchemaVersion">544</Data>
		<Data Name="RuleStatus">65536</Data>
		<Data Name="LocalOnlyMapped">0</Data>
		<Data Name="ErrorCode">0</Data>
	</EventData>
</Event>
```

<sup><sub>This example was produced on Windows 11, Version 10.0.22621 Build 22621</sub></sup>
```

`network/evtx-2005-firewall.md`:

```md
# Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2005: Firewall Rule Modified
This event indicates that a firewall rule has been modified. The contents of this event will contain the new parameters of the firewall rule.

> [!NOTE]
> In recent builds of Windows 11, this event has been replaced by a new event ID, [Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2073: Firewall Rule Modified](/network/evtx-2073-firewall-windows-11.md).

### Analysis Value
 - [x] Account - Security Identifier (SID)
 - [x] Execution - Full Path
 - [x] Execution - Permissions / Account
 - [x] Execution - Process Tree
 - [x] Execution - Evidence of Execution
 - [x] Network Activity - Firewall Activity


## Operating System Availability
 - [x] Windows 11 (⚠️ Event ID changed to 2073)
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-Windows Firewall With Advanced Security%4Firewall.evtx`

## Artifact Interpretation
### Account - Security Identifier (SID)
The `System/Security/UserID` and `EventData/ModifyingUser` fields of this event provides the [Security Identifier (SID)](/README.md/#account---security-identifier-sid) of the account that modified the firewall rule.

### Execution - Full Path
The full image path for the process that modified the firewall rule will be available in the `EventData/ModifyingApplication` field of this event. 

### Execution - Permissions / Account
The `System/Security/UserID` and `EventData/ModifyingUser` fields of this event provides the [Security Identifier (SID)](/README.md/#account---security-identifier-sid) of the account that modified the firewall rule.

### Execution - Process Tree
The Process and Thread ID of the process that modified the firewall rule will be available in the `System/Execution/ProcessID` and `System/Execution/ThreadID` fields of this event, respectively. 

### Execution - Evidence of Execution
The presence of this event indicates that the executable present in the `EventData/ModifyingApplication` field of this event was run.

### Network Activity - Firewall Activity
The presence of this event indicates that the firewall rule specified by the event was modified.

### Additional Fields
The following additional fields are available in this event, and they indicate the new parameters for the firewall rule that was modified:

| XML Path                  | Interpretation                                                            |
| ------------------------- | ------------------------------------------------------------------------- |
| EventData/RuleId          | The firewall rule's GUID                                          |
| EventData/RuleName        | The name for the firewall rule as it appears in the Windows Firewall      |
| EventData/Direction       | 1 for inbound rules and 2 for outbound rules                              |
| EventData/Profiles        | What profiles (Private/Domain/Public) this rule applies to.               |
| EventData/Active          | 0 for disabled rules and 1 for enabled rules                              |
| EventData/Action          | 3 for allow and 2 for block                                               |
| EventData/SecurityOptions | 0 for none and 1 for require authentication                               |
| EventData/ApplicationPath | If the rule applies only to a specific application it will be listed here |
| EventData/ServiceName     | If the rule applies only to a specific service it will be listed here     |


## Example - Windows 10
On an example system, an existing Windows Firewall rule was modified from within the Windows Defender Firewall with Advanced Security control panel, causing the following event to be logged:

```
- 
<Event
	xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
-   <System>
		<Provider Name="Microsoft-Windows-Windows Firewall With Advanced Security" Guid="{d1bc9aff-2abf-4d71-9146-ecb2a986eb85}" />
		<EventID>2005</EventID>
		<Version>0</Version>
		<Level>4</Level>
		<Task>0</Task>
		<Opcode>0</Opcode>
		<Keywords>0x8000020000000000</Keywords>
		<TimeCreated SystemTime="2023-05-04T17:19:02.0655370Z" />
		<EventRecordID>6668</EventRecordID>
		<Correlation />
		<Execution ProcessID="2352" ThreadID="6516" />
		<Channel>Microsoft-Windows-Windows Firewall With Advanced Security/Firewall</Channel>
		<Computer>HLPC01</Computer>
		<Security UserID="S-1-5-19" />
	</System>
-   <EventData>
		<Data Name="RuleId">{8736B31E-8792-452E-8D2D-C45621F236AF}</Data>
		<Data Name="RuleName">Open SSH Port 22</Data>
		<Data Name="Origin">1</Data>
		<Data Name="ApplicationPath"></Data>
		<Data Name="ServiceName" />
		<Data Name="Direction">1</Data>
		<Data Name="Protocol">6</Data>
		<Data Name="LocalPorts">22</Data>
		<Data Name="RemotePorts">*</Data>
		<Data Name="Action">2</Data>
		<Data Name="Profiles">2147483647</Data>
		<Data Name="LocalAddresses">*</Data>
		<Data Name="RemoteAddresses">*</Data>
		<Data Name="RemoteMachineAuthorizationList" />
		<Data Name="RemoteUserAuthorizationList" />
		<Data Name="EmbeddedContext" />
		<Data Name="Flags">0</Data>
		<Data Name="Active">0</Data>
		<Data Name="EdgeTraversal">0</Data>
		<Data Name="LooseSourceMapped">0</Data>
		<Data Name="SecurityOptions">0</Data>
		<Data Name="ModifyingUser">S-1-5-21-3471133136-2963561160-3931775028-1001</Data>
		<Data Name="ModifyingApplication">C:\Windows\System32\mmc.exe</Data>
		<Data Name="SchemaVersion">542</Data>
		<Data Name="RuleStatus">65536</Data>
		<Data Name="LocalOnlyMapped">0</Data>
	</EventData>
</Event>
```

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

## Example - Windows 11
On an example system, an existing Windows Firewall rule was modified from within the Windows Defender Firewall with Advanced Security control panel, causing the following event to be logged:

```
- 
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
-   <System>
		<Provider Name="Microsoft-Windows-Windows Firewall With Advanced Security" Guid="{d1bc9aff-2abf-4d71-9146-ecb2a986eb85}" />
		<EventID>2073</EventID>
		<Version>0</Version>
		<Level>4</Level>
		<Task>0</Task>
		<Opcode>0</Opcode>
		<Keywords>0x8000020000000000</Keywords>
		<TimeCreated SystemTime="2023-09-27T01:09:54.9122530Z" />
		<EventRecordID>550</EventRecordID>
		<Correlation />
		<Execution ProcessID="2704" ThreadID="3624" />
		<Channel>Microsoft-Windows-Windows Firewall With Advanced Security/Firewall</Channel>
		<Computer>W11</Computer>
		<Security UserID="S-1-5-19" />
	</System>
-   <EventData>
		<Data Name="RuleId">{0D458E97-4EC5-4C5C-A5A4-F9F73E769168}</Data>
		<Data Name="RuleName">Open SSH Port 22</Data>
		<Data Name="Origin">1</Data>
		<Data Name="ApplicationPath" />
		<Data Name="ServiceName" />
		<Data Name="Direction">1</Data>
		<Data Name="Protocol">6</Data>
		<Data Name="LocalPorts">22</Data>
		<Data Name="RemotePorts">*</Data>
		<Data Name="Action">3</Data>
		<Data Name="Profiles">2147483647</Data>
		<Data Name="LocalAddresses">*</Data>
		<Data Name="RemoteAddresses">*</Data>
		<Data Name="RemoteMachineAuthorizationList" />
		<Data Name="RemoteUserAuthorizationList" />
		<Data Name="EmbeddedContext" />
		<Data Name="Flags">0</Data>
		<Data Name="Active">0</Data>
		<Data Name="EdgeTraversal">0</Data>
		<Data Name="LooseSourceMapped">0</Data>
		<Data Name="SecurityOptions">0</Data>
		<Data Name="ModifyingUser">S-1-5-21-937911350-1118943250-2293061635-1001</Data>
		<Data Name="ModifyingApplication">C:\Windows\System32\mmc.exe</Data>
		<Data Name="SchemaVersion">544</Data>
		<Data Name="RuleStatus">65536</Data>
		<Data Name="LocalOnlyMapped">0</Data>
		<Data Name="ErrorCode">0</Data>
	</EventData>
</Event>
```

<sup><sub>This example was produced on Windows 11, Version 10.0.22621 Build 22621</sub></sup>
```

`network/evtx-2006-firewall.md`:

```md
# Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2006: Firewall Rule Deleted
This event indicates that a firewall rule has been deleted.

> [!NOTE]
> In recent builds of Windows 11, this event has been replaced by a new event ID, [Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2052: Firewall Rule Deleted](/network/evtx-2052-firewall-windows-11.md).

### Analysis Value
 - [x] Account - Security Identifier (SID)
 - [x] Execution - Full Path
 - [x] Execution - Permissions / Account
 - [x] Execution - Process Tree
 - [x] Execution - Evidence of Execution
 - [x] Network Activity - Firewall Activity

## Operating System Availability
 - [x] Windows 11 (⚠️ Event ID changed to 2052)
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-Windows Firewall With Advanced Security%4Firewall.evtx`

## Artifact Interpretation
### Account - Security Identifier (SID)
The `System/Security/UserID` and `EventData/ModifyingUser` fields of this event provides the [Security Identifier (SID)](/README.md/#account---security-identifier-sid) of the account that deleted the firewall rule.

### Execution - Full Path
The full image path for the process that deleted the firewall rule will be available in the `EventData/ModifyingApplication` field of this event. 

### Execution - Permissions / Account
The `System/Security/UserID` and `EventData/ModifyingUser` fields of this event provides the [Security Identifier (SID)](/README.md/#account---security-identifier-sid) of the account that deleted the firewall rule.

### Execution - Process Tree
The Process and Thread ID of the process that deleted the firewall rule will be available in the `System/Execution/ProcessID` and `System/Execution/ThreadID` fields of this event, respectively. 

### Execution - Evidence of Execution
The presence of this event indicates that the executable present in the `EventData/ModifyingApplication` field of this event was run.

### Network Activity - Firewall Activity
The presence of this event indicates that the firewall rule specified by the event was deleted.

### Additional Fields
The following additional fields are available in this event, and they indicate the new parameters for the firewall rule that was deleted:

| XML Path                  | Interpretation                                                            |
| ------------------------- | ------------------------------------------------------------------------- |
| EventData/RuleId          | The firewall rule's GUID                                          |
| EventData/RuleName        | The name for the firewall rule as it appears in the Windows Firewall      |

## Example - Windows 10
On an example system, an existing Windows Firewall rule was deleted from within the Windows Defender Firewall with Advanced Security control panel, causing the following event to be logged:

```
- 
<Event
	xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
-   <System>
		<Provider Name="Microsoft-Windows-Windows Firewall With Advanced Security" Guid="{d1bc9aff-2abf-4d71-9146-ecb2a986eb85}" />
		<EventID>2006</EventID>
		<Version>0</Version>
		<Level>4</Level>
		<Task>0</Task>
		<Opcode>0</Opcode>
		<Keywords>0x8000020000000000</Keywords>
		<TimeCreated SystemTime="2023-05-04T17:26:06.0482710Z" />
		<EventRecordID>6669</EventRecordID>
		<Correlation />
		<Execution ProcessID="2352" ThreadID="18980" />
		<Channel>Microsoft-Windows-Windows Firewall With Advanced Security/Firewall</Channel>
		<Computer>HLPC01</Computer>
		<Security UserID="S-1-5-19" />
	</System>
-   <EventData>
		<Data Name="RuleId">{8736B31E-8792-452E-8D2D-C45621F236AF}</Data>
		<Data Name="RuleName">Open SSH Port 22</Data>
		<Data Name="ModifyingUser">S-1-5-21-3471133136-2963561160-3931775028-1001</Data>
		<Data Name="ModifyingApplication">C:\Windows\System32\mmc.exe</Data>
	</EventData>
</Event>
```

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

## Example - Windows 11
The same activity, when reproduced on a Windows 11 system, results in the following event being logged:

```
- 
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
-   <System>
		<Provider Name="Microsoft-Windows-Windows Firewall With Advanced Security" Guid="{d1bc9aff-2abf-4d71-9146-ecb2a986eb85}" />
		<EventID>2052</EventID>
		<Version>0</Version>
		<Level>4</Level>
		<Task>0</Task>
		<Opcode>0</Opcode>
		<Keywords>0x8000020000000000</Keywords>
		<TimeCreated SystemTime="2023-09-27T01:10:00.0598218Z" />
		<EventRecordID>552</EventRecordID>
		<Correlation />
		<Execution ProcessID="2704" ThreadID="3292" />
		<Channel>Microsoft-Windows-Windows Firewall With Advanced Security/Firewall</Channel>
		<Computer>W11</Computer>
		<Security UserID="S-1-5-19" />
	</System>
-   <EventData>
		<Data Name="RuleId">{0D458E97-4EC5-4C5C-A5A4-F9F73E769168}</Data>
		<Data Name="RuleName">Open SSH Port 22</Data>
		<Data Name="ModifyingUser">S-1-5-21-937911350-1118943250-2293061635-1001</Data>
		<Data Name="ModifyingApplication">C:\Windows\System32\mmc.exe</Data>
		<Data Name="ErrorCode">0</Data>
	</EventData>
</Event>
```

<sup><sub>This example was produced on Windows 11, Version 10.0.22621 Build 22621</sub></sup>
```

`network/evtx-2052-firewall-windows-11.md`:

```md
# Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2052: Firewall Rule Deleted
This event indicates that a firewall rule has been deleted from the Windows Firewall. While currently unique to newer versions of Windows 11, it is functionally similar to [Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2006: Firewall Rule Deleted](/network/evtx-2006-firewall.md).
```

`network/evtx-2071-firewall-windows-11.md`:

```md
# Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2071: Firewall Rule Added
This event indicates that a new firewall rule has been added to the Windows Firewall. While currently unique to newer versions of Windows 11, it is functionally similar to [Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2004: Firewall Rule Added](/network/evtx-2004-firewall.md).
```

`network/evtx-2073-firewall-windows-11.md`:

```md
# Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2073: Firewall Rule Modified
This event indicates that a Windows Defender Firewall rule has been modified. While currently unique to newer versions of Windows 11, it is functionally similar to [Microsoft-Windows-Windows Firewall With Advanced Security/Firewall/2005: Firewall Rule Modified](/network/evtx-2005-firewall.md).
```

`network/evtx-4778-session-reconnected.md`:

```md
# Security/4778: Session reconnected
This event, logged to the Security channel, is logged when an existing RDP terminal session is connected to, but it may also be logged as a result of Fast User Switching. Fast User Switching is a feature in newer versions of Windows (Vista+) that allows multiple users to be logged in to a single system concurrently. 

> [!IMPORTANT]  
> This event is logged on the **destination** endpoint. 

> [!NOTE]
> In windows XP, the corresponding Event ID is `682`.

### Behavioral Indications
 - [x] Behavioral - Lateral Movement (TA0008)

### Analysis Value
 - [x] Account - Login History
 - [x] Account - Logon ID
 - [x] Network Activity - Source Identification

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2008

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Security.evtx`

## Artifact Interpretation
This artifact can provide the **source** client name and IP address of the connecting endpoint. 

The fields may be interpreted as follows:

| Field Name | Interpretation |
| - | - |
| Subject / Account Name | The name of the account for this RDP session |
| Subject / Logon ID | [Logon ID](/README.md/#account---logon-id) for this session that can be used to correlate with other events |
| Additional Information / Client Name | The name of the source host |
| Additional Information / Client Address | The IP address of the source host |

## Caveats
This event is not unique to RDP sessions. During Fast User Switching events, this event will be logged with the session name set to `Console` and the Client Address set to `LOCAL`. For RDP sessions, the session name will look like: `RDP-Tcp#1`.
```

`network/evtx-5156-wfp-permitted.md`:

```md
# Security/5156: The Windows Filtering Platform has permitted a connection
This event indicates that the Windows Filtering Platform (WFP) has allowed an inbound or outbound connection to be placed. This is a high-volume event and is, by default, disabled. 

To enable it, the System Audit Polict `Windows Filtering Platform Connection` must be configured for Success and/or Failure auditing. This allows for the logging of events when:

 - The Windows Firewall Service blocks an application from accepting incoming connections on the network.
 - The WFP allows a connection.
 - The WFP blocks a connection.
 - The WFP permits a bind to a local port.
 - The WFP blocks a bind to a local port.
 - The WFP allows a connection.
 - The WFP blocks a connection.
 - The WFP permits an application or service to listen on a port for incoming connections.
 - The WFP blocks an application or service to listen on a port for incoming connections.

### Analysis Value
 - [x] Execution - Evidence of Execution
 - [x] File - Path
 - [x] Network - Evidence of Network Activity
 - [x] Network Activity - Destination Identification
 - [x] Network Activity - Source Identification
 - [x] Network Activity - Firewall Activity

## Operating System Availability
 - [x] Windows 11 (⚠️ Requires audit policy configuration)
 - [x] Windows 10 (⚠️ Requires audit policy configuration)
 - [x] Windows 8 (⚠️ Requires audit policy configuration)
 - [x] Windows 7 (⚠️ Requires audit policy configuration)

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Security.evtx`

## Artifact Interpretation
When logged, this event indicates that Windows Filtering Platform has allowed either an inbound or outbound connection to take place. The following information is provided by the event:

| XML Path                              | Interpretation  |
| ------------------------------------- | --------------- |
| EventData/ProcessID               | The Process ID of the process that spawned or accepted the connection |
| EventData/Application        | The full path of the process that spawned or accepted the connection |
| EventData/Direction                        | %%14592 (Inbound), %%14593 (Outbound) |
| EventData/SourceAddress     | The source IP address of the connection |
| EventData/SourcePort              | The source port of the connection |
| EventData/DestAddress              | The destination IP address of the connection |
| EventData/DestPort              | The destination port of the connection |
| EventData/Protocol              | The protocol used for the connection (i.e 6 for TCP, 1 for ICMP, etc.) |

Some common protocols:

 - 1: ICMP
 - 6: TCP
 - 17: UDP

The complete list of protocols is assigned and made available from IANA (Internet Assigned Numbers Authority).

This event is logged even if the network connection never left the local system (i.e, localhost to localhost network traffic). In this case, the source and destination IP addresses will both be `127.0.0.1`.

## Example
In the following example, a DNS request was made on the local system, causing this event to be logged. Note that the `Protocol` field is `17` for UDP.
```
- <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <System>
  <Provider Name="Microsoft-Windows-Security-Auditing" Guid="{54849625-5478-4994-a5ba-3e3b0328c30d}" /> 
  <EventID>5156</EventID> 
  <Version>1</Version> 
  <Level>0</Level> 
  <Task>12810</Task> 
  <Opcode>0</Opcode> 
  <Keywords>0x8020000000000000</Keywords> 
  <TimeCreated SystemTime="2023-06-23T00:28:36.6473989Z" /> 
  <EventRecordID>15500373</EventRecordID> 
  <Correlation /> 
  <Execution ProcessID="4" ThreadID="9184" /> 
  <Channel>Security</Channel> 
  <Computer>HLPC01</Computer> 
  <Security /> 
  </System>
- <EventData>
  <Data Name="ProcessID">2780</Data> 
  <Data Name="Application">\device\harddiskvolume5\windows\system32\svchost.exe</Data> 
  <Data Name="Direction">%%14593</Data> 
  <Data Name="SourceAddress">10.100.65.234</Data> 
  <Data Name="SourcePort">50704</Data> 
  <Data Name="DestAddress">10.100.0.10</Data> 
  <Data Name="DestPort">53</Data> 
  <Data Name="Protocol">17</Data> 
  <Data Name="FilterRTID">89854</Data> 
  <Data Name="LayerName">%%14611</Data> 
  <Data Name="LayerRTID">48</Data> 
  <Data Name="RemoteUserID">S-1-0-0</Data> 
  <Data Name="RemoteMachineID">S-1-0-0</Data> 
  </EventData>
  </Event>
```

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>

In the following example, the local system received DHCP traffic. The local system is not a DHCP server, but this traffic was seen regardless as DHCP typically works by broadcasting traffic. This is an example of how noisy this event can become.
```
- <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <System>
  <Provider Name="Microsoft-Windows-Security-Auditing" Guid="{54849625-5478-4994-a5ba-3e3b0328c30d}" /> 
  <EventID>5156</EventID> 
  <Version>1</Version> 
  <Level>0</Level> 
  <Task>12810</Task> 
  <Opcode>0</Opcode> 
  <Keywords>0x8020000000000000</Keywords> 
  <TimeCreated SystemTime="2023-06-23T00:28:35.7459571Z" /> 
  <EventRecordID>15500366</EventRecordID> 
  <Correlation /> 
  <Execution ProcessID="4" ThreadID="7868" /> 
  <Channel>Security</Channel> 
  <Computer>HLPC01</Computer> 
  <Security /> 
  </System>
- <EventData>
  <Data Name="ProcessID">2148</Data> 
  <Data Name="Application">\device\harddiskvolume5\windows\system32\svchost.exe</Data> 
  <Data Name="Direction">%%14592</Data> 
  <Data Name="SourceAddress">0.0.0.0</Data> 
  <Data Name="SourcePort">68</Data> 
  <Data Name="DestAddress">255.255.255.255</Data> 
  <Data Name="DestPort">67</Data> 
  <Data Name="Protocol">17</Data> 
  <Data Name="FilterRTID">65886</Data> 
  <Data Name="LayerName">%%14610</Data> 
  <Data Name="LayerRTID">44</Data> 
  <Data Name="RemoteUserID">S-1-0-0</Data> 
  <Data Name="RemoteMachineID">S-1-0-0</Data> 
  </EventData>
  </Event>
```

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`network/evtx-8001-wlan-connect.md`:

```md
# Microsoft-Windows-WLAN-AutoConfig/Operational/8001: Successfully Connected to a Wireless Network
This event indicates that the system has connected successfully to a wireless area network.

### Analysis Value
 - [x] Network - Evidence of Network Activity
 - [x] Network - Wireless Activity

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista


## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-WLAN-AutoConfig%4Operational.evtx`

## Artifact Interpretation
When logged, this event indicates that the system has successfully connected to a wireless area network. This event provides the following additional information regarding the connection:

| XML Path                              | Interpretation  |
| ------------------------------------- | --------------- |
| EventData/InterfaceGuid               | The wireless adapter's [Interface GUID](/enumeration/network-cards.md) |
| EventData/InterfaceDescription        | The name of the wireless adapter |
| EventData/SSID                        | The SSID of the network that was connected to |
| EventData/AuthenticationAlgorithm     | The security protocol used to connect to the wireless network (i.e. WEP, WPA2, etc.) |
| EventData/ConnectionMode              | If the wireless network was set to be joined automatically, this will read "Automatic connection with a profile", otherwise, this will read "Connection to a secure network without a profile" |

Together with the event [Microsoft-Windows-WLAN-AutoConfig/Operational/8003: Successfully Disconnected from a Wireless Network](network/evtx-8003-wlan-disconnect), this can be used to determine a timestan during which a system was connected to a wireless area network.

## Example
```
- <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <System>
  <Provider Name="Microsoft-Windows-WLAN-AutoConfig" Guid="{9580d7dd-0379-4658-9870-d5be7d52d6de}" /> 
  <EventID>8001</EventID> 
  <Version>0</Version> 
  <Level>4</Level> 
  <Task>24010</Task> 
  <Opcode>190</Opcode> 
  <Keywords>0x8000000020000600</Keywords> 
  <TimeCreated SystemTime="2022-10-27T04:37:47.1583133Z" /> 
  <EventRecordID>6</EventRecordID> 
  <Correlation /> 
  <Execution ProcessID="3132" ThreadID="3188" /> 
  <Channel>Microsoft-Windows-WLAN-AutoConfig/Operational</Channel> 
  <Computer>HLPC01</Computer> 
  <Security UserID="S-1-5-18" /> 
  </System>
- <EventData>
  <Data Name="InterfaceGuid">{a7d8885d-10c1-43d4-9e1e-0a7b2678f020}</Data> 
  <Data Name="InterfaceDescription">Intel(R) Wi-Fi 6 AX200 160MHz</Data> 
  <Data Name="ConnectionMode">Connection to a secure network without a profile</Data> 
  <Data Name="ProfileName">SSID_TEST</Data> 
  <Data Name="SSID">SSID_TEST</Data> 
  <Data Name="BSSType">Infrastructure</Data> 
  <Data Name="PHYType">802.11ax</Data> 
  <Data Name="AuthenticationAlgorithm">WPA2-Personal</Data> 
  <Data Name="CipherAlgorithm">AES-CCMP</Data> 
  <Data Name="OnexEnabled">0</Data> 
  <Data Name="ConnectionId">0x2</Data> 
  <Data Name="NonBroadcast">false</Data> 
  </EventData>
  </Event>
```

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`network/evtx-8003-wlan-disconnect.md`:

```md
# Microsoft-Windows-WLAN-AutoConfig/Operational/8003: Successfully Disconnected from a Wireless Network
This event indicates that the system has disconnected from a wireless area network.

### Analysis Value
 - [x] Network - Evidence of Network Activity
 - [x] Network - Wireless Activity

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista


## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-WLAN-AutoConfig%4Operational.evtx`

## Artifact Interpretation
When logged, this event indicates that the system has successfully disconnected from a wireless area network. This event provides the following additional information regarding the connection:

| XML Path                              | Interpretation  |
| ------------------------------------- | --------------- |
| EventData/InterfaceGuid               | The wireless adapter's [Interface GUID](/enumeration/network-cards.md) |
| EventData/InterfaceDescription        | The name of the wireless adapter |
| EventData/SSID                        | The SSID of the network that was connected to |
| EventData/Reason              | Provides the reason this network was disconnected from |

Together with the event [Microsoft-Windows-WLAN-AutoConfig/Operational/8001: Successfully Connected to a Wireless Network](network/evtx-8001-wlan-connect), this can be used to determine a timespan during which a system was connected to a wireless area network.

## Example
```
- <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <System>
  <Provider Name="Microsoft-Windows-WLAN-AutoConfig" Guid="{9580d7dd-0379-4658-9870-d5be7d52d6de}" /> 
  <EventID>8003</EventID> 
  <Version>0</Version> 
  <Level>4</Level> 
  <Task>24010</Task> 
  <Opcode>192</Opcode> 
  <Keywords>0x8000000040000600</Keywords> 
  <TimeCreated SystemTime="2023-06-16T03:05:19.9479495Z" /> 
  <EventRecordID>1321</EventRecordID> 
  <Correlation /> 
  <Execution ProcessID="4276" ThreadID="5544" /> 
  <Channel>Microsoft-Windows-WLAN-AutoConfig/Operational</Channel> 
  <Computer>HLPC01</Computer> 
  <Security UserID="S-1-5-18" /> 
  </System>
- <EventData>
  <Data Name="InterfaceGuid">{a7d8885d-10c1-43d4-9e1e-0a7b2678f020}</Data> 
  <Data Name="InterfaceDescription">Intel(R) Wi-Fi 6 AX200 160MHz</Data> 
  <Data Name="ConnectionMode">Automatic connection with a profile</Data> 
  <Data Name="ProfileName">SSID_TEST</Data> 
  <Data Name="SSID">SSID_TEST</Data> 
  <Data Name="BSSType">Infrastructure</Data> 
  <Data Name="Reason">The network is disconnected due to a policy disabling auto connect on this interface.</Data> 
  <Data Name="ConnectionId">0x1</Data> 
  <Data Name="ReasonCode">5</Data> 
  </EventData>
  </Event>
```

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`network/rdp-bitmap-cache.md`:

```md
# RDP Persistent Bitmap Cache
The persistent bitmap cache is a feature of Microsoft Remote Desktop's GDI Acceleration Extension that stores small chunks of images that were present during an RDP session. The goal is to reduce the bandwidth used by a remote desktop connection to increase performance at the cost of storage. As a forensic artifact, these bitmaps are valuable as they provide, to some extent, visual history of RDP sessions that have taken place from a system.

### Behavioral Indications
 - [x] Behavioral - Lateral Movement (TA0008)

### Analysis Value
 - [x] Network - Evidence of Network Activity

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP

## Artifact Location(s)
 - `%UserProfile%\AppData\Local\Microsoft\Terminal Server Client\Cache` (Windows Vista and later)
 - `C:\Documents and Settings\{USERNAME}\Local Settings\Application Data\Microsoft\Terminal Server Client\Cache` (Windows XP)

## Artifact Parsers
 - [bmc-tools](https://github.com/ANSSI-FR/bmc-tools)

## Artifact Interpretation
In this artifact's directory, you will find two types of files, each serving a similar purpose, `.bmc` and `.bin`. The `.bmc` files are typically observed on older versions of Microsoft Remote Desktop client, whereas newer versions will store data in the `.bin` files. The [bmc-tools](https://github.com/ANSSI-FR/bmc-tools) utility is able to parse both of these filetypes.

When the bitmap data is extracted, it will provide tiles containing snapshots of activity that has taken place interactively through an RDP session. They will be scrambled in no particular order, so it may take some work to stitch these images back together in a coherent manner.

The presence of these `.bmc` and `.bin` files indicates that the system on which they were found established an RDP connection to another system through RDP.

In modern versions of Microsoft Remote Desktop Client, the `.bmc` file is created when and RDP connection is established, and the `.bin` files are created or modified when that RDP connection is closed. As such, the most recent modification timestamp among these files indicates the last time an RDP connection was established from the system, assuming that `Persistent Bitmap Caching` was enabled for that session. In the case that it was not enabled, neither the `.bmc` nor the `.bin` files will be created.
```

`network/terminal-server-client-keys.md`:

```md
# Terminal Server Client Registry Keys
These registry keys store information regarding options selected by a user during the establishment of an RDP session, such as:

 - Ignoring an untrusted certificate
 - Username used to log in to the remote system via RDP

### Behavioral Indications
 - [x] Behavioral - Lateral Movement (TA0008)

### Analysis Value
 - [x] Network - Evidence of Network Activity

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista

## Artifact Location(s)
🔋 Live System:
- `HKEY_CURRENT_USER\SOFTWARE\Microsoft\Terminal Server Client\Servers`

🔌 Offline system:
- File: `%UserProfile%\NTUSER.DAT`
- Key: `SOFTWARE\Microsoft\Terminal Server Client\Servers`

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
Under the `Servers` key there will be additional keys, one for each remote system that the local system has connected to via RDP. These keys are created when connecting to the remote system for the first time. The name of the key will be either the IP Address or the domain name used to connect to the remote system. 

The `CertHash` value is created if the remote system has an untrusted certificate, and the user establishing the RDP connection has selected to proceed anyway as well as to never be notified of the certificate error again.

The `UsernameHint` value is created afterwards, and only when a logon succeeds. It stores the most recent username that the local system used to authenticate to the remote system via RDP.

## Example
The following example log, captured by Procmon on a Windows 10 system, shows the activity that takes place when a test user establishes a first-time connection to a remote system and authenticates successfully. In this instance, the user selected to not be notified of the untrusted certificate in the future, hence the creation of the `CertHash` key, and authenticated with the username `user`.

| Time of Day | Process Name | Operation    | Path                                                                                                 | Detail                                                                               |
|-------------|--------------|--------------|------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|
| 7:45:57 PM  | mstsc.exe    | RegCreateKey | HKCU\SOFTWARE\Microsoft\Terminal Server Client\Servers\desktop-ks82313.example.internal              | Desired Access: Write, Disposition: REG_CREATED_NEW_KEY                              |
| 7:45:57 PM  | mstsc.exe    | RegSetValue  | HKCU\SOFTWARE\Microsoft\Terminal Server Client\Servers\desktop-ks82313.example.internal\CertHash     | Type: REG_BINARY, Length: 32, Data: CB D1 82 3E 90 20 CB B0 EE A3 E0 64 35 31 95 F0  |
| 7:45:57 PM  | mstsc.exe    | TCP Connect  | desktop-ks82313.example.internal:59521 -> desktop-ks82313.example.internal:ms-wbt-server             | Length: 0, mss: 1460, sackopt: 1, tsopt: 0, wsopt: 1, rcvwin: 131400, rcvwinscale: 8 |
| 7:45:59 PM  | mstsc.exe    | RegSetValue  | HKCU\SOFTWARE\Microsoft\Terminal Server Client\Servers\desktop-ks82313.example.internal\UsernameHint | Type: REG_SZ, Length: 10, Data: user                                                 |
```

`network/terminal-services-local-21.md`:

```md
# Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/21: Session logon succeeded
This event, logged to the Microsoft-Windows-TerminalServices-LocalSessionManager/Operational channel, is logged when an RDP connection is successfully authenticated. 

> [!IMPORTANT]  
> This event is logged on the **destination** endpoint. 

### Behavioral Indications
 - [x] Behavioral - Lateral Movement (TA0008)

### Analysis Value
 - [x] Account - Username
 - [x] Network Activity - Evidence of Network Activity
 - [x] Network Activity - Source Identification

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2008

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-TerminalServices-LocalSessionManager%4Operational.evtx`

## Artifact Interpretation
### Account - Username
This event logs only the username and domain that the RDP connection was attempting to establish a session for. It is located in the XML path `UserData\EventXML\User`.

### Network Activity - Evidence of Network Activity
The presence of this event indicates that an RDP connection was established and authenticated to the system on which this event was logged.

### Network Activity - Source Identification
This artifact can provide the **source** IP address of an RDP session. This information will be in the XML path `UserData\EventXML\Address` of the event.

### SessionID Correlation
This event logs a Session ID, available in the XML path `UserData\EventXML\SessionID`. This may be used to correlate activity between other events logged in this channel.

### ActivityID Correlation
This event logs an ActivityID, available in the XML path `System\Correlation ActivityID`. This may be used to correlate activity between other events logged that are related to this activity, such as:

 - [Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational/1149](/network/terminal-services-remote-1149.md) to determine when the connection was established

### Determining Timeline of RDP Activity
Together with [Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/24: Session logon succeeded](/network/terminal-services-local-24.md), by correlating the `SessionID` field of both events, one can determine the start and end time of an RDP session.

## Example
```
- <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <System>
  <Provider Name="Microsoft-Windows-TerminalServices-LocalSessionManager" Guid="{5d896912-022d-40aa-a3a8-4fa5515c76d7}" /> 
  <EventID>21</EventID> 
  <Version>0</Version> 
  <Level>4</Level> 
  <Task>0</Task> 
  <Opcode>0</Opcode> 
  <Keywords>0x1000000000000000</Keywords> 
  <TimeCreated SystemTime="2023-07-12T12:01:05.5944806Z" /> 
  <EventRecordID>1520</EventRecordID> 
  <Correlation ActivityID="{f4204024-08a2-45cd-951b-f756f64b0000}" /> 
  <Execution ProcessID="1440" ThreadID="18112" /> 
  <Channel>Microsoft-Windows-TerminalServices-LocalSessionManager/Operational</Channel> 
  <Computer>HLPC01</Computer> 
  <Security UserID="S-1-5-18" /> 
  </System>
- <UserData>
- <EventXML xmlns="Event_NS">
  <User>HLPC01\john.doe</User> 
  <SessionID>4</SessionID> 
  <Address>192.168.180.57</Address> 
  </EventXML>
  </UserData>
  </Event>
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`network/terminal-services-local-24.md`:

```md
# Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/24: Session has been disconnected
This event, logged to the Microsoft-Windows-TerminalServices-LocalSessionManager/Operational channel, is logged when an RDP connection is terminated. 

> [!IMPORTANT]  
> This event is logged on the **destination** endpoint. 

### Behavioral Indications
 - [x] Behavioral - Lateral Movement (TA0008)

### Analysis Value
 - [x] Account - Username
 - [x] Network Activity - Evidence of Network Activity
 - [x] Network Activity - Source Identification

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2008

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-TerminalServices-LocalSessionManager%4Operational.evtx`

## Artifact Interpretation

### Account - Username
This event logs only the username and domain that the RDP connection established a session for. It is located in the XML path `UserData\EventXML\User`.

### Network Activity - Evidence of Network Activity
The presence of this event indicates that an RDP connection that was previously established and authenticated to the system on which this event was logged was terminated.

### Network Activity - Source Identification
This artifact can provide the **source** IP address of an RDP session. This information will be in the XML path `UserData\EventXML\Address` of the event.

### SessionID Correlation
This event logs a Session ID, available in the XML path `UserData\EventXML\SessionID`. This may be used to correlate activity between other events logged in this channel.

### ActivityID Correlation
This event logs an ActivityID, available in the XML path `System\Correlation ActivityID`. This may be used to correlate activity between other events logged that are related to this activity, such as:

 - [Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational/1149](/network/terminal-services-remote-1149.md) to determine when the connection was established

### Determining Timeline of RDP Activity
Together with [Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/21: Session logon succeeded](/network/terminal-services-local-21.md), by correlating the `SessionID` field of both events, one can determine the start and end time of an RDP session.

## Example
```
- <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <System>
  <Provider Name="Microsoft-Windows-TerminalServices-LocalSessionManager" Guid="{5d896912-022d-40aa-a3a8-4fa5515c76d7}" /> 
  <EventID>24</EventID> 
  <Version>0</Version> 
  <Level>4</Level> 
  <Task>0</Task> 
  <Opcode>0</Opcode> 
  <Keywords>0x1000000000000000</Keywords> 
  <TimeCreated SystemTime="2023-07-12T12:46:43.1684648Z" /> 
  <EventRecordID>1544</EventRecordID> 
  <Correlation ActivityID="{f4207ac4-a73b-4efa-b345-178e7e530000}" /> 
  <Execution ProcessID="1440" ThreadID="7996" /> 
  <Channel>Microsoft-Windows-TerminalServices-LocalSessionManager/Operational</Channel> 
  <Computer>HLPC01</Computer> 
  <Security UserID="S-1-5-18" /> 
  </System>
- <UserData>
- <EventXML xmlns="Event_NS">
  <User>HLPC01\john.doe</User> 
  <SessionID>4</SessionID> 
  <Address>192.168.180.57</Address> 
  </EventXML>
  </UserData>
  </Event>
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`network/terminal-services-remote-1149.md`:

```md
# Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational/1149
This event, logged to the Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational channel, is logged when an RDP connection is established. 

> [!WARNING]
> This event does not indicate a successfully authenticated RDP session has taken place, only that the channel has been established for an RDP attempt to be made.

> [!IMPORTANT]  
> This event is logged on the **destination** endpoint. 

### Behavioral Indications
 - [x] Behavioral - Lateral Movement (TA0008)

### Analysis Value
 - [x] Account - Username
 - [x] Network Activity - Evidence of Network Activity
 - [x] Network Activity - Source Identification

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2008

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-TerminalServices-RemoteConnectionManager%4Operational.evtx`

## Artifact Interpretation
### Account - Username
This event logs only the username that the RDP connection was attempting to establish a session for. It is located in the XML path `UserData\EventXML\Param1`.

### Network Activity - Evidence of Network Activity
The presence of this event indicates that an RDP connection was established to the system on which this event was logged.

### Network Activity - Source Identification
This artifact can provide the **source** IP address of an RDP *connection*. This information will be in the XML path `UserData\EventXML\Param3` of the event.

### ActivityID Correlation
This event logs an ActivityID, available in the XML path `System\Correlation ActivityID`. This may be used to correlate activity between other events logged that are related to this activity, such as:

 - [Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/21: Session logon succeeded](/network/terminal-services-local-21.md)

## Caveats
This event is logged regardless of success or failure of the RDP session, and must be cross-referenced with other events such as:

 - [4624: An account was successfully logged on](/account/evtx-4624-successful-logon.md)
 - [Microsoft-Windows-TerminalServices-LocalSessionManager/Operational/21: Session logon succeeded](/network/terminal-services-local-21.md)

## Example
```
- <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
- <System>
  <Provider Name="Microsoft-Windows-TerminalServices-RemoteConnectionManager" Guid="{c76baa63-ae81-421c-b425-340b4b24157f}" /> 
  <EventID>1149</EventID> 
  <Version>0</Version> 
  <Level>4</Level> 
  <Task>0</Task> 
  <Opcode>0</Opcode> 
  <Keywords>0x1000000000000000</Keywords> 
  <TimeCreated SystemTime="2023-07-12T12:01:19.3418899Z" /> 
  <EventRecordID>241</EventRecordID> 
  <Correlation ActivityID="{f4206c2f-b0bf-4c54-aad2-c7d2769b0000}" /> 
  <Execution ProcessID="10680" ThreadID="14208" /> 
  <Channel>Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational</Channel> 
  <Computer>HLPC01</Computer> 
  <Security UserID="S-1-5-20" /> 
  </System>
- <UserData>
- <EventXML xmlns="Event_NS">
  <Param1>john.doe</Param1> 
  <Param2 /> 
  <Param3>192.168.180.57</Param3> 
  </EventXML>
  </UserData>
  </Event>
```
<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`network/tracing-keys.md`:

```md
# Tracing Registry Keys
Tracing registry keys can be used to indicate that a program has initiated a network connection leveraging the Windows Remote Access Server (RAS) through the `rasapi32.dll` and `rasman.dll` libraries.

### Behavioral Indications
 - [x] Behavioral - Execution (TA0002)
 
### Analysis Value
 - [x] Execution - Evidence of Execution
 - [x] Network - Evidence of Network Activity

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7

## Artifact Location(s)
🔋 Live System:
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Tracing`

🔌 Offline system:
- File: `%SystemRoot%\System32\Config\SOFTWARE`
- Key: `SOFTWARE\Microsoft\Tracing`

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
Within the `SOFTWARE\Microsoft\Tracing` key, there may be multiple subkeys with the following name formats of interest:

 - `{EXECUTABLE_FILENAME}_RASMANCS`
 - `{EXECUTABLE_FILENAME}_RASAPI32`

These filenames will not include the executable extension `.exe`.

The Last Write Timestamp of the registry key provides the first time an executable has loaded `rasapi32.dll` and `rasman.dll` in order to establish a remote network connection, typically to download a file. 

> [!IMPORTANT]
> Subsequent activity of this nature will not update the Last Write Timestamp of the registry key.
```

`persistence/evtx-5861-event-consumer-created.md`:

```md
# WMI-Activity/Operational/5861: New WMI Event Consumer
This event, logged to the WMI-Activity/Operational channel, is logged when a new WMI event consumer is registered on the system.

### Behavioral Indications
 - [x] Behavioral - Persistence (TA0003)

### Analysis Value
 - [x] Account - Security Identifier (SID)

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-WMI-Activity%4Operational.evtx`

## Artifact Interpretation
Because new WMI event consumers on Windows enpoints are rather rare, this artifact provides a high-fidelity indicator of persistence activity. The information that you find in this event may vary depending on specific attacker techniques. In general, suspicious WMI event consumers will be of the following types, which are indicated in the event data for event ID `5861`:

 - `CommandLineEventConsumer`
 - `ActiveScriptEventConsumer`

## Analysis Tips
### Proximate Execution
Depending on the method an attacker has used to install a WMI event consumer, they will either have run `mofcomp.exe` or powershell. Consider cross-referencing this finding with artifacts that provide evidence of execution and searching for such activity. 

### Live System Collection
Evidence of WMI event consumers may also be queried on a live system through Powershell's Get-WMI module as follows:

`Get-WMIObject -Namespace root/Subscription -Class CommandLineEventConsumer`

## Example
![Example Image](/media/examples/wmi.png) 
```

`persistence/evtx-7045-service-install.md`:

```md
# System/7045: Service Installed
This event, logged to the System channel, is logged when a new service is installed on the system. 

### Behavioral Indications
 - [x] Behavioral - Persistence (TA0003)

### Analysis Value
 - [x] Account - Security Identifier (SID)
 - [x] File - Path

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista

## Artifact Location(s)
- `%SystemRoot%\System32\Winevt\Logs\System.evtx`

## Artifact Interpretation
The presence of this event in the System log indicates that a Service was installed on the system at the time the event was logged. There is no indication from this event alone that it was installed locally on the system itself, and services may be installed remotely leveraging utilities such as `sc.exe`.

### Account - Security Identifier (SID)
The `System/Security/UserID` field of this event provides the [Security Identifier (SID)](/README.md/#account---security-identifier-sid) of the account that installed the new service.

### File - Path
The `EventData\ImagePath` field of this event indicates the full path to the executable that will be run when the new service is started.ss

## Analysis Tips
In the event that the new service was installed remotely, a [Security/4624: An account was successfully logged on](account/evtx-4624-successful-logon.md) event may be logged before the new service is installed with a `LogonType` of 3. 

## Example
In the following example, the following command was executed on a domain controller:

```
sc.exe \\WKS10-01 create mynewservice binpath= c:\temp\example.exe start= auto displayname= "My new service"
```

This installed a new service on the system WKS10-01, generating the following [Security/4624: An account was successfully logged on](account/evtx-4624-successful-logon.md) event:

```
-
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">-
	<System>
		<ProviderName="Microsoft-Windows-Security-Auditing"Guid="{54849625-5478-4994-a5ba-3e3b0328c30d}"/>
		<EventID>4624</EventID>
		<Version>2</Version>
		<Level>0</Level>
		<Task>12544</Task>
		<Opcode>0</Opcode>
		<Keywords>0x8020000000000000</Keywords>
		<TimeCreatedSystemTime="2023-05-08T22:04:15.0931035Z"/>
		<EventRecordID>9719</EventRecordID>
		<CorrelationActivityID="{96cea955-81f8-0004-8ea9-ce96f881d901}"/>
		<ExecutionProcessID="900"ThreadID="3128"/>
		<Channel>Security</Channel>
		<Computer>WKS10-01.hlab.com</Computer>
		<Security/>
	</System>-
	<EventData>
		<DataName="SubjectUserSid">S-1-0-0</Data>
		<DataName="SubjectUserName">-</Data>
		<DataName="SubjectDomainName">-</Data>
		<DataName="SubjectLogonId">0x0</Data>
		<DataName="TargetUserSid">S-1-5-21-3829912423-625253200-3062624365-1105</Data>
		<DataName="TargetUserName">mvanburanadm</Data>
		<DataName="TargetDomainName">HLAB</Data><DataName="TargetLogonId">0xe4d79</Data>
		<DataName="LogonType">3</Data>
		<DataName="LogonProcessName">NtLmSsp</Data>
		<DataName="AuthenticationPackageName">NTLM</Data>
		<DataName="WorkstationName">HLDC01-WS2K19</Data>
		<DataName="LogonGuid">{00000000-0000-0000-0000-000000000000}</Data>
		<DataName="TransmittedServices">-</Data>
		<DataName="LmPackageName">NTLMV2</Data>
		<DataName="KeyLength">128</Data>
		<DataName="ProcessId">0x0</Data>
		<DataName="ProcessName">-</Data>
		<DataName="IpAddress">172.16.100.10</Data>
		<DataName="IpPort">49757</Data>
		<DataName="ImpersonationLevel">%%1833</Data>
		<DataName="RestrictedAdminMode">-</Data>
		<DataName="TargetOutboundUserName">-</Data>
		<DataName="TargetOutboundDomainName">-</Data>
		<DataName="VirtualAccount">%%1843</Data>
		<DataName="TargetLinkedLogonId">0x0</Data>
		<DataName="ElevatedToken">%%1842</Data>
	</EventData>
</Event>
```

As well as the following `System/7045: Service Installed` event in the `System` channel:

```
-
<Event
	xmlns="http://schemas.microsoft.com/win/2004/08/events/event">-
	<System>
		<ProviderName="ServiceControlManager"Guid="{555908d1-a6d7-4695-8e1e-26931d2012f4}"EventSourceName="ServiceControlManager"/>
		<EventIDQualifiers="16384">7045
		</EventID>
		<Version>0</Version>
		<Level>4</Level>
		<Task>0</Task>
		<Opcode>0</Opcode>
		<Keywords>0x8080000000000000</Keywords>
		<TimeCreatedSystemTime="2023-05-08T22:04:15.0831494Z"/>
		<EventRecordID>1033</EventRecordID>
		<Correlation/>
		<ExecutionProcessID="880"ThreadID="968"/>
		<Channel>System</Channel>
		<Computer>WKS10-01.hlab.com</Computer>
		<SecurityUserID="S-1-5-21-3829912423-625253200-3062624365-1105"/>
	</System>-
	<EventData>
		<DataName="ServiceName">Mynewservice</Data>
		<DataName="ImagePath">c:\temp\example.exe</Data>
		<DataName="ServiceType">usermodeservice</Data>
		<DataName="StartType">autostart</Data>
		<DataName="AccountName">LocalSystem</Data>
	</EventData>
</Event>
```

<sup><sub>This example was produced on Windows 10, Version 10.0.19044 Build 19044</sub></sup>
```

`persistence/image-file-execution-options.md`:

```md
# Image File Execution Options Registry Keys
Image File Execution Options (IFEO) is a registry key that allows users to attach debuggers to programs. Attackers may leverage this registry key to establish persistence, as code execution can be triggered by execution and/or termination of a particular program on an endpoint. 

### Behavioral Indications
 - [x] Behavioral - Persistence (TA0003)

### Analysis Value
 - [x] File - Path

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP

## Artifact Location(s)
🔋 Live System:
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\`
- `HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\`
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\`

🔌 Offline system:
- File: `%SystemRoot%\System32\Config\SOFTWARE`
- Key: `SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\`
- Key: `SOFTWARE\WOW6432Node\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\`
- Key: `SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\`

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
Normally, applications listed in the Image File Execution Options registry key will only have a `MitigationOptions` value present.

There are two common ways an attacker may leverage IFEO to establish a persistent foothold, the first being specifying a debugger for a particular application. This is accomplished by creating a new value of type `REG_SZ` named `Debugger`. When this key is present, the application specified in the `Debugger` key will be attached to the target application. When the target application is launched, the debugger will be launched as well. 

The second method is using the `GlobalFlag` of type `REG_DWORD`,  `ReportingMode` of type `REG_DWORD` and `MonitorProcess` of type `REG_SZ` values. The prerequisites for persistence using this method are:

 - `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\{TARGET_APPLICATION}\GlobalFlag` must be set to `0x200`
 - `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\{TARGET_APPLICATION}\ReportingMode` must be set to `0x1`
 - `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\{TARGET_APPLICATION}\MonitorProcess` must specify an application to execute upon termination of the `{TARGET_APPLICATION}`

The application specified by the `MonitorProcess` key, assuming these prerequisites are met, will execute upon termination of the `{TARGET_APPLICATION}`, with a process parent of `WerFault.exe`.

The silent process exit method does not appear to work if the `GlobalFlag` key is located under `HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\{TARGET_APPLICATION}`.

## Example - GlobalFlag Method
The following registry values are present on a system:

| Value Path | Value Data | Value Type |
| - | - | - |
| `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\excel.exe\GlobalFlag` | `0x200` | `REG_DWORD` |
| `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\excel.exe\ReportingMode` | `0x1` | `REG_DWORD` |
| `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\excel.exe\MonitorProcess` | `C:\Windows\System32\cmd.exe` | `REG_SZ` |

When Microsoft Excel is exited, `cmd.exe` is spawned, as shown in the below Sysmon event:

```
Process Create:
RuleName: -
UtcTime: 2024-02-15 19:10:39.168
ProcessGuid: {3d0d6187-61af-65ce-5007-000000004c00}
ProcessId: 22256
Image: C:\Windows\System32\cmd.exe
CommandLine: C:\Windows\System32\cmd.exe
CurrentDirectory: C:\Windows\system32\
User: DESKTOP-DR5P34J\user
ParentProcessGuid: {3d0d6187-61af-65ce-4f07-000000004c00}
ParentProcessId: 4364
ParentImage: C:\Windows\System32\WerFault.exe
ParentCommandLine: "C:\Windows\system32\WerFault.exe" -s -t 10540 -i 20812 -e 20812 -c 0
ParentUser: DESKTOP-DR5P34J\user
```
```

`persistence/reg-run-runonce.md`:

```md
# Run/RunOnce Registry Keys
The `Run` and `RunOnce` keys specify what programs will start during a logon event. These keys are located in both the NTUSER.dat and SOFTWARE hives.

### Behavioral Indications
 - [x] Behavioral - Persistence (TA0003)

### Analysis Value
 - [x] File - Path

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP

## Artifact Location(s)
> [!NOTE]
> The `Run` and `RunOnce` keys may be located in two distinct locations. Startup items for individual users will be located in their personal registry hive, NTUSER.dat, whereas startup items applying to all users of a system will be located in the SOFTWARE registry hive.

### NTUSER.dat Hive
🔋 Live System:
- `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run`
- `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\RunOnce`

🔌 Offline system:
- File: `%UserProfile%\NTUSER.dat` (Windows Vista - 10)
- File: `C:\Documents and Settings\{USER_NAME}\NTUSER.dat` (Windows XP)
- Key: `SOFTWARE\Microsoft\Windows\CurrentVersion\Run`
- Key: `SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce`

### SOFTWARE Hive
🔋 Live System:
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run`
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce`
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run`

🔌 Offline system:
- File: `%SystemRoot%\System32\Config\SOFTWARE`
- Key: `SOFTWARE\Microsoft\Windows\CurrentVersion\Run`
- Key: `SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce`
- Key: `SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run`

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)
 - AutoRuns (Sysinternals)

## Artifact Interpretation
### NTUSER.DAT Location
The following keys will contain full paths to the executables that will start on **logon** for the account that owns this particular `NTUSER.DAT` hive:

- `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run`
- `NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\RunOnce`

Disabled autoruns will appear in a sub-key named "AutorunsDisabled."

> [!NOTE]
> On a live system, the HKEY_CURRENT_USER registry hive is the loaded NTUSER.dat hive.

### SOFTWARE Location
The following keys will contain full paths to the executables that will start on **logon** for any user on the system:
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run`
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce`
- `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run`

## Analysis Tips
It is possible to obtain evidence of execution for processes that have executed as a result of these registry keys using the [Microsoft-Windows-Shell-Core/Operational/9707: Command Execution Started](/execution/evtx-9707-shell-core.md) event.

## Caveats
If the system is booted into Safe Mode, these keys will be ignored. A `RunOnce` key preceeded by an asterisk will ignore this restriction.

The `RunOnce` entry is typically deleted before the command is executed, regardless of its return value. If preceeded by and exclamation point, the `RunOnce` key will be deleted after the command has executed, and only if the command returned successfully. 
```

`persistence/registry-services.md`:

```md
# Services Registry Key
The Services registry key, located in the SYSTEM hive, stores information regarding installed services on the endpoint. It is useful when searching for evidence of persistence mechanisms on an endpoint. 

### Behavioral Indications
 - [x] Behavioral - Persistence (TA0003)

### Analysis Value
 - [x] File - Path

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista
 - [x] Windows XP
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2
 - [x] Windows Server 2003 R2
 - [x] Windows Server 2003

## Artifact Location(s)
🔋 Live System:
- `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services`

🔌 Offline system:
- File: `%SystemRoot%\system32\config\SYSTEM`
- Key: `SYSTEM\{CURRENT_CONTROL_SET}\Services`

> [!NOTE]
> More information on [{CURRENT_CONTROL_SET}](/enumeration/select.md)

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
Within the `Services` key you will find subkeys, one for each service installed on an endpoint. 

The values within this key may be interpreted as follows:

| Value | Interpretation |
| --- | --- |
| DisplayName | The name of the service as it would appear in `services.msc` |
| Description | The description of the service as it would appear in `services.msc` |
| ImagePath | The path to the executable for this service |
| Start | Start mode of the service |
| Type | Type of service |

The Last Write Timestamp for each service key represents the time at which the service was installed or modified.

Additionally, for each service there may be an optional `Parameters` subkey. This key may contain any options that are passed to the executable when the service is started. Certain service installers such as NSSM (Non-Sucking Service Manager) will show the "true" executable for the service under this `Parameters` key.  

### Interpreting the ```Start``` Value
| Value | Interpretation |
| - | - |
| 0 | **Boot** - Service is a device driver |
| 1 | **System** - Service is a device driver |
| 2 | **Automatic** - Service and all of its dependency services is started on boot by the OS |
| 3 | **Manual** - Service is started manually by user interaction |
| 4 | **Disabled** - Service is disabled and cannot be started automatically or manually |


```

`persistence/task-scheduler-files.md`:

```md
# Task Scheduler Files
Task Scheduler Files are XML files that provide information regarding scheduled tasks on an endpoint. These files are created when a new task is scheduled on the endpoint. This artifact is similar to and replaces `.job` files on Windows XP, but provides more information. 

### Behavioral Indications
 - [x] Behavioral - Persistence (TA0003)
 - [x] Behavioral - Lateral Movement (TA0008)

### Analysis Value
 - [x] Execution - Command Line Options
 - [x] Execution - First Executed
 - [x] Execution - Last Executed
 - [x] Execution - Permissions / Account
 - [x] Execution - Evidence of Execution
 - [x] Execution - Time
 - [x] File - Path
 - [x] Network Activity - Source Identification

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Vista

## Artifact Location(s)
 - `%SystemRoot%\System32\Tasks` for tasks scheduled by 64-bit processes
 - `%SystemRoot%\SysWOW64\Tasks` for tasks scheduled by 32-bit processes

## Artifact Interpretation
| XML Path | Interpretation |
| - | - |
| `Task/Registration Info/Date` | Date the task was scheduled, may or may not be present. |
| `Task/Registration Info/Author` | Author of the task |
| `Task/Triggers` | Triggers for the scheduled task. Could be on a calendar schedule, on boot, on log-on, etc.  |
| `Task/Actions` | Action taken by the scheduled task |
| `Task/Principals` | Authentication used for the task during execution |

In the event that a scheduled task was remotely created (an excellent indicator of lateral movement), the `Task/Registration Info/Author` field may provide the originating endpoint. In cases when the Windows Task Scheduler interface or the `schtasks` command was used to manually create a task, this field will be populated by the user account that performed this action.

> [!NOTE]
> The task scheduler file for a particular task will be created when the task is created. Therefore, the creation timestamp of the file should correspond to the creation time of the scheduled task. When the scheduled task is modified, the modification timestamp of the corresponding file will also be updated. 

## Example
The following example is a scheduled task created by Mozilla Firefox. From this task file we can conclude:

 - The command that will be executed is `C:\Program Files\Mozilla Firefox\default-browser-agent.exe do-task "308046B0AF4A39CB"`
 - This command will attempt to run every day beginning on `2023-12-26`
 - This command will run with the privileges of the user `DESKTOP-DR5P34J\user`
 - The creation and modification timestamp of this scheduled task is `12-26-2023 10:52 AM`, meaning this is when the scheduled task was created and it has not been updated since. 

```
<?xml version="1.0" encoding="UTF-16"?>
<Task version="1.2" xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task">
  <RegistrationInfo>
    <Author>Mozilla</Author>
    <Description>The Default Browser Agent task checks when the default changes from Firefox to another browser. If the change happens under suspicious circumstances, it will prompt users to change back to Firefox no more than two times. This task is installed automatically by Firefox, and is reinstalled when Firefox updates. To disable this task, update the “default-browser-agent.enabled” preference on the about:config page or the Firefox enterprise policy setting “DisableDefaultBrowserAgent”.</Description>
    <URI>\Mozilla\Firefox Default Browser Agent 308046B0AF4A39CB</URI>
  </RegistrationInfo>
  <Triggers>
    <CalendarTrigger>
      <StartBoundary>2023-12-26T16:51:33Z</StartBoundary>
      <Enabled>true</Enabled>
      <ScheduleByDay>
        <DaysInterval>1</DaysInterval>
      </ScheduleByDay>
    </CalendarTrigger>
  </Triggers>
  <Settings>
    <MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy>
    <DisallowStartIfOnBatteries>false</DisallowStartIfOnBatteries>
    <StopIfGoingOnBatteries>false</StopIfGoingOnBatteries>
    <AllowHardTerminate>true</AllowHardTerminate>
    <StartWhenAvailable>true</StartWhenAvailable>
    <RunOnlyIfNetworkAvailable>false</RunOnlyIfNetworkAvailable>
    <IdleSettings>
      <Duration>PT10M</Duration>
      <WaitTimeout>PT1H</WaitTimeout>
      <StopOnIdleEnd>true</StopOnIdleEnd>
      <RestartOnIdle>false</RestartOnIdle>
    </IdleSettings>
    <AllowStartOnDemand>true</AllowStartOnDemand>
    <Enabled>true</Enabled>
    <Hidden>false</Hidden>
    <RunOnlyIfIdle>false</RunOnlyIfIdle>
    <WakeToRun>false</WakeToRun>
    <ExecutionTimeLimit>PT12H5M</ExecutionTimeLimit>
    <Priority>7</Priority>
  </Settings>
  <Actions Context="Author">
    <Exec>
      <Command>C:\Program Files\Mozilla Firefox\default-browser-agent.exe</Command>
      <Arguments>do-task "308046B0AF4A39CB"</Arguments>
    </Exec>
  </Actions>
  <Principals>
    <Principal id="Author">
      <UserId>DESKTOP-DR5P34J\user</UserId>
      <LogonType>InteractiveToken</LogonType>
      <RunLevel>LeastPrivilege</RunLevel>
    </Principal>
  </Principals>
</Task>
```

Another example, this time of a scheduled task created manualy through the Windows Task Scheduler control panel. Note that in this case the `Task/Registration Info/Author` field is populated with a user account corresponding to the user that created the scheduled task. Note that the `Task/Principals/RunLevel` field is set to `HighestAvailable`, indicating this task will launch the command with higher privileges. 

```
<?xml version="1.0" encoding="UTF-16"?>
<Task version="1.2" xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task">
  <RegistrationInfo>
    <Date>2024-04-04T15:56:48.1199881</Date>
    <Author>DESKTOP-DR5P34J\user</Author>
    <URI>\Example Task</URI>
  </RegistrationInfo>
  <Triggers>
    <LogonTrigger>
      <Enabled>true</Enabled>
    </LogonTrigger>
  </Triggers>
  <Principals>
    <Principal id="Author">
      <RunLevel>HighestAvailable</RunLevel>
      <UserId>DESKTOP-DR5P34J\user</UserId>
      <LogonType>Password</LogonType>
    </Principal>
  </Principals>
  <Settings>
    <MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy>
    <DisallowStartIfOnBatteries>true</DisallowStartIfOnBatteries>
    <StopIfGoingOnBatteries>true</StopIfGoingOnBatteries>
    <AllowHardTerminate>true</AllowHardTerminate>
    <StartWhenAvailable>false</StartWhenAvailable>
    <RunOnlyIfNetworkAvailable>false</RunOnlyIfNetworkAvailable>
    <IdleSettings>
      <StopOnIdleEnd>true</StopOnIdleEnd>
      <RestartOnIdle>false</RestartOnIdle>
    </IdleSettings>
    <AllowStartOnDemand>true</AllowStartOnDemand>
    <Enabled>true</Enabled>
    <Hidden>false</Hidden>
    <RunOnlyIfIdle>false</RunOnlyIfIdle>
    <WakeToRun>false</WakeToRun>
    <ExecutionTimeLimit>P3D</ExecutionTimeLimit>
    <Priority>7</Priority>
  </Settings>
  <Actions Context="Author">
    <Exec>
      <Command>C:\Temp\example.exe</Command>
    </Exec>
  </Actions>
</Task>
```
```

`persistence/task-scheduler-operational-log.md`:

```md
# TaskScheduler/Operational Log
The TaskScheduler/Operational event log channel provides detailed tracing of scheduled tasks on an endpoint. 

### Behavioral Indications
 - [x] Behavioral - Persistence (TA0003)
 - [x] Behavioral - Lateral Movement (TA0008)

### Analysis Value
 - [x] Execution - Command Line Options
 - [x] Execution - First Executed
 - [x] Execution - Last Executed
 - [x] Execution - Evidence of Execution
 - [x] Execution - Time
 - [x] File - Path
 - [x] Network Activity - Source Identification

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7
 - [x] Windows Server 2019
 - [x] Windows Server 2016
 - [x] Windows Server 2012 R2
 - [x] Windows Server 2012
 - [x] Windows Server 2008 R2

## Artifact Location(s)
 - `%SystemRoot%\System32\Winevt\Logs\Microsoft-Windows-TaskScheduler%4Operational.evtx`

## Artifact Interpretation
The following event IDs are useful to hunt for persistent implants on an endpoint:

| Event ID | Description | Information |
| - | - | - |
| 106 | Scheduled Task Created | Origin Account/User |
| 140 | Scheduled Task Updated | Origin Account/User |
| 141 | Scheduled Task Deleted | Origin Account/User |
| 200 | Scheduled Task Executed | Executable file path |
| 201 | Scheduled Task Execution Completed | Executable file path |

This activity is also logged in the Security channel with more granular information, as follows:
| Event ID | Description |
| - | - |
| 4698 | Scheduled Task Created |
| 4702 | Scheduled Task Updated |
| 4699 | Scheduled Task Deleted |

## Caveats
Logging for these events is disabled by default and must be enabled to provide these artifacts.

## Analysis Tips

### Deleted Scheduled Tasks
Scheduled task deletion is a rare event on Windows systems and provides an easy to query, high-fidelity indicator of suspicious activity. The following event IDs may be queried:

 - `Windows-TaskScheduler\Operational Event 141: Scheduled Task Deleted`
 - `Security Event 4699: Scheduled Task Deleted`

### Software Installation/Uninstallation
When applications are installed on a Windows system, they will sometimes create a scheduled task to run their update functionality, making the Task Scheduler Operational log a possible option for cross-validation of other application installation artifacts such as the `Uninstall` registry key. 

### Lateral Movement through Remote Scheduled Task Installation
In the event that tasks are remotely scheduled, as is commonly seen during lateral movement attempts, this activity may be identified by observing Type 3 logons via [4624: An account was successfully logged on](/account/evtx-4624-successful-logon.md) events in close proximity to task creation.
```

`user-activity/wordwheelquery.md`:

```md
# WordWheelQuery Registry Key
The WordWheelQuery registry key contains values that represent the history of searches performed using the Explorer search bar.

### Analysis Value
 - [x] User Activity

## Operating System Availability
 - [x] Windows 11
 - [x] Windows 10
 - [x] Windows 8
 - [x] Windows 7

## Artifact Location(s)
🔋 Live System:
- `HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuery`

🔌 Offline system:
- File: `%UserProfile%\NTUSER.DAT`
- Key: `SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuery`

## Artifact Parsers
 - RegistryExplorer (Eric Zimmerman)

## Artifact Interpretation
Within this registry key will be values with numerical names and an additional value `MRUListEx`. Each numerically named value represents one search term, and the `MRUListEx` value indicates the order in which the terms were searched. 

The Last Write Timestamp of the `WordWheelQuery` registry key indicates the time at which the most recent search term was used to perform a search within Explorer. 

## Example
Within the `WordWheelQuery` registry key, the data of the value `MRUListEx` is as follows:

```
00000000  3f 00 00 00  |?...|
00000004  3e 00 00 00  |>...|
00000008  3d 00 00 00  |=...|
0000000c  3c 00 00 00  |<...|
00000010  3b 00 00 00  |;...|
00000014  3a 00 00 00  |:...|
00000018  39 00 00 00  |9...|
0000001c  38 00 00 00  |8...|
00000020  37 00 00 00  |7...|
00000024  31 00 00 00  |1...|
00000028  36 00 00 00  |6...|
0000002c  35 00 00 00  |5...|
00000030  2f 00 00 00  |/...|
00000034  34 00 00 00  |4...|
00000038  33 00 00 00  |3...|
0000003c  32 00 00 00  |2...|
00000040  30 00 00 00  |0...|
00000044  2e 00 00 00  |....|
00000048  2d 00 00 00  |-...|
0000004c  2c 00 00 00  |,...|
00000050  2b 00 00 00  |+...|
00000054  2a 00 00 00  |*...|
00000058  29 00 00 00  |)...|
0000005c  28 00 00 00  |(...|
00000060  27 00 00 00  |'...|
00000064  26 00 00 00  |&...|
00000068  25 00 00 00  |%...|
0000006c  24 00 00 00  |$...|
00000070  23 00 00 00  |#...|
00000074  22 00 00 00  |"...|
00000078  21 00 00 00  |!...|
0000007c  20 00 00 00  | ...|
00000080  1f 00 00 00  |....|
00000084  1e 00 00 00  |....|
00000088  1d 00 00 00  |....|
0000008c  1c 00 00 00  |....|
00000090  1b 00 00 00  |....|
00000094  1a 00 00 00  |....|
00000098  19 00 00 00  |....|
0000009c  18 00 00 00  |....|
000000a0  17 00 00 00  |....|
000000a4  16 00 00 00  |....|
000000a8  15 00 00 00  |....|
000000ac  13 00 00 00  |....|
000000b0  14 00 00 00  |....|
000000b4  12 00 00 00  |....|
000000b8  11 00 00 00  |....|
000000bc  10 00 00 00  |....|
000000c0  0f 00 00 00  |....|
000000c4  0e 00 00 00  |....|
000000c8  0d 00 00 00  |....|
000000cc  0c 00 00 00  |....|
000000d0  0b 00 00 00  |....|
000000d4  05 00 00 00  |....|
000000d8  0a 00 00 00  |....|
000000dc  09 00 00 00  |....|
000000e0  00 00 00 00  |....|
000000e4  08 00 00 00  |....|
000000e8  07 00 00 00  |....|
000000ec  06 00 00 00  |....|
000000f0  03 00 00 00  |....|
000000f4  04 00 00 00  |....|
000000f8  02 00 00 00  |....|
000000fc  01 00 00 00  |....|
00000100  ff ff ff ff  |ÿÿÿÿ|
```

From this information, we can determine that the most recently searched term exists in the value named `3f 00 00 00`, or `63` in decimal. The data of this value is `74 00 65 00 73 00 74 00 00 00`, which when translated from UTF-16LE is `test`. Because this is the most recent term as indicated by the `MRUListEx` value, the Last Write Timestamp will correspond to the time that this term was searched.

The earliest known search term is in the value named `01 00 00 00`, or `1`.
```