Project Path: arc_gmh5225_NoMoreBugCheck_drlvssc5

Source Tree:

```txt
arc_gmh5225_NoMoreBugCheck_drlvssc5
├── NoMoreBugCheck
│   ├── NoMoreBugCheck.vcxproj
│   ├── NoMoreBugCheck.vcxproj.filters
│   └── driver.c
├── NoMoreBugCheck.sln
└── README.md

```

`NoMoreBugCheck.sln`:

```sln

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 16
VisualStudioVersion = 16.0.31911.196
MinimumVisualStudioVersion = 10.0.40219.1
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "NoMoreBugCheck", "NoMoreBugCheck\NoMoreBugCheck.vcxproj", "{E945A953-1C0D-4F75-9562-53ECFC07063F}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|ARM = Debug|ARM
		Debug|ARM64 = Debug|ARM64
		Debug|x64 = Debug|x64
		Debug|x86 = Debug|x86
		Release|ARM = Release|ARM
		Release|ARM64 = Release|ARM64
		Release|x64 = Release|x64
		Release|x86 = Release|x86
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Debug|ARM.ActiveCfg = Debug|ARM
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Debug|ARM.Build.0 = Debug|ARM
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Debug|ARM.Deploy.0 = Debug|ARM
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Debug|ARM64.ActiveCfg = Debug|ARM64
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Debug|ARM64.Build.0 = Debug|ARM64
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Debug|ARM64.Deploy.0 = Debug|ARM64
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Debug|x64.ActiveCfg = Debug|x64
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Debug|x64.Build.0 = Debug|x64
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Debug|x64.Deploy.0 = Debug|x64
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Debug|x86.ActiveCfg = Debug|Win32
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Debug|x86.Build.0 = Debug|Win32
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Debug|x86.Deploy.0 = Debug|Win32
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Release|ARM.ActiveCfg = Release|ARM
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Release|ARM.Build.0 = Release|ARM
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Release|ARM.Deploy.0 = Release|ARM
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Release|ARM64.ActiveCfg = Release|ARM64
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Release|ARM64.Build.0 = Release|ARM64
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Release|ARM64.Deploy.0 = Release|ARM64
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Release|x64.ActiveCfg = Release|x64
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Release|x64.Build.0 = Release|x64
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Release|x64.Deploy.0 = Release|x64
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Release|x86.ActiveCfg = Release|Win32
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Release|x86.Build.0 = Release|Win32
		{E945A953-1C0D-4F75-9562-53ECFC07063F}.Release|x86.Deploy.0 = Release|Win32
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {FAA214D7-36CD-4ACF-ABB5-B9ABF2F3F4F4}
	EndGlobalSection
EndGlobal

```

`NoMoreBugCheck/NoMoreBugCheck.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="12.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM">
      <Configuration>Debug</Configuration>
      <Platform>ARM</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM">
      <Configuration>Release</Configuration>
      <Platform>ARM</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM64">
      <Configuration>Debug</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM64">
      <Configuration>Release</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <ProjectGuid>{E945A953-1C0D-4F75-9562-53ECFC07063F}</ProjectGuid>
    <TemplateGuid>{1bc93793-694f-48fe-9372-81e2b05556fd}</TemplateGuid>
    <TargetFrameworkVersion>v4.5</TargetFrameworkVersion>
    <MinimumVisualStudioVersion>12.0</MinimumVisualStudioVersion>
    <Configuration>Debug</Configuration>
    <Platform Condition="'$(Platform)' == ''">Win32</Platform>
    <RootNamespace>NoMoreBugCheck</RootNamespace>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
    <Driver_SpectreMitigation>false</Driver_SpectreMitigation>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
    <Driver_SpectreMitigation>false</Driver_SpectreMitigation>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
    <Driver_SpectreMitigation>false</Driver_SpectreMitigation>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="PropertySheets">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <ClCompile>
      <TreatWarningAsError>false</TreatWarningAsError>
    </ClCompile>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <TreatWarningAsError>false</TreatWarningAsError>
    </ClCompile>
  </ItemDefinitionGroup>
  <ItemGroup>
    <FilesToPackage Include="$(TargetPath)" />
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="driver.c" />
  </ItemGroup>
  <ItemGroup>
    <None Include=".clang-format" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`NoMoreBugCheck/NoMoreBugCheck.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="Source Files">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="Header Files">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hpp;hxx;hm;inl;inc;xsd</Extensions>
    </Filter>
    <Filter Include="Resource Files">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
    <Filter Include="Driver Files">
      <UniqueIdentifier>{8E41214B-6785-4CFE-B992-037D68949A14}</UniqueIdentifier>
      <Extensions>inf;inv;inx;mof;mc;</Extensions>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="driver.c">
      <Filter>Source Files</Filter>
    </ClCompile>
  </ItemGroup>
  <ItemGroup>
    <None Include=".clang-format" />
  </ItemGroup>
</Project>
```

`NoMoreBugCheck/driver.c`:

```c
#include <ntddk.h>

CHAR KeBugCheckExOrignalBytes[14] = {0};
ULONG_PTR KeBugCheckExAddress;

NTSTATUS Overwrite(PVOID Address, PVOID Data, ULONG Size) {
	PHYSICAL_ADDRESS PhysAddress = MmGetPhysicalAddress(Address);
	PVOID MappedAddress = MmMapIoSpace(PhysAddress, Size, MmNonCached);

	if (MappedAddress == NULL)
		return STATUS_INSUFFICIENT_RESOURCES;

	RtlCopyMemory(MappedAddress, Data, Size);
	MmUnmapIoSpace(MappedAddress, Size);
	return STATUS_SUCCESS;
}

VOID KeHookedBugCheckEx(ULONG BugCheckCode, ULONG_PTR Code1, ULONG_PTR Code2,
						ULONG_PTR Code3, ULONG_PTR Code4) {
	DbgPrint("[*] KeBugCheckEx was called by Process %d, thread id %d\n", PsGetCurrentProcessId(), PsGetCurrentThreadId());
	DbgPrint("[*] KeBugCheckEx(0x%llx, 0x%llx, 0x%llx, 0x%llx)\n", BugCheckCode,
			 Code1, Code2, Code3, Code4);
	LARGE_INTEGER Delay;

	Delay.LowPart = 0;
	Delay.HighPart = 0x80000000;

	KeDelayExecutionThread(KernelMode, FALSE, &Delay);
}


VOID DriverUnload(PDRIVER_OBJECT DriverObject) {
	UNREFERENCED_PARAMETER(DriverObject);
	NTSTATUS Status = Overwrite(KeBugCheckExAddress, (PVOID)KeBugCheckExOrignalBytes, 14);

	if (Status != STATUS_SUCCESS)
		DbgPrint("[!] Failed to restore the orignal KeBugCheckEx function\n");
	else
		DbgPrint("[+] Successfully restored the orignal KeBugCheckEx function\n");

	DbgPrint("[*] Goodbye Cruel World\n");
}

NTSTATUS DriverEntry(PDRIVER_OBJECT DriverObject,
					 PUNICODE_STRING RegistryPath) {
	UNREFERENCED_PARAMETER(RegistryPath);

	DriverObject->DriverUnload = DriverUnload;

	KeBugCheckExAddress = (ULONG_PTR)KeBugCheckEx;

	DbgPrint("[*] Hello World\n");
	DbgPrint("[*] KeBugCheckEx located at 0x%llx\n", KeBugCheckExAddress);
	DbgPrint("[*] KeHookedBugCheckEx located at 0x%llx\n", KeHookedBugCheckEx);
	RtlCopyMemory(KeBugCheckExOrignalBytes, KeBugCheckExAddress, 14);
	
	if (KeBugCheckExOrignalBytes[0])
		DbgPrint("[+] Copied over KeBugCheckEx\n");
	else {
		DbgPrint("[!] Failed to copy\n");
		return STATUS_FAILED_DRIVER_ENTRY;
	}

	for (INT i = 0; i < 14; i++)
		DbgPrint("[*] KeBugCheckExOrignalBytes[%d]: 0x%x\n", i,
				 KeBugCheckExOrignalBytes[i] & 0xff);

	#if defined(_M_X64)
	CHAR Patch[] = {
	    0x49, 0xba, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, // mov r10, address
		0x41, 0xff, 0xe2 // jmp r10
	};

	ULONG_PTR KeHookedBugCheckExAddress = (ULONG_PTR)KeHookedBugCheckEx;
	CHAR *KeHookedBugCheckExAddressBytes = (CHAR*)&KeHookedBugCheckExAddress;

	RtlCopyMemory(&Patch[2], KeHookedBugCheckExAddressBytes, sizeof(ULONG_PTR));

	NTSTATUS Status = Overwrite(KeBugCheckExAddress, (PVOID)Patch, sizeof(Patch));
	
	if (Status != STATUS_SUCCESS) {
		DbgPrint("[!] Failed to overwrite KeBugCheckEx\n");
		return STATUS_FAILED_DRIVER_ENTRY;
	}

	DbgPrint("[+] Successfully overwrote KeBugCheckEx\n");
	#else
	DbgPrint("[!] Unknown architecture");
	return STATUS_FAILED_DRIVER_ENTRY;
	#endif

	CHAR Temp[14] = {0};
	RtlCopyMemory(Temp, KeBugCheckExAddress, 14);

	for (INT i = 0; i < 14; i++)
		DbgPrint("[*] KeBugCheckEx[%d]: 0x%x\n", i,
				 Temp[i] & 0xff);

	return STATUS_SUCCESS;
}
```

`README.md`:

```md
# NoMoreBugCheck

Prevent Windows from BSODing no matter what happens!

# Warning

Using this is the equivalent of disabling the circuit breaker in your house.
Windows BSODs whenever a serious problem occurs to prevent memory/data corruption.
Although your computer won't blow up you could corrupt memory/data present on the system.
This was done only for fun and should not be used for any serious purposes.
I am not responsible for loss of any data or damage to the system.

# How to use?

1. Enable test signing

```
bcdedit /set testsigning on
```

2. Create a service using SC

```
sc create NoMoreBugCheck binPath=C:\where\ever\the\driver\is\NoMoreBugCheck.sys type=kernel start=manual
```

3. Run it!

```
sc start NoMoreBugCheck
```

# Demo

https://user-images.githubusercontent.com/51860844/146301386-68e4b170-89c1-441e-97b0-c5bdd2b16ed8.mp4

# Note

- If you want to revert the changes just unload the driver by running
```
sc stop NoMoreBugCheck
```

- The system can hang if the problem was severe.

```