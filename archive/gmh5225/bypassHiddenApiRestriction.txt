Project Path: arc_gmh5225_bypassHiddenApiRestriction_yy7ocnfs

Source Tree:

```txt
arc_gmh5225_bypassHiddenApiRestriction_yy7ocnfs
├── README.md
├── app
│   ├── build.gradle
│   ├── proguard-rules.pro
│   └── src
│       └── main
│           ├── AndroidManifest.xml
│           ├── cpp
│           │   ├── CMakeLists.txt
│           │   ├── main.cpp
│           │   └── main.h
│           ├── java
│           │   └── com
│           │       └── wind
│           │           └── example
│           │               └── bypass
│           │                   └── MainActivity.kt
│           └── res
│               ├── drawable
│               │   └── ic_launcher_background.xml
│               ├── drawable-v24
│               │   └── ic_launcher_foreground.xml
│               ├── layout
│               │   └── activity_main.xml
│               ├── mipmap-anydpi-v26
│               │   ├── ic_launcher.xml
│               │   └── ic_launcher_round.xml
│               ├── mipmap-hdpi
│               │   ├── ic_launcher.webp
│               │   └── ic_launcher_round.webp
│               ├── mipmap-mdpi
│               │   ├── ic_launcher.webp
│               │   └── ic_launcher_round.webp
│               ├── mipmap-xhdpi
│               │   ├── ic_launcher.webp
│               │   └── ic_launcher_round.webp
│               ├── mipmap-xxhdpi
│               │   ├── ic_launcher.webp
│               │   └── ic_launcher_round.webp
│               ├── mipmap-xxxhdpi
│               │   ├── ic_launcher.webp
│               │   └── ic_launcher_round.webp
│               ├── values
│               │   ├── colors.xml
│               │   ├── strings.xml
│               │   └── themes.xml
│               └── values-night
│                   └── themes.xml
├── build.gradle
├── bypassRestriction
│   ├── build.gradle
│   ├── consumer-rules.pro
│   ├── proguard-rules.pro
│   └── src
│       └── main
│           ├── AndroidManifest.xml
│           ├── cpp
│           │   ├── CMakeLists.txt
│           │   ├── bypass_dl
│           │   │   ├── CMakeLists.txt
│           │   │   └── bypass_dlopen.c
│           │   ├── include
│           │   │   └── bypass_dlopen.h
│           │   ├── main.cpp
│           │   └── utils
│           │       ├── ScopedLocalRef.h
│           │       ├── common.h
│           │       └── utils.h
│           └── java
│               └── com
│                   └── wind
│                       └── hiddenapi
│                           └── bypass
│                               └── HiddenApiBypass.java
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradle.properties
├── gradlew
├── gradlew.bat
├── publish.gradle
└── settings.gradle

```

`README.md`:

```md
## BypassHiddenApiRestriction
This is a library that can bypass the restrictions on non-SDK interfaces on Android 9-12.
## How it works
[另一种绕过Android 9以上非SDK接口调用限制的方法](https://windysha.github.io/2021/07/20/%E5%8F%A6%E4%B8%80%E7%A7%8D%E7%BB%95%E8%BF%87%20Android%209%E4%BB%A5%E4%B8%8A%E9%9D%9ESDK%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%E9%99%90%E5%88%B6%E7%9A%84%E6%96%B9%E6%B3%95/)

## Usage
### 1. Add dependency in build.gradle
```
allprojects {
    repositories {
        mavenCentral()
    }
}
```
```
dependencies {
    implementation 'io.github.windysha:bypassHiddenApiRestriction:1.1.0'
}
```
### 2. Add this code to your Application.attachBaseContext
```
import com.wind.hiddenapi.bypass.HiddenApiBypass

if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {
    HiddenApiBypass.startBypass();
}
```
## License
```
Copyright 2021 WindySha
Apache License, Version 2.0
http://www.apache.org/licenses/LICENSE-2.0
```

```

`app/build.gradle`:

```gradle
plugins {
    id 'com.android.application'
    id 'kotlin-android'
}

android {
    compileSdk 30
    buildToolsVersion "30.0.3"

    defaultConfig {
        applicationId "com.wind.example.bypass"
        minSdk 21
        targetSdk 30
        versionCode 1
        versionName "1.0"

        ndk {
            abiFilters "armeabi-v7a", "arm64-v8a"
        }
        externalNativeBuild {
            cmake {
                cppFlags ""
                arguments '-DANDROID_STL=c++_shared'
            }
        }
    }

//    buildFeatures {
//        prefab true
//    }

    buildTypes {
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    kotlinOptions {
        jvmTarget = '1.8'
    }
    externalNativeBuild {
        cmake {
            path "src/main/cpp/CMakeLists.txt"
            version "3.10.2"
        }
    }
}

dependencies {

    implementation 'androidx.core:core-ktx:1.6.0'
    implementation 'androidx.appcompat:appcompat:1.3.0'
    implementation 'com.google.android.material:material:1.3.0'
    implementation 'androidx.constraintlayout:constraintlayout:2.0.4'
    implementation project(path: ':bypassRestriction')
//    implementation 'io.github.windysha:bypassHiddenApiRestriction:1.0.2'
}
```

`app/proguard-rules.pro`:

```pro
# Add project specific ProGuard rules here.
# You can control the set of applied configuration files using the
# proguardFiles setting in build.gradle.
#
# For more details, see
#   http://developer.android.com/guide/developing/tools/proguard.html

# If your project uses WebView with JS, uncomment the following
# and specify the fully qualified class name to the JavaScript interface
# class:
#-keepclassmembers class fqcn.of.javascript.interface.for.webview {
#   public *;
#}

# Uncomment this to preserve the line number information for
# debugging stack traces.
#-keepattributes SourceFile,LineNumberTable

# If you keep the line number information, uncomment this to
# hide the original source file name.
#-renamesourcefileattribute SourceFile
```

`app/src/main/AndroidManifest.xml`:

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.wind.example.bypass">

    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.Bypass_hidden_api_restriction">
        <activity
            android:name=".MainActivity"
            android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />

                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>

</manifest>
```

`app/src/main/cpp/CMakeLists.txt`:

```txt
cmake_minimum_required(VERSION 3.10.2)

project("test-lib")

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fvisibility=hidden")
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -fvisibility=hidden")


# import lib from local-project
string(TOLOWER ${CMAKE_BUILD_TYPE} BUILD_TYPE_DIRNAME)
set(LIB_BASE ${CMAKE_CURRENT_SOURCE_DIR}/../../../../bypassRestriction)
add_library(bypassRestriction::bypassRestriction SHARED IMPORTED)
set_target_properties(bypassRestriction::bypassRestriction PROPERTIES
        IMPORTED_LOCATION ${LIB_BASE}/build/intermediates/stripped_native_libs/${BUILD_TYPE_DIRNAME}/out/lib/${ANDROID_ABI}/libbypassRestriction.so
        INTERFACE_INCLUDE_DIRECTORIES ${LIB_BASE}/src/main/cpp/include)

# import lib from maven
#find_package(bypassRestriction REQUIRED CONFIG)

add_library(test-lib
        SHARED
        main.cpp)

find_library(log-lib
        log)

target_link_libraries(test-lib
        bypassRestriction::bypassRestriction
        ${log-lib})
```

`app/src/main/cpp/main.cpp`:

```cpp
//
// Created by WindySha on 2021/7/16.
//

#include "main.h"
#include <jni.h>
#include <dlfcn.h>
#include "bypass_dlopen.h"

extern "C"
JNIEXPORT void JNICALL
Java_com_wind_example_bypass_MainActivity_testBypassDlfcn(JNIEnv *env, jclass clazz) {
    void *handle = bypass_dlopen("libart.so", RTLD_NOW);
    void *func_addres = dlsym(handle,
                                 "_ZN3art6mirror5Class15FindClassMethodENSt3__117basic_string_viewIcNS2_11char_traitsIcEEEES6_NS_11PointerSizeE");
    LOGD(" art handle -> %p   func_addres -> %p", handle, func_addres);
}
```

`app/src/main/cpp/main.h`:

```h
//
// Created by WindySha on 2021/7/16.
//

#ifndef BYPASS_HIDDEN_API_RESTRICTION_APP_SRC_MAIN_CPP_MAIN_H
#define BYPASS_HIDDEN_API_RESTRICTION_APP_SRC_MAIN_CPP_MAIN_H

#include <android/log.h>

#define LOG_TAG  "Test_Bypass_Dlfcn_Restriction"
#define LOGD(...) __android_log_print(ANDROID_LOG_DEBUG,  LOG_TAG, __VA_ARGS__)

#endif //BYPASS_HIDDEN_API_RESTRICTION_APP_SRC_MAIN_CPP_MAIN_H

```

`app/src/main/java/com/wind/example/bypass/MainActivity.kt`:

```kt
package com.wind.example.bypass

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.util.Log
import android.view.View
import com.wind.hiddenapi.bypass.HiddenApiBypass
import java.lang.Exception

class MainActivity : AppCompatActivity() {
    init {
        System.loadLibrary("test-lib")
    }

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
    }

    fun onClick(view: View) {
        if (view.id == R.id.bypass) {
            HiddenApiBypass.startBypass()
        }
        if (view.id == R.id.bypass_test) {
            try {
                // api_level >= 29
                // $ adb shell settings delete global hidden_api_policy
                val clazz = Class.forName("dalvik.system.VMRuntime")
                val method =
                    clazz.getDeclaredMethod("setHiddenApiExemptions", Array<String>::class.java)
                Log.e(
                    "MainActivity",
                    " clazz = $clazz   exem_method= $method"
                )
            } catch (e: Exception) {
                e.printStackTrace()
            }
        }
        if (view.id == R.id.bypass_dlfcn_test) {
            testBypassDlfcn()
        }
    }

    companion object {
        @JvmStatic
        private external fun  testBypassDlfcn()
    }
}
```

`app/src/main/res/drawable-v24/ic_launcher_foreground.xml`:

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:aapt="http://schemas.android.com/aapt"
    android:width="108dp"
    android:height="108dp"
    android:viewportWidth="108"
    android:viewportHeight="108">
    <path android:pathData="M31,63.928c0,0 6.4,-11 12.1,-13.1c7.2,-2.6 26,-1.4 26,-1.4l38.1,38.1L107,108.928l-32,-1L31,63.928z">
        <aapt:attr name="android:fillColor">
            <gradient
                android:endX="85.84757"
                android:endY="92.4963"
                android:startX="42.9492"
                android:startY="49.59793"
                android:type="linear">
                <item
                    android:color="#44000000"
                    android:offset="0.0" />
                <item
                    android:color="#00000000"
                    android:offset="1.0" />
            </gradient>
        </aapt:attr>
    </path>
    <path
        android:fillColor="#FFFFFF"
        android:fillType="nonZero"
        android:pathData="M65.3,45.828l3.8,-6.6c0.2,-0.4 0.1,-0.9 -0.3,-1.1c-0.4,-0.2 -0.9,-0.1 -1.1,0.3l-3.9,6.7c-6.3,-2.8 -13.4,-2.8 -19.7,0l-3.9,-6.7c-0.2,-0.4 -0.7,-0.5 -1.1,-0.3C38.8,38.328 38.7,38.828 38.9,39.228l3.8,6.6C36.2,49.428 31.7,56.028 31,63.928h46C76.3,56.028 71.8,49.428 65.3,45.828zM43.4,57.328c-0.8,0 -1.5,-0.5 -1.8,-1.2c-0.3,-0.7 -0.1,-1.5 0.4,-2.1c0.5,-0.5 1.4,-0.7 2.1,-0.4c0.7,0.3 1.2,1 1.2,1.8C45.3,56.528 44.5,57.328 43.4,57.328L43.4,57.328zM64.6,57.328c-0.8,0 -1.5,-0.5 -1.8,-1.2s-0.1,-1.5 0.4,-2.1c0.5,-0.5 1.4,-0.7 2.1,-0.4c0.7,0.3 1.2,1 1.2,1.8C66.5,56.528 65.6,57.328 64.6,57.328L64.6,57.328z"
        android:strokeWidth="1"
        android:strokeColor="#00000000" />
</vector>
```

`app/src/main/res/drawable/ic_launcher_background.xml`:

```xml
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="108dp"
    android:height="108dp"
    android:viewportWidth="108"
    android:viewportHeight="108">
    <path
        android:fillColor="#3DDC84"
        android:pathData="M0,0h108v108h-108z" />
    <path
        android:fillColor="#00000000"
        android:pathData="M9,0L9,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,0L19,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M29,0L29,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M39,0L39,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M49,0L49,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M59,0L59,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M69,0L69,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M79,0L79,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M89,0L89,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M99,0L99,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,9L108,9"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,19L108,19"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,29L108,29"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,39L108,39"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,49L108,49"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,59L108,59"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,69L108,69"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,79L108,79"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,89L108,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,99L108,99"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,29L89,29"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,39L89,39"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,49L89,49"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,59L89,59"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,69L89,69"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,79L89,79"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M29,19L29,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M39,19L39,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M49,19L49,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M59,19L59,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M69,19L69,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M79,19L79,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
</vector>

```

`app/src/main/res/layout/activity_main.xml`:

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity">

    <Button
        android:id="@+id/bypass"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:onClick="onClick"
        android:text="bypass"
        android:textAllCaps="false"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

    <Button
        android:id="@+id/bypass_test"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginTop="30dp"
        android:onClick="onClick"
        android:text="test"
        android:textAllCaps="false"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/bypass" />

    <Button
        android:id="@+id/bypass_dlfcn_test"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginTop="30dp"
        android:onClick="onClick"
        android:text="test_bypass_dlfcn"
        android:textAllCaps="false"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/bypass_test" />

</androidx.constraintlayout.widget.ConstraintLayout>
```

`app/src/main/res/mipmap-anydpi-v26/ic_launcher.xml`:

```xml
<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
    <background android:drawable="@drawable/ic_launcher_background" />
    <foreground android:drawable="@drawable/ic_launcher_foreground" />
</adaptive-icon>
```

`app/src/main/res/mipmap-anydpi-v26/ic_launcher_round.xml`:

```xml
<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
    <background android:drawable="@drawable/ic_launcher_background" />
    <foreground android:drawable="@drawable/ic_launcher_foreground" />
</adaptive-icon>
```

`app/src/main/res/values-night/themes.xml`:

```xml
<resources xmlns:tools="http://schemas.android.com/tools">
    <!-- Base application theme. -->
    <style name="Theme.Bypass_hidden_api_restriction" parent="Theme.MaterialComponents.DayNight.DarkActionBar">
        <!-- Primary brand color. -->
        <item name="colorPrimary">@color/purple_200</item>
        <item name="colorPrimaryVariant">@color/purple_700</item>
        <item name="colorOnPrimary">@color/black</item>
        <!-- Secondary brand color. -->
        <item name="colorSecondary">@color/teal_200</item>
        <item name="colorSecondaryVariant">@color/teal_200</item>
        <item name="colorOnSecondary">@color/black</item>
        <!-- Status bar color. -->
        <item name="android:statusBarColor" tools:targetApi="l">?attr/colorPrimaryVariant</item>
        <!-- Customize your theme here. -->
    </style>
</resources>
```

`app/src/main/res/values/colors.xml`:

```xml
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="purple_200">#FFBB86FC</color>
    <color name="purple_500">#FF6200EE</color>
    <color name="purple_700">#FF3700B3</color>
    <color name="teal_200">#FF03DAC5</color>
    <color name="teal_700">#FF018786</color>
    <color name="black">#FF000000</color>
    <color name="white">#FFFFFFFF</color>
</resources>
```

`app/src/main/res/values/strings.xml`:

```xml
<resources>
    <string name="app_name">bypass_hidden_api_restriction</string>
</resources>
```

`app/src/main/res/values/themes.xml`:

```xml
<resources xmlns:tools="http://schemas.android.com/tools">
    <!-- Base application theme. -->
    <style name="Theme.Bypass_hidden_api_restriction" parent="Theme.MaterialComponents.DayNight.DarkActionBar">
        <!-- Primary brand color. -->
        <item name="colorPrimary">@color/purple_500</item>
        <item name="colorPrimaryVariant">@color/purple_700</item>
        <item name="colorOnPrimary">@color/white</item>
        <!-- Secondary brand color. -->
        <item name="colorSecondary">@color/teal_200</item>
        <item name="colorSecondaryVariant">@color/teal_700</item>
        <item name="colorOnSecondary">@color/black</item>
        <!-- Status bar color. -->
        <item name="android:statusBarColor" tools:targetApi="l">?attr/colorPrimaryVariant</item>
        <!-- Customize your theme here. -->
    </style>
</resources>
```

`build.gradle`:

```gradle
// Top-level build file where you can add configuration options common to all sub-projects/modules.
buildscript {
    repositories {
        google()
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:7.0.3'
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:1.4.32"

        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}
```

`bypassRestriction/build.gradle`:

```gradle
plugins {
    id 'com.android.library'
}

apply from: '../publish.gradle'

android {
    compileSdk 30
    buildToolsVersion "30.0.3"

    defaultConfig {
        minSdk 14
        targetSdk 30

        consumerProguardFiles "consumer-rules.pro"
        externalNativeBuild {
            cmake {
                cppFlags ""
                arguments '-DANDROID_STL=c++_shared'
            }
        }
        ndk {
            abiFilters "armeabi-v7a", "arm64-v8a"
        }
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    externalNativeBuild {
        cmake {
            path "src/main/cpp/CMakeLists.txt"
            version "3.10.2"
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    buildFeatures {
        prefabPublishing true
    }

    prefab {
        bypassRestriction {
            headers "src/main/cpp/include"
        }
    }

}

dependencies {
}
```

`bypassRestriction/proguard-rules.pro`:

```pro
# Add project specific ProGuard rules here.
# You can control the set of applied configuration files using the
# proguardFiles setting in build.gradle.
#
# For more details, see
#   http://developer.android.com/guide/developing/tools/proguard.html

# If your project uses WebView with JS, uncomment the following
# and specify the fully qualified class name to the JavaScript interface
# class:
#-keepclassmembers class fqcn.of.javascript.interface.for.webview {
#   public *;
#}

# Uncomment this to preserve the line number information for
# debugging stack traces.
#-keepattributes SourceFile,LineNumberTable

# If you keep the line number information, uncomment this to
# hide the original source file name.
#-renamesourcefileattribute SourceFile
```

`bypassRestriction/src/main/AndroidManifest.xml`:

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.wind.hiddenapi.bypass">

</manifest>
```

`bypassRestriction/src/main/cpp/CMakeLists.txt`:

```txt
cmake_minimum_required(VERSION 3.10.2)

project("bypassRestriction")

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fvisibility=hidden")
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -fvisibility=hidden")

set(bypass_dlfcn_root_dir ${CMAKE_CURRENT_SOURCE_DIR}/bypass_dl)
add_subdirectory(${bypass_dlfcn_root_dir} bypass_dlfcn)

add_library(bypassRestriction
        SHARED
        main.cpp)

include_directories(
        include/
)

find_library(log-lib
        log)

target_link_libraries(bypassRestriction
        bypass_dlfcn
        ${log-lib})
```

`bypassRestriction/src/main/cpp/bypass_dl/CMakeLists.txt`:

```txt
cmake_minimum_required(VERSION 3.10.2)

project("bypass_dlfcn")

set(bypass_dlfcn_sources
        ${CMAKE_CURRENT_SOURCE_DIR}/bypass_dlopen.c
        )

include_directories(
        ../include/
)

add_library(
        bypass_dlfcn
        STATIC    # You can change it to SHARED, to build an seperate so into the apk
        ${bypass_dlfcn_sources}
)

target_link_libraries(
        bypass_dlfcn
        log)
```

`bypassRestriction/src/main/cpp/bypass_dl/bypass_dlopen.c`:

```c
//
// Created by Windysha on 2022/2/12.
//

#include <link.h>
#include <dlfcn.h>
#include <string.h>
#include <sys/system_properties.h>
#include <android/api-level.h>
#include <stdio.h>
#include "bypass_dlopen.h"
#include "../utils/common.h"

typedef void *(*loader_dlopen_func)(const char *filename, int flag, void *address);

extern __attribute__((weak))
int dl_iterate_phdr(int (*__callback)(struct dl_phdr_info *, size_t, void *), void *__data);

typedef struct {
    const char *elf_path;
    void *address;
} dl_phdr_data;

static inline int32_t get_android_api_level() {
    static int api_level = -1;
    if (api_level < 0) {
        api_level = android_get_device_api_level();
    }
    return api_level;
}

static int dl_iterate_callback(struct dl_phdr_info *info, size_t size, void *data) {
    dl_phdr_data *target = (dl_phdr_data *) (data);
    if (info->dlpi_addr != 0 && strstr(info->dlpi_name, target->elf_path)) {
        target->address = (void *) info->dlpi_addr;
        return 1;
    }
    return 0;
}

static void *get_lib_art_base_address() {
    static void *art_base_address = NULL;
    if (art_base_address != NULL) {
        return art_base_address;
    }
    if (dl_iterate_phdr == NULL) {
        return NULL;
    }
    const char *art_name = "libart.so";
    const char *so_prefix;
    int level = get_android_api_level();
    if (level >= ANDROID_R) {
        so_prefix = kApexArtNsLibDir;
    } else if (level == ANDROID_Q) {
        so_prefix = kApexLibDir;
    } else {
        so_prefix = kSystemLibDir;
    }
    char target_so_path[256];
    memset(target_so_path, 0, sizeof(target_so_path));
    sprintf(target_so_path, "%s%s", so_prefix, art_name);

    dl_phdr_data data;
    data.elf_path = target_so_path;
    data.address = NULL;
    dl_iterate_phdr(dl_iterate_callback, &data);
    art_base_address = data.address;

    return art_base_address;
}

__attribute__ ((visibility ("default")))
void *bypass_dlopen(const char *filename, int flag) {
    if (get_android_api_level() < ANDROID_N) {
        return dlopen(filename, flag);
    }
    void *handle = dlopen("libdl.so", RTLD_NOW);
    loader_dlopen_func loader_dlopen = (loader_dlopen_func) (dlsym(handle, "__loader_dlopen"));

    void *result_handle = loader_dlopen(filename, flag, (void *) dlerror);
    if (result_handle != NULL) return result_handle;

    void *called_adddres = get_lib_art_base_address();
    LOGI("dlopen called_adddres ->  [%p]", called_adddres);
    if (called_adddres == NULL) {
        return NULL;
    }

    return loader_dlopen(filename, flag, called_adddres);
}
```

`bypassRestriction/src/main/cpp/include/bypass_dlopen.h`:

```h
//
// Created by Windysha.
//


#pragma once

#ifdef __cplusplus
extern "C" {
#endif

void *bypass_dlopen(const char *filename, int flag);

#ifdef __cplusplus
}
#endif
```

`bypassRestriction/src/main/cpp/main.cpp`:

```cpp

//
// Created by WindySha(https://github.com/WindySha) on 2021/7/10.
//

#include <jni.h>
#include <string>
#include <android/api-level.h>
#include <mutex>
#include <dlfcn.h>
#include "utils/utils.h"
#include "utils/ScopedLocalRef.h"
#include "bypass_dlopen.h"

static void *(*DecodeJObject)(void *, void *) = nullptr;
static void *(*FindClassMethod)(void *, std::string_view, std::string_view, size_t) = nullptr;
static void *(*FindClassMethod_P)(void *,
                                  const bypass::StringPiece &,
                                  const bypass::StringPiece &,
                                  size_t) = nullptr;  //Only For Android P
static void *(*FindDeclaredDirectMethodByName)(void *, std::string_view, size_t) = nullptr;
static void *(*FindDeclaredVirtualMethodByName)(void *, std::string_view, size_t) = nullptr;

// Mutex protecting static variables
static std::mutex g_has_inited_mutex;
static bool g_has_inited = false;

static const auto android_api_level = android_get_device_api_level();  /* NOLINT */

static void EnsureInitialized() {
    if (g_has_inited) {
        return;
    }
    std::lock_guard<std::mutex> guard(g_has_inited_mutex);
    if (g_has_inited) {
        return;
    }

    void *art_so_handle = bypass_dlopen("libart.so", RTLD_NOW);

    const char *findClassMethod_name;
    if (art_so_handle != nullptr) {
        if (android_api_level == ANDROID_P) {
            findClassMethod_name =
                    "_ZN3art6mirror5Class15FindClassMethodERKNS_11StringPieceES4_NS_11PointerSizeE";
            void *address = dlsym(art_so_handle, findClassMethod_name);
            FindClassMethod_P = reinterpret_cast<decltype(FindClassMethod_P)>(address);
        } else {
            findClassMethod_name =
                    "_ZN3art6mirror5Class15FindClassMethodENSt3__117basic_string_viewIcNS2_11char_traitsIcEEEES6_NS_11PointerSizeE";
            void *address = dlsym(art_so_handle, findClassMethod_name);
            FindClassMethod = reinterpret_cast<decltype(FindClassMethod)>(address);
        }
    }

    const char *decodeJObject_name = "_ZNK3art6Thread13DecodeJObjectEP8_jobject";
    DecodeJObject = reinterpret_cast<decltype(DecodeJObject)>(dlsym(
        art_so_handle,
        decodeJObject_name));

    g_has_inited = true;
}

static void *FindClassMethodCompat(void *mirrorClass,
                                   std::string name,
                                   std::string signature,
                                   size_t pointer_size) {
    void *art_method = nullptr;
    if (android_api_level == ANDROID_P) {
        if (FindClassMethod_P != nullptr) {
            art_method = FindClassMethod_P(mirrorClass,
                                           bypass::StringPiece(name.c_str()),
                                           bypass::StringPiece(signature.c_str()),
                                           pointer_size);
        }
    } else {
        if (FindClassMethod != nullptr) {
            art_method = FindClassMethod(mirrorClass,
                                         name,
                                         signature,
                                         pointer_size);
        }
    }
    CHECK_NOT_NULL_RETURN(art_method)

    // If FindClassMethod is blocked by Google in the future, try to use FindDeclaredDirectMethodByName or FindDeclaredVirtualMethodByName
    // So, you know, the following code will not be executed at current time.
    void *art_so_handle = bypass_dlopen("libart.so", RTLD_NOW);
    if (FindDeclaredDirectMethodByName == nullptr && art_so_handle != nullptr) {
        const char *FindDeclaredDirectMethodByName_sig =
            "_ZN3art6mirror5Class30FindDeclaredDirectMethodByNameENSt3__117basic_string_viewIcNS2_11char_traitsIcEEEENS_11PointerSizeE";
        FindDeclaredDirectMethodByName =
            reinterpret_cast<decltype(FindDeclaredDirectMethodByName)>(dlsym(art_so_handle,
                                                                                FindDeclaredDirectMethodByName_sig));
    }
    if (FindDeclaredDirectMethodByName != nullptr) {
        art_method = FindDeclaredDirectMethodByName(mirrorClass, name, pointer_size);
        CHECK_NOT_NULL_RETURN(art_method)
    }

    if (FindDeclaredVirtualMethodByName == nullptr && art_so_handle != nullptr) {
        const char *FindDeclaredVirtualMethodByName_sig =
            "_ZN3art6mirror5Class31FindDeclaredVirtualMethodByNameENSt3__117basic_string_viewIcNS2_11char_traitsIcEEEENS_11PointerSizeE";
        FindDeclaredVirtualMethodByName =
            reinterpret_cast<decltype(FindDeclaredVirtualMethodByName)>(dlsym(art_so_handle,
                                                                                 FindDeclaredVirtualMethodByName_sig));
    }
    if (FindDeclaredVirtualMethodByName != nullptr) {
        art_method = FindDeclaredVirtualMethodByName(mirrorClass, name, pointer_size);
        CHECK_NOT_NULL_RETURN(art_method)
    }
    return art_method;
}

static void *GetCurrentThread(JNIEnv *env) {
    ScopedLocalRef<jclass> thread_class(env, env->FindClass("java/lang/Thread"));
    static jmethodID currentThread_id =
        env->GetStaticMethodID(thread_class.get(), "currentThread", "()Ljava/lang/Thread;");
    ScopedLocalRef<jobject>
        current_thread(env, env->CallStaticObjectMethod(thread_class.get(), currentThread_id));
    static jfieldID nativePeer_fid = env->GetFieldID(thread_class.get(), "nativePeer", "J");

    if (env->ExceptionCheck()) {
        env->ExceptionDescribe();
        env->ExceptionClear();
    } else {
        jlong thread_id = env->GetLongField(current_thread.get(), nativePeer_fid);
        if (env->ExceptionCheck()) {
            env->ExceptionDescribe();
            env->ExceptionClear();
        } else {
            return reinterpret_cast<void *>(thread_id);
        }
    }

    //  Thread.nativePeer is in the graylist, if it cannot be accessed in the future, use the following method:
    auto *mirrorEnv = reinterpret_cast<FakeJNIEnv *>(env);
    return mirrorEnv->self_;
}

extern "C"
JNIEXPORT void JNICALL
Java_com_wind_hiddenapi_bypass_HiddenApiBypass_setHiddenApiExemptions(JNIEnv *env,
                                                                      jclass clazz,
                                                                      jobjectArray signature_prefixes) {
    if (android_api_level < ANDROID_P) {
        LOGI("Device do not need to bypass hidden api restriction.");
        return;
    }
    EnsureInitialized();

    if (DecodeJObject == nullptr) {
        LOGE("DecodeJObject function is null !!!");
        return;
    }

    const char *VMRuntime_class_name = "dalvik/system/VMRuntime";
    ScopedLocalRef<jclass> vmRumtime_class(env, env->FindClass(VMRuntime_class_name));
    if (!JNIExceptionClearAndDescribe(env, "Find VMRuntime class failed !!!", "")) {
        return;
    }

    auto current_thread = GetCurrentThread(env);
    void *VMRuntime_mirror_class_obj = DecodeJObject(current_thread, vmRumtime_class.get());
    if (VMRuntime_mirror_class_obj == nullptr) {
        LOGE("Decode VMRuntime jclass to mirror::class failed !!!");
        return;
    }

    size_t pointer_size = sizeof(void *);
    // Find the jmethodId of VMRuntime.getRuntime()
    void *getRuntime_art_method = FindClassMethodCompat(VMRuntime_mirror_class_obj,
                                                        "getRuntime",
                                                        "()Ldalvik/system/VMRuntime;",
                                                        pointer_size);
    if (getRuntime_art_method == nullptr) {
        LOGE("VMRuntime.getRuntime() method cannot be founded !!!");
        return;
    }
    ScopedLocalRef<jobject> VMRuntime_instance(env,
                                               env->CallStaticObjectMethod(vmRumtime_class.get(),
                                                                           reinterpret_cast<jmethodID>(getRuntime_art_method)));
    if (!JNIExceptionClearAndDescribe(env, "Call VMRuntime.getRuntime() method failed !!!", "")) {
        return;
    }

    // Find the jmethodId of VMRuntime.setHiddenApiExemptions()
    void *setHiddenApiExemptions_art_method = FindClassMethodCompat(VMRuntime_mirror_class_obj,
                                                                    "setHiddenApiExemptions",
                                                                    "([Ljava/lang/String;)V",
                                                                    pointer_size);
    if (setHiddenApiExemptions_art_method == nullptr) {
        LOGE("VMRuntime.setHiddenApiExemptions() method cannot be founded !!!");
        return;
    }

    env->CallVoidMethod(VMRuntime_instance.get(),
                        reinterpret_cast<jmethodID>(setHiddenApiExemptions_art_method),
                        signature_prefixes);
    if (!JNIExceptionClearAndDescribe(env,
                                      "Call VMRuntime.setHiddenApiExemptions() method failed !!!",
                                      "")) {
        return;
    }
    LOGI("Bypass Hidden Api Restriction Succeed.");
}
```

`bypassRestriction/src/main/cpp/utils/ScopedLocalRef.h`:

```h

#pragma once

#include "jni.h"
#include <stddef.h>

template<typename T>
class ScopedLocalRef {
public:
    ScopedLocalRef(JNIEnv *env, T localRef) : mEnv(env), mLocalRef(localRef) {
    }

    ~ScopedLocalRef() {
        reset();
    }

    void reset(T ptr = NULL) {
        if (ptr != mLocalRef) {
            if (mLocalRef != NULL) {
                mEnv->DeleteLocalRef(mLocalRef);
            }
            mLocalRef = ptr;
        }
    }

    T release() __attribute__((warn_unused_result)) {
        T localRef = mLocalRef;
        mLocalRef = NULL;
        return localRef;
    }

    T get() const {
        return mLocalRef;
    }

private:
    JNIEnv *mEnv;
    T mLocalRef;

    // Disallow copy and assignment.
    ScopedLocalRef(const ScopedLocalRef &);
    void operator=(const ScopedLocalRef &);
};

```

`bypassRestriction/src/main/cpp/utils/common.h`:

```h
//
// Created by Windysha on 2022/2/12.
//
#pragma
#include <android/log.h>

#define ANDROID_N                       24
#define ANDROID_P                       28
#define ANDROID_Q                       29
#define ANDROID_R                       30

#define LOG_TAG  "Bypass_Restriction"
#define LOGI(...) __android_log_print(ANDROID_LOG_INFO,  LOG_TAG, __VA_ARGS__)
#define LOGE(...) __android_log_print(ANDROID_LOG_ERROR,  LOG_TAG, __VA_ARGS__)

#ifdef __LP64__
const char *const kSystemLibDir = "/system/lib64/";
const char *const kApexLibDir = "/apex/com.android.runtime/lib64/";
const char *const kApexArtNsLibDir = "/apex/com.android.art/lib64/";
#else
const char *const kSystemLibDir = "/system/lib/";
const char *const kApexLibDir = "/apex/com.android.runtime/lib/";
const char *const kApexArtNsLibDir = "/apex/com.android.art/lib/";
#endif
```

`bypassRestriction/src/main/cpp/utils/utils.h`:

```h
//
// Created by WindySha on 2021/7/7.
//

#pragma

#include <jni.h>
#include "common.h"

#define CHECK_NOT_NULL_RETURN(__x)  \
    if (__x) {           \
        return (__x);               \
    }

struct FakeJNIEnv {
    void *vtb_function;
    void *const self_;  // Link to Thread::Current().    Thread* const self_;
    void *const vm_;  // The invocation interface JavaVM.    JavaVMExt* const vm_;
};

template<typename ...Args>
static bool JNIExceptionClearAndDescribe(JNIEnv *env, const char *format, Args... args) {
    if (env->ExceptionCheck()) {
        env->ExceptionDescribe();
        env->ExceptionClear();
        LOGE(format, args...);
        return false;
    }
    return true;
}

namespace bypass {
class StringPiece {
public:
    StringPiece(const char *str)
        : ptr_(str), length_((str == nullptr) ? 0 : strlen(str)) {}
private:
    const char *ptr_;
    // Length of data.
    size_t length_;
};
}
```

`bypassRestriction/src/main/java/com/wind/hiddenapi/bypass/HiddenApiBypass.java`:

```java
package com.wind.hiddenapi.bypass;

/**
 * @author WindySha (https://github.com/WindySha)
 */
public class HiddenApiBypass {
    static {
        System.loadLibrary("bypassRestriction");
    }

    public static void startBypass() {
        setHiddenApiExemptions(new String[]{"L"});
    }

    /**
     * Sets the list of exemptions from hidden API access enforcement.
     *
     * @param signaturePrefixes A list of signature prefixes. Each item in the list is a prefix match on the type
     *                          signature of a blacklisted API. All matching APIs are treated as if they were on
     *                          the whitelist: access permitted, and no logging..
     */
    public static native void setHiddenApiExemptions(String[] signaturePrefixes);
}
```

`gradle.properties`:

```properties
# Project-wide Gradle settings.
# IDE (e.g. Android Studio) users:
# Gradle settings configured through the IDE *will override*
# any settings specified in this file.
# For more details on how to configure your build environment visit
# http://www.gradle.org/docs/current/userguide/build_environment.html
# Specifies the JVM arguments used for the daemon process.
# The setting is particularly useful for tweaking memory settings.
org.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8
# When configured, Gradle will run in incubating parallel mode.
# This option should only be used with decoupled projects. More details, visit
# http://www.gradle.org/docs/current/userguide/multi_project_builds.html#sec:decoupled_projects
# org.gradle.parallel=true
# AndroidX package structure to make it clearer which packages are bundled with the
# Android operating system, and which are packaged with your app"s APK
# https://developer.android.com/topic/libraries/support-library/androidx-rn
android.useAndroidX=true
# Automatically convert third-party libraries to use AndroidX
android.enableJetifier=true
# Kotlin code style for this project: "official" or "obsolete":
kotlin.code.style=official
```

`gradle/wrapper/gradle-wrapper.properties`:

```properties
#Wed Jul 07 00:41:03 CST 2021
distributionBase=GRADLE_USER_HOME
distributionUrl=https\://services.gradle.org/distributions/gradle-7.0.2-bin.zip
distributionPath=wrapper/dists
zipStorePath=wrapper/dists
zipStoreBase=GRADLE_USER_HOME

```

`gradlew`:

```
#!/usr/bin/env sh

#
# Copyright 2015 the original author or authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

##############################################################################
##
##  Gradle start up script for UN*X
##
##############################################################################

# Attempt to set APP_HOME
# Resolve links: $0 may be a link
PRG="$0"
# Need this for relative symlinks.
while [ -h "$PRG" ] ; do
    ls=`ls -ld "$PRG"`
    link=`expr "$ls" : '.*-> \(.*\)$'`
    if expr "$link" : '/.*' > /dev/null; then
        PRG="$link"
    else
        PRG=`dirname "$PRG"`"/$link"
    fi
done
SAVED="`pwd`"
cd "`dirname \"$PRG\"`/" >/dev/null
APP_HOME="`pwd -P`"
cd "$SAVED" >/dev/null

APP_NAME="Gradle"
APP_BASE_NAME=`basename "$0"`

# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
DEFAULT_JVM_OPTS='"-Xmx64m" "-Xms64m"'

# Use the maximum available, or set MAX_FD != -1 to use that value.
MAX_FD="maximum"

warn () {
    echo "$*"
}

die () {
    echo
    echo "$*"
    echo
    exit 1
}

# OS specific support (must be 'true' or 'false').
cygwin=false
msys=false
darwin=false
nonstop=false
case "`uname`" in
  CYGWIN* )
    cygwin=true
    ;;
  Darwin* )
    darwin=true
    ;;
  MINGW* )
    msys=true
    ;;
  NONSTOP* )
    nonstop=true
    ;;
esac

CLASSPATH=$APP_HOME/gradle/wrapper/gradle-wrapper.jar


# Determine the Java command to use to start the JVM.
if [ -n "$JAVA_HOME" ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
        # IBM's JDK on AIX uses strange locations for the executables
        JAVACMD="$JAVA_HOME/jre/sh/java"
    else
        JAVACMD="$JAVA_HOME/bin/java"
    fi
    if [ ! -x "$JAVACMD" ] ; then
        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
else
    JAVACMD="java"
    which java >/dev/null 2>&1 || die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
fi

# Increase the maximum file descriptors if we can.
if [ "$cygwin" = "false" -a "$darwin" = "false" -a "$nonstop" = "false" ] ; then
    MAX_FD_LIMIT=`ulimit -H -n`
    if [ $? -eq 0 ] ; then
        if [ "$MAX_FD" = "maximum" -o "$MAX_FD" = "max" ] ; then
            MAX_FD="$MAX_FD_LIMIT"
        fi
        ulimit -n $MAX_FD
        if [ $? -ne 0 ] ; then
            warn "Could not set maximum file descriptor limit: $MAX_FD"
        fi
    else
        warn "Could not query maximum file descriptor limit: $MAX_FD_LIMIT"
    fi
fi

# For Darwin, add options to specify how the application appears in the dock
if $darwin; then
    GRADLE_OPTS="$GRADLE_OPTS \"-Xdock:name=$APP_NAME\" \"-Xdock:icon=$APP_HOME/media/gradle.icns\""
fi

# For Cygwin or MSYS, switch paths to Windows format before running java
if [ "$cygwin" = "true" -o "$msys" = "true" ] ; then
    APP_HOME=`cygpath --path --mixed "$APP_HOME"`
    CLASSPATH=`cygpath --path --mixed "$CLASSPATH"`

    JAVACMD=`cygpath --unix "$JAVACMD"`

    # We build the pattern for arguments to be converted via cygpath
    ROOTDIRSRAW=`find -L / -maxdepth 1 -mindepth 1 -type d 2>/dev/null`
    SEP=""
    for dir in $ROOTDIRSRAW ; do
        ROOTDIRS="$ROOTDIRS$SEP$dir"
        SEP="|"
    done
    OURCYGPATTERN="(^($ROOTDIRS))"
    # Add a user-defined pattern to the cygpath arguments
    if [ "$GRADLE_CYGPATTERN" != "" ] ; then
        OURCYGPATTERN="$OURCYGPATTERN|($GRADLE_CYGPATTERN)"
    fi
    # Now convert the arguments - kludge to limit ourselves to /bin/sh
    i=0
    for arg in "$@" ; do
        CHECK=`echo "$arg"|egrep -c "$OURCYGPATTERN" -`
        CHECK2=`echo "$arg"|egrep -c "^-"`                                 ### Determine if an option

        if [ $CHECK -ne 0 ] && [ $CHECK2 -eq 0 ] ; then                    ### Added a condition
            eval `echo args$i`=`cygpath --path --ignore --mixed "$arg"`
        else
            eval `echo args$i`="\"$arg\""
        fi
        i=`expr $i + 1`
    done
    case $i in
        0) set -- ;;
        1) set -- "$args0" ;;
        2) set -- "$args0" "$args1" ;;
        3) set -- "$args0" "$args1" "$args2" ;;
        4) set -- "$args0" "$args1" "$args2" "$args3" ;;
        5) set -- "$args0" "$args1" "$args2" "$args3" "$args4" ;;
        6) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" ;;
        7) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" ;;
        8) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" ;;
        9) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" "$args8" ;;
    esac
fi

# Escape application args
save () {
    for i do printf %s\\n "$i" | sed "s/'/'\\\\''/g;1s/^/'/;\$s/\$/' \\\\/" ; done
    echo " "
}
APP_ARGS=`save "$@"`

# Collect all arguments for the java command, following the shell quoting and substitution rules
eval set -- $DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS "\"-Dorg.gradle.appname=$APP_BASE_NAME\"" -classpath "\"$CLASSPATH\"" org.gradle.wrapper.GradleWrapperMain "$APP_ARGS"

exec "$JAVACMD" "$@"

```

`gradlew.bat`:

```bat
@rem
@rem Copyright 2015 the original author or authors.
@rem
@rem Licensed under the Apache License, Version 2.0 (the "License");
@rem you may not use this file except in compliance with the License.
@rem You may obtain a copy of the License at
@rem
@rem      https://www.apache.org/licenses/LICENSE-2.0
@rem
@rem Unless required by applicable law or agreed to in writing, software
@rem distributed under the License is distributed on an "AS IS" BASIS,
@rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
@rem See the License for the specific language governing permissions and
@rem limitations under the License.
@rem

@if "%DEBUG%" == "" @echo off
@rem ##########################################################################
@rem
@rem  Gradle startup script for Windows
@rem
@rem ##########################################################################

@rem Set local scope for the variables with windows NT shell
if "%OS%"=="Windows_NT" setlocal

set DIRNAME=%~dp0
if "%DIRNAME%" == "" set DIRNAME=.
set APP_BASE_NAME=%~n0
set APP_HOME=%DIRNAME%

@rem Resolve any "." and ".." in APP_HOME to make it shorter.
for %%i in ("%APP_HOME%") do set APP_HOME=%%~fi

@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
set DEFAULT_JVM_OPTS="-Xmx64m" "-Xms64m"

@rem Find java.exe
if defined JAVA_HOME goto findJavaFromJavaHome

set JAVA_EXE=java.exe
%JAVA_EXE% -version >NUL 2>&1
if "%ERRORLEVEL%" == "0" goto execute

echo.
echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
echo.
echo Please set the JAVA_HOME variable in your environment to match the
echo location of your Java installation.

goto fail

:findJavaFromJavaHome
set JAVA_HOME=%JAVA_HOME:"=%
set JAVA_EXE=%JAVA_HOME%/bin/java.exe

if exist "%JAVA_EXE%" goto execute

echo.
echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME%
echo.
echo Please set the JAVA_HOME variable in your environment to match the
echo location of your Java installation.

goto fail

:execute
@rem Setup the command line

set CLASSPATH=%APP_HOME%\gradle\wrapper\gradle-wrapper.jar


@rem Execute Gradle
"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %*

:end
@rem End local scope for the variables with windows NT shell
if "%ERRORLEVEL%"=="0" goto mainEnd

:fail
rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
rem the _cmd.exe /c_ return code!
if  not "" == "%GRADLE_EXIT_CONSOLE%" exit 1
exit /b 1

:mainEnd
if "%OS%"=="Windows_NT" endlocal

:omega

```

`publish.gradle`:

```gradle
apply plugin: 'maven-publish'
apply plugin: 'signing'

ext {
    PUBLISH_GROUP_ID = 'io.github.windysha'
    PUBLISH_ARTIFACT_ID = 'bypassHiddenApiRestriction'
    PUBLISH_ARTIFACT_NAME = 'Android Hidden Api Bypass'
    PUBLISH_VERSION_NAME = '1.1.0'

    POM_URL = 'https://github.com/WindySha/bypassHiddenApiRestriction'
    POM_DESCRIPTION = 'This is a library that can bypass the hidden api restriction on Android 9-12.'

    POM_DEVELOPER_ID = 'WindySha'
    POM_DEVELOPER_NAME = 'WindySha'
    POM_DEVELOPER_EMAIL = '819170366@qq.com'
    POM_DEVELOPER_URL = 'https://windysha.github.io/'

    POM_SCM_URL = 'https://github.com/WindySha/bypassHiddenApiRestriction/tree/master'
    POM_SCM_CONNECTION = 'scm:git:https://github.com/WindySha/bypassHiddenApiRestriction.git'
}

task androidSourcesJar(type: Jar) {
    archiveClassifier.set('sources')
    if (project.plugins.findPlugin("com.android.library")) {
        // For Android libraries
        from android.sourceSets.main.java.srcDirs
        from android.sourceSets.main.kotlin.srcDirs
    } else {
        // For pure Kotlin libraries, in case you have them
        from sourceSets.main.java.srcDirs
        from sourceSets.main.kotlin.srcDirs
    }
}

ext["signing.keyId"] = ''
ext["signing.password"] = ''
ext["signing.secretKeyRingFile"] = ''
ext["ossrhUsername"] = ''
ext["ossrhPassword"] = ''

File secretPropsFile = project.rootProject.file('bypass_hidden_api_signing.properties')
if (secretPropsFile.exists()) {
    println "Found secret props file, loading props"
    Properties p = new Properties()
    p.load(new FileInputStream(secretPropsFile))
    p.each { name, value ->
        ext[name] = value
    }
} else {
    println "No props file, loading env vars"
}
publishing {
    publications {
        release(MavenPublication) {
            // The coordinates of the library, being set from variables that
            // we'll set up in a moment
            groupId PUBLISH_GROUP_ID
            artifactId PUBLISH_ARTIFACT_ID
            version PUBLISH_VERSION_NAME

            afterEvaluate {
                artifact tasks.getByName("bundleReleaseAar")
                artifact androidSourcesJar
            }

            // Two artifacts, the `aar` and the sources
//            artifact("$buildDir/outputs/aar/${project.getName()}-release.aar")
//            artifact androidSourcesJar

            // Self-explanatory metadata for the most part
            pom {
                name = PUBLISH_ARTIFACT_NAME
                description = POM_DESCRIPTION
                url = POM_URL
                licenses {
                    license {
                        //协议类型，一般默认Apache License2.0的话不用改：
                        name = 'The Apache License, Version 2.0'
                        url = 'http://www.apache.org/licenses/LICENSE-2.0.txt'
                    }
                }
                developers {
                    developer {
                        id = POM_DEVELOPER_ID
                        name = POM_DEVELOPER_NAME
                        email = POM_DEVELOPER_EMAIL
                        url = POM_DEVELOPER_URL
                    }
                }
                // Version control info, if you're using GitHub, follow the format as seen here
                scm {
                    url = POM_SCM_URL
                    connection = POM_SCM_CONNECTION
                    developerConnection = POM_SCM_CONNECTION
                }
                // A slightly hacky fix so that your POM will include any transitive dependencies
                // that your library builds upon
                withXml {
                    def dependenciesNode = asNode().appendNode('dependencies')

                    project.configurations.implementation.allDependencies.each {
                        def dependencyNode = dependenciesNode.appendNode('dependency')
                        dependencyNode.appendNode('groupId', it.group)
                        dependencyNode.appendNode('artifactId', it.name)
                        dependencyNode.appendNode('version', it.version)
                    }
                }
            }
        }
    }
    repositories {
        maven {
            name = "mavenCentral"
            url = "https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/"

            // The username and password we've fetched earlier
            credentials {
                username ossrhUsername
                password ossrhPassword
            }
        }
    }
}
signing {
    sign publishing.publications
}
//  https://s01.oss.sonatype.org/#stagingRepositories
// publish dst: https://repo.maven.apache.org/maven2/io/github/windysha/bypassHiddenApiRestriction/1.0.2/
```

`settings.gradle`:

```gradle
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()
        mavenCentral()
        jcenter() // Warning: this repository is going to shut down soon
    }
}
rootProject.name = "bypass_hidden_api_restriction"
include ':app'
include ':bypassRestriction'

```