Project Path: arc_gmh5225_NotifyRoutineHijackThread_69occe9m

Source Tree:

```txt
arc_gmh5225_NotifyRoutineHijackThread_69occe9m
├── README.md
├── UC-NotifyRoutineHijack.sln
└── UC-NotifyRoutineHijackKernel
    ├── Source.cpp
    ├── UC-NotifyRoutineHijackKernel.vcxproj
    ├── UC-NotifyRoutineHijackKernel.vcxproj.filters
    └── UC-NotifyRoutineHijackKernel.vcxproj.user

```

`README.md`:

```md
# NotifyRoutineHijackThread
Hijack NotifyRoutine for a kernelmode thread

Showcase: ![](https://i.vgy.me/h8TTRY.gif)

View a write up here: https://www.unknowncheats.me/forum/rainbow-six-siege/501898-kernel-thread-method.html#post3445216

```

`UC-NotifyRoutineHijack.sln`:

```sln

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 16
VisualStudioVersion = 16.0.32413.511
MinimumVisualStudioVersion = 10.0.40219.1
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "UC-NotifyRoutineHijackKernel", "UC-NotifyRoutineHijackKernel\UC-NotifyRoutineHijackKernel.vcxproj", "{4E384C1F-45CD-4ED2-A844-A331C75294E7}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|ARM = Debug|ARM
		Debug|ARM64 = Debug|ARM64
		Debug|x64 = Debug|x64
		Debug|x86 = Debug|x86
		Release|ARM = Release|ARM
		Release|ARM64 = Release|ARM64
		Release|x64 = Release|x64
		Release|x86 = Release|x86
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Debug|ARM.ActiveCfg = Debug|ARM
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Debug|ARM.Build.0 = Debug|ARM
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Debug|ARM.Deploy.0 = Debug|ARM
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Debug|ARM64.ActiveCfg = Debug|ARM64
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Debug|ARM64.Build.0 = Debug|ARM64
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Debug|ARM64.Deploy.0 = Debug|ARM64
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Debug|x64.ActiveCfg = Debug|x64
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Debug|x64.Build.0 = Debug|x64
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Debug|x64.Deploy.0 = Debug|x64
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Debug|x86.ActiveCfg = Debug|Win32
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Debug|x86.Build.0 = Debug|Win32
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Debug|x86.Deploy.0 = Debug|Win32
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Release|ARM.ActiveCfg = Release|ARM
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Release|ARM.Build.0 = Release|ARM
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Release|ARM.Deploy.0 = Release|ARM
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Release|ARM64.ActiveCfg = Release|ARM64
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Release|ARM64.Build.0 = Release|ARM64
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Release|ARM64.Deploy.0 = Release|ARM64
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Release|x64.ActiveCfg = Release|x64
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Release|x64.Build.0 = Release|x64
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Release|x64.Deploy.0 = Release|x64
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Release|x86.ActiveCfg = Release|Win32
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Release|x86.Build.0 = Release|Win32
		{4E384C1F-45CD-4ED2-A844-A331C75294E7}.Release|x86.Deploy.0 = Release|Win32
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {E28E6E36-F638-4F06-B74C-EB1ABE98FD79}
	EndGlobalSection
EndGlobal

```

`UC-NotifyRoutineHijackKernel/Source.cpp`:

```cpp
#include <ntifs.h>
#include <windef.h>
#define RVA(addr, size) ((uintptr_t)((uintptr_t)(addr) + *(PINT)((uintptr_t)(addr) + ((size) - sizeof(INT))) + (size)))


#define ABSOLUTE(wait) (wait)
#define RELATIVE(wait) (-(wait))
#define NANOSECONDS(nanos) \
(((signed __int64)(nanos)) / 100L)

#define MICROSECONDS(micros) \
(((signed __int64)(micros)) * NANOSECONDS(1000L))

#define MILLISECONDS(milli) \
(((signed __int64)(milli)) * MICROSECONDS(1000L))

#define SECONDS(seconds) \
(((signed __int64)(seconds)) * MILLISECONDS(1000L))

typedef struct _SYSTEM_MODULE_ENTRY {
	HANDLE Section;
	PVOID MappedBase;
	PVOID ImageBase;
	ULONG ImageSize;
	ULONG Flags;
	USHORT LoadOrderIndex;
	USHORT InitOrderIndex;
	USHORT LoadCount;
	USHORT OffsetToFileName;
	UCHAR FullPathName[256];
} SYSTEM_MODULE_ENTRY, * PSYSTEM_MODULE_ENTRY;

typedef struct _SYSTEM_MODULE_INFORMATION {
	ULONG Count;
	SYSTEM_MODULE_ENTRY Module[1];
} SYSTEM_MODULE_INFORMATION, * PSYSTEM_MODULE_INFORMATION;

extern "C" {
	NTSTATUS NTAPI ZwQuerySystemInformation(_In_ ULONG SystemInformationClass, _Inout_ PVOID SystemInformation, _In_ ULONG SystemInformationLength, _Out_opt_ PULONG ReturnLength);
};

typedef signed __int64* __fastcall ExReferenceCallBackBlock_t(signed __int64* a1);
typedef signed __int64 __fastcall ExDereferenceCallBackBlock_t(signed __int64* a1, __int64 a2);

NTSTATUS find_kernel_module(const char* moduleName, uintptr_t* moduleStart, size_t* moduleSize) {
	DWORD size = 0x0;
	ZwQuerySystemInformation((0xB), nullptr, size, reinterpret_cast<PULONG>(&size));

	auto listHeader = ExAllocatePool(NonPagedPool, size);

	if (!listHeader)
		return STATUS_MEMORY_NOT_ALLOCATED;


	if (const auto status = ZwQuerySystemInformation((0xB), listHeader, size, reinterpret_cast<PULONG>(&size))) {
		ExFreePoolWithTag(listHeader, 0);
		return status;
	}

	auto currentModule = reinterpret_cast<PSYSTEM_MODULE_INFORMATION>(listHeader)->Module;

	for (size_t i{}; i < reinterpret_cast<PSYSTEM_MODULE_INFORMATION>(listHeader)->Count; ++i, ++currentModule) {
		const auto currentModuleName = reinterpret_cast<const char*>(currentModule->FullPathName + currentModule->OffsetToFileName);
		if (strstr(moduleName, currentModuleName)) {
			*moduleStart = reinterpret_cast<uintptr_t>(currentModule->ImageBase);
			*moduleSize = currentModule->ImageSize;
			ExFreePoolWithTag(listHeader, 0);
			return STATUS_SUCCESS;
		}
	}
	ExFreePoolWithTag(listHeader, 0);
	return STATUS_NOT_FOUND;
}

bool data_compare(const char* pdata, const char* bmask, const char* szmask)
{
	for (; *szmask; ++szmask, ++pdata, ++bmask)
	{
		if (*szmask == ("x")[0] && *pdata != *bmask)
			return false;
	}

	return !*szmask;
}

__forceinline uintptr_t find_pattern(const uintptr_t base, const size_t size, const char* bmask, const char* szmask)
{
	for (size_t i = 0; i < size; ++i)
		if (data_compare(reinterpret_cast<const char*>(base + i), bmask, szmask))
			return base + i;

	return 0;
}

LONG64 ThreadNotifyCallbackDataPtr;
void (*CreateThreadNotifyRoutineOriginal)(HANDLE ProcessId, HANDLE ThreadId, BOOLEAN Create);
void CreateThreadNotifyRoutineHook(HANDLE ProcessId, HANDLE ThreadId, BOOLEAN Create) {
	DbgPrintEx(0, 0, "Enter CreateThreadNotifyRoutineHook\n");
	static int iSkipFirst = 0;
	if (iSkipFirst < 10)
	{
		iSkipFirst++;
		return CreateThreadNotifyRoutineOriginal(ProcessId, ThreadId, Create);
	}

	auto PreviousMode = ExGetPreviousMode();
	if (PreviousMode == UserMode || PreviousMode == MaximumMode) { //maybe also "|| Create" but then it takes loop to start the loop because most CreateThreadNotifyRoutine calls are for create.
		return CreateThreadNotifyRoutineOriginal(ProcessId, ThreadId, Create);
	}

	*(LONG64*)(ThreadNotifyCallbackDataPtr + 8) = (LONG64)CreateThreadNotifyRoutineOriginal;

	LARGE_INTEGER Timeout500MS;
	Timeout500MS.QuadPart = RELATIVE(MILLISECONDS(500));
	DbgPrintEx(0, 0, "Start loop\n");
	while (true)
	{
		//blabal
		KeDelayExecutionThread(KernelMode, FALSE, &Timeout500MS);
		DbgPrintEx(0, 0, "+\n");
	}
}

NTSTATUS DriverStart() {
	size_t NtKrlSize = 0;
	uintptr_t NtKrlBase = 0;
	auto ntstatus = find_kernel_module("ntoskrnl.exe", &NtKrlBase, &NtKrlSize);
	if (NT_SUCCESS(ntstatus))
	{
		auto PspCreateThreadNotifyRoutineInst = (ULONG64)find_pattern(NtKrlBase, NtKrlSize, ("\x48\x8D\x0D\x00\x00\x00\x00\x45\x33\xC0\x48\x8D\x0C\xD9\x48\x8B\xD7\xE8\x00\x00\x00\x00\x84\xC0\x75\x0C"), ("xxx????xxxxxxxxxxx????xxxx")); //2004 - win11
		if (!PspCreateThreadNotifyRoutineInst || !MmIsAddressValid((void*)PspCreateThreadNotifyRoutineInst))
		{
			return STATUS_NOT_FOUND;
		}
		PRTL_RUN_ONCE PspCreateThreadNotifyRoutine = (PRTL_RUN_ONCE)RVA(PspCreateThreadNotifyRoutineInst, 7);
		if (!PspCreateThreadNotifyRoutine || !MmIsAddressValid((void*)PspCreateThreadNotifyRoutine))
		{
			return STATUS_NOT_FOUND + 1;
		}

		auto ExReferenceCallBackBlockInst = (ULONG64)find_pattern(NtKrlBase, NtKrlSize, ("\xE8\x00\x00\x00\x00\x48\x8B\xE8\x48\x85\xC0\x74\x66\x48\x8B\x40\x08\x4D\x8B\xC4\x48\x8B\x4D\x10"), ("x????xxxxxxxxxxxxxxxxxxx")); //2004 - win11
		if (!ExReferenceCallBackBlockInst || !MmIsAddressValid((void*)ExReferenceCallBackBlockInst))
		{
			return STATUS_NOT_FOUND + 2;
		}
		ExReferenceCallBackBlock_t* ExReferenceCallBackBlock = (ExReferenceCallBackBlock_t*)RVA(ExReferenceCallBackBlockInst, 5);
		if (!ExReferenceCallBackBlock || !MmIsAddressValid((void*)ExReferenceCallBackBlock))
		{
			return STATUS_NOT_FOUND + 3;
		}

		auto ExDereferenceCallBackBlockInst = (ULONG64)find_pattern(NtKrlBase, NtKrlSize, ("\x8B\xF8\xE8\x00\x00\x00\x00\x48\x8D\x54\x24\x00\x48\x8B\xCE"), ("xxx????xxxx?xxx")); //2004 - win11
		if (!ExDereferenceCallBackBlockInst || !MmIsAddressValid((void*)ExDereferenceCallBackBlockInst))
		{
			return STATUS_NOT_FOUND + 2;
		}
		ExDereferenceCallBackBlockInst += 0x2;

		ExDereferenceCallBackBlock_t* ExDereferenceCallBackBlock = (ExDereferenceCallBackBlock_t*)RVA(ExDereferenceCallBackBlockInst, 5);
		if (!ExDereferenceCallBackBlock || !MmIsAddressValid((void*)ExDereferenceCallBackBlock))
		{
			return STATUS_NOT_FOUND + 3;
		}

		int i = 0;
		while (true)
		{
			if ((unsigned int)i >= 0x40)
			{
				break;
			}
			if (auto Callback = ExReferenceCallBackBlock((signed __int64*)&PspCreateThreadNotifyRoutine->Ptr + i))
			{
				if (!Callback || !MmIsAddressValid((void*)Callback))
				{
					continue;
				}
				else
				{
					ThreadNotifyCallbackDataPtr = (LONG64)Callback;
					auto ThreadCallbackFunctionAddr = *(LONG64*)(ThreadNotifyCallbackDataPtr + 8);
					*(LONG64*)&CreateThreadNotifyRoutineOriginal = ThreadCallbackFunctionAddr;
					*(LONG64*)(ThreadNotifyCallbackDataPtr + 8) = (LONG64)&CreateThreadNotifyRoutineHook;

					ExDereferenceCallBackBlock((signed __int64*)&PspCreateThreadNotifyRoutine->Ptr + i, (__int64)Callback);
					DbgPrintEx(0, 0, "CreateThreadNotifyRoutine Hooked\n");
					return STATUS_SUCCESS;
				}
			}
			i++;
		}
	}
	return STATUS_UNSUCCESSFUL;
}
```

`UC-NotifyRoutineHijackKernel/UC-NotifyRoutineHijackKernel.vcxproj`:

```vcxproj
<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="12.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM">
      <Configuration>Debug</Configuration>
      <Platform>ARM</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM">
      <Configuration>Release</Configuration>
      <Platform>ARM</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|ARM64">
      <Configuration>Debug</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|ARM64">
      <Configuration>Release</Configuration>
      <Platform>ARM64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <ProjectGuid>{4E384C1F-45CD-4ED2-A844-A331C75294E7}</ProjectGuid>
    <TemplateGuid>{1bc93793-694f-48fe-9372-81e2b05556fd}</TemplateGuid>
    <TargetFrameworkVersion>v4.5</TargetFrameworkVersion>
    <MinimumVisualStudioVersion>12.0</MinimumVisualStudioVersion>
    <Configuration>Debug</Configuration>
    <Platform Condition="'$(Platform)' == ''">Win32</Platform>
    <RootNamespace>UC_NotifyRoutineHijackKernel</RootNamespace>
    <WindowsTargetPlatformVersion>$(LatestTargetPlatformVersion)</WindowsTargetPlatformVersion>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
    <Driver_SpectreMitigation>false</Driver_SpectreMitigation>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'" Label="Configuration">
    <TargetVersion>Windows10</TargetVersion>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>WindowsKernelModeDriver10.0</PlatformToolset>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>KMDF</DriverType>
    <DriverTargetPlatform>Universal</DriverTargetPlatform>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="PropertySheets">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <PropertyGroup />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
    <EnableInf2cat>false</EnableInf2cat>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'">
    <DebuggerFlavor>DbgengKernelDebugger</DebuggerFlavor>
  </PropertyGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <DriverSign>
      <FileDigestAlgorithm>sha256</FileDigestAlgorithm>
    </DriverSign>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <DriverSign>
      <FileDigestAlgorithm>sha256</FileDigestAlgorithm>
    </DriverSign>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <DriverSign>
      <FileDigestAlgorithm>sha256</FileDigestAlgorithm>
    </DriverSign>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <DriverSign>
      <FileDigestAlgorithm>sha256</FileDigestAlgorithm>
    </DriverSign>
    <ClCompile>
      <LanguageStandard>stdcpplatest</LanguageStandard>
      <SuppressStartupBanner>false</SuppressStartupBanner>
      <TreatWarningAsError>false</TreatWarningAsError>
      <MultiProcessorCompilation>true</MultiProcessorCompilation>
      <BufferSecurityCheck>false</BufferSecurityCheck>
      <ControlFlowGuard>false</ControlFlowGuard>
      <StringPooling>false</StringPooling>
    </ClCompile>
    <Link>
      <EntryPointSymbol>DriverStart</EntryPointSymbol>
    </Link>
    <Link>
      <RandomizedBaseAddress>true</RandomizedBaseAddress>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM'">
    <DriverSign>
      <FileDigestAlgorithm>sha256</FileDigestAlgorithm>
    </DriverSign>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM'">
    <DriverSign>
      <FileDigestAlgorithm>sha256</FileDigestAlgorithm>
    </DriverSign>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|ARM64'">
    <DriverSign>
      <FileDigestAlgorithm>sha256</FileDigestAlgorithm>
    </DriverSign>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|ARM64'">
    <DriverSign>
      <FileDigestAlgorithm>sha256</FileDigestAlgorithm>
    </DriverSign>
  </ItemDefinitionGroup>
  <ItemGroup>
    <Inf Include="UC-NotifyRoutineHijackKernel.inf" />
  </ItemGroup>
  <ItemGroup>
    <FilesToPackage Include="$(TargetPath)" />
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="Source.cpp" />
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
```

`UC-NotifyRoutineHijackKernel/UC-NotifyRoutineHijackKernel.vcxproj.filters`:

```filters
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <Filter Include="Source Files">
      <UniqueIdentifier>{4FC737F1-C7A5-4376-A066-2A32D752A2FF}</UniqueIdentifier>
      <Extensions>cpp;c;cc;cxx;def;odl;idl;hpj;bat;asm;asmx</Extensions>
    </Filter>
    <Filter Include="Header Files">
      <UniqueIdentifier>{93995380-89BD-4b04-88EB-625FBE52EBFB}</UniqueIdentifier>
      <Extensions>h;hpp;hxx;hm;inl;inc;xsd</Extensions>
    </Filter>
    <Filter Include="Resource Files">
      <UniqueIdentifier>{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}</UniqueIdentifier>
      <Extensions>rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx;tiff;tif;png;wav;mfcribbon-ms</Extensions>
    </Filter>
    <Filter Include="Driver Files">
      <UniqueIdentifier>{8E41214B-6785-4CFE-B992-037D68949A14}</UniqueIdentifier>
      <Extensions>inf;inv;inx;mof;mc;</Extensions>
    </Filter>
  </ItemGroup>
  <ItemGroup>
    <Inf Include="UC-NotifyRoutineHijackKernel.inf">
      <Filter>Driver Files</Filter>
    </Inf>
  </ItemGroup>
  <ItemGroup>
    <ClCompile Include="Source.cpp">
      <Filter>Source Files</Filter>
    </ClCompile>
  </ItemGroup>
</Project>
```

`UC-NotifyRoutineHijackKernel/UC-NotifyRoutineHijackKernel.vcxproj.user`:

```user
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <SignMode>Off</SignMode>
  </PropertyGroup>
</Project>
```